============================= test session starts ==============================
platform linux -- Python 3.8.0, pytest-8.3.4, pluggy-1.5.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /home/cc/file/dpsys/deeplearning-sys-pj-master/hw4_extra
collecting ... Using needle backend
collected 112 items / 80 deselected / 32 selected

tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-False-32-8-27-5-4] q.shape1: (4, 5, 27)
q.shape2: (20, 27)
q.shape3: (20, 27)
q.shape4: (4, 5, 27)
q_liner: [[[-0.45098242 -1.8597653  -0.18044859 ...  0.44736135 -0.781291
   -1.3717852 ]
  [-1.5089675  -1.1255506   0.2868886  ... -0.59291077 -4.2512317
    1.4017425 ]
  [-0.5946903   1.0263848  -0.581638   ... -2.404116    1.5132208
   -2.4856858 ]
  [-0.31688586  0.5528781  -0.47048947 ... -3.4016237   0.32389942
    0.792212  ]
  [ 0.5705429  -1.4638315  -1.4060916  ...  0.13239647 -0.5641086
   -0.13941243]]

 [[-0.48622677  0.58664197 -0.8507686  ... -1.5951675   0.925034
   -0.5789255 ]
  [ 0.01250778  0.2590642  -1.4820707  ...  0.27701756  0.50881475
   -1.5133846 ]
  [ 1.8713679  -1.6441334  -0.23689702 ...  1.4759533   0.5980671
    1.3676003 ]
  [-1.7826596  -0.49967113 -0.13877717 ... -2.309278   -0.94425654
   -0.6702585 ]
  [-1.9854672  -0.1258095  -1.3325741  ... -1.2256528   0.3417048
   -1.306887  ]]

 [[ 0.08923486  0.40770042 -1.179379   ... -2.331579    1.0649294
   -1.4443758 ]
  [-0.9717777  -1.0941966   0.10684844 ... -1.3449765   1.5412539
    1.2202598 ]
  [-1.9089527  -0.49968353 -0.7305629  ... -0.31890056  0.05979536
   -0.012014  ]
  [ 0.8310764  -0.54699755 -2.0045779  ...  1.1674607  -0.8113641
    2.528547  ]
  [-0.6054805   0.17777057 -0.3048614  ... -3.8101263   0.3146161
    0.12864286]]

 [[-1.0738883   0.71441406  1.033029   ...  2.1741903  -0.05606913
   -2.216511  ]
  [ 2.8600929   2.6552117   1.1548573  ...  0.5743336  -0.509936
   -1.0215002 ]
  [-0.76020247 -2.2237751  -0.00880839 ... -1.8565425   0.76902795
    1.1017361 ]
  [ 0.56063336  2.2217882   1.0828176  ...  1.7795793  -0.5760088
    1.1000314 ]
  [-0.13495904 -2.4847577  -0.8736485  ... -0.48269773  0.6778818
    1.9465017 ]]]
q.shape5: (4, 5, 256)
q.shape6: (4, 8, 5, 32)
attn_res: [[[[-1.56702673e+00 -4.69070882e-01  1.03741951e-01 ... -4.60170358e-02
    -6.94522083e-01 -1.22118485e+00]
   [ 1.34373820e+00 -1.87690783e+00  1.60815990e+00 ... -2.45289063e+00
     1.03603557e-01 -1.10723637e-01]
   [-2.47734562e-01 -1.11027777e+00  1.28638595e-02 ...  4.38867569e-01
    -4.15985912e-01 -1.17019224e+00]
   [ 3.39969158e-01 -1.05182672e+00  2.34179348e-01 ... -1.05900204e+00
    -1.41077667e-01 -1.40954018e-01]
   [ 6.53426290e-01 -1.67093372e+00  6.73505962e-02 ... -5.32993317e-01
     5.73118389e-01 -2.86715418e-01]]

  [[-1.44017494e+00  9.08970386e-02 -2.84626055e+00 ...  5.18329918e-01
    -8.43587697e-01 -6.35888636e-01]
   [-1.26445794e+00  6.64104521e-01 -1.76885891e+00 ...  8.32142383e-02
    -3.16542238e-02 -4.10565615e-01]
   [-2.91539192e-01  1.08404827e+00  1.07546723e+00 ... -1.51263207e-01
     5.14647365e-03 -9.95201692e-02]
   [-2.60757893e-01  8.69082689e-01  1.88403070e-01 ...  1.17581084e-01
    -3.54902267e-01 -3.79877687e-02]
   [-2.17446494e+00  2.18828678e-01 -2.36754990e+00 ... -2.19945759e-01
    -4.03808087e-01 -9.30400312e-01]]

  [[ 6.01317704e-01  9.55168530e-02 -1.26649458e-02 ...  1.79502094e+00
     2.33753268e-02 -6.73947990e-01]
   [ 2.65852436e-02 -3.43534321e-01 -8.45857382e-01 ...  2.45785379e+00
    -2.19996437e-01 -1.06374931e+00]
   [-8.32648098e-01  7.41541147e-01 -1.91799372e-01 ...  1.82947874e+00
    -3.89758766e-01 -4.07424927e-01]
   [-1.38203096e+00  9.40560341e-01 -1.78886414e-01 ...  1.86726308e+00
    -5.10746241e-01 -3.19562137e-01]
   [ 3.88045996e-01  2.92600513e-01  3.86031151e-01 ...  1.26619840e+00
     1.69493616e-01 -5.40767193e-01]]

  ...

  [[-1.51166642e+00  7.55854130e-01 -5.82134008e-01 ... -1.82383788e+00
    -1.76628661e+00 -1.22697961e+00]
   [-6.25697851e-01  8.96329403e-01  4.85139132e-01 ... -9.24069583e-02
     2.77800620e-01 -6.17886186e-01]
   [-6.81496263e-01  1.07175970e+00  1.15158892e+00 ...  1.92329419e+00
     9.19528306e-02 -2.62070251e+00]
   [-6.14558876e-01  1.02183807e+00  1.02718234e+00 ...  1.80180418e+00
     2.71175832e-01 -2.35579133e+00]
   [-1.31311369e+00 -3.58441889e-01  1.10824716e+00 ... -1.40534306e+00
    -2.32291698e+00 -4.88947928e-02]]

  [[-4.93589699e-01  3.42095822e-01  5.43111265e-01 ... -1.15608239e+00
     2.19779491e-01 -9.57073867e-02]
   [-2.96260691e+00  4.39988405e-01  2.08290172e+00 ... -8.37974072e-01
    -1.24943292e+00  3.87533605e-01]
   [ 8.92996788e-01  7.83096492e-01  4.43976194e-01 ...  8.27526450e-01
     2.33507872e-01  9.29447711e-01]
   [ 5.25755703e-01  5.09026051e-02  3.85629952e-01 ...  1.45974302e+00
     1.21113253e+00  1.25302744e+00]
   [ 4.43685055e-01  1.95801958e-01  3.36557090e-01 ...  3.51673007e-01
     1.07864046e+00  7.42618382e-01]]

  [[-3.36625367e-01 -1.61177158e-01 -1.29719317e-01 ... -1.91846287e+00
    -8.95335913e-01  1.82528055e+00]
   [-6.38334990e-01 -1.14805508e+00  1.17623675e+00 ... -1.20375454e+00
    -6.50162339e-01  2.69352406e-01]
   [-1.35917664e-02 -6.40449643e-01  1.36864114e+00 ... -1.23321176e-01
    -1.20484984e+00 -1.66842222e-01]
   [-1.55946827e+00 -1.42975676e+00 -6.58733368e-01 ... -2.78247857e+00
     1.79346740e-01  7.02253282e-01]
   [-1.51875213e-01 -9.10536766e-01  8.98156106e-01 ... -3.90620232e-01
    -6.59721494e-01 -2.62063622e-01]]]


 [[[ 1.02128386e+00  1.89331222e+00 -1.82447994e+00 ... -1.72148481e-01
     1.56875062e+00  1.20214224e+00]
   [-1.19669187e+00  9.87060785e-01  1.21226728e-01 ... -2.09882426e+00
     1.88477015e+00 -3.89605641e-01]
   [-5.58194458e-01 -1.40627638e-01 -5.69544911e-01 ... -1.43428421e+00
     1.63414073e+00  8.84232342e-01]
   [-5.89181900e-01  1.16819477e+00 -4.85370338e-01 ... -1.57468772e+00
     1.79752564e+00  1.40145093e-01]
   [-6.41471267e-01  1.22276855e+00 -3.73080581e-01 ... -1.61741710e+00
     1.81115067e+00  9.81783867e-03]]

  [[-4.79137063e-01  1.46417272e+00  8.48199725e-02 ...  1.29226327e+00
    -3.63881230e-01  1.11753607e+00]
   [-6.17801666e-01  5.56015849e-01 -4.82818067e-01 ...  8.43796909e-01
    -8.57671320e-01  7.31076896e-01]
   [-1.96516767e-01  1.30504155e+00 -7.34060258e-02 ...  1.39488995e+00
    -5.56907475e-01  1.10439324e+00]
   [-5.05975485e-01  1.20754242e+00 -5.32435477e-02 ...  1.16702330e+00
    -4.99629855e-01  9.78694141e-01]
   [-5.28654695e-01  1.49967635e+00 -1.44985661e-01 ...  1.10563707e+00
    -4.28476721e-01  1.09400499e+00]]

  [[-5.45800179e-02  1.28369570e+00 -9.64088917e-01 ... -1.96408182e-01
     1.55757070e+00 -9.02773023e-01]
   [-1.57994127e+00 -7.99720883e-01  9.62946355e-01 ... -1.91509748e+00
     6.81343496e-01 -8.66802454e-01]
   [-4.07678187e-01  1.42936516e+00 -1.05495727e+00 ...  1.24318564e+00
     1.59017992e+00 -1.15751946e+00]
   [-2.10425591e+00 -1.42341852e+00  1.12815046e+00 ... -3.52821803e+00
     8.19252193e-01 -1.23219848e+00]
   [-5.55289626e-01  7.36188531e-01 -1.09066558e+00 ... -2.29375526e-01
     1.67534566e+00 -1.63957262e+00]]

  ...

  [[ 1.78766823e+00  1.04978013e+00 -5.62477410e-01 ... -2.73860663e-01
    -1.20623159e+00 -1.13509858e+00]
   [ 6.72967553e-01 -5.88333786e-01  7.26465434e-02 ...  2.06838536e+00
    -6.69027746e-01 -4.55583483e-01]
   [ 7.03347623e-01 -3.22052330e-01  7.63181821e-02 ...  5.19870758e-01
    -1.65682340e+00  7.49998808e-01]
   [ 1.76716125e+00  1.03830993e+00 -5.32337368e-01 ... -2.81604230e-01
    -1.18445826e+00 -1.15401649e+00]
   [ 1.74972701e+00  1.02007866e+00 -5.36142588e-01 ... -2.68191516e-01
    -1.19312465e+00 -1.10187018e+00]]

  [[-1.38562632e+00  4.97253358e-01 -2.32874918e+00 ... -1.11612618e+00
    -2.11440587e+00  5.38027167e-01]
   [-1.36788082e+00  3.81446406e-02 -8.71632516e-01 ... -1.30501270e+00
     1.16324496e+00 -3.64410400e-01]
   [-1.41172504e+00  3.60568464e-01 -2.05526400e+00 ... -7.84336925e-01
    -1.22450542e+00  6.37136221e-01]
   [-1.22785103e+00  1.13737643e+00 -1.04531932e+00 ... -3.15498114e-02
    -4.63567436e-01  7.97720194e-01]
   [-1.20292890e+00  3.48198861e-01 -1.74205828e+00 ... -1.10957623e+00
    -8.67623448e-01  1.73768818e-01]]

  [[-2.29939491e-01 -7.30436504e-01  1.43328142e+00 ... -1.49916863e+00
    -6.26002610e-01  1.82993054e-01]
   [-1.69371414e+00  2.34341836e+00  7.66104400e-01 ...  4.71501976e-01
     2.19430208e-01  2.05184984e+00]
   [ 5.09898305e-01 -1.23520374e+00  1.13940799e+00 ... -4.47104990e-01
     1.90690666e-01 -4.49922234e-01]
   [-6.20306492e-01  2.81837672e-01  1.09023380e+00 ...  2.04171181e+00
     5.31314671e-01  5.88145137e-01]
   [ 1.53559834e-01 -7.34195948e-01  1.03098559e+00 ...  1.24604261e+00
     6.45786881e-01 -1.56373143e-01]]]


 [[[ 2.17031822e-01 -8.93665254e-01  4.79319245e-01 ... -5.98767519e-01
    -5.98687418e-02 -3.95329803e-01]
   [ 5.09882092e-01 -4.08282489e-01  6.92143440e-01 ... -6.03563786e-01
    -9.47639346e-03 -4.23601627e-01]
   [ 8.53448629e-01 -1.96952188e+00 -1.92701906e-01 ... -1.49076462e-01
     1.26771390e+00  1.23156023e+00]
   [ 9.33731347e-02 -7.34546185e-01  6.76384389e-01 ... -6.87915683e-01
    -3.32174301e-01 -2.65301317e-01]
   [ 4.03230041e-01 -1.44863486e+00  6.05166793e-01 ... -4.70452696e-01
     1.44024193e-01 -2.44865462e-01]]

  [[ 1.28285050e-01  1.80260086e+00  8.02773952e-01 ...  6.39983833e-01
     1.08295596e+00 -8.38819623e-01]
   [-2.33669326e-01  6.38764322e-01  3.22899930e-02 ...  3.52664262e-01
     3.36706638e-01  1.20647103e-01]
   [ 3.69532287e-01  1.04311848e+00  5.01114726e-01 ... -3.79459441e-01
     6.92921519e-01 -1.69010460e-01]
   [ 2.39660072e+00  6.13580525e-01 -1.91486013e+00 ... -8.26972127e-01
    -2.55018294e-01 -9.21954438e-02]
   [ 5.78466475e-01  2.83318186e+00  1.51391435e+00 ...  9.15881753e-01
     1.89619613e+00 -2.07890582e+00]]

  [[-9.52505350e-01 -8.17057043e-02 -6.29002392e-01 ...  1.00384855e+00
    -2.77309299e-01  2.04102531e-01]
   [ 2.73053348e-01  6.28244281e-02  5.18802524e-01 ...  7.96359956e-01
    -6.45851254e-01  1.63498974e+00]
   [-1.25314641e+00 -8.33077133e-02 -7.99861312e-01 ...  1.08737504e+00
    -4.61701065e-01  4.80048150e-01]
   [ 3.31220716e-01 -7.72794113e-02  8.89608204e-01 ...  1.87895298e+00
    -1.42875820e-01 -1.66795850e-01]
   [ 5.96211612e-01  3.86731565e-01  1.40645707e+00 ...  1.52969193e+00
    -1.29963434e+00  2.39882636e+00]]

  ...

  [[-1.11893308e+00 -1.13183689e+00  1.04869068e+00 ...  1.15212524e+00
     7.66782939e-01  3.08210731e-01]
   [-7.15536773e-01 -6.19667172e-02  4.75941569e-01 ...  1.72181797e+00
    -1.52941883e-01  3.62706900e-01]
   [-1.14136088e+00 -1.90706718e+00  1.48624456e+00 ...  5.57256401e-01
     1.13050377e+00  1.45132214e-01]
   [-1.37537205e+00 -7.27325439e-01  1.08424592e+00 ...  3.12203312e+00
    -1.30527759e+00 -1.49004057e-01]
   [-7.18746841e-01 -1.01146007e+00  9.61373270e-01 ...  9.70084667e-01
     1.34036195e+00 -6.56575337e-02]]

  [[-2.51382411e-01 -9.64822412e-01  3.06302726e-01 ... -5.40588617e-01
    -4.33517098e-02 -1.50568771e+00]
   [ 1.39548779e-01 -4.44400936e-01  6.35194242e-01 ... -3.66480410e-01
    -5.53633809e-01 -1.56284726e+00]
   [ 1.39373016e+00  3.12609076e-01  5.70497930e-01 ...  1.06231600e-01
     2.56087780e-02 -1.93411589e+00]
   [ 2.39282703e+00  2.16998625e+00  1.16325188e+00 ...  7.17327178e-01
    -8.04124117e-01 -2.46965456e+00]
   [-2.01281533e-02 -2.24964261e+00 -2.41621166e-01 ... -7.50214398e-01
     1.15825605e+00 -1.19672751e+00]]

  [[ 1.33035421e+00 -5.61577678e-01  4.96510029e-01 ... -8.61714259e-02
    -1.57295406e+00 -1.30761945e+00]
   [-2.31306839e+00  2.82251090e-01 -8.74774337e-01 ... -5.57909846e-01
    -1.17230189e+00  7.50962913e-01]
   [-4.29361373e-01 -1.27234125e+00  6.23594999e-01 ... -1.42590845e+00
     6.96448684e-01 -1.53579104e+00]
   [ 6.86049819e-01 -6.24845922e-01 -1.42237276e-01 ... -6.09106362e-01
    -1.63264346e+00 -9.89313722e-01]
   [-1.83856988e+00 -5.37121952e-01 -1.53068513e-01 ... -1.01773369e+00
    -2.09945530e-01 -1.26641795e-01]]]


 [[[ 7.67067671e-01  2.64379382e-03  4.51253742e-01 ...  1.88307852e-01
    -4.73680675e-01 -1.15011096e-01]
   [ 2.69057453e-01  7.08511829e-01 -7.47541785e-02 ...  8.43941331e-01
    -3.33656609e-01 -1.41332969e-01]
   [ 5.96108913e-01  5.20270050e-01  5.28493106e-01 ...  2.29458749e-01
    -6.36419535e-01  4.01237756e-01]
   [ 6.20581985e-01  2.96907067e-01  6.94273293e-01 ...  2.68908441e-01
    -6.76946878e-01 -1.84207931e-02]
   [ 3.64239007e-01 -2.38893628e-02  2.57039219e-01 ...  6.66535378e-01
    -3.63745242e-01 -4.10947502e-01]]

  [[-1.01672053e+00 -2.34287322e-01 -1.22632062e+00 ... -1.35060382e+00
    -7.64353633e-01  4.13081884e-01]
   [ 8.99248302e-01 -9.69253719e-01 -1.09630775e+00 ... -1.28554392e+00
    -2.47743249e+00  1.26563951e-01]
   [-1.38176227e+00 -1.01469085e-01 -1.28947985e+00 ... -1.74894905e+00
    -7.11819112e-01  6.64006948e-01]
   [ 5.20651750e-02 -6.78850532e-01 -1.18712151e+00 ... -1.42185998e+00
    -1.86028314e+00  3.15024078e-01]
   [-9.35102046e-01 -3.20369482e-01 -1.20892107e+00 ... -7.98875153e-01
    -5.75031102e-01  1.29331380e-01]]

  [[-2.55074918e-01  3.80396664e-01  2.26176500e-01 ...  1.65664643e-01
     1.69966471e+00  9.05800164e-01]
   [ 2.60850012e-01  5.89063704e-01  8.64367723e-01 ...  3.71169865e-01
     1.45791501e-01  3.49354655e-01]
   [-6.02355659e-01  8.40670466e-01  6.86249435e-01 ... -3.12309653e-01
     1.66170740e+00  1.10639513e+00]
   [-2.05644920e-01 -1.84751704e-01 -3.12842637e-01 ...  8.65019202e-01
     2.69732952e+00  1.01773608e+00]
   [-7.38375727e-03  7.59679854e-01  1.10409558e+00 ...  2.68496841e-01
     7.26550221e-02  3.32303673e-01]]

  ...

  [[-5.49745440e-01 -2.54665434e-01  9.06367779e-01 ... -1.18115723e+00
     6.49969578e-01  2.37557888e-02]
   [-1.57753873e+00 -8.09494615e-01 -3.09269845e-01 ... -1.68715417e+00
     7.31943130e-01 -1.29754353e+00]
   [-9.05243337e-01 -1.89556494e-01  1.82428324e+00 ... -1.99810290e+00
    -4.48363990e-01  1.04659259e+00]
   [-4.47614849e-01  3.68031293e-01  6.14831626e-01 ...  9.55482006e-01
     1.43431723e+00 -2.14187443e-01]
   [-6.90639913e-01 -5.76991588e-03  1.28608644e+00 ... -7.88958430e-01
     3.67644370e-01  4.86574650e-01]]

  [[ 4.64426637e-01 -2.28054672e-01 -5.41121781e-01 ...  2.83815295e-01
    -3.26753438e-01  6.97890639e-01]
   [ 1.85270286e+00  5.70341468e-01 -1.19638228e+00 ...  6.28725529e-01
    -1.14734221e+00  1.83232343e+00]
   [ 1.37614751e+00 -1.01428795e+00  2.38318339e-01 ...  4.56527531e-01
     3.03979725e-01 -9.37716901e-01]
   [ 2.11364698e+00  3.02497804e-01 -6.97546005e-02 ...  1.39769363e+00
    -8.95361960e-01  2.35998893e+00]
   [ 5.82875669e-01  4.31003511e-01 -1.05339468e+00 ...  2.97630072e-01
    -7.61801124e-01  1.39633799e+00]]

  [[-2.82428533e-01 -1.40270507e+00 -1.25910592e+00 ... -1.34440517e+00
    -4.25813496e-01  1.32088602e-01]
   [-6.54487252e-01 -1.90926695e+00 -1.03985667e+00 ... -1.17665708e+00
    -1.70531392e-01  4.23851550e-01]
   [-3.76650333e-01 -1.25653660e+00 -1.04679716e+00 ... -6.09376132e-01
     6.08649671e-01  3.15298319e-01]
   [-1.51076645e-01 -1.38982904e+00 -1.07708681e+00 ... -9.48211372e-01
     3.37444246e-01 -3.88428569e-04]
   [-1.90700367e-01 -6.49843812e-01 -1.31630707e+00 ... -1.32001913e+00
    -3.52316380e-01  2.72504427e-02]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-False-32-8-27-5-8] q.shape1: (8, 5, 27)
q.shape2: (40, 27)
q.shape3: (40, 27)
q.shape4: (8, 5, 27)
q_liner: [[[ 0.15200193  0.42109507  0.1894755  ... -1.7429329  -0.88422495
   -0.3164864 ]
  [-0.7228274   0.49029985  0.58301187 ...  2.1885214  -0.0600438
    2.0428016 ]
  [-0.5260736   0.6122724   1.230041   ... -2.247764    0.22396035
   -1.7408255 ]
  [ 0.3971978   0.6543124   0.09537844 ...  1.0527573   2.5283172
    1.3539605 ]
  [-2.2944772  -1.2713732  -0.40413117 ... -2.6895072   1.2463971
    1.2484484 ]]

 [[-1.1593062  -0.88011456 -1.8108406  ... -1.7323458   1.1656864
   -0.8288701 ]
  [ 0.9558411  -0.23498295  2.5545673  ... -3.0560327  -2.0548532
   -2.2333834 ]
  [-1.7470474  -2.3977683  -2.3310997  ...  0.24311657 -0.14915945
    0.71529585]
  [ 0.89870685  1.1873523  -0.10763843 ...  2.5449615   0.67048955
    0.58401346]
  [ 2.0645623   0.3715976   0.32978135 ...  1.3476607   0.29302907
   -0.27270532]]

 [[-0.00490406 -0.09373393  1.1604989  ... -0.68984926  1.4405506
    0.73424846]
  [-0.04013184 -0.74264437  0.7171273  ...  0.84781003 -0.8189953
    1.0422674 ]
  [ 1.3068575   1.0912939  -0.5706339  ...  0.6620283   0.5126465
    1.2609537 ]
  [-1.4994874   1.0570575  -2.6855764  ...  1.986622    1.5518485
   -0.7573723 ]
  [ 1.1151257  -2.2495382   0.6445344  ... -1.7265897  -0.9692527
    1.5563262 ]]

 ...

 [[-1.2600608   0.42844245 -1.0461015  ...  0.4404278   0.8438228
    0.35004786]
  [-0.80994964  0.90170777 -1.5636967  ...  1.9153154   0.15813263
    0.75824195]
  [-0.41504437  0.5501679  -0.46502814 ...  1.3531638   0.20270535
   -1.1872677 ]
  [-2.140977   -1.8058908  -2.543361   ... -1.3188152  -0.2109273
    3.014104  ]
  [ 0.30165464 -1.7570784  -0.5276766  ... -0.95511556  0.6305223
    2.6884043 ]]

 [[ 0.54159     2.0929532   1.2214144  ...  1.3534613  -2.23457
   -3.0139523 ]
  [-0.41575354  1.8297943   0.4623497  ... -0.0106837   0.28909513
   -1.1019404 ]
  [ 1.7901554  -2.319938    0.07372504 ...  1.7785084  -2.0408728
   -0.50145024]
  [-3.2801116   0.87907857  1.1032302  ...  1.1696819   2.6237779
   -2.4771411 ]
  [ 2.1882672   2.8574078   1.3916488  ... -0.65159124  0.67476016
   -2.5030303 ]]

 [[-0.2869474   0.19633447  1.8981183  ...  1.5710847  -1.9368707
    0.45920563]
  [ 1.1749982   0.24199866 -1.4054803  ...  0.47076377  0.1422315
    2.097656  ]
  [ 1.5478255   2.0425947   0.8884625  ... -1.2721355  -1.8794547
   -1.3773708 ]
  [-0.51357377  1.8262048   0.93602985 ... -1.289328    1.1409357
   -3.3090458 ]
  [-0.5917449   1.1871253   0.05737568 ...  2.3166168   0.7226818
    1.4457972 ]]]
q.shape5: (8, 5, 256)
q.shape6: (8, 8, 5, 32)
attn_res: [[[[-1.10189891e+00 -2.75773704e-01  1.00157320e+00 ... -1.04409361e+00
    -1.47432148e+00 -1.02181768e+00]
   [-1.41157353e+00 -8.92405868e-01  1.57548451e+00 ... -7.91311502e-01
    -2.27434945e+00 -4.00319993e-01]
   [-2.83711761e-01  2.32169533e+00 -5.86623490e-01 ... -1.93937862e+00
    -1.21788180e+00 -1.36057162e+00]
   [-8.83381307e-01  6.46011949e-01  6.07748330e-01 ... -4.58651595e-02
     5.52984118e-01  1.27753627e+00]
   [-1.37542927e+00 -7.53719151e-01  1.54225707e+00 ... -7.70005882e-01
    -2.34606647e+00 -2.07543492e-01]]

  [[-5.98480403e-01  2.24762022e-01 -2.37585098e-01 ...  4.79626954e-01
     2.40223203e-03  3.49768609e-01]
   [ 7.24396229e-01 -3.65033209e-01  1.06750917e+00 ...  3.02280605e-01
    -1.10113990e+00  1.55627716e+00]
   [-2.02308726e+00  4.57590669e-01  9.54192877e-03 ...  6.95861399e-01
     7.03144312e-01 -1.43315589e+00]
   [-4.02823836e-01 -1.85063696e+00  2.52712059e+00 ...  1.14448830e-01
     7.44482577e-01 -9.15467203e-01]
   [-7.95715451e-01 -1.63129842e+00  2.02739096e+00 ...  1.80224866e-01
     7.02831268e-01 -9.24400508e-01]]

  [[ 7.62226343e-01 -1.10489893e+00  6.08091876e-02 ... -1.36325324e+00
     1.26294971e+00  3.51603031e-01]
   [ 7.28295326e-01  2.93120295e-01 -7.08074808e-01 ...  2.87301838e-01
    -8.68266106e-01  3.24826193e+00]
   [ 1.74806428e+00 -2.04887247e+00  4.18655694e-01 ... -2.16483927e+00
     2.15324593e+00  6.85237870e-02]
   [ 7.70026207e-01  1.20742452e+00 -6.96271658e-01 ...  1.18642008e+00
    -8.22678804e-02  7.25893259e-01]
   [ 1.66984677e+00 -1.03722298e+00 -7.64083490e-02 ... -1.00316811e+00
     8.62542629e-01  1.63332307e+00]]

  ...

  [[ 1.84335738e-01  6.75271213e-01 -1.02976406e+00 ...  4.22779173e-02
    -5.98427892e-01  5.59228420e-01]
   [ 2.36929074e-01  1.29625630e+00  6.72697306e-01 ...  4.51689392e-01
    -7.30380833e-01 -1.22325674e-01]
   [ 3.84547949e-01  6.18283272e-01 -4.12082016e-01 ... -1.89672947e-01
    -3.94166917e-01  1.01129079e+00]
   [ 3.46539140e-01  1.91895187e-01 -1.40467680e+00 ... -3.81552309e-01
     2.45614380e-01  1.18640220e+00]
   [ 8.01564991e-01  9.98804510e-01  2.37001657e-01 ...  1.11361764e-01
    -8.06862831e-01  5.79791963e-01]]

  [[ 4.17515606e-01 -5.28795838e-01 -2.82390922e-01 ... -4.60646078e-02
    -1.30667186e+00  1.12591827e+00]
   [-3.24661255e-01 -5.97637773e-01 -8.55938852e-01 ...  9.48248953e-02
    -6.29324317e-01  4.49904978e-01]
   [ 1.75599945e+00 -5.77378511e-01  5.60422242e-03 ... -6.36550546e-01
    -2.68453360e-01  1.36190426e+00]
   [-7.32251704e-01 -7.80083120e-01 -1.02246547e+00 ...  6.27543271e-01
     1.22323871e+00 -8.67956340e-01]
   [ 8.14970255e-01 -3.77229363e-01 -5.29657722e-01 ... -3.67213577e-01
    -1.24196458e+00  1.22869360e+00]]

  [[ 1.81767678e+00 -2.78498620e-01 -3.24981213e-01 ...  1.77966881e+00
    -2.56299227e-01  5.64602137e-01]
   [ 7.29965687e-01 -2.30147243e+00  3.04590184e-02 ...  1.61959600e+00
     2.96753943e-01 -1.70375693e+00]
   [ 1.19315243e+00 -2.01397300e+00 -1.01620829e+00 ...  2.37251663e+00
    -8.13262910e-02 -1.96362829e+00]
   [ 1.54368186e+00 -9.32774305e-01 -3.68111610e-01 ...  1.90057182e+00
    -1.67743444e-01 -4.28701103e-01]
   [ 1.27142823e+00 -1.92271280e+00 -1.40598798e+00 ...  2.60565662e+00
    -2.39166349e-01 -2.17472029e+00]]]


 [[[-8.79141688e-03  2.36096382e-01 -6.68105111e-02 ...  7.16289282e-01
     5.73264062e-01  3.04903090e-01]
   [-6.34340346e-01  1.71938515e+00  3.87160331e-01 ... -2.06889838e-01
     8.31686318e-01  1.73035073e+00]
   [-2.22961530e-02  4.94741827e-01  4.60706741e-01 ...  5.57887435e-01
     1.06233120e+00  1.18397582e+00]
   [ 1.37819618e-01 -2.71161228e-01  8.81053984e-01 ... -1.10494554e-01
    -7.29313076e-01 -9.19940352e-01]
   [-4.95237112e-02  2.45127454e-01  4.92662668e-01 ...  1.01479977e-01
     5.28664947e-01  3.20379198e-01]]

  [[-9.72520411e-02 -9.94894326e-01  3.32623124e-02 ... -6.09551847e-01
     1.78512502e+00 -9.98337209e-01]
   [-1.81832656e-01 -1.12361467e+00  3.97287965e-01 ... -5.66416204e-01
     8.52609158e-01  3.98373783e-01]
   [-7.01408863e-01 -5.66101193e-01  2.22069621e-01 ... -9.14199710e-01
    -1.70621037e-01  1.58734179e+00]
   [ 1.45710692e-01 -9.83357131e-01 -6.45874619e-01 ...  8.24519843e-02
     1.81047583e+00 -3.14343274e-01]
   [ 1.71631664e-01 -9.17153835e-01 -8.71153533e-01 ...  2.06307068e-01
     1.79664314e+00 -1.06346622e-01]]

  [[ 6.16908193e-01 -7.79185295e-01  2.23508596e+00 ... -5.51486552e-01
    -7.30545282e-01  7.52319217e-01]
   [-7.86931694e-01 -2.82485157e-01  2.94611239e+00 ... -1.36027944e+00
    -5.09737134e-01  1.20540392e+00]
   [-1.87946945e-01 -1.15818715e+00  9.97311831e-01 ... -1.00867796e+00
    -1.00148892e+00  1.25461921e-01]
   [-1.57639456e+00  2.45045543e+00 -3.06557447e-01 ... -1.28176713e+00
    -9.28174078e-01  2.01845241e+00]
   [-1.02690542e+00  1.03962064e+00  1.30479753e-01 ... -1.16411531e+00
    -9.90285873e-01  1.26116514e+00]]

  ...

  [[-2.70009041e-02 -3.72643292e-01  1.15486836e+00 ... -1.93682921e+00
     4.85494137e-01  3.20561111e-01]
   [ 1.56272304e+00  5.85132420e-01  7.67754436e-01 ...  9.66325521e-01
     3.29535961e-01  7.63750076e-02]
   [-2.65043229e-01  4.58322734e-01  6.97272956e-01 ... -7.48094141e-01
     4.40496206e-01  5.45028225e-02]
   [ 6.97365999e-02 -3.45209569e-01  1.17294455e+00 ... -2.47155261e+00
     7.36539185e-01  1.12652950e-01]
   [-4.52753425e-01  1.21304929e-01  5.20596385e-01 ... -1.22551215e+00
     8.29265893e-01  5.64739406e-01]]

  [[-6.71414286e-02  1.34265864e+00 -4.85473126e-01 ... -1.21288612e-01
     5.38917243e-01  5.55429816e-01]
   [-3.51335168e-01  1.51315844e+00  1.25820741e-01 ...  1.71663344e-01
     8.22310865e-01 -9.26502943e-02]
   [ 3.29578221e-01  1.44256222e+00  4.13715392e-01 ... -4.13776934e-02
     6.76127076e-01  1.93792596e-01]
   [-1.21774431e-02 -1.95101008e-01 -6.00614846e-02 ...  7.88022101e-01
     1.23427391e+00  6.88056052e-01]
   [-5.71583271e-01  1.19585347e+00 -3.23907584e-02 ...  5.52797258e-01
     8.13548326e-01 -2.16337755e-01]]

  [[-1.28426790e+00  4.85953093e-02  2.88198173e-01 ... -6.85896754e-01
     3.82150412e-02  7.02851772e-01]
   [ 5.91482557e-02  7.49346256e-01  3.55905853e-02 ... -5.68106472e-01
    -4.72099930e-01 -1.12620509e+00]
   [-1.62030280e+00  1.75951552e+00  4.68266398e-01 ... -1.00608487e-02
    -1.35027266e+00  2.95567513e-01]
   [-1.13842821e+00  1.37362933e+00  7.96772242e-01 ... -1.23377526e+00
    -4.03192818e-01  4.77466494e-01]
   [-2.06636727e-01  8.97844970e-01  2.14792296e-01 ... -6.76467419e-01
    -4.05734003e-01 -8.92250538e-01]]]


 [[[-7.24960923e-01  4.89220738e-01 -6.18362904e-01 ... -1.22624516e+00
     9.05881703e-01 -1.17000341e+00]
   [-5.27687788e-01  4.24599737e-01 -4.34792519e-01 ... -1.12473392e+00
     7.84289479e-01 -8.62299144e-01]
   [ 7.36473799e-02  2.45665580e-01  4.31485534e-01 ... -9.33390856e-02
    -6.38525747e-03  7.86636353e-01]
   [-7.18928516e-01  5.56366503e-01 -5.29180050e-01 ... -1.22250748e+00
     9.47523832e-01 -1.27666903e+00]
   [ 5.62926888e-01 -1.70756012e-01  3.47928196e-01 ... -3.90981436e-01
    -1.40755653e-01  1.46338439e+00]]

  [[ 1.11942446e+00  6.18077099e-01  6.78796232e-01 ...  1.00514174e-01
     6.77074969e-01  2.81865448e-01]
   [ 3.17883849e-01 -7.31555164e-01 -5.56343853e-01 ...  3.25302154e-01
     1.60065019e+00  1.41158986e+00]
   [ 6.80590153e-01  2.49084568e+00  6.17818892e-01 ...  1.32952988e+00
     5.57067811e-01 -5.69199622e-01]
   [ 8.24756801e-01 -1.42152548e-01  1.33976817e-01 ...  1.65723383e-01
     9.78674591e-01  5.43788254e-01]
   [ 1.02108312e+00  1.47516787e-01  5.11201859e-01 ...  4.90533412e-02
     4.65023756e-01  1.02833301e-01]]

  [[ 1.34171748e+00  4.47279572e-01  3.02226454e-01 ...  1.13018084e+00
    -1.02021761e-01  8.03677678e-01]
   [ 4.75357413e-01 -1.95874619e+00 -1.62491882e+00 ... -1.09542930e+00
     1.57161200e+00 -8.41545701e-01]
   [-3.67550552e-01 -1.82585716e+00 -3.38341236e-01 ...  3.95040780e-01
     7.58330524e-01 -1.18209906e-01]
   [ 6.76466525e-01 -3.30375552e-01 -1.79495096e-01 ...  9.18162525e-01
     2.16171116e-01  4.04010385e-01]
   [-3.43781382e-01 -1.70977283e+00  3.35506722e-02 ...  5.93083143e-01
     5.48238754e-01  9.30738971e-02]]

  ...

  [[-5.04618108e-01 -8.87208045e-01 -8.48855436e-01 ... -1.83057547e-01
    -1.01577848e-01 -7.95926213e-01]
   [-4.39572692e-01 -2.72048295e-01 -2.59692222e-01 ... -4.36445475e-02
    -1.27262399e-01 -1.81540698e-01]
   [-1.47990394e+00 -1.56376767e+00 -4.16823268e-01 ...  4.30379689e-01
    -3.98077190e-01  2.10202605e-01]
   [-4.52753305e-01 -4.19814736e-01 -5.71960032e-01 ... -3.11916351e-01
    -8.01958293e-02 -5.39947867e-01]
   [-3.41073155e-01 -7.86957920e-01 -9.48418558e-01 ... -2.02146277e-01
    -2.30861623e-02 -9.12664890e-01]]

  [[-1.10916090e+00 -1.12141037e+00  1.70250189e+00 ...  1.43398225e+00
    -2.91503263e+00  1.25080836e+00]
   [-6.24327898e-01  1.04773736e+00 -1.18636012e+00 ... -6.30626827e-02
    -7.29678750e-01  1.11703503e+00]
   [-5.83176851e-01 -6.08296096e-01  1.03705466e+00 ...  7.17886209e-01
    -2.36522865e+00  1.02674413e+00]
   [-1.14941943e+00 -9.55057085e-01  1.50494325e+00 ...  1.39474547e+00
    -2.74790049e+00  1.25192952e+00]
   [-1.57274532e+00  6.52692020e-01 -1.47006226e+00 ...  5.34399569e-01
    -1.07262039e+00  1.45283842e+00]]

  [[-1.32727551e+00  8.69187534e-01  1.10157561e+00 ... -9.44365859e-01
     5.76483488e-01  4.64556903e-01]
   [-1.20413828e+00  2.87591875e-01  6.05949759e-01 ...  1.34417266e-01
     1.12659252e+00 -1.03058219e-02]
   [-1.96391332e+00  1.50419331e+00  2.25284624e+00 ... -1.80158103e+00
     2.02003196e-01  4.96658087e-01]
   [-8.38155925e-01  7.86856651e-01  1.79987997e-01 ... -1.19121671e-01
     5.75050473e-01  5.17423391e-01]
   [-2.13495612e+00  1.77886558e+00  2.77246523e+00 ... -2.38135910e+00
    -9.91312414e-02  7.14307189e-01]]]


 ...


 [[[ 1.67360628e+00 -4.12841678e-01 -9.58820760e-01 ...  3.55022848e-01
     9.47416425e-01 -4.51054037e-01]
   [ 5.04675806e-01  9.32085633e-01 -3.38148624e-01 ... -1.14834368e+00
     1.40711471e-01 -2.90938079e-01]
   [ 4.77663368e-01  1.85494602e+00 -2.91190326e-01 ... -8.80115390e-01
     1.76189804e+00  6.60337925e-01]
   [ 1.48366904e+00 -2.90276408e-02 -8.90570283e-01 ...  1.47515461e-01
     1.05094409e+00 -2.24968433e-01]
   [ 6.15390420e-01 -1.11208811e-01 -8.94065380e-01 ... -2.39751205e-01
    -6.08770490e-01  8.65371644e-01]]

  [[-4.38322932e-01 -4.17597800e-01 -6.28971040e-01 ...  1.32442760e+00
    -1.12142766e+00 -3.54148448e-02]
   [-1.58525503e+00 -2.21204951e-01 -1.68092120e+00 ... -4.34320420e-01
     5.12784600e-01 -1.05947840e+00]
   [-1.02775764e+00 -4.36889678e-02 -2.03868842e+00 ... -5.09994149e-01
     3.70246559e-01  3.02276015e-03]
   [-1.20648193e+00 -3.27817291e-01 -1.02078938e+00 ...  3.38137567e-01
    -2.49729484e-01 -8.48273039e-01]
   [-2.52016282e+00 -4.24600929e-01 -2.15934134e+00 ... -3.21520805e-01
     2.71529168e-01 -1.31956339e+00]]

  [[-3.37161750e-01 -1.20043635e+00  1.40427172e+00 ... -2.06643343e-02
     1.23531926e+00  1.36114883e+00]
   [ 1.74122542e-01  8.16694945e-02  1.24354529e+00 ...  2.68695474e-01
     9.45464447e-02  1.16554451e+00]
   [-9.39412564e-02 -5.21734536e-01  1.49213719e+00 ...  1.12706564e-01
     8.22483122e-01  1.48872447e+00]
   [-1.90690622e-01 -8.73363137e-01  1.29199946e+00 ...  7.86691457e-02
     6.71212316e-01  1.30615497e+00]
   [-6.01636469e-01  8.72595310e-02  1.16699994e+00 ... -2.11265135e+00
    -1.64315984e-01 -4.60204892e-02]]

  ...

  [[ 9.97466266e-01  1.78963411e+00 -8.00554678e-02 ... -8.22348058e-01
    -1.43611085e+00  4.38429594e-01]
   [-2.60960579e-01  5.87833345e-01 -2.18616337e-01 ... -6.34334564e-01
    -5.52587926e-01  1.86546549e-01]
   [ 1.32061303e+00  1.88651752e+00 -8.39292631e-02 ... -8.12539756e-01
    -1.38507104e+00  3.48766148e-01]
   [-1.10437500e+00  1.03190327e+00 -5.67957282e-01 ... -7.62503624e-01
    -2.11794353e+00  5.69884360e-01]
   [-1.53350770e+00  2.92650998e-01 -8.07485342e-01 ... -4.79313552e-01
    -1.70692384e+00  5.31664550e-01]]

  [[-5.85333288e-01  8.30940425e-01  6.32890880e-01 ... -2.86661893e-01
    -3.28968263e+00  1.26054204e+00]
   [ 1.91869542e-01 -2.56795597e+00  9.67266619e-01 ...  1.17845607e+00
    -8.13928962e-01  1.19073522e+00]
   [ 1.32964239e-01 -1.74583900e+00  9.02621150e-01 ...  8.02566051e-01
    -8.46888602e-01  1.09176314e+00]
   [ 2.62718409e-01 -9.18681026e-01  7.86664605e-01 ...  3.64810228e-01
    -1.66061074e-01  8.23342502e-01]
   [ 1.15491617e+00  1.08092463e+00 -5.89832604e-01 ... -1.12281823e+00
    -2.88653046e-01  2.17605412e-01]]

  [[ 1.08241999e+00 -8.32033157e-01 -3.19619775e+00 ...  8.54487777e-01
    -3.71912122e-01 -4.84953821e-01]
   [-3.05553138e-01 -1.31070352e+00 -5.55525124e-01 ...  1.51912403e+00
     2.10174352e-01 -1.50845742e+00]
   [-1.64742023e-01 -1.78084075e+00 -1.87289894e-01 ...  1.11975050e+00
    -1.16290236e+00  4.03483808e-01]
   [ 4.51171756e-01 -2.42740726e+00 -1.08269739e+00 ... -1.00976181e+00
    -7.37001598e-01 -8.55142474e-01]
   [ 4.37383980e-01 -1.91210353e+00 -1.35850167e+00 ... -6.82220161e-02
    -6.54098868e-01 -6.57951832e-01]]]


 [[[ 1.53073406e+00 -7.19463050e-01 -9.79473442e-02 ... -3.60924602e-01
     2.29759145e+00 -4.70740914e-01]
   [ 1.48785460e+00 -6.32073104e-01 -3.34357172e-02 ... -3.52965862e-01
     2.35407782e+00 -6.38920665e-01]
   [-6.94869339e-01  1.63818240e+00  3.37636828e-01 ...  4.00092214e-01
     2.25584888e+00 -2.48358935e-01]
   [ 9.20522928e-01  5.71669936e-02  2.52680033e-01 ... -1.90984339e-01
     2.43108082e+00 -1.10859299e+00]
   [ 1.50569642e+00 -7.94944048e-01 -8.54804367e-03 ... -3.03171992e-01
     2.22646356e+00 -9.72814679e-01]]

  [[ 3.13084394e-01  1.46406996e+00 -1.48942161e+00 ...  1.43165231e-01
     2.84684628e-01 -3.97699177e-02]
   [ 1.64129126e+00 -8.74922037e-01  2.72518694e-01 ... -3.19865346e-01
    -3.64184320e-01 -3.20167214e-01]
   [ 1.56922257e+00 -6.50647879e-01 -4.53307629e-02 ... -3.23429078e-01
    -5.36636114e-02 -4.72166210e-01]
   [ 1.78766024e+00 -1.05407107e+00  3.51281554e-01 ... -3.77646029e-01
    -3.23025107e-01 -4.15071607e-01]
   [-2.37981868e+00 -2.79026985e+00  1.67625165e+00 ...  3.32251310e-01
     1.07712984e+00  2.79359251e-01]]

  [[-5.83881319e-01  7.94915438e-01 -1.55956912e+00 ...  6.03142381e-02
     1.06200647e+00  4.40236509e-01]
   [-6.95387006e-01  7.50279069e-01 -1.22672093e+00 ... -3.47956955e-01
     9.53963101e-01  3.40246439e-01]
   [-1.24927923e-01  1.51012051e+00 -6.03521049e-01 ...  3.97363633e-01
    -1.02576733e-01  1.23558688e+00]
   [-4.21184480e-01  8.28552365e-01 -2.62134224e-01 ... -1.37838161e+00
    -1.90924138e-01  7.19943643e-01]
   [ 1.56379446e-01  1.77501583e+00 -4.95033294e-01 ...  7.74773717e-01
    -5.71065128e-01  1.66983509e+00]]

  ...

  [[-2.58454472e-01  3.22777241e-01  7.24591911e-01 ...  4.67021793e-01
     2.07481718e+00 -1.57747948e+00]
   [-6.34790540e-01 -7.60400832e-01  4.54144269e-01 ... -1.06788683e+00
    -1.51130986e+00  1.90932858e+00]
   [-3.22917312e-01 -4.15649533e-01  4.25522029e-01 ... -6.62968516e-01
    -1.02694988e+00  1.24718368e+00]
   [-3.60730022e-01 -5.07572114e-01  4.02265787e-01 ... -9.16704059e-01
    -1.28450739e+00  1.59583175e+00]
   [-1.88916162e-01  4.44561630e-01  7.37804532e-01 ...  5.80599308e-01
     2.31314898e+00 -1.82982969e+00]]

  [[ 7.57111430e-01 -4.76704210e-01 -6.01680994e-01 ... -2.36606628e-01
    -1.29733586e+00  1.60083938e+00]
   [ 4.82144862e-01 -1.63987845e-01  9.49609816e-01 ...  1.57211614e+00
    -7.56483912e-01  9.28908765e-01]
   [ 2.05420703e-01 -3.99868935e-01  7.49914289e-01 ...  1.40800357e+00
    -7.73634315e-01  6.96812510e-01]
   [ 3.32819998e-01 -2.45088726e-01  9.56978500e-02 ...  7.14001060e-01
    -6.54815316e-01  8.42403054e-01]
   [ 8.21320355e-01 -2.81146407e-01  2.38485694e-01 ...  6.77863479e-01
    -1.17492342e+00  1.51104116e+00]]

  [[-6.54688954e-01 -2.31139630e-01  1.36716628e+00 ... -1.14343262e+00
     1.87201738e+00  5.69182813e-01]
   [-7.39030302e-01 -5.64212620e-01  1.86043692e+00 ... -1.79280829e+00
     2.32649326e+00  1.36057830e+00]
   [-5.57427108e-01  3.67531151e-01  1.06625164e+00 ... -1.38273418e+00
     9.18413997e-01  1.29487610e+00]
   [-7.31060386e-01 -2.87055075e-01  1.58380234e+00 ... -1.15192580e+00
     2.06717730e+00  4.61431205e-01]
   [-5.93997240e-01  5.07736266e-01  8.98755312e-01 ... -5.41500509e-01
     9.47924376e-01 -9.02354717e-04]]]


 [[[-1.15914154e+00  1.30005026e+00 -1.34894609e+00 ... -4.90237057e-01
    -1.14327836e+00 -8.21267962e-01]
   [-7.46339381e-01  9.44283843e-01 -1.13388062e+00 ... -3.68831187e-01
    -7.58229971e-01 -8.30495834e-01]
   [ 4.95542586e-01  5.53993583e-01 -1.07254112e+00 ...  3.61772299e-01
     5.46151757e-01  2.01481283e-01]
   [ 1.01222932e+00  6.97144032e-01 -1.26004314e+00 ...  7.13271737e-01
     1.16630483e+00  6.26621366e-01]
   [ 4.87387151e-01  7.05754876e-01 -1.48120320e+00 ...  9.94350195e-01
    -4.12753403e-01  4.41542685e-01]]

  [[-3.20235901e-02 -4.60721850e-02 -1.38812017e+00 ... -1.06107759e+00
     5.94707653e-02  1.47327244e+00]
   [ 2.67193802e-02  6.81157231e-01  2.96213537e-01 ... -1.16994905e+00
     1.05807614e+00 -6.87294304e-01]
   [ 1.33185101e+00  2.38612607e-01 -1.35186970e+00 ... -2.05217910e+00
    -9.80747998e-01  6.66539252e-01]
   [-5.84890008e-01  7.48307228e-01 -5.72636127e-01 ... -6.96264803e-01
     5.40922344e-01 -2.09714603e+00]
   [ 2.23373026e-01 -2.89779544e-01 -5.46640873e-01 ... -8.58616114e-01
    -1.02189571e-01  1.78972125e-01]]

  [[-8.42442036e-01  5.40670037e-01  5.75718164e-01 ... -6.82024136e-02
    -1.51987582e-01 -2.78406650e-01]
   [ 2.38810569e-01  5.17306253e-02  4.12391365e-01 ...  1.30039230e-01
    -6.82316244e-01 -8.74721885e-01]
   [ 1.44156575e+00  2.69862324e-01  1.16873384e+00 ...  6.02672756e-01
     7.65832365e-02 -6.83269799e-01]
   [ 5.26553571e-01  5.92953041e-02  8.21322858e-01 ... -1.22992322e-01
    -9.28257227e-01 -1.13523388e+00]
   [-5.83314419e-01  1.44906902e+00  2.37507653e+00 ... -2.64465570e-01
     7.69216537e-01  3.38556200e-01]]

  ...

  [[ 9.57685232e-01  1.06804538e+00  5.42847872e-01 ...  1.94437492e+00
     1.37998664e+00 -8.34122300e-01]
   [ 3.83359849e-01 -4.11479950e-01 -2.88695276e-01 ... -1.04460716e-02
     1.24353850e+00 -1.75691509e+00]
   [ 4.15828317e-01  7.48618245e-02  6.24114394e-01 ...  1.27611673e+00
     1.28938770e+00 -7.10869133e-01]
   [ 6.56661689e-01  7.22677648e-01  5.62905133e-01 ...  1.56610513e+00
     1.41467655e+00 -7.62982905e-01]
   [ 9.83673811e-01  1.14893043e+00  5.91727078e-01 ...  2.05047560e+00
     1.37970793e+00 -7.76439965e-01]]

  [[ 7.83416331e-01 -4.87086743e-01 -1.61075652e-01 ... -9.86887664e-02
     1.40411222e+00 -9.04701948e-01]
   [-1.21484673e+00 -1.09511852e+00 -7.45788515e-01 ...  2.37562108e+00
    -1.14251411e+00  1.34890807e+00]
   [-8.74630570e-01 -7.20546007e-01 -5.75227678e-01 ...  1.98207319e+00
    -4.64979559e-01  7.20466733e-01]
   [-3.22597593e-01  2.74064280e-02  7.33696967e-02 ...  4.77942973e-01
     9.53330696e-01 -1.60923147e+00]
   [ 8.22290421e-01  2.18061566e-01 -2.84042120e-01 ...  2.35507816e-01
     1.68761635e+00 -1.25965548e+00]]

  [[ 9.13591385e-01 -4.31674644e-02  2.76240259e-01 ... -3.24329793e-01
    -1.07327032e+00 -1.13109136e+00]
   [ 1.17108202e+00 -3.42124194e-01  3.12932849e-01 ...  9.71969664e-02
    -1.06601691e+00 -1.33646250e+00]
   [ 1.13517451e+00 -1.21195090e+00  7.58296251e-02 ...  7.83273041e-01
    -4.09219563e-01 -1.15586913e+00]
   [-7.08127677e-01 -1.11795878e-02  3.69248204e-02 ...  1.06469756e-02
     1.19447088e+00  1.11236833e-02]
   [-1.08015127e-01  1.45491257e-01  6.24188602e-01 ... -8.18454504e-01
    -2.65983701e-01  6.21557117e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-False-32-8-27-11-4] q.shape1: (4, 11, 27)
q.shape2: (44, 27)
q.shape3: (44, 27)
q.shape4: (4, 11, 27)
q_liner: [[[-0.08246311  1.2976369  -4.386915   ...  1.6648992   1.0225513
   -0.23413594]
  [-2.1036825   0.34269288 -1.3593392  ...  0.28710133 -2.3495028
   -0.5770221 ]
  [ 0.55015564  1.3115653  -2.7073863  ... -1.2594198   0.450877
   -0.5750791 ]
  ...
  [ 1.9723426   1.9014059  -0.07350484 ... -0.6233986  -1.8269871
   -3.14204   ]
  [ 0.5897575   0.5651129  -1.4288164  ...  1.6924045  -1.9481409
    1.4147217 ]
  [ 1.4633553  -0.39679056 -0.7927203  ...  0.4363156  -1.650817
    0.20362736]]

 [[-0.9566642   0.6318296  -0.99751896 ... -1.8659797  -0.01259731
    1.0842644 ]
  [-0.15104908  1.3874646   0.19238688 ... -2.0061364  -0.9589741
    0.54090524]
  [-0.31797698 -0.8425765   3.2394023  ...  0.84538174 -0.51091385
   -0.27457827]
  ...
  [ 0.33640513  1.8460543   2.5176854  ...  1.0853881   2.9914553
    2.6077735 ]
  [ 1.546665    0.5879998   0.41907552 ...  0.75106627  1.0203562
   -0.15183803]
  [-1.0632492   2.5393524   0.9687923  ... -1.3010052  -0.02241022
    1.0278877 ]]

 [[ 0.24715352  1.9982486  -1.0008467  ... -0.99167144  2.288722
   -0.38216916]
  [-1.7900983   1.6657426   0.72222143 ...  1.0981413  -0.52470183
   -1.220509  ]
  [-1.0200733  -0.02188973  0.9696115  ... -3.8275013   1.2366807
   -2.000785  ]
  ...
  [-1.0458595  -1.4305166  -1.8524687  ...  1.3384255  -2.3837926
   -1.3595229 ]
  [ 0.65088063 -0.07472718  0.7910718  ...  1.1668599   0.17494643
   -2.2131062 ]
  [-0.5484388  -0.3512259  -0.9518742  ... -0.37090048 -2.5363982
   -0.35450423]]

 [[-1.659759   -2.0460486   1.7956158  ...  0.7144731  -2.8808205
   -2.3229935 ]
  [-0.6778062  -1.0200877   2.5991158  ... -0.39864084 -0.1548618
   -1.7684385 ]
  [-0.9458304   1.8510628  -0.13740486 ... -1.860934    1.164453
    0.04018883]
  ...
  [ 0.38199356 -1.6202837  -1.9532994  ...  2.8872821  -0.4262538
   -0.07649663]
  [-1.2970152  -0.8319859  -1.2084574  ... -0.85649323  1.5001354
    1.9378235 ]
  [ 0.15252627  1.7864983  -2.6395547  ...  0.10763691  0.13296238
   -1.6784537 ]]]
q.shape5: (4, 11, 256)
q.shape6: (4, 8, 11, 32)
attn_res: [[[[-5.67015946e-01 -7.92597473e-01  6.83330476e-01 ...  5.03605530e-02
     5.40350378e-01  4.78779495e-01]
   [-6.67033255e-01 -4.51856285e-01  8.49767327e-02 ... -2.89714128e-01
     3.32637608e-01  8.51852477e-01]
   [ 1.56478807e-01  3.69466282e-02  9.94778514e-01 ...  9.20058191e-02
     4.41416353e-02  8.79464447e-02]
   ...
   [-3.29181105e-01 -8.54799211e-01  2.73077786e-01 ... -8.52646112e-01
     7.83050418e-01 -2.09681201e+00]
   [-6.42008543e-01 -6.85225546e-01  9.71108377e-01 ...  9.61113274e-01
    -3.95404041e-01 -9.69727486e-02]
   [-6.44800484e-01 -5.47839761e-01  4.73242402e-01 ...  1.49182379e-01
    -2.84885406e-01 -5.89085996e-01]]

  [[-1.68176219e-01  9.52995792e-02  6.62096739e-01 ...  4.62585837e-01
    -2.68388957e-01  9.29372907e-02]
   [-3.00828934e-01  2.21041143e-02  5.62227368e-01 ...  5.25085807e-01
    -6.36798561e-01  6.44650578e-01]
   [ 2.11523056e+00 -7.66764283e-02 -1.39024580e+00 ... -1.35095346e+00
     9.97807264e-01 -1.42808139e+00]
   ...
   [-4.26952988e-01 -9.70790207e-01 -6.30095541e-01 ...  6.71087444e-01
    -3.77055734e-01  1.71019167e-01]
   [-4.42424834e-01 -4.25000906e-01 -8.44846219e-02 ...  8.30675602e-01
    -5.21475255e-01  4.39102948e-01]
   [ 1.09383154e+00 -4.45902944e-01 -2.58861572e-01 ... -1.40261579e+00
    -1.60417467e-01  5.18881917e-01]]

  [[-1.02028584e+00  3.45038503e-01  2.18447328e-01 ...  1.17928803e+00
     1.39237583e+00  7.61447132e-01]
   [-8.87428820e-01  2.86176354e-01  3.84369418e-02 ... -4.13523167e-01
    -5.59647143e-01  1.50282657e+00]
   [ 9.86276045e-02 -1.53344715e+00  1.96472228e-01 ... -4.68352944e-01
     8.73857200e-01 -6.95771396e-01]
   ...
   [-7.47779787e-01 -8.79654646e-01 -4.91240680e-01 ... -6.80411577e-01
     5.13362467e-01  7.72187531e-01]
   [-5.05484283e-01  5.69798946e-01 -1.50162295e-01 ...  5.16953170e-01
     6.40214622e-01  1.18146527e+00]
   [-3.46082188e-02  1.10835946e+00  4.05768156e-01 ...  1.17635024e+00
     3.32567662e-01  1.82683313e+00]]

  ...

  [[ 3.95178467e-01  8.25456619e-01 -7.00884759e-01 ... -1.97467983e-01
    -5.26656747e-01  3.89780402e-01]
   [ 1.41411066e-01  2.24472314e-01 -9.83064175e-01 ... -1.19031155e+00
     4.87739354e-01  5.64094007e-01]
   [ 4.26107109e-01  4.33565795e-01  7.24755228e-05 ... -9.19799089e-01
    -6.95991457e-01 -4.98163462e-01]
   ...
   [ 1.78168416e-01  7.80328393e-01  7.26392195e-02 ... -9.99998748e-01
     1.27289653e-01  6.44286275e-01]
   [-1.32141098e-01  2.02570963e+00 -5.65201521e-01 ... -4.95430455e-02
    -3.31800818e-01  1.89807260e+00]
   [-4.57994044e-01  1.24447858e+00 -2.39099592e-01 ... -3.80729400e-02
     3.81052718e-02  1.17919207e+00]]

  [[-1.90605164e-01 -2.16882229e-02  2.48568088e-01 ...  8.79864395e-01
    -7.28116751e-01  1.59914827e+00]
   [ 1.89989209e-01 -6.63103014e-02  9.91827369e-01 ...  4.08301890e-01
    -9.62487936e-01  7.27992237e-01]
   [ 8.62120464e-02 -2.03858542e+00  1.29264414e-01 ...  1.69542551e-01
    -2.26530105e-01 -9.13482189e-01]
   ...
   [ 1.83820039e-01 -6.21862411e-02  8.29533875e-01 ...  3.66263479e-01
    -8.90538633e-01  7.88428605e-01]
   [-5.95205843e-01  7.47466087e-02 -1.47445172e-01 ...  1.24000466e+00
    -3.22300553e-01  1.88636911e+00]
   [-6.61939532e-02  5.80882609e-01 -5.53099871e-01 ... -5.87873124e-02
     4.00111258e-01  7.34933972e-01]]

  [[ 2.00354815e-01 -2.10307598e-01  3.55871052e-01 ...  7.08514571e-01
     5.58851007e-03 -4.46488202e-01]
   [ 8.01425949e-02 -1.38881594e-01  7.02293754e-01 ...  3.11678275e-02
     2.56121401e-02 -4.59857166e-01]
   [ 2.75859892e-01 -3.79215956e-01 -1.14274621e-02 ...  5.98094583e-01
     6.53031528e-01 -9.17627335e-01]
   ...
   [ 1.46473289e-01 -3.76280993e-02  9.44043577e-01 ...  2.01336116e-01
    -1.91288486e-01 -1.83206528e-01]
   [-7.80437589e-01 -4.28289473e-01 -5.84980845e-01 ...  1.08958638e+00
     5.47809958e-01 -5.46340942e-01]
   [ 4.88506675e-01  5.81339240e-01 -2.60151088e-01 ...  1.23528743e+00
    -1.62985325e-01 -2.90847152e-01]]]


 [[[-8.07615817e-01 -1.15343344e+00  1.43600082e+00 ...  7.18166769e-01
     6.04099751e-01 -1.09548330e-01]
   [ 6.70689106e-01  1.51304793e+00 -7.39425942e-02 ...  6.09986663e-01
     8.60900879e-02  6.79533482e-02]
   [ 1.99698031e-01  2.99663544e-01 -2.51898259e-01 ...  7.21104145e-01
    -3.76465559e-01  6.46733940e-01]
   ...
   [ 2.80711442e-01  6.47476673e-01  6.08129263e-01 ...  4.13769126e-01
    -6.80703580e-01 -2.66057283e-01]
   [ 8.09854984e-01  1.06039369e+00 -1.08889902e+00 ...  9.36251819e-01
    -4.09286290e-01  1.16447425e+00]
   [ 5.83714247e-01  6.54274225e-01 -1.65784299e-01 ...  2.56409287e-01
     3.58881116e-01  3.52989256e-01]]

  [[ 3.03827733e-01  1.29115596e-01 -5.12937248e-01 ...  5.21179259e-01
    -5.65751374e-01  1.26247847e+00]
   [-4.51809615e-01 -6.74879923e-03 -2.16002464e-01 ...  9.87456501e-01
     1.56779662e-01  3.68127637e-02]
   [-3.24884802e-01  4.56397772e-01 -3.85216117e-01 ...  2.06359297e-01
     2.03139186e-01 -2.41526991e-01]
   ...
   [-5.83517790e-01  3.96603495e-01 -9.02297914e-01 ...  6.98595822e-01
    -3.20196003e-01 -3.81479919e-01]
   [-1.19667038e-01 -6.89145088e-01 -6.35410011e-01 ... -1.64294258e-01
    -1.30669165e+00  1.96469641e+00]
   [ 4.24772173e-01  3.69495422e-01 -6.50876522e-01 ... -3.91570985e-01
    -3.46668959e-02  1.00993037e-01]]

  [[ 4.35992539e-01 -6.77330494e-02  7.08684206e-01 ... -4.37932551e-01
    -7.99217373e-02 -3.86620015e-01]
   [-1.37114215e+00 -1.49515474e+00  1.67433858e-01 ... -9.23729002e-01
     1.25993562e+00  1.11499643e+00]
   [ 1.22936809e+00 -1.69393408e+00  6.50514305e-01 ...  1.05290759e+00
    -5.01630068e-01 -1.25369990e+00]
   ...
   [ 1.77796707e-01 -1.71863949e+00 -2.58015603e-01 ...  6.99040592e-01
    -5.67659557e-01 -2.81275630e-01]
   [-1.12885737e+00 -1.34067535e+00  4.35453922e-01 ... -6.63354397e-01
     1.44311666e+00  7.07235932e-01]
   [ 4.68275130e-01 -7.75296569e-01  2.05964446e-01 ...  8.42780471e-02
     3.18009257e-01 -1.33161330e+00]]

  ...

  [[-4.35528189e-01 -1.32054794e+00  2.72934937e+00 ... -8.30586791e-01
     1.02608109e+00  1.12135124e+00]
   [-2.92690098e-01  1.35519683e-01  2.64881909e-01 ... -1.49408787e-01
     1.95471078e-01  6.29044652e-01]
   [ 9.68384326e-01  1.93266416e+00 -1.10002947e+00 ... -4.92356598e-01
     7.30344832e-01  1.89750278e+00]
   ...
   [ 1.79710174e+00  8.46316040e-01 -1.02185917e+00 ...  1.02212332e-01
    -4.94679093e-01 -2.29306556e-02]
   [-2.61961043e-01  7.17249095e-01  8.32757711e-01 ... -3.88518721e-01
     7.40213990e-01  1.91696322e+00]
   [ 1.04985452e+00  4.65070695e-01 -2.48642817e-01 ... -4.44283783e-01
    -5.76454960e-03  1.73775051e-02]]

  [[-3.03241909e-01  4.20753837e-01  8.27482998e-01 ... -7.90206641e-02
    -5.12284875e-01 -1.01528490e+00]
   [ 5.94880402e-01 -3.90488446e-01 -2.97912419e-01 ... -1.48364592e+00
     1.26145065e-01 -5.88918805e-01]
   [ 3.11016500e-01 -7.41012216e-01 -2.74431109e-01 ... -1.40376699e+00
    -8.56206119e-02 -7.62922466e-01]
   ...
   [ 7.42370844e-01  2.43548229e-01  5.69240868e-01 ...  1.35813999e+00
    -3.66879255e-01  4.39109594e-01]
   [ 2.95521557e-01 -6.69120312e-01 -3.43272895e-01 ... -5.42296290e-01
    -1.29878569e+00 -4.65594977e-02]
   [ 7.49634385e-01 -6.73455715e-01  1.28297389e-01 ... -7.20099986e-01
    -6.45827115e-01 -4.52732503e-01]]

  [[ 2.67501697e-02 -3.17874476e-02 -6.80766821e-01 ... -2.45862491e-02
     2.58562505e-01 -1.24960637e+00]
   [ 8.90024483e-01 -1.46026313e-02  4.53520924e-01 ... -4.49756794e-02
     9.78469729e-01 -3.84863317e-01]
   [ 5.18837273e-01 -3.43108252e-02  2.82100320e-01 ...  4.46254432e-01
     5.67111135e-01  1.97171643e-02]
   ...
   [ 5.51524103e-01 -6.00758553e-01  1.97055191e-01 ...  3.55607301e-01
     1.00557077e+00  1.54501304e-01]
   [ 5.65220416e-01 -2.50020921e-01 -5.48404813e-01 ... -4.58824366e-01
     1.36296064e-01 -5.93254685e-01]
   [-7.92791992e-02 -1.00367284e+00 -4.50505406e-01 ...  1.75546005e-01
     2.13013247e-01  9.15101826e-01]]]


 [[[-6.96963444e-03  1.06113076e+00  2.47535601e-01 ...  7.14721859e-01
     3.08157094e-02  1.78216076e+00]
   [ 3.44690681e-01  6.35285914e-01 -2.07513064e-01 ... -1.07321873e-01
     5.93518198e-01  3.78406718e-02]
   [ 9.66113210e-01  5.24013102e-01  6.71557605e-01 ... -1.61869431e+00
     7.18194842e-01  4.52035844e-01]
   ...
   [ 3.11139405e-01 -5.34943521e-01 -3.09644371e-01 ...  3.94547045e-01
     2.95455545e-01 -1.67163350e-02]
   [ 2.99088418e-01  3.56946021e-01 -6.10395670e-01 ...  4.41012412e-01
     3.83030504e-01  9.09426391e-01]
   [-8.84265378e-02  4.51626569e-01  5.56991279e-01 ...  1.97941065e-01
     5.22200286e-01  1.92891955e-01]]

  [[-1.06816161e+00 -1.56335974e+00  5.29700398e-01 ...  3.51257712e-01
    -1.45914686e+00 -9.58811462e-01]
   [-4.67802584e-03 -1.01494305e-01  3.93753350e-02 ... -6.62341595e-01
    -1.17894471e-01  3.07785451e-01]
   [-1.27174342e+00 -5.98183632e-01  2.79025197e-01 ...  8.94257069e-01
    -1.55506396e+00  5.54872870e-01]
   ...
   [-2.70248055e-01  4.08330739e-01  2.24233150e-01 ...  6.17442310e-01
     6.81971908e-01 -7.12844789e-01]
   [-4.80224043e-01  1.19270056e-01  1.24446559e+00 ... -3.05266023e-01
     5.06722145e-02  3.21656168e-01]
   [-1.96576849e-01 -7.18304932e-01  1.86559781e-01 ... -3.25054407e-01
    -7.78824389e-01  5.79773307e-01]]

  [[-2.51272273e+00  1.43403625e+00  1.79101861e+00 ... -1.17834079e+00
     8.71739388e-01  1.87789130e+00]
   [-6.22375667e-01  2.49532387e-01  7.77532905e-02 ... -1.14532685e+00
     1.16850066e+00 -8.21605504e-01]
   [ 1.65188819e-01  3.70851718e-03 -5.83100379e-01 ...  1.31947613e+00
    -6.23091042e-01 -2.51339644e-01]
   ...
   [-3.00986886e-01  4.74936105e-02  1.41073510e-01 ... -2.49061376e-01
     6.14022851e-01 -5.63403070e-01]
   [-5.86113334e-01  7.99117804e-01  2.57042348e-01 ... -1.57042801e+00
    -9.52431709e-02  8.78738880e-01]
   [-9.59128797e-01 -1.63643301e-01  1.81809723e-01 ... -6.82621062e-01
     9.33641374e-01  3.88466805e-01]]

  ...

  [[ 7.41429567e-01 -3.30519199e-01 -5.53599000e-01 ... -2.75802046e-01
     7.49965072e-01 -3.50943506e-01]
   [ 1.33902752e+00 -3.52847949e-02  4.01394397e-01 ... -1.04733562e+00
     2.21624449e-01 -4.91805166e-01]
   [ 1.27876222e-01  1.33299780e+00  4.50860620e-01 ...  1.89384747e+00
     3.55651915e-01  8.35229218e-01]
   ...
   [ 3.29636931e-02  1.19197106e+00 -4.25272822e-01 ...  1.67751372e+00
    -1.00232333e-01  1.19522166e+00]
   [ 1.85871470e+00 -2.42059067e-01 -3.92896384e-01 ... -2.63016135e-01
     5.86810172e-01 -1.03957570e+00]
   [ 2.09099546e-01  9.71636474e-01  2.30301142e-01 ... -8.58015597e-01
     1.62213400e-01 -1.38929322e-01]]

  [[-3.36444438e-01 -3.32999974e-01 -7.53123283e-01 ... -2.07638130e-01
    -2.83042997e-01 -5.11421263e-01]
   [-1.83156177e-01  2.06219316e-01  4.68367040e-01 ... -1.35199457e-01
    -5.32696366e-01 -1.01763916e+00]
   [-3.52348804e-01 -1.48649469e-01 -5.21877944e-01 ... -9.42702293e-01
    -8.52959529e-02  1.51940420e-01]
   ...
   [ 9.74712893e-02 -7.89189219e-01 -2.84923434e-01 ... -1.22189343e+00
     4.83368337e-01 -4.61115956e-01]
   [ 6.94580555e-01 -9.41497326e-01 -2.53357500e-01 ... -4.63508844e-01
     2.46645749e-01 -1.62781072e+00]
   [-7.38585293e-01 -2.06068367e-01 -4.07559812e-01 ...  2.39458472e-01
    -3.15944970e-01 -1.05142820e+00]]

  [[-2.33137123e-02 -4.26201910e-01  3.26057643e-01 ... -3.22625250e-01
     4.12973881e-01  1.56904384e-02]
   [-9.24166381e-01  1.65892437e-01  8.26065958e-01 ... -8.77461553e-01
     2.97421575e-01  1.71986866e+00]
   [ 1.01826930e+00  5.81444763e-02  5.51074326e-01 ...  6.14441276e-01
     3.73105675e-01  4.40984040e-01]
   ...
   [-6.82266474e-01 -7.41059780e-01  8.27144504e-01 ... -1.08673358e+00
     6.66682243e-01  6.62537694e-01]
   [-4.11010534e-01  4.24304865e-02 -5.51546998e-02 ...  1.55249506e-01
     2.51872659e-01 -4.53393936e-01]
   [-6.42826438e-01 -7.00617731e-01  5.22118449e-01 ... -5.57051420e-01
     6.36588573e-01 -3.53115082e-01]]]


 [[[ 5.13509661e-03  8.60820055e-01 -3.20536375e-01 ... -9.58187461e-01
     6.15805626e-01  3.12426597e-01]
   [ 7.69331634e-01  1.29024994e+00 -3.50964427e-01 ...  9.76531208e-01
    -1.38428175e+00  1.07138678e-01]
   [ 1.63816440e+00  6.36221111e-01  2.22013712e+00 ... -2.16008258e+00
    -1.06643297e-01  2.08045673e+00]
   ...
   [ 6.78904131e-02  6.19647264e-01 -1.40949750e+00 ... -1.28271133e-01
    -3.84112448e-01  2.67067760e-01]
   [ 1.22997391e+00  8.68819833e-01  5.90213478e-01 ... -2.35753775e-01
    -6.55928075e-01  9.16332841e-01]
   [ 6.71961725e-01  5.87159097e-01  2.83029526e-01 ... -1.14824486e+00
    -4.40750569e-01  1.40367401e+00]]

  [[ 3.17075849e-01  3.88282776e-01  1.19357586e-01 ...  4.75877672e-01
     5.66922724e-01  2.23164767e-01]
   [ 7.56719485e-02  1.10724068e+00 -5.04163027e-01 ...  1.53843611e-01
     5.56216002e-01  7.76601970e-01]
   [ 6.38496280e-01 -5.15882254e-01 -8.33078086e-01 ...  4.94046837e-01
     1.02578878e+00  5.78332484e-01]
   ...
   [-9.32715088e-02 -7.25287050e-02  1.01483893e+00 ...  4.61402804e-01
     1.09046245e+00 -1.68205500e-01]
   [-3.27845275e-01  4.53238368e-01  1.66358352e+00 ...  3.81941050e-01
    -4.46929842e-01 -5.07314265e-01]
   [ 1.01380026e+00 -8.36295545e-01 -1.79102492e+00 ...  8.88698995e-01
     2.08030224e+00  7.46353194e-02]]

  [[-1.35617375e+00 -1.50487661e+00  2.04402423e+00 ...  1.27425086e+00
     7.69980490e-01  5.53974450e-01]
   [-7.92007267e-01 -1.30353677e+00  9.11431015e-01 ...  7.29277074e-01
     7.73831248e-01  2.38960043e-01]
   [ 7.80947208e-01 -9.54028428e-01 -7.05695868e-01 ...  6.20969892e-01
    -3.13245624e-01 -8.10560048e-01]
   ...
   [-3.97963077e-01 -3.13039243e-01  1.32434189e-01 ...  2.57870972e-01
     4.57834959e-01  2.35803246e-01]
   [ 1.19231308e+00 -8.44705880e-01 -1.11705613e+00 ...  8.79268885e-01
    -8.21923792e-01 -8.79338443e-01]
   [ 7.15175688e-01 -1.24196494e+00 -2.61666358e-01 ...  3.30515474e-01
     1.39026210e-01 -5.09308457e-01]]

  ...

  [[-1.90778166e-01 -7.64875591e-01  3.06433260e-01 ...  3.50682020e-01
    -9.35827136e-01  3.38573754e-01]
   [-3.07108968e-01 -1.22256029e+00 -1.53816497e+00 ...  1.47939622e+00
    -1.53072023e+00  7.90563285e-01]
   [ 8.41188610e-01 -2.66540384e+00  1.69990087e+00 ...  1.07626462e+00
     6.77438080e-01 -1.46864736e+00]
   ...
   [-1.57677054e-01 -1.65809286e+00  1.19404173e+00 ...  8.28184009e-01
     1.27362919e+00 -4.68374014e-01]
   [ 1.94587737e-01 -5.21089733e-01  3.65173399e-01 ...  2.87710056e-02
    -4.29370314e-01 -6.89912260e-01]
   [-7.46806443e-01 -4.46989208e-01  5.76055586e-01 ...  2.24367380e-01
     4.00748491e-01  9.53863919e-01]]

  [[-4.01341975e-01  6.14136010e-02 -9.20332611e-01 ...  1.61144108e-01
    -3.96494120e-01  8.28395709e-02]
   [ 6.58285677e-01  1.41735876e+00 -6.24441266e-01 ... -2.21741498e-01
     5.16968608e-01  9.11988914e-01]
   [ 1.06851840e+00  6.82310879e-01 -8.01804960e-01 ...  1.99156821e-01
     2.92654216e-01  1.47831321e+00]
   ...
   [-5.20695627e-01 -6.35172844e-01 -5.50711393e-01 ...  1.02564251e+00
    -2.34760419e-01  1.59982309e-01]
   [-3.65699381e-02  2.45227411e-01 -3.16716969e-01 ...  7.47060537e-01
     1.29644245e-01  1.09244871e+00]
   [-2.29993060e-01 -2.67816573e-01 -5.19306779e-01 ...  1.31643319e+00
     4.06938493e-02  4.62852687e-01]]

  [[ 1.89366388e+00 -1.39253390e+00 -5.05520642e-01 ...  2.97791809e-01
     1.04940884e-01  1.16354525e+00]
   [-3.68139505e-01 -6.35474682e-01 -2.72458577e+00 ...  1.15559959e+00
     4.02049124e-01 -3.96923721e-01]
   [ 2.02578425e+00 -4.60892856e-01  9.63247240e-01 ...  2.82172978e-01
     5.55950344e-01  2.56814241e+00]
   ...
   [ 1.02140233e-01  7.73276210e-01  5.01871228e-01 ...  5.21274030e-01
     1.32453591e-01 -2.84538358e-01]
   [ 1.72171092e+00  1.03173681e-01  1.29276383e+00 ...  2.80606687e-01
     5.10869682e-01  1.38153386e+00]
   [-1.56089112e-01 -9.26118612e-01 -7.72087455e-01 ...  4.47130382e-01
     3.89755517e-01 -1.80325672e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-False-32-8-27-11-8] q.shape1: (8, 11, 27)
q.shape2: (88, 27)
q.shape3: (88, 27)
q.shape4: (8, 11, 27)
q_liner: [[[ 0.7224421  -0.4349443   3.4143312  ...  0.35247484  1.755044
    1.3171575 ]
  [ 2.726345    1.2628067  -1.7939713  ... -0.06979546  0.00453782
    3.1302361 ]
  [-1.1040715  -0.15600364  1.9368501  ... -0.5825903  -0.65041417
   -2.2147686 ]
  ...
  [ 2.2915697   0.908618    1.0856221  ... -1.3256544   0.3059599
   -0.8404981 ]
  [-0.40498114 -0.5691511   2.6631112  ...  0.8738295   0.4198153
    1.1513562 ]
  [-0.4481117  -0.92076814  3.5576978  ...  2.7185454   3.3272922
   -0.97112256]]

 [[-1.1616747  -1.7085901  -0.06308014 ... -0.84628963  0.9343368
   -0.6217179 ]
  [ 0.4018707   0.30482602  0.46497503 ...  0.11524689  0.10966628
   -0.6314564 ]
  [ 2.181069   -1.1074287   1.3467315  ...  0.3924123   0.333957
    0.59106386]
  ...
  [ 3.5478017   0.51425123 -2.1266656  ... -1.1019756  -0.78907716
    2.1269352 ]
  [-1.6231765  -2.7684586   0.24566987 ... -0.25909057 -0.6573771
   -1.6647071 ]
  [ 2.5132887   0.55106294  0.7015406  ...  1.2227943   0.7392053
    1.8680627 ]]

 [[ 0.27821246 -1.1018684   1.7200263  ... -1.7082299  -0.4673362
   -2.2366893 ]
  [ 2.7587233   1.7226602   0.80260444 ...  1.1995286  -0.92798245
    0.2717521 ]
  [ 0.64558136  0.08447142  0.4400963  ...  1.3089368   1.2809186
   -1.5577403 ]
  ...
  [-1.0232698  -1.5747494   1.018051   ...  0.00518736 -0.4626458
    0.8344153 ]
  [ 1.1266454   0.38148978  2.193111   ... -1.535103    0.7982023
   -0.95043397]
  [-0.9965041  -1.8504593   1.8635492  ...  1.692321    1.8115427
   -0.7349715 ]]

 ...

 [[ 2.0749588   2.2624092   0.34631866 ... -3.2463973   1.0677856
    1.5288495 ]
  [ 0.26497793  1.3373191   3.0214698  ...  0.41106525 -0.168928
    0.03355249]
  [ 0.5420742   1.2251354  -3.826573   ... -0.3492088  -0.03093641
    0.7989888 ]
  ...
  [-3.2419846  -1.4931114   0.72515845 ...  1.7054092  -0.04060049
   -2.0626805 ]
  [ 0.9767814   0.28908026 -1.5257835  ... -3.0712612  -0.89618737
   -0.34019697]
  [ 0.62380505  1.7282047  -0.0089727  ...  3.7021785  -0.5753088
    1.6830212 ]]

 [[ 2.0232096   0.64801383  0.06984097 ...  0.75521886  0.41255075
    0.5661507 ]
  [ 0.1846309   0.6487752  -2.7815032  ...  0.88175464 -0.7132604
   -0.08390007]
  [-1.9218032   0.28904673 -1.1362168  ... -2.5849714  -0.15884835
   -1.8206904 ]
  ...
  [-1.7156733  -0.79765487 -1.7961345  ... -0.48244846  1.5824316
    0.23448431]
  [-0.93504095 -0.5579303  -1.3916396  ... -1.3223844  -0.33638978
   -0.6543721 ]
  [-3.1369114  -1.0516436   3.0829988  ...  0.66301984  1.6387496
   -2.8189466 ]]

 [[ 0.5203575   2.510916   -2.5926096  ... -0.47947776 -2.6331599
    1.5112784 ]
  [ 0.2482923   0.10941231 -1.2460439  ...  1.8010229  -0.24936317
   -0.89507395]
  [-0.4074848   0.35642445  1.1563052  ... -0.9337908  -0.3271042
    0.46405247]
  ...
  [ 0.87635964  0.15448402  0.44426605 ... -1.1368421   0.7098688
   -0.3491225 ]
  [-2.248125    0.22241627 -1.8704771  ... -1.2285389   0.29145718
   -0.22001871]
  [-1.0332358   0.15769057 -1.6133977  ...  0.13136601  1.1417925
   -0.2518325 ]]]
q.shape5: (8, 11, 256)
q.shape6: (8, 8, 11, 32)
attn_res: [[[[ 1.21430433e+00  1.95367083e-01 -9.86170948e-01 ...  1.98731732e+00
     5.10460027e-02  1.77679396e+00]
   [ 1.40532959e+00  1.44045281e+00 -5.27803123e-01 ... -6.27148390e-01
    -9.30280745e-01 -1.97408104e+00]
   [ 2.04509163e+00  8.85950446e-01 -6.11198664e-01 ... -5.07280111e-01
    -1.24272060e+00 -1.14945841e+00]
   ...
   [ 1.32808363e+00 -9.84155387e-02  1.12253189e-01 ...  5.49309671e-01
    -1.93467963e+00 -5.95809102e-01]
   [ 1.83262908e+00  6.42086327e-01 -4.19836491e-01 ... -3.67607445e-01
    -1.15683246e+00 -9.10497606e-01]
   [ 1.05437362e+00 -2.61561573e-01  1.35842472e-01 ...  1.24704339e-01
    -1.13332480e-01  5.12320280e-01]]

  [[-5.00326633e-01 -5.06486952e-01  3.12151201e-03 ...  5.54592311e-01
     3.35716009e-01  9.56450045e-01]
   [-7.70857811e-01  4.96236295e-01 -9.66503203e-01 ... -5.41272201e-02
    -2.64924049e-01  1.42728388e-01]
   [ 1.50207669e-01 -1.79926157e-02  4.17005926e-01 ...  2.90578485e-01
     8.21782649e-01 -1.49019027e+00]
   ...
   [ 6.50553480e-02  2.42546305e-01  3.48377913e-01 ...  2.83440828e-01
     1.38445497e+00 -1.78110886e+00]
   [-1.54654890e-01 -4.92315590e-01  3.04457486e-01 ...  2.72951275e-01
     6.44148529e-01  9.92902815e-01]
   [-9.12903786e-01 -5.15863478e-01  2.18485713e-01 ...  8.71827960e-01
     2.18937397e-01  1.18633270e+00]]

  [[-4.69289303e-01  7.93021202e-01 -7.65970290e-01 ...  6.38635635e-01
     5.17525077e-01 -1.47592926e+00]
   [-1.04003263e+00  6.65258765e-01 -4.51359391e-01 ...  1.26560330e+00
     3.35381329e-01 -1.31179380e+00]
   [-8.78557384e-01 -3.26175690e-01 -1.07492357e-02 ... -1.50817379e-01
    -9.96453762e-02 -4.94703650e-03]
   ...
   [-3.13848317e-01 -1.37600160e+00 -9.70607921e-02 ...  8.37982595e-01
    -7.79091120e-01  8.28727782e-02]
   [ 5.55957220e-02  4.49211538e-01 -7.94008195e-01 ... -4.90786761e-01
     9.09446657e-01 -2.16512060e+00]
   [-6.49106860e-01  6.73618913e-01 -5.90066016e-01 ...  1.95189148e-01
     5.03111660e-01 -7.89762288e-03]]

  ...

  [[-3.33397865e-01 -2.62789428e-01 -1.07285842e-01 ...  3.67383897e-01
     4.90355492e-01 -1.30703425e+00]
   [-9.22066569e-01  5.66003144e-01 -4.22036014e-02 ...  3.71808559e-03
    -3.19167525e-01  3.19923162e-01]
   [-3.68259817e-01 -1.09754968e+00  8.98916543e-01 ... -1.65266022e-01
    -6.59303010e-01 -5.56451082e-01]
   ...
   [-2.21505359e-01  1.96496576e-01  3.18922669e-01 ... -1.16578972e+00
    -9.90111470e-01 -4.12990332e-01]
   [ 1.27243772e-01  5.81158519e-01 -7.11112261e-01 ... -1.08970344e-01
     1.49704143e-01 -1.62113333e+00]
   [-1.35383576e-01 -3.08974773e-01 -1.91549152e-01 ...  4.15296257e-01
     7.18355358e-01 -1.56317377e+00]]

  [[ 1.25201046e+00 -6.88264742e-02  9.09437716e-01 ...  6.97375357e-01
    -7.00079024e-01 -1.56375661e-01]
   [ 1.37135541e+00 -1.13144897e-01 -8.17847192e-01 ... -2.82987356e-01
    -1.59908250e-01 -5.66148385e-02]
   [ 1.41456556e+00  2.16974214e-01 -9.53759730e-01 ... -3.48024338e-01
     2.11336881e-01 -5.31475758e-03]
   ...
   [ 1.71713424e+00  1.32508904e-01 -4.54624861e-01 ... -1.96862757e-01
    -2.41060704e-02 -1.50328368e-01]
   [ 1.46285653e+00 -6.25709653e-01  1.39684689e+00 ...  9.26967561e-01
    -1.10487700e+00 -8.42395127e-01]
   [ 1.34272611e+00 -5.13755798e-01  9.21667337e-01 ...  5.77723444e-01
    -8.79723608e-01 -8.99160624e-01]]

  [[ 4.13629524e-02 -1.64321864e+00 -4.76301879e-01 ...  3.46252352e-01
     1.37687862e+00  1.48105109e+00]
   [ 4.16469485e-01 -8.15060735e-01 -5.92675686e-01 ...  8.06153357e-01
     5.52231908e-01  5.91825783e-01]
   [-2.70232141e-01 -5.88975787e-01 -7.65304983e-01 ...  5.48543274e-01
     7.37306237e-01  2.63970792e-01]
   ...
   [ 8.87127399e-01 -7.56061196e-01 -1.21097720e+00 ...  1.22413911e-01
     1.32819998e+00  2.40550816e-01]
   [-1.11602575e-01 -1.21645331e+00 -2.70749897e-01 ... -4.46483213e-03
     1.55933034e+00  1.55052722e+00]
   [ 3.87121849e-02 -5.42808354e-01 -2.84451008e-01 ...  9.71410751e-01
     4.33796197e-01  7.04505920e-01]]]


 [[[ 2.73378313e-01  5.57699859e-01 -1.03941374e-01 ... -1.48270452e+00
     1.25513887e+00  2.63130456e-01]
   [-9.77839977e-02 -4.43963349e-01  5.02835333e-01 ...  9.64792669e-02
     2.26148784e-01 -6.20761096e-01]
   [-3.94431800e-01 -6.45707071e-01  5.70508599e-01 ...  3.09781194e-01
     3.93033147e-01 -6.68910146e-01]
   ...
   [-2.93609500e-01 -6.38797283e-01  9.56644654e-01 ...  5.62237561e-01
     7.71670192e-02 -4.07319456e-01]
   [-1.38379169e+00  2.25716025e-01  6.92568898e-01 ... -5.64243868e-02
     4.91313010e-01 -5.64059973e-01]
   [-9.06590581e-01 -5.65421939e-01  1.32119751e+00 ...  7.92022124e-02
     9.38407660e-01 -3.16813327e-02]]

  [[ 6.46291599e-02  1.15162313e+00  9.25112724e-01 ...  1.90021172e-01
     3.05479348e-01 -7.09059909e-02]
   [-1.18940222e+00  3.80001694e-01 -1.30664623e+00 ... -1.05088189e-01
    -1.08396888e+00  1.73362181e-01]
   [-8.01298141e-01  4.91965115e-01  2.04758644e-01 ...  1.57499647e+00
     3.52660656e-01  2.54040778e-01]
   ...
   [-1.49099684e+00 -8.06108177e-01  1.25392675e+00 ...  2.66316205e-01
     6.99963450e-01 -4.57678363e-02]
   [ 1.58892781e-01  1.10147834e+00  3.99083912e-01 ...  7.90956438e-01
     4.24051166e-01  7.27496296e-02]
   [-4.83647361e-02  4.36622113e-01  5.47260702e-01 ...  4.69822526e-01
     1.13277003e-01  6.39422238e-03]]

  [[-4.80182469e-01 -4.41875935e-01  5.56158900e-01 ...  6.72816515e-01
     4.15135086e-01 -3.74941111e-01]
   [ 6.80305004e-01 -2.30802178e-01  2.04429194e-01 ...  6.48176074e-01
    -1.86461210e-02  7.94600546e-01]
   [ 8.84120107e-01 -1.43147185e-01  4.81888890e-01 ...  6.88107431e-01
     1.13250785e-01 -8.45286846e-02]
   ...
   [ 1.38621271e+00  8.37670028e-01  9.66261104e-02 ...  1.98860571e-01
     4.72786963e-01  5.44513762e-02]
   [ 5.42516172e-01 -2.55351625e-02 -2.54204609e-02 ...  1.42131209e-01
     4.55327302e-01 -3.73935103e-01]
   [ 1.13654160e+00 -1.26374829e+00 -5.94699264e-01 ...  1.06376255e+00
    -1.00664997e+00 -4.42791045e-01]]

  ...

  [[-1.42977691e+00  1.50997365e+00  4.37664658e-01 ... -2.68158841e+00
    -1.16268051e+00  1.05820346e+00]
   [-7.16515303e-01  6.18245184e-01 -6.74299777e-01 ... -6.39713705e-01
    -9.39467475e-02 -5.05662262e-01]
   [ 9.45054352e-01  2.38694593e-01  4.85502668e-02 ... -8.78917038e-01
     1.61043972e-01 -1.39803004e+00]
   ...
   [-1.99473817e-02  3.36684287e-01 -8.10267746e-01 ...  1.19536543e+00
     6.65902793e-01 -1.33116090e+00]
   [-2.66535908e-01  1.40933180e+00 -1.68265641e-01 ...  8.40118945e-01
    -3.11801016e-01 -3.38576645e-01]
   [-5.50514996e-01  5.11174440e-01 -2.15692759e-01 ... -7.74040639e-01
    -1.43968791e-01 -2.71022856e-01]]

  [[ 1.96360126e-01  3.38328093e-01 -1.55741513e-01 ...  2.81046093e-01
    -7.83133209e-01  3.99579108e-01]
   [ 1.34362817e+00 -3.98097277e-01 -4.52202052e-01 ... -4.67975557e-01
    -1.16165423e+00  1.65199250e-01]
   [-3.65528852e-01  4.20012437e-02  4.93706226e-01 ...  5.21207631e-01
     3.53339404e-01  2.90772617e-01]
   ...
   [ 3.19833308e-01 -6.33637905e-02  7.76863813e-01 ...  5.29089212e-01
     2.56699502e-01 -1.95207584e+00]
   [-2.95496613e-01  3.69723767e-01  7.53824294e-01 ...  3.45492870e-01
     3.72324795e-01 -2.58169621e-01]
   [-4.37480032e-01  8.09769273e-01  1.02907836e+00 ... -4.97010738e-01
     6.60119832e-01 -1.02402699e+00]]

  [[-5.63182831e-01  3.26509207e-01  4.41508830e-01 ... -1.80813402e-01
     9.28705692e-01  8.96516442e-01]
   [-4.98677433e-01  2.08694994e-01  1.20291793e+00 ...  5.57697773e-01
     4.88843083e-01  2.34998658e-01]
   [ 4.09964591e-01 -1.63653910e-01  1.41248190e+00 ... -3.84977728e-01
     7.24050641e-01  1.62685919e+00]
   ...
   [ 1.84514791e-01  3.63180131e-01  5.35923600e-01 ...  3.03172261e-01
     9.90146518e-01  7.95229018e-01]
   [-4.21291351e-01  1.18817680e-01  8.57229471e-01 ... -1.48841143e-02
     5.96742511e-01  9.82198119e-01]
   [ 7.27238655e-01  7.83828855e-01  6.76017776e-02 ... -6.69153214e-01
     1.38852048e+00  6.04394734e-01]]]


 [[[-7.99952149e-01 -1.29546809e+00  2.01614928e+00 ...  1.92318380e-01
     9.53911781e-01  6.44336224e-01]
   [-8.87548983e-01 -8.61774266e-01  1.19562900e+00 ... -1.18683808e-01
     2.02920818e+00  8.10754538e-01]
   [-6.06236875e-01 -6.57211781e-01 -5.56815386e-01 ...  7.62462318e-01
     5.22738993e-02  2.63655037e-01]
   ...
   [ 5.14155149e-01 -2.56278276e-01 -2.99385488e-01 ...  2.60004193e-01
    -3.25936228e-01  9.49435651e-01]
   [-6.32858992e-01 -9.84936595e-01  1.38231182e+00 ... -8.12654793e-02
     5.20140767e-01  9.83083010e-01]
   [-4.29668754e-01 -6.79789722e-01  1.17221427e+00 ...  1.40322521e-01
     2.90795207e-01  6.14536762e-01]]

  [[-5.62321484e-01  8.69850993e-01  3.93767476e-01 ...  2.99446344e-01
     1.96138948e-01  6.32410169e-01]
   [-1.51524797e-01  8.16248506e-02  4.42554504e-01 ...  1.00104995e-01
    -2.00041682e-01  4.48002428e-01]
   [-5.30903578e-01  8.07812274e-01  1.30700409e+00 ...  8.20464313e-01
     2.11759135e-01  2.23628139e+00]
   ...
   [ 7.00154483e-01  2.95984960e+00  7.83693075e-01 ... -1.29262768e-02
     2.20183468e+00  5.22108197e-01]
   [-2.64560968e-01  1.37446713e+00  9.19277072e-01 ...  1.37048006e-01
     7.55904853e-01  6.99814618e-01]
   [-3.33450228e-01  6.59322381e-01  9.79734957e-01 ... -4.53988463e-01
     3.19667995e-01  1.51572913e-01]]

  [[-9.53416586e-01  1.30904424e+00 -2.74996608e-01 ... -2.66875595e-01
    -1.02468348e+00 -4.70613211e-01]
   [-7.34875202e-01 -5.60728908e-01  3.47761005e-01 ... -1.88582629e-01
    -7.77569652e-01 -6.64631188e-01]
   [-2.09956184e-01  9.81543779e-01  2.92098701e-01 ... -5.54514170e-01
     6.59384429e-01 -3.92616093e-01]
   ...
   [-1.11117244e+00  8.50478292e-01  4.80478346e-01 ...  2.69357637e-02
     2.90235549e-01 -1.92147121e-01]
   [ 4.99617100e-01  1.29731250e+00  2.82076932e-02 ... -8.64189267e-01
    -2.38995135e-01 -5.12898386e-01]
   [-1.46691561e+00  2.76467085e-01  7.83053100e-01 ... -4.68465924e-01
     3.53129476e-01  9.56063390e-01]]

  ...

  [[ 3.92673671e-01  4.06375468e-01 -8.89274240e-01 ... -2.60544807e-01
    -8.67724791e-02  8.00719857e-02]
   [ 8.84535238e-02 -3.01505476e-01  6.08557403e-01 ... -8.79934430e-01
     4.44719106e-01 -4.15235549e-01]
   [-5.22598386e-01 -1.15809536e+00  8.79547238e-01 ...  1.77489407e-02
     1.24920821e+00  1.71398926e+00]
   ...
   [ 9.66729745e-02 -2.71921694e-01  1.05219163e-01 ... -1.60224825e-01
     4.85783368e-01  2.71760255e-01]
   [-1.04037024e-01  5.51234305e-01 -3.71939749e-01 ... -2.68017739e-01
    -4.18296233e-02  4.92915779e-01]
   [ 1.72556236e-01 -7.90012032e-02 -1.58772618e-01 ... -7.25641370e-01
     9.49458256e-02 -4.51774120e-01]]

  [[ 4.33354110e-01 -9.12738800e-01  4.04014587e-01 ... -5.86677313e-01
    -6.90147400e-01 -2.22568333e-01]
   [-4.34015542e-01 -9.67978477e-01  7.61893570e-01 ...  2.72453618e+00
     1.82633530e-02 -5.31107485e-01]
   [ 3.47408295e-01 -4.45369542e-01  9.60410655e-01 ...  1.65462166e-01
    -7.38756061e-01 -5.94124556e-01]
   ...
   [-1.17702484e-01 -2.31725752e-01  9.91754711e-01 ...  3.57168943e-01
    -6.13559186e-02 -5.91243029e-01]
   [ 1.25656891e+00 -8.02354440e-02  9.73269343e-01 ...  1.92151666e-01
     6.26688600e-01 -5.75583339e-01]
   [ 1.34372258e+00 -5.14276445e-01  1.41382957e+00 ... -4.91896987e-01
    -2.55720437e-01 -9.13248241e-01]]

  [[-5.89185774e-01  9.05737042e-01  2.23898983e+00 ...  3.78607869e-01
     3.32203269e-01  9.52588081e-01]
   [ 7.99068391e-01 -2.49833107e+00 -1.10012436e+00 ...  1.93317503e-01
    -1.13372481e+00  1.62596357e+00]
   [ 5.49762428e-01 -6.80570364e-01 -2.58626819e-01 ...  2.45512649e-01
    -2.46542692e-02  1.05427623e+00]
   ...
   [-9.51325834e-01  8.33900869e-01  1.62970573e-02 ... -8.20657134e-01
     6.63949922e-02  4.26752448e-01]
   [-1.76935577e+00  8.60293806e-02 -3.47018480e-01 ... -1.54106355e+00
     1.10824183e-02  7.66723692e-01]
   [-1.08978462e+00  1.04029369e+00 -7.97640562e-01 ... -1.41758609e+00
     1.64621606e-01  3.69242907e-01]]]


 ...


 [[[ 1.04057884e+00 -3.65653157e-01  1.33510268e+00 ... -6.77752078e-01
    -9.15333331e-01  3.22917432e-01]
   [ 3.44460130e-01  9.08236206e-02 -6.65953696e-01 ... -3.98714006e-01
    -5.49227118e-01  4.07694131e-01]
   [-2.72252858e-01  1.10588968e-01 -5.98873556e-01 ... -8.46343696e-01
    -5.76786280e-01 -3.91833335e-01]
   ...
   [ 1.41690409e+00  6.19692445e-01 -7.27865279e-01 ... -2.26166415e+00
    -1.51152265e+00 -4.44873959e-01]
   [ 1.12389350e+00 -2.30034798e-01 -4.27550822e-01 ... -4.50677395e-01
    -2.97752231e-01  2.31265694e-01]
   [ 3.23576719e-01  6.95001334e-02 -1.09837282e+00 ... -5.93767881e-01
    -3.21236461e-01 -5.73535152e-02]]

  [[-6.93099722e-02 -8.06742609e-01  8.43312085e-01 ... -6.20516658e-01
    -2.73458123e-01 -2.31947088e+00]
   [-2.07545042e-01  1.69321895e-03  2.33536988e-01 ... -1.68798417e-01
     4.12255913e-01 -7.93007374e-01]
   [-1.28407747e-01  2.69621640e-01  3.90891731e-02 ... -2.19196528e-02
     6.20089769e-01 -1.00706577e-01]
   ...
   [-1.66002184e-01  3.97296876e-01  4.55636024e-01 ...  1.27312100e+00
     1.32921135e+00  1.37789965e+00]
   [ 3.39650959e-02  5.12247324e-01  3.11262995e-01 ... -5.32114744e-01
     1.10240304e+00  8.36712718e-02]
   [ 1.55748241e-02 -1.05891772e-01  3.76196623e-01 ...  9.22345042e-01
     2.87458152e-02 -1.47092175e+00]]

  [[-2.93003619e-01 -2.54055709e-01  4.83809710e-01 ...  5.18875778e-01
     3.82511348e-01 -5.49129099e-02]
   [-1.38420844e+00  4.15156543e-01 -1.01812094e-01 ... -6.48173034e-01
     1.27957582e+00 -1.19163647e-01]
   [ 5.25335550e-01 -4.28548604e-01  1.51299044e-01 ...  2.32244104e-01
    -1.34806097e-01 -2.95448273e-01]
   ...
   [ 1.38475627e-01 -4.36962068e-01 -9.77301523e-02 ...  4.53921467e-01
     4.68413204e-01 -6.77605748e-01]
   [-1.43204975e+00 -4.21410859e-01 -1.03158474e+00 ... -8.33915770e-01
     1.06390643e+00 -1.65983593e+00]
   [-7.95671105e-01  2.72055268e-02  5.88857055e-01 ... -2.24537715e-01
     4.74835068e-01  3.15239757e-01]]

  ...

  [[-2.10885867e-01 -4.74005371e-01  1.13106072e+00 ... -1.16507876e+00
    -1.26220453e+00  2.04856467e+00]
   [-1.72322035e+00 -2.25166723e-01 -4.20702398e-01 ...  1.11549839e-01
     2.58753181e-01  3.11554790e-01]
   [ 2.28373662e-01  1.26420581e+00 -2.10871160e-01 ...  8.15333575e-02
    -7.96976760e-02 -4.10254560e-02]
   ...
   [-2.35500193e+00  8.94813985e-02 -1.08946495e-01 ... -6.08490229e-01
     3.25145245e-01  2.99513847e-01]
   [-5.41850448e-01 -3.56395185e-01  1.05306756e+00 ... -1.09155035e+00
    -1.40111327e+00  1.77574217e+00]
   [-3.28795284e-01 -6.32193923e-01  5.71555376e-01 ... -9.05484080e-01
    -1.80358529e-01  1.28702950e+00]]

  [[ 1.62765491e+00 -1.33334303e+00  3.29724848e-02 ... -2.94031620e-01
    -1.49397981e+00 -6.82668269e-01]
   [ 1.93361491e-01 -1.36452094e-02 -6.14863873e-01 ... -3.60868633e-01
    -4.95783836e-02  5.26021361e-01]
   [ 2.20095873e+00  3.62804271e-02  4.07804519e-01 ... -1.00525129e+00
    -7.93217480e-01 -1.98684216e+00]
   ...
   [-8.95953536e-01 -7.19013691e-01 -4.03126508e-01 ...  4.24666226e-01
    -5.58519423e-01  4.67020303e-01]
   [ 1.77882686e-01 -5.89164674e-01 -3.97542030e-01 ... -9.66592282e-02
    -1.69499964e-03 -1.18847847e+00]
   [ 1.18751168e-01 -1.08804810e+00  1.21069387e-01 ... -1.99705452e-01
    -4.81202304e-01 -7.03940094e-01]]

  [[-7.38455176e-01 -1.71980977e-01 -4.30914968e-01 ...  5.21976575e-02
    -3.07294875e-01  5.33013046e-01]
   [-9.86617953e-02 -4.98298585e-01  1.92375854e-01 ... -2.03318983e-01
     4.62413996e-01  1.39709806e+00]
   [-8.83836210e-01 -1.65591314e-01  9.16845083e-01 ...  1.30434319e-01
     6.94219470e-01  1.32118380e+00]
   ...
   [-8.18233669e-01  4.42174107e-01  1.19892992e-01 ... -1.37070194e-01
     2.18338370e-01 -3.96375179e-01]
   [-1.62424350e+00  2.95197338e-01  4.69364017e-01 ... -4.26332653e-01
    -1.10425159e-01  7.11631060e-01]
   [ 5.84261715e-02  3.51829141e-01  9.17507708e-02 ...  4.98433679e-01
     3.81224126e-01  3.94881606e-01]]]


 [[[-1.39094806e+00  1.13471067e+00  3.06265354e-01 ... -9.15451646e-01
     4.35020566e-01  1.10993636e+00]
   [-7.80530274e-02 -2.08305764e+00  1.29794165e-01 ...  1.46709955e+00
     2.73279011e-01  2.05284619e+00]
   [ 1.72965539e+00 -7.28800654e-01  1.35864317e+00 ...  1.51326454e+00
    -5.71336448e-01 -4.85637814e-01]
   ...
   [ 9.30102885e-01 -1.05770612e+00  1.42149985e+00 ...  7.18816221e-01
     6.46519661e-03  8.90248477e-01]
   [ 4.66113180e-01 -2.04325843e+00  8.71262789e-01 ...  1.70134306e+00
     2.99001050e+00  1.04885650e+00]
   [ 1.40804076e+00 -2.32210398e+00  7.60907769e-01 ...  1.47407913e+00
     1.97639108e+00  9.83586073e-01]]

  [[-1.25038475e-02 -2.94363558e-01 -2.71596640e-01 ... -8.33407938e-01
     2.21281004e+00 -2.22845626e+00]
   [-4.40799683e-01 -3.25630009e-01  2.58714706e-01 ... -1.08912051e+00
     3.79687399e-01 -1.24911582e+00]
   [ 6.36778772e-01 -7.90999711e-01  8.49642873e-01 ... -1.82081604e+00
     6.41111135e-01 -9.76312220e-01]
   ...
   [ 4.39429283e-01 -4.26334679e-01  1.06695831e+00 ... -1.86886144e+00
     4.55452263e-01 -1.41151118e+00]
   [-5.30725241e-01 -4.46230680e-01 -1.86975032e-01 ...  1.33711457e-01
     5.32465756e-01 -8.92182291e-01]
   [ 1.88930452e-01 -2.38757402e-01  5.91547489e-01 ... -1.13304853e+00
     9.56508279e-01 -7.99867392e-01]]

  [[-9.25552845e-01  1.12684846e+00  3.76927912e-01 ... -2.18073115e-01
     1.59032035e+00 -1.14864075e+00]
   [-8.56576383e-01  2.62233287e-01 -1.14798689e+00 ...  7.84506723e-02
     1.85198164e+00 -2.50243282e+00]
   [-6.86192214e-01  2.00725511e-01 -3.43154728e-01 ...  1.90381333e-02
     1.36444366e+00 -2.11067104e+00]
   ...
   [-1.45973754e+00 -3.94865513e-01 -8.19981217e-01 ...  1.95821226e-01
     7.22131848e-01 -2.07966232e+00]
   [-9.35377955e-01  9.12891179e-02  5.54867327e-01 ...  3.05952787e-01
     4.29756403e-01 -1.39303887e+00]
   [-8.18779945e-01  9.82970953e-01 -3.34682494e-01 ...  8.74235928e-01
     6.39162511e-02 -1.48706603e+00]]

  ...

  [[-2.63190493e-02 -8.55469704e-01  8.60580742e-01 ... -1.67544544e+00
    -1.44934261e+00  9.31365967e-01]
   [ 2.21316338e-01 -8.01023841e-02 -1.88571417e+00 ...  1.82949305e+00
     1.91516101e-01  6.04139864e-01]
   [-1.21083713e+00  1.12938619e+00 -1.00921738e+00 ... -2.87985086e-01
    -1.52367449e+00 -1.07630861e+00]
   ...
   [ 3.30667436e-01 -3.01732160e-02 -5.21521211e-01 ... -2.62877196e-01
    -6.63598597e-01  8.23431313e-01]
   [ 2.27649584e-01  1.44775972e-01 -9.74749506e-01 ...  4.27070320e-01
    -5.37648439e-01  2.31448397e-01]
   [-1.17132652e+00  8.24551046e-01 -8.22138429e-01 ... -9.19350266e-01
    -6.45599604e-01  1.05909899e-01]]

  [[-5.13848126e-01  7.06665665e-02  7.44746089e-01 ...  3.23330820e-01
    -7.58171797e-01 -1.07888639e+00]
   [ 4.76053953e-01  6.93877041e-01  6.71593189e-01 ... -1.55399215e+00
    -1.05673289e+00 -3.95773351e-01]
   [-9.97883916e-01 -3.78564522e-02  9.19824779e-01 ...  4.78389174e-01
    -9.82331991e-01  1.81271061e-01]
   ...
   [-6.32896185e-01  4.49284077e-01  7.52363682e-01 ...  2.65484780e-01
    -4.70979601e-01 -8.02484870e-01]
   [-1.38215065e-01  1.19154084e+00  9.25849795e-01 ...  6.13772988e-01
    -6.50341362e-02 -5.47787905e-01]
   [-2.44571596e-01 -4.30736125e-01  9.35387611e-01 ... -2.97742701e+00
    -1.58123815e+00  4.65305805e-01]]

  [[ 2.18809113e-01 -5.99633634e-01  5.51481068e-01 ...  6.01673275e-02
    -1.04667664e-01  1.13315582e+00]
   [ 6.14322543e-01 -1.41503644e+00  8.42867136e-01 ...  2.48670578e-01
    -7.32023954e-01  1.48664761e+00]
   [ 3.48843366e-01  1.90451133e+00 -6.67429149e-01 ... -6.14400133e-02
    -2.93051839e-01  4.67769921e-01]
   ...
   [ 3.66936654e-01  1.24892044e+00  5.54006100e-01 ...  8.46517563e-01
    -3.50926608e-01 -2.89401263e-01]
   [ 2.84664035e-01  1.19622254e+00 -1.38225234e+00 ...  2.95753121e-01
    -4.41631377e-01  5.76165438e-01]
   [ 3.17377865e-01  7.78876066e-01  5.50578654e-01 ...  7.22341537e-01
    -1.98021710e-01 -3.64834756e-01]]]


 [[[-1.36375511e+00 -1.32790375e+00  1.09737122e+00 ...  1.89339876e-01
     1.30297589e+00  1.31895149e+00]
   [-5.31971514e-01 -2.61570960e-01 -3.07893693e-01 ... -9.86105859e-01
    -1.59629560e+00 -1.80353403e-01]
   [-4.15173948e-01 -1.61696553e+00  5.78364968e-01 ... -2.14726642e-01
    -9.57022369e-01  4.46940064e-01]
   ...
   [-4.22921091e-01  1.01357222e-01 -1.43296629e-01 ... -1.02296150e+00
    -1.75877988e+00 -2.08623588e-01]
   [-5.61593056e-01 -8.99019480e-01  2.00808853e-01 ... -1.69715822e-01
     3.96337777e-01  7.78820157e-01]
   [-3.26613575e-01  8.42672110e-01  9.09774601e-01 ...  6.21514581e-02
     2.87985176e-01  6.81026280e-01]]

  [[ 1.25591978e-01 -2.63584316e-01 -8.46713006e-01 ...  6.32203817e-01
     6.78783655e-02  3.15634102e-01]
   [-1.33475646e-01  1.73369914e-01  3.89086545e-01 ...  4.82924402e-01
     3.99139285e-01  2.01294255e-02]
   [ 2.08086073e-01  3.58420014e-01  8.32332373e-01 ...  2.05037308e+00
     9.00965869e-01  1.60676196e-01]
   ...
   [-9.30747151e-01  4.18388456e-01  1.05209208e+00 ...  1.15717673e+00
    -1.02711773e+00  1.61520648e+00]
   [-4.09054644e-02 -3.87932211e-01  2.28019550e-01 ...  6.48672581e-01
     3.75635833e-01  5.96524358e-01]
   [-2.66376942e-01 -5.23450673e-01  6.65453196e-01 ... -8.09507132e-01
    -1.77260727e-01 -3.67632985e-01]]

  [[-9.06469166e-01 -4.31205153e-01 -2.20682323e-02 ... -3.13443899e-01
    -3.95787001e-01 -2.19443917e-01]
   [ 5.92894077e-01 -5.13735175e-01 -1.84125498e-01 ...  1.61450064e+00
     3.89283091e-01 -1.35147274e+00]
   [-2.05450982e-01  1.28268123e+00  5.70078433e-01 ... -9.01411355e-01
     3.68132919e-01  1.57951370e-01]
   ...
   [-1.63806215e-01 -1.88998508e+00 -4.50279899e-02 ... -1.20102835e+00
    -1.47897744e+00 -1.67247266e-01]
   [-1.34662640e+00  5.72480738e-01 -2.91787416e-01 ...  1.72641826e+00
    -2.24556780e+00 -4.77383316e-01]
   [-4.99463856e-01 -8.07881534e-01 -6.85226381e-01 ... -2.36907601e-01
    -1.13581586e+00 -2.38638803e-01]]

  ...

  [[ 3.69491309e-01  2.31744140e-01  5.56899607e-03 ...  4.96731490e-01
    -3.21621686e-01  3.94595742e-01]
   [-2.80946106e-01 -1.07528412e+00  1.00080228e+00 ... -1.99483633e-01
     1.31928003e+00  1.09310675e+00]
   [ 5.87069929e-01  7.08310977e-02 -7.22444773e-01 ...  6.10527098e-01
     6.51989579e-01 -3.54555696e-01]
   ...
   [-2.36376792e-01  1.72800645e-02 -2.82022327e-01 ... -2.80891448e-01
    -1.92463130e-01  1.32393456e+00]
   [ 4.13815737e-01 -2.25912228e-01  6.55840099e-01 ... -3.47768813e-01
    -6.43799007e-01  7.92632580e-01]
   [-6.29006922e-02  2.26471618e-01  5.21057606e-01 ...  2.31786340e-01
    -1.07727671e+00  1.16489983e+00]]

  [[-1.44856858e+00  1.42562699e+00  1.29702878e+00 ...  4.52810466e-01
     3.38224143e-01 -1.45539090e-01]
   [ 3.61971259e-01  6.57865822e-01 -5.79416156e-01 ...  1.08271921e+00
     3.82241666e-01 -2.77155995e-01]
   [-1.41949165e+00  1.01273760e-01 -4.33532745e-01 ...  4.69531864e-01
    -8.21680427e-01 -1.68005371e+00]
   ...
   [ 1.07624543e+00  5.40532589e-01  6.23091817e-01 ...  1.96396291e+00
    -2.93776602e-01 -1.77275455e+00]
   [-1.11161780e+00 -1.30034888e+00 -5.94964400e-02 ... -4.67372417e-01
    -2.96242297e-01  1.66705772e-01]
   [-3.03121686e-01 -6.83007896e-01 -1.06202829e+00 ...  7.68090069e-01
     3.68466318e-01 -7.76617289e-01]]

  [[-6.60709918e-01  1.27311420e+00  4.08624291e-01 ... -2.43563724e+00
     1.07902557e-01  2.48973823e+00]
   [-9.64745134e-02 -6.42600298e-01 -4.57611024e-01 ... -5.14966547e-01
    -6.49867296e-01 -1.72997487e+00]
   [ 1.09319314e-01 -1.59033895e-01 -1.04767692e+00 ...  3.30217153e-01
    -1.05406046e-02 -9.60865796e-01]
   ...
   [ 2.84838170e-01  2.23635837e-01  6.10094853e-02 ...  1.77558982e+00
     6.83505476e-01 -1.53132573e-01]
   [-6.90492839e-02 -1.98660254e+00  8.82363319e-02 ... -1.06234521e-01
    -4.58832115e-01 -5.72381318e-01]
   [-4.11456041e-02 -9.40154910e-01 -2.28354841e-01 ... -5.63349724e-01
    -8.59609604e-01 -1.20323110e+00]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-True-32-8-27-5-4] q.shape1: (4, 5, 27)
q.shape2: (20, 27)
q.shape3: (20, 27)
q.shape4: (4, 5, 27)
q_liner: [[[-0.45098242 -1.8597653  -0.18044859 ...  0.44736135 -0.781291
   -1.3717852 ]
  [-1.5089675  -1.1255506   0.2868886  ... -0.59291077 -4.2512317
    1.4017425 ]
  [-0.5946903   1.0263848  -0.581638   ... -2.404116    1.5132208
   -2.4856858 ]
  [-0.31688586  0.5528781  -0.47048947 ... -3.4016237   0.32389942
    0.792212  ]
  [ 0.5705429  -1.4638315  -1.4060916  ...  0.13239647 -0.5641086
   -0.13941243]]

 [[-0.48622677  0.58664197 -0.8507686  ... -1.5951675   0.925034
   -0.5789255 ]
  [ 0.01250778  0.2590642  -1.4820707  ...  0.27701756  0.50881475
   -1.5133846 ]
  [ 1.8713679  -1.6441334  -0.23689702 ...  1.4759533   0.5980671
    1.3676003 ]
  [-1.7826596  -0.49967113 -0.13877717 ... -2.309278   -0.94425654
   -0.6702585 ]
  [-1.9854672  -0.1258095  -1.3325741  ... -1.2256528   0.3417048
   -1.306887  ]]

 [[ 0.08923486  0.40770042 -1.179379   ... -2.331579    1.0649294
   -1.4443758 ]
  [-0.9717777  -1.0941966   0.10684844 ... -1.3449765   1.5412539
    1.2202598 ]
  [-1.9089527  -0.49968353 -0.7305629  ... -0.31890056  0.05979536
   -0.012014  ]
  [ 0.8310764  -0.54699755 -2.0045779  ...  1.1674607  -0.8113641
    2.528547  ]
  [-0.6054805   0.17777057 -0.3048614  ... -3.8101263   0.3146161
    0.12864286]]

 [[-1.0738883   0.71441406  1.033029   ...  2.1741903  -0.05606913
   -2.216511  ]
  [ 2.8600929   2.6552117   1.1548573  ...  0.5743336  -0.509936
   -1.0215002 ]
  [-0.76020247 -2.2237751  -0.00880839 ... -1.8565425   0.76902795
    1.1017361 ]
  [ 0.56063336  2.2217882   1.0828176  ...  1.7795793  -0.5760088
    1.1000314 ]
  [-0.13495904 -2.4847577  -0.8736485  ... -0.48269773  0.6778818
    1.9465017 ]]]
q.shape5: (4, 5, 256)
q.shape6: (4, 8, 5, 32)
attn_res: [[[[-2.80319524e+00 -4.44879346e-02  2.17424989e-01 ... -4.92406696e-01
    -7.14090049e-01 -1.29643941e+00]
   [-1.38720080e-01 -4.84938383e-01 -2.31890351e-01 ...  9.90081847e-01
    -1.49395692e+00 -1.34055483e+00]
   [-3.27846080e-01 -1.12097430e+00  9.44364071e-03 ...  5.44462621e-01
    -4.21593308e-01 -1.26262593e+00]
   [-3.22776109e-01 -6.83280945e-01 -6.80930018e-01 ... -4.47308719e-02
    -7.18713403e-02 -2.18238324e-01]
   [ 6.53426290e-01 -1.67093372e+00  6.73505962e-02 ... -5.32993317e-01
     5.73118389e-01 -2.86715418e-01]]

  [[ 6.39512539e-01  1.15021920e+00  3.25770664e+00 ... -3.44755650e-01
    -7.09135354e-01  2.68249720e-01]
   [-1.36833036e+00  1.10835671e+00  1.46197408e-01 ...  1.36248067e-01
     1.25481951e+00 -9.64864016e-01]
   [-2.05885023e-02  1.26983464e+00  1.80415392e+00 ... -2.28157923e-01
     1.47897765e-01  2.14451514e-02]
   [ 8.83977637e-02  9.95336056e-01  7.34887242e-01 ...  1.67515725e-01
    -3.31289768e-01  1.12156712e-01]
   [-2.17446494e+00  2.18828678e-01 -2.36754990e+00 ... -2.19945759e-01
    -4.03808087e-01 -9.30400312e-01]]

  [[ 8.09758663e-01 -9.71923023e-03  1.28495598e+00 ... -1.52837962e-01
     9.21359539e-01 -6.43020034e-01]
   [ 1.05608785e+00  2.79985934e-01  1.22594011e+00 ...  2.59045124e-01
     6.95364952e-01 -4.36347604e-01]
   [ 6.58181667e-01  1.09377384e-01  1.24770343e-01 ...  1.60662580e+00
     1.05504274e-01 -6.52299345e-01]
   [ 1.32870078e-02 -2.57822722e-01  1.66465974e+00 ...  9.89608884e-01
     8.06797087e-01 -7.06659436e-01]
   [ 3.88045996e-01  2.92600513e-01  3.86031151e-01 ...  1.26619840e+00
     1.69493616e-01 -5.40767193e-01]]

  ...

  [[ 1.28433600e-01  2.25222397e+00  5.97746253e-01 ...  6.70284390e-01
     2.84509754e+00 -3.24684650e-01]
   [-3.19677532e-01  1.96099699e+00  1.48907512e-01 ...  3.50157320e-02
     1.68419468e+00 -7.19701886e-01]
   [-6.11553133e-01  1.21179044e+00  1.14073420e+00 ...  2.23522139e+00
     3.53085011e-01 -2.84450221e+00]
   [-5.84392786e-01  1.25595558e+00  1.10554099e+00 ...  2.14175558e+00
     4.50863242e-01 -2.72458267e+00]
   [-1.31311369e+00 -3.58441889e-01  1.10824716e+00 ... -1.40534306e+00
    -2.32291698e+00 -4.88947928e-02]]

  [[-4.69944119e-01  6.70536995e-01  3.11837107e-01 ... -2.41985726e+00
    -5.08751094e-01 -9.48328316e-01]
   [-4.56336737e-01 -2.22268790e-01  3.27934027e-01 ...  1.09106243e+00
     4.07372504e-01  5.98126650e-01]
   [-5.81899881e-01  6.10064805e-01  3.92829299e-01 ... -2.14065123e+00
    -4.95583922e-01 -7.98365653e-01]
   [-5.07956684e-01 -5.75426459e-01  3.11629176e-01 ...  3.22047591e-01
     1.56774867e+00  5.71561098e-01]
   [ 4.43685055e-01  1.95801958e-01  3.36557090e-01 ...  3.51673007e-01
     1.07864046e+00  7.42618382e-01]]

  [[ 1.13297176e+00  2.13383898e-01  1.35840237e+00 ...  1.38145638e+00
    -1.77384984e+00 -4.56836522e-01]
   [-9.03018594e-01 -1.17695320e+00 -3.26366067e-01 ... -1.56978238e+00
    -9.08885002e-02  3.31848860e-04]
   [ 4.71781433e-01 -4.22495067e-01  1.22188401e+00 ...  4.84764278e-01
    -1.16849840e+00 -3.82768422e-01]
   [-1.50871861e+00 -1.41081405e+00 -8.97162497e-01 ... -2.78980517e+00
     3.13014269e-01  7.07667589e-01]
   [-1.51875213e-01 -9.10536766e-01  8.98156106e-01 ... -3.90620232e-01
    -6.59721494e-01 -2.62063622e-01]]]


 [[[ 1.78416359e+00  2.12847400e+00  8.80897403e-01 ...  5.60044825e-01
    -4.92928088e-01 -7.78833687e-01]
   [-8.28028560e-01  5.75104117e-01 -1.79080570e+00 ... -1.91938913e+00
     2.00046730e+00  1.43776774e+00]
   [-6.42088532e-01 -4.79160845e-01 -5.23512483e-01 ... -1.48341060e+00
     1.60904121e+00  1.00206983e+00]
   [-1.50377131e+00  6.92839742e-01  2.79738873e-01 ... -2.36733317e+00
     1.90836585e+00 -4.33147013e-01]
   [-6.41471267e-01  1.22276855e+00 -3.73080581e-01 ... -1.61741710e+00
     1.81115067e+00  9.81783867e-03]]

  [[-7.39863157e-01 -2.79601288e+00  1.19394875e+00 ...  1.61532164e+00
    -1.33034456e+00 -7.05599666e-01]
   [-3.47097576e-01 -2.05591917e+00  9.55611885e-01 ...  1.70682812e+00
    -1.28007805e+00 -4.36766863e-01]
   [-6.95995986e-02  1.71467376e+00 -2.31308453e-02 ...  1.43407738e+00
    -4.37878728e-01  1.15157747e+00]
   [-5.18223941e-01  1.38743734e+00  1.15126148e-01 ...  1.28118241e+00
    -3.67816746e-01  1.08049786e+00]
   [-5.28654695e-01  1.49967635e+00 -1.44985661e-01 ...  1.10563707e+00
    -4.28476721e-01  1.09400499e+00]]

  [[-2.24010277e+00 -1.61406410e+00  1.31747341e+00 ... -3.82814550e+00
     7.48241246e-01 -1.20210147e+00]
   [-1.72359955e+00 -1.00190628e+00  1.25571406e+00 ... -2.08741236e+00
     5.34401715e-01 -7.48970807e-01]
   [-1.22111666e+00  1.06140804e+00 -9.76471901e-01 ...  2.74213791e+00
     1.55224097e+00 -1.80152667e+00]
   [-2.10940480e+00 -1.42980087e+00  1.13016880e+00 ... -3.53390360e+00
     8.19032788e-01 -1.23637056e+00]
   [-5.55289626e-01  7.36188531e-01 -1.09066558e+00 ... -2.29375526e-01
     1.67534566e+00 -1.63957262e+00]]

  ...

  [[ 5.18869281e-01 -3.53117764e-01  1.29362202e+00 ... -1.06612432e+00
    -2.05602646e+00  6.73958287e-02]
   [ 7.02163160e-01 -3.69021177e-01 -5.68851903e-02 ...  7.04999387e-01
    -1.69983900e+00  9.62643504e-01]
   [ 6.69689775e-01 -3.69806290e-01  1.77653342e-01 ...  4.12958145e-01
    -1.75352538e+00  7.97611892e-01]
   [ 7.16823816e-01 -2.59574234e-01  2.66840070e-01 ...  6.88099504e-01
    -1.16539359e+00 -1.00512251e-01]
   [ 1.74972701e+00  1.02007866e+00 -5.36142588e-01 ... -2.68191516e-01
    -1.19312465e+00 -1.10187018e+00]]

  [[ 2.62004167e-01  5.85391641e-01 -5.93074799e-01 ... -3.27271134e-01
     7.11398125e-01 -3.06471258e-01]
   [-1.34802401e+00 -1.87202036e-01 -9.46986675e-01 ... -1.45116580e+00
     1.34190023e+00 -4.86879587e-01]
   [-2.38827825e+00 -6.45802081e-01 -1.16075134e+00 ... -2.15017724e+00
     1.71881866e+00 -5.82780421e-01]
   [-1.42540073e+00  1.18572783e+00 -8.58680129e-01 ... -5.92930555e-01
    -4.32025254e-01  3.89572978e-01]
   [-1.20292890e+00  3.48198861e-01 -1.74205828e+00 ... -1.10957623e+00
    -8.67623448e-01  1.73768818e-01]]

  [[ 1.93283308e+00 -1.62004364e+00  1.23325920e+00 ...  7.79917479e-01
     5.41524470e-01 -1.51799464e+00]
   [-1.53996277e+00  2.76292682e+00  8.89561117e-01 ...  5.54684877e-01
     1.65696610e-02  2.07576418e+00]
   [ 1.08014739e+00 -1.37752867e+00  1.36015511e+00 ... -4.01346326e-01
    -3.97833586e-02 -8.72898579e-01]
   [-5.96014678e-01  2.87217975e-01  1.10326791e+00 ...  2.06792688e+00
     5.20461261e-01  5.71951687e-01]
   [ 1.53559834e-01 -7.34195948e-01  1.03098559e+00 ...  1.24604261e+00
     6.45786881e-01 -1.56373143e-01]]]


 [[[-3.30765367e-01 -1.26376975e+00  9.23854768e-01 ... -7.74505317e-01
    -8.49337876e-01 -1.19330311e+00]
   [-3.15007359e-01 -1.27742302e+00  8.76121163e-01 ... -7.61466622e-01
    -7.97870398e-01 -1.14459479e+00]
   [ 7.04774380e-01 -1.80310214e+00 -1.69993353e+00 ... -3.49746421e-02
     2.10907245e+00  1.59931087e+00]
   [ 3.51787508e-01 -7.15747237e-01  6.98598921e-01 ... -6.09020233e-01
    -1.13841906e-01 -5.20093560e-01]
   [ 4.03230041e-01 -1.44863486e+00  6.05166793e-01 ... -4.70452696e-01
     1.44024193e-01 -2.44865462e-01]]

  [[-4.85244900e-01  2.67290235e-01 -7.41559863e-02 ... -6.10105634e-01
    -4.07254308e-01  2.06193566e+00]
   [-1.44850641e-01  3.07594985e-01 -2.91992307e-01 ... -6.36664331e-01
    -3.90018046e-01  1.80905759e+00]
   [ 1.57185733e-01 -5.77312768e-01 -4.11863267e-01 ... -1.59419799e+00
    -4.37789142e-01  1.68254912e+00]
   [ 2.39803720e+00  6.11372471e-01 -1.91796732e+00 ... -8.28655660e-01
    -2.57115096e-01 -9.00358707e-02]
   [ 5.78466475e-01  2.83318186e+00  1.51391435e+00 ...  9.15881753e-01
     1.89619613e+00 -2.07890582e+00]]

  [[-7.70459950e-01 -1.43444204e+00 -9.73627567e-01 ...  1.09368896e+00
     8.95273745e-01 -4.97718185e-01]
   [-1.58521980e-01 -2.05444306e-01 -4.25364584e-01 ...  1.62135124e-01
     4.21322584e-02  5.66759586e-01]
   [-1.69951248e+00 -1.87351540e-01 -1.38141000e+00 ...  8.87515247e-01
    -2.38691539e-01  1.38627794e-02]
   [ 1.94211423e-01 -1.91349283e-01  6.30254447e-01 ...  1.84212220e+00
     1.73275724e-01 -8.25852513e-01]
   [ 5.96211612e-01  3.86731565e-01  1.40645707e+00 ...  1.52969193e+00
    -1.29963434e+00  2.39882636e+00]]

  ...

  [[-1.35487449e+00 -2.01735711e+00  1.51025438e+00 ...  3.62886250e-01
     1.20628619e+00  4.52259541e-01]
   [-8.39600742e-01 -7.76210248e-01  7.54370272e-01 ...  8.66532207e-01
     1.75105834e+00  2.43747875e-01]
   [-1.15406883e+00 -1.94632053e+00  1.50986338e+00 ...  5.48121989e-01
     1.14496911e+00  1.35722727e-01]
   [-1.38867950e+00 -7.39982009e-01  1.09632945e+00 ...  3.15247536e+00
    -1.32990944e+00 -1.60145849e-01]
   [-7.18746841e-01 -1.01146007e+00  9.61373270e-01 ...  9.70084667e-01
     1.34036195e+00 -6.56575337e-02]]

  [[ 1.05277991e+00  7.67185465e-02  6.30479336e-01 ... -4.98718202e-01
     9.27938879e-01 -2.14455485e+00]
   [-6.74727857e-01 -1.71707347e-01  6.75957680e-01 ... -6.12218678e-01
    -6.16182327e-01 -1.78729272e+00]
   [ 2.45350623e+00  2.24753571e+00  1.18443644e+00 ...  7.48514175e-01
    -8.27382207e-01 -2.49278164e+00]
   [ 2.42019153e+00  2.22079635e+00  1.17956424e+00 ...  7.34074891e-01
    -8.27089667e-01 -2.48422217e+00]
   [-2.01281533e-02 -2.24964261e+00 -2.41621166e-01 ... -7.50214398e-01
     1.15825605e+00 -1.19672751e+00]]

  [[ 1.86621344e+00 -9.82518792e-01  1.03057158e+00 ...  1.19127288e-01
    -1.74547875e+00 -1.56513011e+00]
   [-2.64868999e+00  1.52624115e-01 -7.58836508e-01 ... -5.10054350e-01
    -1.18890774e+00  9.60266232e-01]
   [-4.43611205e-01 -1.42837358e+00  8.02371502e-01 ... -1.46115971e+00
     8.66713285e-01 -1.62331450e+00]
   [ 8.79608154e-01 -1.03267884e+00  1.66023374e-01 ... -6.14058256e-01
    -1.70011234e+00 -1.12016904e+00]
   [-1.83856988e+00 -5.37121952e-01 -1.53068513e-01 ... -1.01773369e+00
    -2.09945530e-01 -1.26641795e-01]]]


 [[[-1.22885203e+00  3.59101653e+00  1.64254403e+00 ...  2.44549799e+00
    -1.92062962e+00 -1.14543426e+00]
   [-1.04101503e+00  3.39447832e+00 -1.46780324e+00 ...  1.96746445e+00
    -1.67358369e-01  2.11059117e+00]
   [-7.97532380e-01  2.98368907e+00 -1.14643827e-01 ...  1.89754355e+00
    -8.16165090e-01  4.67021316e-01]
   [ 6.70892715e-01  4.48014617e-01  7.88738310e-01 ...  2.07536817e-01
    -7.61160374e-01  3.82296592e-02]
   [ 3.64239007e-01 -2.38893628e-02  2.57039219e-01 ...  6.66535378e-01
    -3.63745242e-01 -4.10947502e-01]]

  [[-1.55586994e+00 -1.25099599e-01 -1.35277283e+00 ... -1.96697199e+00
    -8.69244039e-01  7.39177823e-01]
   [ 1.47149968e+00 -1.10085642e+00 -1.11441624e+00 ... -1.68497777e+00
    -3.11832523e+00  4.46860135e-01]
   [-1.38868582e+00 -9.81453657e-02 -1.28794622e+00 ... -1.86473429e+00
    -7.79211640e-01  6.93104684e-01]
   [ 8.82249177e-02 -7.04102933e-01 -1.17327857e+00 ... -1.55330384e+00
    -1.99664605e+00  2.98708498e-01]
   [-9.35102046e-01 -3.20369482e-01 -1.20892107e+00 ... -7.98875153e-01
    -5.75031102e-01  1.29331380e-01]]

  [[-3.44743848e-01 -1.21160157e-01  4.71291959e-01 ...  1.80866003e+00
     3.61541963e+00  1.35351884e+00]
   [-2.83008695e-01  6.44393623e-01  4.35708940e-01 ... -1.31574452e-01
     2.03128338e+00  1.27244115e+00]
   [-2.54709899e-01  6.60123348e-01  4.57210064e-01 ... -1.50678068e-01
     1.91281974e+00  1.23130143e+00]
   [-2.64060855e-01 -1.97147205e-03  5.68273365e-01 ...  1.60946846e+00
     3.06805611e+00  1.18995225e+00]
   [-7.38375727e-03  7.59679854e-01  1.10409558e+00 ...  2.68496841e-01
     7.26550221e-02  3.32303673e-01]]

  ...

  [[-3.09568357e+00  1.58821166e+00 -4.42662448e-01 ... -2.64995551e+00
     5.72898053e-03 -2.02834463e+00]
   [-1.20852685e+00  1.00290608e+00 -1.95810243e-01 ... -2.35596013e+00
     1.04770267e+00 -1.70814514e+00]
   [-8.98474216e-01 -1.81169376e-01  1.85779476e+00 ... -2.05426788e+00
    -4.79058921e-01  1.07750523e+00]
   [-4.03507918e-01  4.45097744e-01  6.50372148e-01 ...  1.03391755e+00
     1.46240282e+00 -1.83115959e-01]
   [-6.90639913e-01 -5.76991588e-03  1.28608644e+00 ... -7.88958430e-01
     3.67644370e-01  4.86574650e-01]]

  [[ 2.24173403e+00  3.67864728e-01  2.63187557e-01 ...  1.74812007e+00
    -9.44547594e-01  2.91319847e+00]
   [ 2.14511180e+00  4.19998854e-01  2.59818316e-01 ...  1.71990144e+00
    -9.11038637e-01  2.83388209e+00]
   [ 2.09205556e+00 -1.07189810e+00  2.55509019e-01 ...  5.09509504e-01
     3.52840841e-01 -1.50819743e+00]
   [ 2.15958571e+00  3.15484524e-01 -7.43914396e-02 ...  1.41033471e+00
    -9.07428265e-01  2.36819744e+00]
   [ 5.82875669e-01  4.31003511e-01 -1.05339468e+00 ...  2.97630072e-01
    -7.61801124e-01  1.39633799e+00]]

  [[-3.18923801e-01 -7.27193832e-01 -1.54356337e+00 ...  7.26870358e-01
     1.19138587e+00  1.16101253e+00]
   [-2.22394514e+00  5.99487185e-01 -5.77832162e-01 ...  2.16899961e-01
     1.38435090e+00  1.86982071e+00]
   [-6.98676288e-01 -2.82908320e-01 -1.21963203e+00 ... -5.48922658e-01
     3.21566939e-01  7.10158825e-01]
   [-3.83636415e-01 -5.39569557e-01 -1.31857741e+00 ... -1.21924162e+00
    -3.52137744e-01  2.47810706e-01]
   [-1.90700367e-01 -6.49843812e-01 -1.31630707e+00 ... -1.32001913e+00
    -3.52316380e-01  2.72504427e-02]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-True-32-8-27-5-8] q.shape1: (8, 5, 27)
q.shape2: (40, 27)
q.shape3: (40, 27)
q.shape4: (8, 5, 27)
q_liner: [[[ 0.15200193  0.42109507  0.1894755  ... -1.7429329  -0.88422495
   -0.3164864 ]
  [-0.7228274   0.49029985  0.58301187 ...  2.1885214  -0.0600438
    2.0428016 ]
  [-0.5260736   0.6122724   1.230041   ... -2.247764    0.22396035
   -1.7408255 ]
  [ 0.3971978   0.6543124   0.09537844 ...  1.0527573   2.5283172
    1.3539605 ]
  [-2.2944772  -1.2713732  -0.40413117 ... -2.6895072   1.2463971
    1.2484484 ]]

 [[-1.1593062  -0.88011456 -1.8108406  ... -1.7323458   1.1656864
   -0.8288701 ]
  [ 0.9558411  -0.23498295  2.5545673  ... -3.0560327  -2.0548532
   -2.2333834 ]
  [-1.7470474  -2.3977683  -2.3310997  ...  0.24311657 -0.14915945
    0.71529585]
  [ 0.89870685  1.1873523  -0.10763843 ...  2.5449615   0.67048955
    0.58401346]
  [ 2.0645623   0.3715976   0.32978135 ...  1.3476607   0.29302907
   -0.27270532]]

 [[-0.00490406 -0.09373393  1.1604989  ... -0.68984926  1.4405506
    0.73424846]
  [-0.04013184 -0.74264437  0.7171273  ...  0.84781003 -0.8189953
    1.0422674 ]
  [ 1.3068575   1.0912939  -0.5706339  ...  0.6620283   0.5126465
    1.2609537 ]
  [-1.4994874   1.0570575  -2.6855764  ...  1.986622    1.5518485
   -0.7573723 ]
  [ 1.1151257  -2.2495382   0.6445344  ... -1.7265897  -0.9692527
    1.5563262 ]]

 ...

 [[-1.2600608   0.42844245 -1.0461015  ...  0.4404278   0.8438228
    0.35004786]
  [-0.80994964  0.90170777 -1.5636967  ...  1.9153154   0.15813263
    0.75824195]
  [-0.41504437  0.5501679  -0.46502814 ...  1.3531638   0.20270535
   -1.1872677 ]
  [-2.140977   -1.8058908  -2.543361   ... -1.3188152  -0.2109273
    3.014104  ]
  [ 0.30165464 -1.7570784  -0.5276766  ... -0.95511556  0.6305223
    2.6884043 ]]

 [[ 0.54159     2.0929532   1.2214144  ...  1.3534613  -2.23457
   -3.0139523 ]
  [-0.41575354  1.8297943   0.4623497  ... -0.0106837   0.28909513
   -1.1019404 ]
  [ 1.7901554  -2.319938    0.07372504 ...  1.7785084  -2.0408728
   -0.50145024]
  [-3.2801116   0.87907857  1.1032302  ...  1.1696819   2.6237779
   -2.4771411 ]
  [ 2.1882672   2.8574078   1.3916488  ... -0.65159124  0.67476016
   -2.5030303 ]]

 [[-0.2869474   0.19633447  1.8981183  ...  1.5710847  -1.9368707
    0.45920563]
  [ 1.1749982   0.24199866 -1.4054803  ...  0.47076377  0.1422315
    2.097656  ]
  [ 1.5478255   2.0425947   0.8884625  ... -1.2721355  -1.8794547
   -1.3773708 ]
  [-0.51357377  1.8262048   0.93602985 ... -1.289328    1.1409357
   -3.3090458 ]
  [-0.5917449   1.1871253   0.05737568 ...  2.3166168   0.7226818
    1.4457972 ]]]
q.shape5: (8, 5, 256)
q.shape6: (8, 8, 5, 32)
attn_res: [[[[-2.56978244e-01  2.42297196e+00 -6.34604275e-01 ... -1.98050916e+00
    -1.27987063e+00 -1.35229886e+00]
   [-5.69313884e-01  1.58913970e+00 -4.18030918e-02 ... -1.03192234e+00
    -3.72941703e-01 -1.95099711e-02]
   [-2.82356501e-01  2.34160399e+00 -6.00440204e-01 ... -1.95056856e+00
    -1.21521211e+00 -1.36832583e+00]
   [-8.82674813e-01  6.47974253e-01  6.06346130e-01 ... -4.50101867e-02
     5.57124734e-01  1.27918196e+00]
   [-1.37542927e+00 -7.53719151e-01  1.54225707e+00 ... -7.70005882e-01
    -2.34606647e+00 -2.07543492e-01]]

  [[-3.39703679e+00  6.50438368e-01 -8.07872713e-01 ...  8.49320650e-01
     4.89596575e-01 -1.73697221e+00]
   [ 6.42460287e-01 -7.21580923e-01  1.08607423e+00 ...  2.37193048e-01
    -1.54782414e+00  2.02061868e+00]
   [-3.24755049e+00  5.53794503e-01 -8.38467419e-01 ...  8.08727801e-01
     4.11459804e-01 -1.50862479e+00]
   [-6.76288903e-01 -2.47522414e-01 -4.75582421e-01 ...  3.68518651e-01
    -4.46726680e-01  1.04018259e+00]
   [-7.95715451e-01 -1.63129842e+00  2.02739096e+00 ...  1.80224866e-01
     7.02831268e-01 -9.24400508e-01]]

  [[ 1.78496814e+00 -2.16982675e+00  4.57702726e-01 ... -2.28703833e+00
     2.22641945e+00  6.80158734e-02]
   [ 1.64571404e+00  3.86126220e-01 -8.37649822e-01 ...  6.96563601e-01
    -1.21402204e+00  4.46721125e+00]
   [ 1.78256738e+00 -2.15939045e+00  4.52475548e-01 ... -2.27519751e+00
     2.21238732e+00  8.53437260e-02]
   [ 7.69540191e-01  1.20811319e+00 -6.96254492e-01 ...  1.18760729e+00
    -8.16897750e-02  7.25535691e-01]
   [ 1.66984677e+00 -1.03722298e+00 -7.64083490e-02 ... -1.00316811e+00
     8.62542629e-01  1.63332307e+00]]

  ...

  [[-5.62886715e-01  5.97115397e-01 -2.70146918e+00 ...  5.65000884e-02
    -2.03188372e+00  7.25510299e-01]
   [-3.71762514e-02  6.02029800e-01 -2.11667204e+00 ... -3.20816040e-02
    -1.73646355e+00  8.97429466e-01]
   [ 2.03622729e-01  7.01676846e-01 -2.56132185e-02 ... -3.50324750e-01
    -1.00812352e+00  1.47415626e+00]
   [-5.52293539e-01  7.91832507e-01  1.86235756e-02 ... -2.79328674e-01
    -1.15130925e+00  1.31666875e+00]
   [ 8.01564991e-01  9.98804510e-01  2.37001657e-01 ...  1.11361764e-01
    -8.06862831e-01  5.79791963e-01]]

  [[ 2.82789350e-01  5.53259015e-01 -1.62999117e+00 ... -1.87181130e-01
    -3.58288670e+00  1.29338598e+00]
   [-5.27654171e-01 -7.25743830e-01 -1.52060568e-01 ...  2.31066719e-02
    -2.73151016e+00  1.80194926e+00]
   [ 2.01521301e+00 -5.46444237e-01  9.11497846e-02 ... -7.74550676e-01
    -4.26716775e-01  1.58811808e+00]
   [-6.83979392e-01 -1.38691199e+00  6.54935479e-01 ...  1.05373001e+00
     5.76327384e-01 -1.81460381e-03]
   [ 8.14970255e-01 -3.77229363e-01 -5.29657722e-01 ... -3.67213577e-01
    -1.24196458e+00  1.22869360e+00]]

  [[ 1.83115840e+00 -3.66189909e+00 -4.56891179e-01 ...  3.22955012e+00
     4.74897981e-01 -3.31948924e+00]
   [ 5.56023598e-01 -2.69884968e+00  3.25058430e-01 ...  1.48468113e+00
     4.98144567e-01 -1.90101862e+00]
   [ 1.08083999e+00 -2.33744812e+00 -1.14427006e+00 ...  2.48100042e+00
    -4.27682251e-02 -2.41088486e+00]
   [ 1.19484925e+00 -1.60896814e+00 -4.87381101e-01 ...  2.00557995e+00
    -8.88103545e-02 -1.47241080e+00]
   [ 1.27142823e+00 -1.92271280e+00 -1.40598798e+00 ...  2.60565662e+00
    -2.39166349e-01 -2.17472029e+00]]]


 [[[ 4.24186856e-01 -8.04261446e-01  1.17144096e+00 ...  1.14419743e-01
    -1.30125868e+00 -1.51003325e+00]
   [ 1.20768562e-01  5.45704901e-01  7.15154707e-01 ...  1.01706064e+00
     5.80856264e-01  1.34334242e+00]
   [ 7.85499439e-02  6.92742288e-01  5.67384839e-01 ...  1.15852213e+00
     8.01981866e-01  1.62118971e+00]
   [ 1.73425257e-01 -2.53317922e-01  9.31063414e-01 ...  2.32290775e-02
    -8.88723433e-01 -9.01096582e-01]
   [-4.95237112e-02  2.45127454e-01  4.92662668e-01 ...  1.01479977e-01
     5.28664947e-01  3.20379198e-01]]

  [[ 2.15448380e-01 -1.74560130e+00  9.87766743e-01 ... -4.07929480e-01
     1.91420972e+00 -1.44195890e+00]
   [ 3.18728387e-01 -1.72002363e+00  8.50680172e-01 ... -7.14345634e-01
     1.92897058e+00 -8.08651805e-01]
   [-1.78320110e-02 -8.71710479e-01 -1.98828876e-02 ... -1.66765273e+00
     1.84509563e+00  7.73674250e-03]
   [ 1.45961821e-01 -9.83477712e-01 -6.46095753e-01 ...  8.26207399e-02
     1.81109643e+00 -3.14908415e-01]
   [ 1.71631664e-01 -9.17153835e-01 -8.71153533e-01 ...  2.06307068e-01
     1.79664314e+00 -1.06346622e-01]]

  [[-6.55044690e-02 -1.45136380e+00  1.02622950e+00 ... -9.73279953e-01
    -1.04390550e+00 -4.62780297e-02]
   [-8.15087914e-01 -2.77673185e-01  2.99122715e+00 ... -1.37440264e+00
    -5.29417157e-01  1.22440100e+00]
   [-8.88406336e-02 -1.40871286e+00  1.09830272e+00 ... -9.85548556e-01
    -1.02534354e+00  2.93015677e-04]
   [-3.08086574e-01 -9.96024370e-01  1.40232694e+00 ... -1.12502956e+00
    -6.15329266e-01  2.93542325e-01]
   [-1.02690542e+00  1.03962064e+00  1.30479753e-01 ... -1.16411531e+00
    -9.90285873e-01  1.26116514e+00]]

  ...

  [[-6.67787433e-01 -7.48468995e-01  1.75346112e+00 ... -1.59070957e+00
    -7.21942008e-01  3.60106647e-01]
   [-5.41643023e-01 -6.97640657e-01  1.69934988e+00 ... -1.73765934e+00
    -5.34307778e-01  2.96188414e-01]
   [-7.20738769e-01 -6.85732543e-01  1.36199546e+00 ... -1.75737953e+00
    -1.44002527e-01  6.39540672e-01]
   [ 5.49170785e-02 -3.54317933e-01  1.17707300e+00 ... -2.50371790e+00
     7.39560962e-01  1.13265708e-01]
   [-4.52753425e-01  1.21304929e-01  5.20596385e-01 ... -1.22551215e+00
     8.29265893e-01  5.64739406e-01]]

  [[ 8.17478597e-02  2.04386401e+00 -1.42903364e+00 ... -1.35942900e+00
     2.94508636e-01  1.55493462e+00]
   [-9.65518832e-01  1.81430912e+00 -3.87145430e-01 ...  3.21311980e-01
     6.09965146e-01 -4.06747848e-01]
   [-6.74268842e-01  1.11177814e+00 -2.65769839e-01 ...  5.25034308e-01
     8.33180666e-01 -7.26757646e-02]
   [-2.15503424e-02 -1.89341694e-01 -4.88718748e-02 ...  7.86029816e-01
     1.24795628e+00  6.80651188e-01]
   [-5.71583271e-01  1.19585347e+00 -3.23907584e-02 ...  5.52797258e-01
     8.13548326e-01 -2.16337755e-01]]

  [[-1.99589849e+00  2.66326785e+00  8.72237027e-01 ...  2.06453912e-02
    -1.53577614e+00  6.32512346e-02]
   [-2.41088080e+00  1.94077063e+00  1.57901120e+00 ... -2.09240818e+00
    -4.10253167e-01  2.56434536e+00]
   [-1.97838414e+00  2.64496017e+00  8.67962718e-01 ...  7.53651606e-03
    -1.52162838e+00  5.90771288e-02]
   [-1.12771070e+00  1.42933178e+00  8.09941411e-01 ... -1.26925099e+00
    -4.53853667e-01  5.17464638e-01]
   [-2.06636727e-01  8.97844970e-01  2.14792296e-01 ... -6.76467419e-01
    -4.05734003e-01 -8.92250538e-01]]]


 [[[-6.66273952e-01  4.61785406e-01 -6.14513457e-01 ... -1.37143135e+00
     9.52131808e-01 -1.34169173e+00]
   [-4.03144002e-01  3.55458140e-01 -4.41120505e-01 ... -1.36103213e+00
     8.50123227e-01 -1.03298092e+00]
   [ 1.07786119e+00  2.44722307e-01  1.23197091e+00 ... -7.98614025e-01
     3.51195216e-01  7.04872012e-01]
   [-6.78871751e-01  5.43601871e-01 -5.12849510e-01 ... -1.29226315e+00
     9.68530774e-01 -1.35647535e+00]
   [ 5.62926888e-01 -1.70756012e-01  3.47928196e-01 ... -3.90981436e-01
    -1.40755653e-01  1.46338439e+00]]

  [[-6.94682658e-01 -3.52912486e-01 -3.84189010e-01 ...  1.99356124e-01
    -4.81281817e-01  1.85464919e+00]
   [ 1.43326581e-01 -1.25256449e-01  2.20411822e-01 ... -1.11000657e-01
    -2.63003886e-01  1.27206039e+00]
   [ 8.77347708e-01 -5.94646156e-01  4.69589233e-03 ... -5.54023534e-02
     1.39257061e+00  1.05374408e+00]
   [ 5.95855117e-01  3.15763593e-01 -8.34880173e-02 ...  5.84285021e-01
     1.35551214e+00  6.98574781e-01]
   [ 1.02108312e+00  1.47516787e-01  5.11201859e-01 ...  4.90533412e-02
     4.65023756e-01  1.02833301e-01]]

  [[ 1.25649559e+00  1.29391122e+00 -2.79297090e+00 ...  1.44442177e+00
     1.01406360e+00 -3.80325079e-01]
   [ 1.36681592e+00  1.32052362e+00 -2.40725708e+00 ...  1.44097412e+00
     8.13360929e-01 -1.85186267e-01]
   [ 1.08427358e+00 -4.94374931e-01 -1.92268860e+00 ... -2.02791691e-01
     1.23341048e+00 -5.35030365e-01]
   [ 1.84450090e+00  1.19181061e+00 -3.61197919e-01 ...  1.23372710e+00
    -1.06430031e-01  7.44557977e-01]
   [-3.43781382e-01 -1.70977283e+00  3.35506722e-02 ...  5.93083143e-01
     5.48238754e-01  9.30738971e-02]]

  ...

  [[ 7.36637592e-01 -1.04915118e+00  7.98356831e-01 ...  1.89770293e+00
    -7.57482231e-01 -3.41061831e-01]
   [ 4.46583718e-01 -1.39696097e+00 -2.06490636e-01 ...  1.20105338e+00
    -4.80651617e-01 -1.00526798e+00]
   [-2.42045075e-02 -1.89089048e+00 -1.75126052e+00 ...  9.88951325e-02
    -4.09308709e-02 -1.99271333e+00]
   [-6.49973452e-01 -1.53972983e+00 -8.61876965e-01 ...  4.06859219e-01
    -2.37354159e-01 -7.04228401e-01]
   [-3.41073155e-01 -7.86957920e-01 -9.48418558e-01 ... -2.02146277e-01
    -2.30861623e-02 -9.12664890e-01]]

  [[ 1.35227926e-02 -2.07307696e+00  1.30978429e+00 ...  1.09331772e-01
    -3.69059515e+00  1.03458047e+00]
   [-1.80522466e+00  4.71573472e-01 -1.76421130e+00 ...  5.50222516e-01
    -1.20739365e+00  1.55124068e+00]
   [-1.55486614e-01 -2.32470274e-01  2.20053732e-01 ...  8.81275758e-02
    -2.05658460e+00  1.22190499e+00]
   [-5.71880579e-01  8.56631577e-01 -1.15484393e+00 ... -1.51747018e-01
    -8.65738392e-01  1.02290606e+00]
   [-1.57274532e+00  6.52692020e-01 -1.47006226e+00 ...  5.34399569e-01
    -1.07262039e+00  1.45283842e+00]]

  [[-8.98597538e-01  1.36141288e+00 -9.64361608e-01 ... -8.33650112e-01
     1.03497648e+00  1.91794440e-01]
   [-2.10425138e+00  1.92637825e+00  2.59698105e+00 ... -2.56887746e+00
    -1.21086583e-01  7.56922424e-01]
   [-2.26824379e+00  1.99169779e+00  3.07671547e+00 ... -2.80730343e+00
    -2.66377389e-01  8.28264713e-01]
   [-1.05246341e+00  1.21413696e+00 -5.99411666e-01 ... -1.09080780e+00
     1.11478519e+00  1.56446934e-01]
   [-2.13495612e+00  1.77886558e+00  2.77246523e+00 ... -2.38135910e+00
    -9.91312414e-02  7.14307189e-01]]]


 ...


 [[[ 5.12231648e-01  2.65683341e+00 -5.28806031e-01 ... -1.00575161e+00
     2.45839715e+00  1.24075902e+00]
   [ 2.44238436e-01  1.45790040e+00 -6.68403268e-01 ... -8.02414417e-01
     6.09421134e-01  1.47841167e+00]
   [ 5.23321211e-01  2.55669403e+00 -5.46488106e-01 ... -9.74699914e-01
     2.35547280e+00  1.22361553e+00]
   [ 1.65032530e+00  1.42235562e-01 -1.11479044e+00 ...  1.04943551e-01
     1.17208385e+00 -1.99630201e-01]
   [ 6.15390420e-01 -1.11208811e-01 -8.94065380e-01 ... -2.39751205e-01
    -6.08770490e-01  8.65371644e-01]]

  [[-2.82856655e+00 -7.50701278e-02 -2.67526531e+00 ... -6.20151639e-01
    -1.42378545e+00  1.04771841e+00]
   [-1.65642881e+00 -2.72703946e-01 -1.57168829e+00 ...  4.75616544e-01
    -1.44416714e+00  5.41228414e-01]
   [-2.54466200e+00 -1.38043031e-01 -2.39426041e+00 ... -3.47914606e-01
    -1.35745955e+00  8.23694229e-01]
   [-1.42357028e+00 -4.53841716e-01 -1.27011514e+00 ...  7.05690205e-01
    -6.54189050e-01 -5.87186098e-01]
   [-2.52016282e+00 -4.24600929e-01 -2.15934134e+00 ... -3.21520805e-01
     2.71529168e-01 -1.31956339e+00]]

  [[-9.31375265e-01  8.73723686e-01  1.46984863e+00 ... -3.73638177e+00
    -5.05779028e-01 -4.60493624e-01]
   [-2.30514318e-01 -1.19337153e+00  1.82728398e+00 ...  4.50006664e-01
     1.74710226e+00  2.16123414e+00]
   [-3.94947976e-02 -4.35772389e-01  1.56109154e+00 ...  2.21783698e-01
     8.74527812e-01  1.61396670e+00]
   [-1.86127752e-01 -8.64506721e-01  1.29789495e+00 ...  8.64399672e-02
     6.65763855e-01  1.31964004e+00]
   [-6.01636469e-01  8.72595310e-02  1.16699994e+00 ... -2.11265135e+00
    -1.64315984e-01 -4.60204892e-02]]

  ...

  [[ 1.72073162e+00  2.15879130e+00 -1.09917581e-01 ... -7.97739625e-01
    -1.63647890e+00  4.42075223e-01]
   [ 1.37895548e+00  2.02536249e+00 -1.66804239e-01 ... -7.92966008e-01
    -1.70231462e+00  4.61616486e-01]
   [ 1.60733652e+00  2.08371568e+00 -6.58251792e-02 ... -8.05445969e-01
    -1.53594899e+00  4.57112223e-01]
   [-1.10802579e+00  1.04020715e+00 -5.82878172e-01 ... -7.52022505e-01
    -2.16633582e+00  6.02570772e-01]
   [-1.53350770e+00  2.92650998e-01 -8.07485342e-01 ... -4.79313552e-01
    -1.70692384e+00  5.31664550e-01]]

  [[-8.78985524e-02  3.48210424e-01  5.40509641e-01 ... -2.68903047e-01
    -2.31514961e-01  6.20793104e-01]
   [-1.09498374e-01  3.65086734e-01  5.46922863e-01 ... -2.67645866e-01
    -3.46019119e-01  6.45765841e-01]
   [ 7.68257603e-02 -2.06543231e+00  9.26934600e-01 ...  9.61180389e-01
    -1.06945217e+00  1.17981482e+00]
   [ 2.50602722e-01 -1.53877056e+00  6.49288476e-01 ...  5.91456294e-01
    -6.86812699e-01  9.55713451e-01]
   [ 1.15491617e+00  1.08092463e+00 -5.89832604e-01 ... -1.12281823e+00
    -2.88653046e-01  2.17605412e-01]]

  [[ 4.38498408e-01 -3.00517678e+00 -6.87294483e-01 ... -2.01898813e+00
    -9.53092039e-01 -8.47300172e-01]
   [-2.42675498e-01 -2.00424767e+00  1.33689344e-02 ... -3.19305420e-01
    -8.35498333e-01  1.91834271e-01]
   [-3.16872746e-01 -1.39736176e+00 -2.02464193e-01 ...  5.74926496e-01
    -7.20665514e-01  5.38156748e-01]
   [ 4.72142279e-01 -2.42987204e+00 -1.13695443e+00 ... -1.17400491e+00
    -6.63838506e-01 -9.34348226e-01]
   [ 4.37383980e-01 -1.91210353e+00 -1.35850167e+00 ... -6.82220161e-02
    -6.54098868e-01 -6.57951832e-01]]]


 [[[ 1.69672623e-01 -2.31720448e+00 -7.93696225e-01 ...  1.26635635e+00
    -5.03826916e-01 -1.42568254e+00]
   [ 8.15054178e-01 -1.87734914e+00 -4.74097073e-01 ...  1.28979892e-01
    -3.95822763e-01 -4.35646176e-02]
   [ 4.87856209e-01 -1.74324226e+00 -7.17331827e-01 ...  7.02809572e-01
     1.26487523e-01 -2.65370667e-01]
   [-1.05019903e+00  2.55128860e+00  5.80314159e-01 ...  3.45429242e-01
     2.79489160e+00 -1.14719287e-01]
   [ 1.50569642e+00 -7.94944048e-01 -8.54804367e-03 ... -3.03171992e-01
     2.22646356e+00 -9.72814679e-01]]

  [[ 1.65069580e-01  1.38705218e+00 -1.46295160e-01 ...  4.66477215e-01
    -2.15122056e+00  1.49720359e+00]
   [ 1.98555648e+00 -1.40498161e+00  7.33058810e-01 ... -4.19928938e-01
    -6.51496351e-01 -3.17221284e-01]
   [ 2.17228985e+00 -1.70569885e+00  8.17957759e-01 ... -5.19385636e-01
    -5.02107143e-01 -5.11894405e-01]
   [ 2.07864928e+00 -1.57375419e+00  7.87511170e-01 ... -4.69874829e-01
    -5.58198869e-01 -4.22114015e-01]
   [-2.37981868e+00 -2.79026985e+00  1.67625165e+00 ...  3.32251310e-01
     1.07712984e+00  2.79359251e-01]]

  [[-2.59726453e+00 -2.58485556e-01 -1.56555399e-01 ... -4.75263715e-01
    -6.29661739e-01  8.69563818e-01]
   [-1.12702656e+00  2.21406555e+00  3.99260521e-01 ...  2.40152764e+00
    -4.01685745e-01  1.68510818e+00]
   [ 5.94160706e-02  2.00791073e+00 -3.14500988e-01 ...  1.26320696e+00
    -6.11948669e-01  1.79106688e+00]
   [-4.18361366e-01  8.30091834e-01 -2.52058864e-01 ... -1.38858366e+00
    -2.00976387e-01  7.22843707e-01]
   [ 1.56379446e-01  1.77501583e+00 -4.95033294e-01 ...  7.74773717e-01
    -5.71065128e-01  1.66983509e+00]]

  ...

  [[-6.50331736e-01 -7.75322676e-01  4.56743866e-01 ... -1.08240318e+00
    -1.53862035e+00  1.94021118e+00]
   [-6.48938119e-01 -7.69892335e-01  4.58413959e-01 ... -1.07365227e+00
    -1.51818967e+00  1.92054462e+00]
   [-3.07005405e-01 -5.17944455e-01  3.67347568e-01 ... -8.09772253e-01
    -1.12238801e+00  1.41921794e+00]
   [-3.42085212e-01 -5.20778477e-01  3.84080619e-01 ... -9.60439920e-01
    -1.31018806e+00  1.64101744e+00]
   [-1.88916162e-01  4.44561630e-01  7.37804532e-01 ...  5.80599308e-01
     2.31314898e+00 -1.82982969e+00]]

  [[ 1.42568064e+00 -3.11741918e-01 -1.17190421e+00 ... -7.38123953e-01
    -1.70774972e+00  2.43887997e+00]
   [-5.70037901e-01 -8.68768692e-02  3.56637239e-02 ...  6.72290683e-01
     4.30468827e-01 -4.27428842e-01]
   [-6.28739357e-01 -8.67452741e-01  5.04984856e-01 ...  6.73293948e-01
    -4.99443680e-01 -1.00218296e-01]
   [ 1.84164986e-01 -2.95484215e-01 -4.39192206e-01 ...  2.54202038e-01
    -5.42224348e-01  7.07970798e-01]
   [ 8.21320355e-01 -2.81146407e-01  2.38485694e-01 ...  6.77863479e-01
    -1.17492342e+00  1.51104116e+00]]

  [[-5.45827746e-01  1.75641835e+00 -5.46063483e-01 ...  4.79147464e-01
    -8.34876060e-01 -1.89206851e+00]
   [-4.60938275e-01  1.67489076e+00 -2.33769417e-02 ... -6.79758310e-01
    -9.14643288e-01  4.12531972e-01]
   [-5.88242054e-01  5.61904550e-01  1.12813127e+00 ... -1.70422447e+00
     6.40193224e-01  1.74468780e+00]
   [-7.19984353e-01 -5.95665991e-01  1.85500157e+00 ... -1.86343968e+00
     2.32992125e+00  1.50358999e+00]
   [-5.93997240e-01  5.07736266e-01  8.98755312e-01 ... -5.41500509e-01
     9.47924376e-01 -9.02354717e-04]]]


 [[[ 1.01886499e+00  7.07246304e-01 -1.26817119e+00 ...  7.20232964e-01
     1.18867445e+00  6.67371273e-01]
   [-8.19205880e-01  1.50146037e-01 -1.27692938e-01 ... -1.41927457e+00
     4.66120392e-01 -1.01142490e+00]
   [ 4.72669929e-01  5.14694989e-01 -9.14863288e-01 ...  8.50187913e-02
     9.12013471e-01  5.38987294e-02]
   [ 1.01236057e+00  6.97094560e-01 -1.26003385e+00 ...  7.13352859e-01
     1.16642380e+00  6.26711369e-01]
   [ 4.87387151e-01  7.05754876e-01 -1.48120320e+00 ...  9.94350195e-01
    -4.12753403e-01  4.41542685e-01]]

  [[-7.92184055e-01  1.35121393e+00  1.46130168e+00 ... -8.33490610e-01
     2.65534258e+00 -1.70190215e+00]
   [-7.86147833e-01  1.16950047e+00  1.12007678e+00 ... -8.03813934e-01
     2.42030334e+00 -1.24762011e+00]
   [-7.88917661e-01  1.19885027e+00  1.16348922e+00 ... -8.08832943e-01
     2.45282030e+00 -1.31642556e+00]
   [-1.61623979e+00  2.29582787e+00 -1.96513307e+00 ... -1.09129059e+00
     1.45271218e+00 -2.03446126e+00]
   [ 2.23373026e-01 -2.89779544e-01 -5.46640873e-01 ... -8.58616114e-01
    -1.02189571e-01  1.78972125e-01]]

  [[ 2.71228957e+00 -3.01190853e-01  7.29119241e-01 ...  1.07058120e+00
    -1.95445523e-01 -1.23041058e+00]
   [ 1.56437480e+00 -5.89774922e-02  1.07354212e+00 ...  1.62227616e-01
    -7.65786171e-01 -1.34240961e+00]
   [ 1.71143687e+00  2.92736262e-01  1.35132420e+00 ...  6.41611576e-01
     1.46455020e-01 -7.12904096e-01]
   [ 6.59321547e-01  7.44009241e-02  9.48170781e-01 ... -1.10262692e-01
    -9.40885544e-01 -1.14260280e+00]
   [-5.83314419e-01  1.44906902e+00  2.37507653e+00 ... -2.64465570e-01
     7.69216537e-01  3.38556200e-01]]

  ...

  [[ 4.83010888e-01 -1.01937366e+00 -1.05301905e+00 ... -9.99012887e-01
     1.36652422e+00 -2.75660849e+00]
   [ 3.71008486e-01 -8.59475076e-01 -4.94174957e-01 ... -3.47474337e-01
     1.09721684e+00 -2.03869653e+00]
   [ 4.80520763e-02 -3.18988383e-01  9.15928066e-01 ...  1.26322901e+00
     5.10026217e-01 -1.96659625e-01]
   [-6.41535595e-02 -2.16484100e-01  5.01301229e-01 ...  5.01294971e-01
     1.48916864e+00 -7.30760992e-01]
   [ 9.83673811e-01  1.14893043e+00  5.91727078e-01 ...  2.05047560e+00
     1.37970793e+00 -7.76439965e-01]]

  [[-1.27995539e+00 -1.16412377e+00 -7.80307412e-01 ...  2.46035886e+00
    -1.27029550e+00  1.47953832e+00]
   [-1.27247870e+00 -1.16242075e+00 -7.77234375e-01 ...  2.45365477e+00
    -1.25854409e+00  1.47620523e+00]
   [-8.80864143e-01 -8.24089289e-01 -7.19001472e-01 ...  2.20989943e+00
    -6.59801722e-01  1.11479831e+00]
   [-4.38568771e-01  1.02015376e-01  2.71143824e-01 ...  7.49839187e-01
     1.28237128e+00 -1.28990483e+00]
   [ 8.22290421e-01  2.18061566e-01 -2.84042120e-01 ...  2.35507816e-01
     1.68761635e+00 -1.25965548e+00]]

  [[-8.31601620e-01  1.53527766e-01  1.17939755e-01 ... -5.40696420e-02
     1.26932383e+00  1.20196931e-01]
   [ 1.18725491e+00 -8.48548785e-02 -1.41688988e-01 ...  1.31661415e-01
    -9.92572784e-01 -2.30625391e+00]
   [ 1.14933670e+00 -1.32101679e+00 -7.99543679e-01 ...  5.82918346e-01
    -3.91083926e-01 -2.11976027e+00]
   [-7.15477109e-01 -5.20379562e-03  3.13554741e-02 ...  2.46628188e-04
     1.19653606e+00  1.23502268e-02]
   [-1.08015127e-01  1.45491257e-01  6.24188602e-01 ... -8.18454504e-01
    -2.65983701e-01  6.21557117e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-True-32-8-27-11-4] q.shape1: (4, 11, 27)
q.shape2: (44, 27)
q.shape3: (44, 27)
q.shape4: (4, 11, 27)
q_liner: [[[-0.08246311  1.2976369  -4.386915   ...  1.6648992   1.0225513
   -0.23413594]
  [-2.1036825   0.34269288 -1.3593392  ...  0.28710133 -2.3495028
   -0.5770221 ]
  [ 0.55015564  1.3115653  -2.7073863  ... -1.2594198   0.450877
   -0.5750791 ]
  ...
  [ 1.9723426   1.9014059  -0.07350484 ... -0.6233986  -1.8269871
   -3.14204   ]
  [ 0.5897575   0.5651129  -1.4288164  ...  1.6924045  -1.9481409
    1.4147217 ]
  [ 1.4633553  -0.39679056 -0.7927203  ...  0.4363156  -1.650817
    0.20362736]]

 [[-0.9566642   0.6318296  -0.99751896 ... -1.8659797  -0.01259731
    1.0842644 ]
  [-0.15104908  1.3874646   0.19238688 ... -2.0061364  -0.9589741
    0.54090524]
  [-0.31797698 -0.8425765   3.2394023  ...  0.84538174 -0.51091385
   -0.27457827]
  ...
  [ 0.33640513  1.8460543   2.5176854  ...  1.0853881   2.9914553
    2.6077735 ]
  [ 1.546665    0.5879998   0.41907552 ...  0.75106627  1.0203562
   -0.15183803]
  [-1.0632492   2.5393524   0.9687923  ... -1.3010052  -0.02241022
    1.0278877 ]]

 [[ 0.24715352  1.9982486  -1.0008467  ... -0.99167144  2.288722
   -0.38216916]
  [-1.7900983   1.6657426   0.72222143 ...  1.0981413  -0.52470183
   -1.220509  ]
  [-1.0200733  -0.02188973  0.9696115  ... -3.8275013   1.2366807
   -2.000785  ]
  ...
  [-1.0458595  -1.4305166  -1.8524687  ...  1.3384255  -2.3837926
   -1.3595229 ]
  [ 0.65088063 -0.07472718  0.7910718  ...  1.1668599   0.17494643
   -2.2131062 ]
  [-0.5484388  -0.3512259  -0.9518742  ... -0.37090048 -2.5363982
   -0.35450423]]

 [[-1.659759   -2.0460486   1.7956158  ...  0.7144731  -2.8808205
   -2.3229935 ]
  [-0.6778062  -1.0200877   2.5991158  ... -0.39864084 -0.1548618
   -1.7684385 ]
  [-0.9458304   1.8510628  -0.13740486 ... -1.860934    1.164453
    0.04018883]
  ...
  [ 0.38199356 -1.6202837  -1.9532994  ...  2.8872821  -0.4262538
   -0.07649663]
  [-1.2970152  -0.8319859  -1.2084574  ... -0.85649323  1.5001354
    1.9378235 ]
  [ 0.15252627  1.7864983  -2.6395547  ...  0.10763691  0.13296238
   -1.6784537 ]]]
q.shape5: (4, 11, 256)
q.shape6: (4, 8, 11, 32)
attn_res: [[[[-7.82797694e-01 -7.05090404e-01  1.16394675e+00 ...  1.43466663e+00
    -7.27955580e-01  4.03522849e-01]
   [-2.65097558e-01  5.38695335e-01  6.21953607e-01 ...  2.17163754e+00
    -2.66362977e+00  8.79871964e-01]
   [-2.79882401e-01  2.05818892e+00  1.10953450e+00 ...  2.42745161e+00
    -1.51950228e+00  1.62116003e+00]
   ...
   [ 4.44491327e-01 -3.51914525e-01  1.59920490e+00 ...  7.77009368e-01
    -1.15761364e+00 -4.06685740e-01]
   [-5.90563476e-01 -7.17281401e-01  1.02156675e+00 ...  1.01625395e+00
    -3.52799803e-01 -1.01238370e-01]
   [-6.44800484e-01 -5.47839761e-01  4.73242402e-01 ...  1.49182379e-01
    -2.84885406e-01 -5.89085996e-01]]

  [[-3.84690523e-01  5.09867489e-01  1.70596993e+00 ... -4.46363896e-01
     1.47602046e+00 -2.11042094e+00]
   [-2.00560778e-01  3.76345307e-01  1.26715970e+00 ... -6.22877002e-01
     1.08514750e+00 -1.76592994e+00]
   [ 2.21600533e+00 -8.23303834e-02 -1.44443548e+00 ... -1.41419899e+00
     1.03324282e+00 -1.47853017e+00]
   ...
   [-4.32021052e-01 -1.07400775e+00 -7.25562513e-01 ...  6.38647854e-01
    -3.25048089e-01  8.40801001e-02]
   [-4.71170276e-01 -9.11544085e-01 -4.88182396e-01 ...  6.37454629e-01
    -1.70876876e-01 -1.43031567e-01]
   [ 1.09383154e+00 -4.45902944e-01 -2.58861572e-01 ... -1.40261579e+00
    -1.60417467e-01  5.18881917e-01]]

  [[-6.68475091e-01  5.88191152e-01  4.09249902e-01 ...  1.44571984e+00
     1.49056196e+00  7.76133537e-01]
   [-8.16305399e-01  4.60186213e-01  3.31496149e-01 ...  1.48403502e+00
     1.75677037e+00  6.14673972e-01]
   [-5.75285494e-01 -2.69897056e+00 -9.89835203e-01 ...  1.10353673e+00
     2.03809094e+00 -6.83966577e-02]
   ...
   [-7.46705770e-01 -8.80083144e-01 -4.96230662e-01 ... -7.01417923e-01
     5.20667076e-01  7.62722492e-01]
   [-5.05361915e-01  5.70956111e-01 -1.50730625e-01 ...  5.18287778e-01
     6.44528449e-01  1.18766141e+00]
   [-3.46082188e-02  1.10835946e+00  4.05768156e-01 ...  1.17635024e+00
     3.32567662e-01  1.82683313e+00]]

  ...

  [[-1.33651388e+00 -1.32428145e+00  1.88286781e-01 ...  6.31891847e-01
    -6.36829615e-01 -2.82155418e+00]
   [-4.93001282e-01  1.03756225e+00 -1.59344995e+00 ... -1.04979861e+00
     3.97201836e-01 -5.53398013e-01]
   [-1.33327627e+00 -1.31634486e+00  1.82151183e-01 ...  6.25963628e-01
    -6.33139789e-01 -2.81351495e+00]
   ...
   [-1.87176973e-01  1.45256197e+00 -7.59774148e-01 ... -5.38433671e-01
     1.78342268e-01  1.23531866e+00]
   [-1.36399150e-01  2.02703238e+00 -5.66346586e-01 ... -4.48381118e-02
    -3.30575168e-01  1.90042222e+00]
   [-4.57994044e-01  1.24447858e+00 -2.39099592e-01 ... -3.80729400e-02
     3.81052718e-02  1.17919207e+00]]

  [[ 9.57527831e-02  1.05419958e+00 -4.14175868e-01 ...  9.14744854e-01
     1.19614458e+00  1.46989965e+00]
   [ 5.50434887e-01 -1.10757363e+00 -2.80860364e-01 ...  6.60410941e-01
    -1.01275706e+00  1.51269126e+00]
   [ 8.76092434e-01 -2.60682154e+00 -4.05034393e-01 ... -7.46536553e-02
    -1.61918902e+00 -8.38587165e-01]
   ...
   [-8.89152586e-01  1.40690282e-01  2.18697011e-01 ...  1.18205070e+00
     2.56932378e-01  6.96779490e-01]
   [-9.31143463e-01  1.45705730e-01 -4.71376389e-01 ...  1.56571269e+00
    -4.40049209e-02  2.16727471e+00]
   [-6.61939532e-02  5.80882609e-01 -5.53099871e-01 ... -5.87873124e-02
     4.00111258e-01  7.34933972e-01]]

  [[-5.43105006e-01 -1.97100520e-01 -9.77805182e-02 ...  2.12661862e+00
    -1.36288688e-01 -8.65139663e-01]
   [ 1.46774262e-01  1.87085778e-01 -4.29071411e-02 ...  1.84342241e+00
    -1.95560515e-01 -8.34917665e-01]
   [ 4.05392230e-01 -6.04230940e-01  8.00218433e-02 ...  1.83974433e+00
     7.00795293e-01 -2.05803585e+00]
   ...
   [ 4.73383248e-01  3.82585585e-01  2.49550670e-01 ...  5.50663233e-01
    -1.98469311e-02  1.18726432e-01]
   [-4.95617241e-01 -2.72289634e-01 -5.56140125e-01 ...  1.45978487e+00
     5.54666162e-01 -6.58740461e-01]
   [ 4.88506675e-01  5.81339240e-01 -2.60151088e-01 ...  1.23528743e+00
    -1.62985325e-01 -2.90847152e-01]]]


 [[[ 1.02772713e+00  1.35011780e+00 -1.75573993e+00 ...  1.41256022e+00
    -2.45164990e+00  2.14382672e+00]
   [ 1.31864798e+00  2.31072545e+00  6.17401838e-01 ... -3.80683631e-01
     1.20941412e+00  5.41587830e-01]
   [ 7.53494680e-01  1.18271279e+00 -1.57628286e+00 ...  1.17404890e+00
    -1.82647443e+00  1.68410897e+00]
   ...
   [ 2.57203758e-01  6.31534278e-01  6.52221441e-01 ...  4.21593577e-01
    -7.26016641e-01 -3.07845354e-01]
   [ 6.29850924e-01  1.14781535e+00 -1.01373005e+00 ...  1.24820459e+00
    -1.17893183e+00  1.00139141e+00]
   [ 5.83714247e-01  6.54274225e-01 -1.65784299e-01 ...  2.56409287e-01
     3.58881116e-01  3.52989256e-01]]

  [[ 2.46850654e-01 -2.22034740e+00 -9.03714418e-01 ...  6.90524876e-01
    -2.24828553e+00  1.62168884e+00]
   [ 4.01909858e-01  2.10255802e-01  1.82419372e+00 ... -3.04969996e-01
     1.58557975e+00  1.00365147e-01]
   [-1.32026088e+00 -2.05459818e-01 -1.86940837e+00 ...  2.37821436e+00
    -5.91796041e-01 -3.45648885e-01]
   ...
   [-6.29169106e-01  1.65537462e-01 -1.41229010e+00 ...  1.23870826e+00
    -8.54146540e-01  1.61117345e-01]
   [-1.17638655e-01 -7.08831012e-01 -6.49007618e-01 ... -1.53678894e-01
    -1.33530259e+00  2.00567651e+00]
   [ 4.24772173e-01  3.69495422e-01 -6.50876522e-01 ... -3.91570985e-01
    -3.46668959e-02  1.00993037e-01]]

  [[ 6.18349791e-01 -7.21764982e-01  7.88778603e-01 ...  2.46619654e+00
     1.34478879e+00 -3.31257677e+00]
   [-1.44860780e+00 -1.46909845e+00  4.00718540e-01 ... -1.15687728e+00
     1.56199479e+00  1.38887489e+00]
   [-1.26575723e-01 -9.02936578e-01  6.14728689e-01 ...  9.48265433e-01
     1.08806312e+00 -1.13746011e+00]
   ...
   [ 1.83288977e-01 -1.72422802e+00 -2.84835607e-01 ...  7.59351313e-01
    -6.24909639e-01 -2.82874763e-01]
   [-1.14357531e+00 -1.34012282e+00  4.38856363e-01 ... -6.59642041e-01
     1.45278144e+00  7.08489597e-01]
   [ 4.68275130e-01 -7.75296569e-01  2.05964446e-01 ...  8.42780471e-02
     3.18009257e-01 -1.33161330e+00]]

  ...

  [[ 1.79606473e+00 -2.30095387e+00 -8.35755095e-02 ... -1.62428117e+00
     1.12373626e+00 -2.27187657e+00]
   [ 1.71502793e+00 -2.28679180e+00  3.62716317e-02 ... -1.60628307e+00
     1.13005388e+00 -2.15885973e+00]
   [ 1.26729822e+00  1.99069822e+00 -6.27047598e-01 ... -9.85931277e-01
     1.80626416e+00  9.34664682e-02]
   ...
   [ 1.73651743e+00  8.86144519e-01 -1.00368702e+00 ...  1.67378977e-01
    -5.82750261e-01  1.93284489e-02]
   [-2.80047596e-01  7.29664803e-01  8.45449209e-01 ... -3.75143021e-01
     7.41312265e-01  1.99287617e+00]
   [ 1.04985452e+00  4.65070695e-01 -2.48642817e-01 ... -4.44283783e-01
    -5.76454960e-03  1.73775051e-02]]

  [[ 3.08803320e-01 -1.07793617e+00 -8.01253498e-01 ... -1.19333756e+00
    -2.40198660e+00  5.46615601e-01]
   [ 1.33175290e+00  4.81273502e-01  8.49641383e-01 ...  1.90772235e+00
    -5.45336902e-01  4.04765785e-01]
   [ 3.81709456e-01 -6.78820789e-01 -2.91890085e-01 ... -5.24905741e-01
    -1.96161473e+00  3.65842760e-01]
   ...
   [ 6.41799688e-01  3.06217700e-01  8.14647734e-01 ...  1.67071593e+00
    -4.16457117e-01  6.48648620e-01]
   [ 1.52876437e-01 -7.47542500e-01 -2.92613864e-01 ... -4.90122318e-01
    -1.47331238e+00  7.43297562e-02]
   [ 7.49634385e-01 -6.73455715e-01  1.28297389e-01 ... -7.20099986e-01
    -6.45827115e-01 -4.52732503e-01]]

  [[ 5.13023436e-01 -4.12499696e-01 -1.23955142e+00 ... -7.12222531e-02
     1.40037382e+00 -1.18268502e+00]
   [ 1.41168165e+00 -9.89107043e-02  1.20559430e+00 ...  3.78553838e-01
     1.86416554e+00 -4.02199626e-01]
   [ 1.31964159e+00 -1.19578674e-01  1.28999031e+00 ...  5.00372529e-01
     1.76927614e+00 -4.37740266e-01]
   ...
   [ 1.11252427e+00  4.66035269e-02  1.04221356e+00 ...  3.71420979e-01
     1.16235757e+00  3.88628803e-02]
   [ 6.65802002e-01 -3.21025968e-01 -4.48938668e-01 ... -4.78562683e-01
     1.36288702e-01 -4.58530784e-01]
   [-7.92791992e-02 -1.00367284e+00 -4.50505406e-01 ...  1.75546005e-01
     2.13013247e-01  9.15101826e-01]]]


 [[[ 6.79256678e-01 -4.11796361e-01  1.41844913e-01 ...  7.27725506e-01
     2.21689597e-01 -2.43345261e-01]
   [ 6.98762834e-01  1.04673851e+00 -1.83135462e+00 ...  6.27717137e-01
     6.06621444e-01  1.52939951e+00]
   [ 1.15733457e+00  5.41183531e-01 -4.91250455e-02 ... -5.83911717e-01
     5.26498020e-01  4.59215581e-01]
   ...
   [ 4.14125651e-01 -6.56279564e-01 -4.46716428e-01 ...  4.02746677e-01
     2.68846452e-01 -2.91363578e-02]
   [ 1.27852067e-01  3.08756232e-01 -8.44262362e-01 ...  7.65966535e-01
     4.71529067e-01  9.90620434e-01]
   [-8.84265378e-02  4.51626569e-01  5.56991279e-01 ...  1.97941065e-01
     5.22200286e-01  1.92891955e-01]]

  [[-9.85302925e-01 -1.90665412e+00  6.43937290e-01 ... -1.50937098e-03
    -1.42847383e+00 -1.42419624e+00]
   [-1.40195680e+00 -1.30185056e+00  3.89282227e-01 ...  6.17924929e-01
    -1.73726296e+00 -5.92099071e-01]
   [-1.84033358e+00 -6.41903579e-01  1.03622533e-01 ...  1.26289320e+00
    -2.05407023e+00  3.03085655e-01]
   ...
   [-2.87732184e-01  5.61322510e-01  9.90376920e-02 ...  4.68534708e-01
     8.85416925e-01 -1.00895488e+00]
   [-3.94416660e-01 -3.29972982e-01  5.14960766e-01 ...  2.80992329e-01
    -6.81899935e-02 -8.42847764e-01]
   [-1.96576849e-01 -7.18304932e-01  1.86559781e-01 ... -3.25054407e-01
    -7.78824389e-01  5.79773307e-01]]

  [[-1.17996407e+00 -3.46276641e-01  2.58381367e-01 ... -1.14218140e+00
     1.54212689e+00  3.64426970e-01]
   [-1.07037115e+00 -2.62852401e-01  4.30887789e-01 ... -1.06196356e+00
     1.34694564e+00  3.36222529e-01]
   [ 1.11856699e-01 -2.50249743e-01 -4.05974388e-01 ...  2.41025305e+00
    -1.10279715e+00 -4.36427712e-01]
   ...
   [-1.85120970e-01 -5.49954325e-02  7.42031187e-02 ... -1.01709686e-01
     6.47333205e-01 -7.87537336e-01]
   [-1.85561609e+00  1.14335322e+00  1.00731206e+00 ... -1.21800506e+00
     7.11946368e-01  1.10593534e+00]
   [-9.59128797e-01 -1.63643301e-01  1.81809723e-01 ... -6.82621062e-01
     9.33641374e-01  3.88466805e-01]]

  ...

  [[-2.54926562e-01  1.29361176e+00  6.00369811e-01 ... -1.81429017e+00
     4.50769924e-02 -6.68522835e-01]
   [ 3.34940434e+00  1.17560291e+00 -1.14809203e+00 ... -4.23846930e-01
     1.98193324e+00 -2.11457610e+00]
   [-3.34769160e-01  7.00641036e-01 -1.94623232e-01 ... -1.23184681e+00
     8.16662371e-01 -7.14954674e-01]
   ...
   [ 3.50454748e-01  5.54966271e-01 -8.42965305e-01 ...  1.16064382e+00
    -3.55415583e-01  1.06510019e+00]
   [ 1.90324306e+00 -2.92187810e-01 -4.08501685e-01 ... -3.17433268e-01
     5.88834465e-01 -1.08394110e+00]
   [ 2.09099546e-01  9.71636474e-01  2.30301142e-01 ... -8.58015597e-01
     1.62213400e-01 -1.38929322e-01]]

  [[ 2.02414799e+00 -2.14569911e-01 -1.01251018e+00 ...  3.78964871e-01
    -1.93298197e+00  2.57698274e+00]
   [ 5.75349391e-01 -9.06125426e-01 -1.31463516e+00 ... -2.51094532e+00
     4.57995743e-01 -3.77332628e-01]
   [ 1.29631066e+00 -3.16262603e-01 -1.08663619e+00 ... -2.98820198e-01
    -1.21292281e+00  1.45966434e+00]
   ...
   [ 4.72176582e-01 -8.89330029e-01 -1.12209654e+00 ... -2.28638840e+00
     3.22099537e-01 -4.35108453e-01]
   [ 6.93497777e-01 -9.46550250e-01 -2.39336565e-01 ... -4.73958373e-01
     2.36009106e-01 -1.64106667e+00]
   [-7.38585293e-01 -2.06068367e-01 -4.07559812e-01 ...  2.39458472e-01
    -3.15944970e-01 -1.05142820e+00]]

  [[-1.49495471e+00 -1.13906026e+00 -6.02677882e-01 ... -1.48851478e+00
    -5.36250882e-02 -1.76877606e+00]
   [-1.70871377e+00 -3.33489835e-01 -9.91315842e-01 ... -9.19063926e-01
    -1.20420866e-01 -1.50303376e+00]
   [-7.24219799e-01 -1.21567440e+00  2.36331105e-01 ... -1.29008460e+00
     4.46626633e-01 -6.77164495e-02]
   ...
   [-4.27363634e-01 -1.28419542e+00  6.07237697e-01 ... -8.53450119e-01
     8.87462378e-01 -5.42234719e-01]
   [-3.75588804e-01  2.66363434e-02 -1.09328628e-01 ...  2.28698120e-01
     2.54799336e-01 -6.08527362e-01]
   [-6.42826438e-01 -7.00617731e-01  5.22118449e-01 ... -5.57051420e-01
     6.36588573e-01 -3.53115082e-01]]]


 [[[-7.52099752e-01  2.12098813e+00 -2.68689537e+00 ... -1.00197947e+00
     5.23489892e-01  1.12729383e+00]
   [-6.88432574e-01  1.69971323e+00 -2.44537997e+00 ... -1.02435076e+00
     4.85042781e-01  1.10892153e+00]
   [-3.51681858e-01 -6.90798998e-01 -1.09167469e+00 ... -1.10599577e+00
     2.63346940e-01  8.44945967e-01]
   ...
   [-3.63638401e-02  6.43630564e-01 -1.69506609e+00 ...  3.99794042e-01
    -6.88547373e-01  1.60426408e-01]
   [ 1.26261139e+00  8.83741438e-01  6.28516555e-01 ... -1.31980002e-01
    -7.35682487e-01  9.31560278e-01]
   [ 6.71961725e-01  5.87159097e-01  2.83029526e-01 ... -1.14824486e+00
    -4.40750569e-01  1.40367401e+00]]

  [[-4.78691697e-01 -1.50024319e+00  1.48856211e+00 ...  2.05961370e+00
    -5.23125112e-01  5.79068005e-01]
   [ 3.31757367e-02 -1.37775242e+00  1.37856901e-01 ...  1.69133580e+00
     8.03892374e-01  1.58168793e-01]
   [ 6.66514516e-01 -1.03079295e+00 -1.63752484e+00 ...  1.15857196e+00
     2.48905063e+00 -3.24707747e-01]
   ...
   [ 2.21542090e-01  6.60262764e-01  7.52417028e-01 ...  2.23274142e-01
     4.04757671e-02 -4.17402446e-01]
   [-3.51659477e-01  5.62004507e-01  1.75160837e+00 ...  3.59226674e-01
    -7.21669376e-01 -5.69545805e-01]
   [ 1.01380026e+00 -8.36295545e-01 -1.79102492e+00 ...  8.88698995e-01
     2.08030224e+00  7.46353194e-02]]

  [[ 8.87545466e-01 -3.18653965e+00 -9.03638721e-01 ...  1.57836330e+00
     1.30295563e+00  1.40476692e+00]
   [ 1.98698092e+00 -2.11431003e+00 -1.34642005e+00 ...  7.42896974e-01
     6.17649555e-01  1.85571671e-01]
   [ 1.17406404e+00 -7.34221816e-01 -1.12478006e+00 ...  9.17231739e-01
    -8.54862094e-01 -9.76135314e-01]
   ...
   [-3.57811332e-01 -9.37860370e-01  4.64445591e-01 ...  5.17261267e-01
     6.94529891e-01 -1.29476398e-01]
   [ 1.19283080e+00 -8.43895435e-01 -1.11749244e+00 ...  8.77593040e-01
    -8.23087037e-01 -8.77792478e-01]
   [ 7.15175688e-01 -1.24196494e+00 -2.61666358e-01 ...  3.30515474e-01
     1.39026210e-01 -5.09308457e-01]]

  ...

  [[ 9.76177514e-01 -2.82888746e+00  1.95143092e+00 ...  1.08512151e+00
     8.79025340e-01 -1.71927452e+00]
   [-3.13100785e-01 -1.33157837e+00 -1.82478654e+00 ...  1.70922196e+00
    -1.75663328e+00  7.96582878e-01]
   [ 9.00364518e-01 -2.74084139e+00  1.72960818e+00 ...  1.12173426e+00
     7.24126875e-01 -1.57137561e+00]
   ...
   [ 9.73997936e-02 -1.81752634e+00  1.25709713e+00 ...  7.26661623e-01
     5.49839158e-03 -3.63934189e-01]
   [ 1.95312470e-01 -5.19498527e-01  3.64253730e-01 ...  2.72938944e-02
    -4.34487373e-01 -6.89986229e-01]
   [-7.46806443e-01 -4.46989208e-01  5.76055586e-01 ...  2.24367380e-01
     4.00748491e-01  9.53863919e-01]]

  [[-2.62644589e-01  2.10418034e+00 -6.09190285e-01 ...  2.76826859e-01
    -5.42636991e-01  1.25648177e+00]
   [-3.22910637e-01  1.29212976e+00 -7.99763620e-01 ...  1.16374753e-01
    -6.56659722e-01  7.33869195e-01]
   [-1.76827088e-02  2.14411646e-01 -9.43155140e-02 ... -1.61132529e-01
    -8.80290687e-01  6.00491643e-01]
   ...
   [-2.21375942e-01 -1.17633069e+00 -5.08539021e-01 ...  5.48839688e-01
    -6.67705774e-01  2.43189871e-01]
   [-4.93759103e-03  2.13887647e-01 -3.01568806e-01 ...  7.66960859e-01
     1.23438358e-01  1.13379300e+00]
   [-2.29993060e-01 -2.67816573e-01 -5.19306779e-01 ...  1.31643319e+00
     4.06938493e-02  4.62852687e-01]]

  [[ 2.59913951e-01  1.27878439e+00 -3.74643713e-01 ...  2.51893330e+00
     8.88677776e-01 -1.80509162e+00]
   [ 2.23752284e+00 -1.97519290e+00 -1.29602468e+00 ... -2.37561226e-01
    -2.34186485e-01  6.16716385e-01]
   [ 9.41376805e-01 -2.51328409e-01 -5.35112321e-01 ...  1.46455443e+00
     3.63003254e-01 -8.16778660e-01]
   ...
   [ 1.61531299e-01  8.96935642e-01  4.56649393e-01 ...  5.41159689e-01
     8.21315721e-02 -3.07141274e-01]
   [ 1.78109908e+00  1.32447481e-01  1.29475689e+00 ...  2.81842291e-01
     5.01551151e-01  1.41242504e+00]
   [-1.56089112e-01 -9.26118612e-01 -7.72087455e-01 ...  4.47130382e-01
     3.89755517e-01 -1.80325672e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-True-32-8-27-11-8] q.shape1: (8, 11, 27)
q.shape2: (88, 27)
q.shape3: (88, 27)
q.shape4: (8, 11, 27)
q_liner: [[[ 0.7224421  -0.4349443   3.4143312  ...  0.35247484  1.755044
    1.3171575 ]
  [ 2.726345    1.2628067  -1.7939713  ... -0.06979546  0.00453782
    3.1302361 ]
  [-1.1040715  -0.15600364  1.9368501  ... -0.5825903  -0.65041417
   -2.2147686 ]
  ...
  [ 2.2915697   0.908618    1.0856221  ... -1.3256544   0.3059599
   -0.8404981 ]
  [-0.40498114 -0.5691511   2.6631112  ...  0.8738295   0.4198153
    1.1513562 ]
  [-0.4481117  -0.92076814  3.5576978  ...  2.7185454   3.3272922
   -0.97112256]]

 [[-1.1616747  -1.7085901  -0.06308014 ... -0.84628963  0.9343368
   -0.6217179 ]
  [ 0.4018707   0.30482602  0.46497503 ...  0.11524689  0.10966628
   -0.6314564 ]
  [ 2.181069   -1.1074287   1.3467315  ...  0.3924123   0.333957
    0.59106386]
  ...
  [ 3.5478017   0.51425123 -2.1266656  ... -1.1019756  -0.78907716
    2.1269352 ]
  [-1.6231765  -2.7684586   0.24566987 ... -0.25909057 -0.6573771
   -1.6647071 ]
  [ 2.5132887   0.55106294  0.7015406  ...  1.2227943   0.7392053
    1.8680627 ]]

 [[ 0.27821246 -1.1018684   1.7200263  ... -1.7082299  -0.4673362
   -2.2366893 ]
  [ 2.7587233   1.7226602   0.80260444 ...  1.1995286  -0.92798245
    0.2717521 ]
  [ 0.64558136  0.08447142  0.4400963  ...  1.3089368   1.2809186
   -1.5577403 ]
  ...
  [-1.0232698  -1.5747494   1.018051   ...  0.00518736 -0.4626458
    0.8344153 ]
  [ 1.1266454   0.38148978  2.193111   ... -1.535103    0.7982023
   -0.95043397]
  [-0.9965041  -1.8504593   1.8635492  ...  1.692321    1.8115427
   -0.7349715 ]]

 ...

 [[ 2.0749588   2.2624092   0.34631866 ... -3.2463973   1.0677856
    1.5288495 ]
  [ 0.26497793  1.3373191   3.0214698  ...  0.41106525 -0.168928
    0.03355249]
  [ 0.5420742   1.2251354  -3.826573   ... -0.3492088  -0.03093641
    0.7989888 ]
  ...
  [-3.2419846  -1.4931114   0.72515845 ...  1.7054092  -0.04060049
   -2.0626805 ]
  [ 0.9767814   0.28908026 -1.5257835  ... -3.0712612  -0.89618737
   -0.34019697]
  [ 0.62380505  1.7282047  -0.0089727  ...  3.7021785  -0.5753088
    1.6830212 ]]

 [[ 2.0232096   0.64801383  0.06984097 ...  0.75521886  0.41255075
    0.5661507 ]
  [ 0.1846309   0.6487752  -2.7815032  ...  0.88175464 -0.7132604
   -0.08390007]
  [-1.9218032   0.28904673 -1.1362168  ... -2.5849714  -0.15884835
   -1.8206904 ]
  ...
  [-1.7156733  -0.79765487 -1.7961345  ... -0.48244846  1.5824316
    0.23448431]
  [-0.93504095 -0.5579303  -1.3916396  ... -1.3223844  -0.33638978
   -0.6543721 ]
  [-3.1369114  -1.0516436   3.0829988  ...  0.66301984  1.6387496
   -2.8189466 ]]

 [[ 0.5203575   2.510916   -2.5926096  ... -0.47947776 -2.6331599
    1.5112784 ]
  [ 0.2482923   0.10941231 -1.2460439  ...  1.8010229  -0.24936317
   -0.89507395]
  [-0.4074848   0.35642445  1.1563052  ... -0.9337908  -0.3271042
    0.46405247]
  ...
  [ 0.87635964  0.15448402  0.44426605 ... -1.1368421   0.7098688
   -0.3491225 ]
  [-2.248125    0.22241627 -1.8704771  ... -1.2285389   0.29145718
   -0.22001871]
  [-1.0332358   0.15769057 -1.6133977  ...  0.13136601  1.1417925
   -0.2518325 ]]]
q.shape5: (8, 11, 256)
q.shape6: (8, 8, 11, 32)
attn_res: [[[[ 2.29930592e+00  1.64481744e-01  1.01702285e+00 ... -9.95433927e-02
     2.68009752e-01  1.06779754e+00]
   [ 4.91901994e-01 -2.61321163e+00  1.89640963e+00 ...  3.17844301e-01
     2.79524851e+00  4.26422834e-01]
   [ 7.14560330e-01  8.39176357e-01  1.31249976e+00 ... -1.69021797e+00
     2.27317154e-01  1.39981222e+00]
   ...
   [ 1.67043710e+00  2.84278482e-01  5.87283313e-01 ... -2.33790413e-01
    -1.22020289e-01  7.05130696e-01]
   [ 1.85510504e+00  6.88494563e-01 -3.98589820e-01 ... -3.98177505e-01
    -1.20962608e+00 -9.07486439e-01]
   [ 1.05437362e+00 -2.61561573e-01  1.35842472e-01 ...  1.24704339e-01
    -1.13332480e-01  5.12320280e-01]]

  [[-1.12356985e+00 -9.83506382e-01 -1.12679029e+00 ... -1.76943791e+00
    -6.85944736e-01 -2.68765926e+00]
   [-1.47824097e+00  4.78286326e-01 -2.25603127e+00 ... -3.08165163e-01
    -1.40956104e+00  4.94964212e-01]
   [-3.20842206e-01 -1.88976169e+00  1.82584083e+00 ...  2.88553447e-01
    -8.19338918e-01 -6.91011965e-01]
   ...
   [-3.99710000e-01  6.57906532e-01 -1.08710730e+00 ...  5.38541257e-01
     2.55247444e-01 -9.93493721e-02]
   [-1.60077587e-01 -5.02073586e-01  2.97412246e-01 ...  2.73832262e-01
     6.26981437e-01  1.04502809e+00]
   [-9.12903786e-01 -5.15863478e-01  2.18485713e-01 ...  8.71827960e-01
     2.18937397e-01  1.18633270e+00]]

  [[-1.63404834e+00  3.15329015e-01 -2.88394272e-01 ... -3.26663814e-02
     2.97724366e+00 -2.09884381e+00]
   [-1.47793388e+00  1.97742820e-01 -2.26640105e-01 ... -6.04160279e-02
     1.82008469e+00 -1.40075290e+00]
   [-1.10961497e+00 -6.94739260e-03 -2.71672428e-01 ...  3.97056416e-02
     1.26154661e-01 -4.11196083e-01]
   ...
   [-3.42645913e-01 -1.50033188e+00 -1.71798483e-01 ...  9.86898780e-01
    -9.94651973e-01  9.53121260e-02]
   [ 5.46639264e-02  4.40741152e-01 -8.54663670e-01 ... -4.54585344e-01
     8.48150969e-01 -2.22758913e+00]
   [-6.49106860e-01  6.73618913e-01 -5.90066016e-01 ...  1.95189148e-01
     5.03111660e-01 -7.89762288e-03]]

  ...

  [[-3.60828668e-01 -3.50639254e-01  1.72324526e+00 ... -2.69805241e+00
    -2.46656013e+00  6.11302018e-01]
   [-1.22971006e-01  9.29452717e-01  1.74055938e-02 ...  9.29680467e-01
     3.25684309e-01 -2.15683365e+00]
   [-3.56320828e-01 -3.36868316e-01  1.68258429e+00 ... -2.67667389e+00
    -2.43112803e+00  6.01194203e-01]
   ...
   [-1.36202693e-01  2.49740183e-01  3.31518412e-01 ... -1.21585608e+00
    -1.00346005e+00 -4.68953788e-01]
   [ 1.90684870e-01  5.93421757e-01 -7.35006154e-01 ... -5.48742265e-02
     2.06984505e-01 -1.71389818e+00]
   [-1.35383576e-01 -3.08974773e-01 -1.91549152e-01 ...  4.15296257e-01
     7.18355358e-01 -1.56317377e+00]]

  [[ 1.29735219e+00 -1.50211990e+00 -1.12833714e+00 ... -1.43933451e+00
    -9.96930361e-01  1.51755142e+00]
   [ 1.43456912e+00 -4.53953445e-01 -9.61430013e-01 ... -1.20983124e+00
    -5.97446680e-01  1.10965812e+00]
   [ 7.27005720e-01  6.78218246e-01 -1.27437484e+00 ... -6.54683352e-01
     2.86540359e-01  1.51518822e+00]
   ...
   [ 1.51994908e+00  9.10847932e-02 -9.75857437e-01 ... -4.32719618e-01
     1.91399351e-01  1.44976517e-02]
   [ 1.45326173e+00 -6.27583742e-01  1.40255737e+00 ...  9.28951263e-01
    -1.10752714e+00 -8.48638713e-01]
   [ 1.34272611e+00 -5.13755798e-01  9.21667337e-01 ...  5.77723444e-01
    -8.79723608e-01 -8.99160624e-01]]

  [[-1.50207233e+00  8.29241633e-01  1.07725894e+00 ... -6.26680076e-01
     2.26478791e+00  1.79772913e+00]
   [-1.12366891e+00  7.69516826e-01  8.67097676e-01 ... -7.08199739e-01
     2.32277060e+00  1.63535190e+00]
   [ 7.00243056e-01 -1.06534481e+00 -7.49881744e-01 ...  3.18909049e-01
     1.62710643e+00  7.22615659e-01]
   ...
   [ 1.24474645e+00 -1.06499410e+00 -1.24393487e+00 ...  7.63490424e-02
     1.63258374e+00  4.11473572e-01]
   [-1.11574091e-01 -1.22435153e+00 -2.76929587e-01 ... -7.10283592e-03
     1.56510842e+00  1.55074883e+00]
   [ 3.87121849e-02 -5.42808354e-01 -2.84451008e-01 ...  9.71410751e-01
     4.33796197e-01  7.04505920e-01]]]


 [[[-1.23551917e+00 -1.38201523e+00  1.21296906e+00 ...  2.24386549e+00
     3.86394382e-01 -8.50818306e-02]
   [-1.63295603e+00 -5.32034397e-01  6.53088033e-01 ...  1.57469094e+00
     1.64302021e-01 -2.94290066e-01]
   [-1.47358036e+00 -6.83639824e-01  9.86930370e-01 ...  1.36834276e+00
     4.68302637e-01 -2.44234920e-01]
   ...
   [-3.11854005e-01 -6.30388856e-01  1.00649798e+00 ...  5.57893932e-01
     5.30145094e-02 -4.07563150e-01]
   [-1.47745442e+00  2.89847165e-01  7.79004455e-01 ... -9.90756303e-02
     4.64350045e-01 -5.73481381e-01]
   [-9.06590581e-01 -5.65421939e-01  1.32119751e+00 ...  7.92022124e-02
     9.38407660e-01 -3.16813327e-02]]

  [[-2.05873799e+00 -1.66703284e+00  2.36390162e+00 ... -4.67089117e-01
     1.22965634e+00 -1.25620589e-01]
   [-1.67401004e+00 -1.41971469e+00  1.89681435e+00 ... -4.99572724e-01
     9.90873873e-01 -1.55994684e-01]
   [-1.03641701e+00 -9.52349484e-01  1.17609668e+00 ... -5.09003222e-01
     6.11808121e-01 -1.80421576e-01]
   ...
   [-1.64168394e+00 -1.29767764e+00  1.71408570e+00 ... -4.10249054e-01
     9.05799091e-01 -2.17490539e-01]
   [ 5.61679184e-01  1.34273827e+00  4.62346673e-01 ...  4.71610397e-01
     4.84938860e-01 -1.99564546e-02]
   [-4.83647361e-02  4.36622113e-01  5.47260702e-01 ...  4.69822526e-01
     1.13277003e-01  6.39422238e-03]]

  [[-8.90546620e-01 -2.05230641e+00 -4.19193238e-01 ...  8.14763367e-01
     1.18504703e+00 -2.36157870e+00]
   [ 2.07793355e+00 -1.96626687e+00 -9.82275665e-01 ...  1.15117300e+00
    -1.73160529e+00 -4.45691168e-01]
   [ 2.38937974e-01 -8.42937648e-01 -2.03851312e-01 ...  7.10915744e-01
     2.37828046e-01 -1.38963640e+00]
   ...
   [ 1.40589118e+00  8.65791380e-01  2.26800218e-02 ...  2.26553217e-01
     4.78913695e-01  5.99201843e-02]
   [ 5.58611572e-01 -2.78411377e-02 -7.12576509e-02 ...  1.91652834e-01
     4.07429308e-01 -3.84784997e-01]
   [ 1.13654160e+00 -1.26374829e+00 -5.94699264e-01 ...  1.06376255e+00
    -1.00664997e+00 -4.42791045e-01]]

  ...

  [[-1.74510825e+00  8.61098528e-01 -6.50493622e-01 ... -3.28302789e+00
    -1.08785796e+00  5.20625770e-01]
   [-1.72781074e+00  8.57256293e-01 -6.46260440e-01 ... -3.26838303e+00
    -1.08010292e+00  5.08153617e-01]
   [ 1.01990962e+00  2.47041181e-01  2.62444280e-02 ... -9.41993117e-01
     1.51653007e-01 -1.47283852e+00]
   ...
   [-1.96648296e-02  3.34963948e-01 -8.12128663e-01 ...  1.19863009e+00
     6.67339861e-01 -1.33301985e+00]
   [-2.66520411e-01  1.40880656e+00 -1.68568134e-01 ...  8.41176867e-01
    -3.11271727e-01 -3.39300603e-01]
   [-5.50514996e-01  5.11174440e-01 -2.15692759e-01 ... -7.74040639e-01
    -1.43968791e-01 -2.71022856e-01]]

  [[-1.16930938e+00  1.37919998e+00  1.77833676e+00 ...  5.66664994e-01
    -4.76901494e-02 -5.42733788e-01]
   [-1.51538992e+00  1.00692081e+00  1.47241938e+00 ...  3.19259107e-01
     3.40949774e-01 -3.32549810e-02]
   [-4.44284171e-01  1.78862780e-01  9.01913524e-01 ... -6.25910044e-01
     2.98512965e-01 -1.07214558e+00]
   ...
   [ 3.05181950e-01  1.11336362e+00  6.74190164e-01 ... -4.22054082e-01
     6.46130741e-01 -1.61087024e+00]
   [-2.96581686e-01  3.73865664e-01  7.53485203e-01 ...  3.42425793e-01
     3.73649418e-01 -2.54307419e-01]
   [-4.37480032e-01  8.09769273e-01  1.02907836e+00 ... -4.97010738e-01
     6.60119832e-01 -1.02402699e+00]]

  [[-3.02879691e-01  1.71402335e+00  4.92524534e-01 ...  1.68938851e+00
     1.64163840e+00  3.41118574e-02]
   [-9.18986917e-01  1.24247849e-01  1.08746088e+00 ...  8.17934155e-01
    -5.70389271e-01 -9.67636704e-01]
   [ 1.94573951e+00  6.92887306e-01  1.55967963e+00 ...  7.74396479e-01
    -6.47921041e-02  1.56291378e+00]
   ...
   [ 2.24395514e-01  3.65169585e-01  5.15642405e-01 ...  3.13895106e-01
     1.00055826e+00  7.89382219e-01]
   [ 1.11651242e-01 -9.30709615e-02  7.36164808e-01 ...  1.93504065e-01
     7.52256870e-01  1.00363660e+00]
   [ 7.27238655e-01  7.83828855e-01  6.76017776e-02 ... -6.69153214e-01
     1.38852048e+00  6.04394734e-01]]]


 [[[-2.03731871e+00 -1.19672990e+00 -1.56765890e+00 ...  1.01664054e+00
     4.20120299e-01  1.14538632e-01]
   [-1.80783010e+00 -9.12708521e-01 -1.51787090e+00 ...  1.08807647e+00
     2.91041613e-01 -1.99834704e-02]
   [-6.91125870e-01 -4.84159499e-01 -1.21955287e+00 ...  1.26558673e+00
     1.79635242e-01 -1.12333104e-01]
   ...
   [ 8.50528777e-01 -7.56493509e-01  1.75867677e-01 ...  1.44125450e+00
     7.08182752e-01  3.88708800e-01]
   [-8.45141947e-01 -1.43058097e+00  2.12202764e+00 ...  3.30119848e-01
     1.20682120e+00  6.51192844e-01]
   [-4.29668754e-01 -6.79789722e-01  1.17221427e+00 ...  1.40322521e-01
     2.90795207e-01  6.14536762e-01]]

  [[-1.24512565e+00  9.05421317e-01 -4.97368753e-01 ...  1.54153311e+00
    -9.74362731e-01  3.18297923e-01]
   [-1.16392446e+00  9.22408342e-01 -1.97270334e-01 ...  1.48080182e+00
    -8.00370514e-01  6.75090969e-01]
   [-5.84514260e-01  8.07108939e-01  1.55089617e+00 ...  9.99391735e-01
     1.66239738e-01  2.52892923e+00]
   ...
   [ 6.97689414e-01  2.96246791e+00  7.83647418e-01 ... -1.33828139e-02
     2.20221591e+00  5.23324490e-01]
   [-2.86970139e-01  1.37469125e+00  9.20122623e-01 ...  1.35893047e-01
     7.44928181e-01  7.08365560e-01]
   [-3.33450228e-01  6.59322381e-01  9.79734957e-01 ... -4.53988463e-01
     3.19667995e-01  1.51572913e-01]]

  [[ 8.43233392e-02 -2.90420842e+00  1.53992921e-01 ... -1.08981705e+00
    -1.81922507e+00 -1.00536287e+00]
   [-2.51882493e-01 -1.93921423e+00 -4.44075167e-02 ... -9.76576746e-01
    -8.90176415e-01 -7.61282682e-01]
   [-3.36509675e-01  3.50051075e-01  8.42559218e-01 ... -2.33707219e-01
     1.97884738e+00 -2.93176711e-01]
   ...
   [-1.24541318e+00  6.14743471e-01 -2.40927041e-01 ... -1.47003829e-02
     4.56930339e-01 -5.68261385e-01]
   [ 5.15691400e-01  1.29693747e+00  1.29326805e-02 ... -8.76997054e-01
    -2.43649334e-01 -5.18689573e-01]
   [-1.46691561e+00  2.76467085e-01  7.83053100e-01 ... -4.68465924e-01
     3.53129476e-01  9.56063390e-01]]

  ...

  [[-1.02148223e+00 -1.90400648e+00  1.51862442e+00 ...  1.53731823e-01
     1.97434974e+00  2.32368684e+00]
   [-9.95903671e-01 -1.37928796e+00  7.02485025e-01 ... -2.77225733e-01
     4.82631028e-01  8.53853703e-01]
   [-8.95832121e-01 -1.71480143e+00  1.25288296e+00 ...  9.13495272e-02
     1.72198343e+00  2.02223492e+00]
   ...
   [ 1.07970707e-01 -3.01111221e-01  1.01309150e-01 ... -2.01747671e-01
     4.86485153e-01  2.61973709e-01]
   [-2.44670853e-01  5.96364021e-01 -3.84426653e-01 ... -3.05484533e-01
    -7.79494196e-02  2.95157313e-01]
   [ 1.72556236e-01 -7.90012032e-02 -1.58772618e-01 ... -7.25641370e-01
     9.49458256e-02 -4.51774120e-01]]

  [[ 1.55342683e-01  1.89956093e+00  4.21297789e+00 ...  3.70919019e-01
    -9.25309896e-01 -2.32174373e+00]
   [-7.74865866e-01  3.73879254e-01  2.45730591e+00 ...  1.38833672e-02
     2.06273049e-01 -1.30612636e+00]
   [ 4.49955106e-01  1.23348105e+00  2.58463955e+00 ...  6.07989967e-01
     1.57448560e-01 -1.23563194e+00]
   ...
   [-3.08285635e-02  1.13984182e-01  1.11608851e+00 ... -7.34612167e-01
    -9.23602730e-02 -6.35224462e-01]
   [ 1.31502020e+00  8.35339278e-02  1.06710529e+00 ...  2.41355300e-01
     8.16660106e-01 -5.06259859e-01]
   [ 1.34372258e+00 -5.14276445e-01  1.41382957e+00 ... -4.91896987e-01
    -2.55720437e-01 -9.13248241e-01]]

  [[ 5.73971331e-01  3.18099403e+00 -2.04927564e+00 ... -8.78634691e-01
     5.07037222e-01 -1.16363674e-01]
   [ 3.63775492e-01  2.62554526e+00 -1.39180863e+00 ... -9.18032706e-01
     4.06157643e-01 -1.08253039e-01]
   [-3.09406281e-01  5.38695574e-01  1.38102543e+00 ... -8.85276437e-01
     1.49019003e-01  2.11356342e-01]
   ...
   [-5.28546453e-01  1.54193616e+00  5.17755032e-01 ... -3.75745386e-01
     2.56870925e-01  1.78218663e-01]
   [-1.92495918e+00  2.90219426e-01 -3.01160663e-01 ... -1.65504324e+00
     1.02426454e-01  7.01026320e-01]
   [-1.08978462e+00  1.04029369e+00 -7.97640562e-01 ... -1.41758609e+00
     1.64621606e-01  3.69242907e-01]]]


 ...


 [[[-5.23577094e-01  3.09747368e-01 -2.24636197e+00 ... -2.64340580e-01
     9.33719695e-01 -8.64511728e-01]
   [ 1.14286971e+00 -2.26517737e-01  1.47475672e+00 ... -6.41097426e-01
    -7.79094338e-01 -2.32091248e-01]
   [-3.79387110e-01  2.47085690e-01 -1.96345019e+00 ... -2.94697821e-01
     8.14806223e-01 -7.55289137e-01]
   ...
   [ 1.66655135e+00  6.20024264e-01 -7.97769606e-01 ... -2.54002261e+00
    -1.68665898e+00 -4.46416676e-01]
   [ 1.15498388e+00 -2.24504739e-01 -4.28489596e-01 ... -4.50542241e-01
    -2.99183428e-01  2.21334964e-01]
   [ 3.23576719e-01  6.95001334e-02 -1.09837282e+00 ... -5.93767881e-01
    -3.21236461e-01 -5.73535152e-02]]

  [[-9.77786183e-02  4.45360780e-01 -8.19456577e-01 ...  1.61316633e-01
    -1.40525058e-01 -1.76251853e+00]
   [-2.41912574e-01  1.69864550e-01 -1.90046370e-01 ...  1.75516307e-03
    -5.05536377e-01 -1.73822367e+00]
   [-3.77265811e-02 -5.61514378e-01  3.90806943e-01 ...  5.11253774e-02
    -1.76773643e+00 -1.31159365e+00]
   ...
   [-1.45864189e-01  4.02262181e-01  5.08843780e-01 ...  1.34030879e+00
     1.33261323e+00  1.40674138e+00]
   [ 4.25913095e-01 -1.67714164e-01 -4.22556847e-02 ... -1.49426430e-01
     5.51056564e-02 -1.81804121e+00]
   [ 1.55748241e-02 -1.05891772e-01  3.76196623e-01 ...  9.22345042e-01
     2.87458152e-02 -1.47092175e+00]]

  [[ 7.31119335e-01 -1.74818134e+00  2.28420353e+00 ... -5.03938878e-04
    -5.01344442e-01  1.84551764e+00]
   [ 3.71722639e-01 -2.33450234e-02 -2.33302474e-01 ...  1.02219748e+00
     2.66256905e+00 -2.67500734e+00]
   [ 7.52491891e-01 -8.04628134e-01  1.08491755e+00 ...  8.28198910e-01
     2.32349083e-01  3.19710791e-01]
   ...
   [ 2.36830950e-01 -4.47919369e-01 -1.18083000e-01 ...  4.92184848e-01
     4.49604869e-01 -7.32081294e-01]
   [-1.41169679e+00 -4.28557873e-01 -1.05316043e+00 ... -8.36964250e-01
     1.05959713e+00 -1.69584048e+00]
   [-7.95671105e-01  2.72055268e-02  5.88857055e-01 ... -2.24537715e-01
     4.74835068e-01  3.15239757e-01]]

  ...

  [[-3.00324130e+00  2.27493453e+00 -2.53267407e-01 ...  5.91655612e-01
     6.55345142e-01 -1.88414395e+00]
   [-1.76998627e+00 -6.84234858e-01 -4.57431525e-01 ... -2.89342329e-02
     6.29295468e-01  7.53205836e-01]
   [-3.88447404e-01  1.89115620e+00 -7.18472421e-01 ...  1.10171747e+00
     2.37284094e-01 -1.72132039e+00]
   ...
   [-2.78336436e-01 -7.34336823e-02  4.04408276e-01 ... -6.93466425e-01
    -9.97655392e-01  9.83115554e-01]
   [-4.94676650e-01 -3.67754161e-01  1.08315742e+00 ... -1.10427785e+00
    -1.44578493e+00  1.81373513e+00]
   [-3.28795284e-01 -6.32193923e-01  5.71555376e-01 ... -9.05484080e-01
    -1.80358529e-01  1.28702950e+00]]

  [[ 8.77268732e-01 -4.10598934e-01  7.67015278e-01 ...  8.00498545e-01
    -5.44355154e-01 -2.67568916e-01]
   [ 6.81768119e-01  1.59644055e+00  2.35124856e-01 ... -2.06102228e+00
    -1.57994553e-01  9.61350083e-01]
   [ 3.82003903e-01  3.39776278e-01 -1.07261729e+00 ... -7.16167510e-01
     3.69500428e-01  9.92328405e-01]
   ...
   [-9.72434044e-01 -7.14947999e-01 -4.46261823e-01 ...  4.41125691e-01
    -5.23746073e-01  5.12334824e-01]
   [ 1.52161509e-01 -5.80757737e-01 -4.38756675e-01 ... -1.06609233e-01
     6.05237558e-02 -1.22285676e+00]
   [ 1.18751168e-01 -1.08804810e+00  1.21069387e-01 ... -1.99705452e-01
    -4.81202304e-01 -7.03940094e-01]]

  [[-2.31879997e+00  3.23942035e-01  9.37920809e-01 ... -5.63451171e-01
    -4.64981407e-01  1.48543751e+00]
   [-2.09423900e-02  1.01500034e+00 -2.43932247e-01 ... -7.48187780e-01
     1.15023613e+00  1.12210011e+00]
   [-1.01159739e+00  7.05622613e-01  2.65302479e-01 ... -6.71307743e-01
     4.49873775e-01  1.28155458e+00]
   ...
   [-7.92707324e-01  5.05951822e-01  8.66278186e-02 ... -2.11775467e-01
     2.66125619e-01 -3.62946928e-01]
   [-1.62499738e+00  3.33974600e-01  4.74820793e-01 ... -4.40173388e-01
    -1.08137555e-01  7.47754455e-01]
   [ 5.84261715e-02  3.51829141e-01  9.17507708e-02 ...  4.98433679e-01
     3.81224126e-01  3.94881606e-01]]]


 [[[-5.02216578e-01 -2.33657598e+00 -7.69787133e-01 ...  1.59963918e+00
    -1.52967960e-01  2.36315107e+00]
   [-5.14567256e-01 -2.28237486e+00 -6.97986662e-01 ...  1.51181686e+00
    -1.38898849e-01  2.37501001e+00]
   [-1.10156894e+00 -1.65055907e+00  2.25888872e+00 ...  9.25542772e-01
     8.73935401e-01  1.98507428e+00]
   ...
   [ 6.92387700e-01 -8.38977516e-01  1.60156500e+00 ...  6.20569050e-01
    -4.72387969e-02  8.86278927e-01]
   [ 4.19787854e-01 -2.02289581e+00  8.69317770e-01 ...  1.70581305e+00
     3.01637936e+00  1.05180216e+00]
   [ 1.40804076e+00 -2.32210398e+00  7.60907769e-01 ...  1.47407913e+00
     1.97639108e+00  9.83586073e-01]]

  [[ 1.04314864e+00 -1.56638062e+00  1.10289752e+00 ... -2.18960309e+00
     7.50824153e-01 -1.28821909e+00]
   [ 9.51477468e-01 -7.84027100e-01  2.70042801e+00 ... -4.66197163e-01
     1.24079168e+00 -1.48869768e-01]
   [ 9.07663405e-01 -1.31746566e+00  1.29348361e+00 ... -2.15703177e+00
     7.77407169e-01 -1.18211079e+00]
   ...
   [ 4.57119673e-01 -4.33496445e-01  1.21140754e+00 ... -2.00707006e+00
     4.36300993e-01 -1.45000732e+00]
   [-5.32869697e-01 -4.46309268e-01 -1.85763538e-01 ...  1.33806229e-01
     5.31509697e-01 -8.92537057e-01]
   [ 1.88930452e-01 -2.38757402e-01  5.91547489e-01 ... -1.13304853e+00
     9.56508279e-01 -7.99867392e-01]]

  [[-1.71718574e+00 -6.18346691e-01 -2.36137092e-01 ...  9.47143376e-01
     6.82267070e-01 -1.45662522e+00]
   [-1.83149076e+00  1.67528534e+00 -6.10133052e-01 ...  1.62860274e-01
     1.10560429e+00 -3.32612514e-01]
   [-1.58737612e+00  5.22891939e-01 -7.66673565e-01 ...  4.04881656e-01
     8.72087061e-01 -3.17398548e+00]
   ...
   [-1.56652582e+00 -4.84370828e-01 -1.14526713e+00 ...  3.24671715e-01
     7.41721988e-01 -2.38602805e+00]
   [-9.64861155e-01  4.99784946e-02  4.74504322e-01 ...  3.78816158e-01
     4.07266974e-01 -1.51054025e+00]
   [-8.18779945e-01  9.82970953e-01 -3.34682494e-01 ...  8.74235928e-01
     6.39162511e-02 -1.48706603e+00]]

  ...

  [[ 8.40526298e-02 -3.05065423e-01 -2.40211725e+00 ...  2.51445079e+00
     6.22644126e-01  4.88214254e-01]
   [ 1.15869805e-01 -3.97488564e-01 -2.30415416e+00 ...  2.42161703e+00
     5.95580935e-01  5.33915520e-01]
   [ 8.19318146e-02 -1.19066310e+00 -9.22089219e-01 ...  7.37422347e-01
    -1.40535325e-01  7.16316104e-01]
   ...
   [ 3.37998658e-01 -6.38206080e-02 -5.90681553e-01 ... -2.07061455e-01
    -5.94067454e-01  7.99896300e-01]
   [ 2.25297153e-01  2.33066589e-01 -1.04505837e+00 ...  4.33694333e-01
    -5.97039759e-01  2.84478933e-01]
   [-1.17132652e+00  8.24551046e-01 -8.22138429e-01 ... -9.19350266e-01
    -6.45599604e-01  1.05909899e-01]]

  [[ 1.54328597e+00  1.04389977e+00  1.68628466e+00 ...  7.05978632e-01
    -8.90491366e-01 -1.18545473e+00]
   [ 1.09322238e+00  8.24211538e-01  1.36300778e+00 ...  7.52861381e-01
    -7.03641057e-01 -6.76098585e-01]
   [-6.60677433e-01 -4.47036684e-01  3.63803446e-01 ... -1.51663101e+00
    -8.49872530e-01  1.26021528e+00]
   ...
   [-7.67961681e-01  5.17816067e-01  4.12962496e-01 ...  2.55298078e-01
    -1.22623809e-01 -2.38133520e-02]
   [-6.53602779e-01  7.28860438e-01  8.90548587e-01 ...  1.62543744e-01
    -3.36647391e-01 -5.53217173e-01]
   [-2.44571596e-01 -4.30736125e-01  9.35387611e-01 ... -2.97742701e+00
    -1.58123815e+00  4.65305805e-01]]

  [[ 4.55715179e-01  1.19146752e+00 -2.30643082e+00 ...  6.46457732e-01
    -4.68116790e-01  1.53607339e-01]
   [-7.74578825e-02 -4.55456644e-01  3.08382839e-01 ...  1.26317620e-01
     2.46407524e-01  8.85237157e-01]
   [-1.08658455e-01 -3.96715105e-01  4.47291732e-01 ...  1.32892042e-01
     2.59060204e-01  7.21964478e-01]
   ...
   [ 4.35228616e-01  1.05414975e+00  1.94830656e-01 ...  3.94947022e-01
    -1.24072894e-01 -4.02740717e-01]
   [ 2.84697980e-01  1.19587195e+00 -1.38542461e+00 ...  2.94206470e-01
    -4.41391140e-01  5.77223837e-01]
   [ 3.17377865e-01  7.78876066e-01  5.50578654e-01 ...  7.22341537e-01
    -1.98021710e-01 -3.64834756e-01]]]


 [[[-7.65058279e-01 -1.28571784e+00 -2.52530705e-02 ...  9.61547941e-02
     2.43091965e+00  1.85263646e+00]
   [-7.62691677e-01 -1.29602849e+00  1.96099468e-02 ...  1.60103872e-01
     2.36835146e+00  1.74982452e+00]
   [-7.62938380e-01 -1.40238011e+00 -3.49719375e-01 ... -1.46326035e-01
     2.01772332e+00  1.67375791e+00]
   ...
   [-4.08040643e-01 -1.35418415e-01 -4.21337456e-01 ... -1.19810057e+00
    -1.95115054e+00 -2.83383191e-01]
   [-5.33847809e-01 -8.90270233e-01  1.70799226e-01 ... -1.67972684e-01
     3.73974115e-01  7.49898016e-01]
   [-3.26613575e-01  8.42672110e-01  9.09774601e-01 ...  6.21514581e-02
     2.87985176e-01  6.81026280e-01]]

  [[ 1.93592772e-01  9.59824264e-01  3.40321332e-01 ... -4.49948370e-01
     1.83061779e-01 -1.93495548e+00]
   [ 1.67419046e-01  9.57827270e-01  3.61894876e-01 ... -4.09913957e-01
     1.62785456e-01 -1.85928059e+00]
   [ 2.56705374e-01  4.15964216e-01  1.46771419e+00 ...  2.92594504e+00
     1.34135079e+00 -6.35596871e-01]
   ...
   [-1.09345055e+00  7.64212072e-01  1.45986903e+00 ...  1.75721824e+00
    -7.79285431e-01  2.15665817e+00]
   [ 7.04375375e-03 -2.50349343e-01  2.39688620e-01 ...  8.43830705e-01
     6.54134452e-01  8.32153797e-01]
   [-2.66376942e-01 -5.23450673e-01  6.65453196e-01 ... -8.09507132e-01
    -1.77260727e-01 -3.67632985e-01]]

  [[-1.66600466e+00  1.88242126e+00  2.58194208e-01 ... -4.67830509e-01
     1.85051218e-01  2.26301193e-01]
   [-1.54710555e+00  1.68335783e+00  5.27301431e-02 ... -4.94050920e-01
     1.37241349e-01  2.96989381e-02]
   [-1.63814044e+00  1.83126211e+00  2.15119675e-01 ... -4.75400299e-01
     1.70433432e-01  1.84607610e-01]
   ...
   [-2.28787169e-01 -2.07675886e+00  2.24456452e-02 ... -1.39412344e+00
    -1.59171355e+00 -2.35364109e-01]
   [-1.35560489e+00  5.77401757e-01 -2.90520638e-01 ...  1.72232080e+00
    -2.25373602e+00 -4.72125798e-01]
   [-4.99463856e-01 -8.07881534e-01 -6.85226381e-01 ... -2.36907601e-01
    -1.13581586e+00 -2.38638803e-01]]

  ...

  [[-3.43075544e-01  4.16523457e-01  1.04071283e+00 ...  3.43887091e-01
    -2.70073867e+00  1.23653293e+00]
   [-2.95889646e-01  4.40832317e-01  7.76438236e-01 ...  4.62658316e-01
    -2.25116205e+00  9.63957906e-01]
   [ 4.19853330e-02  6.03992701e-01 -1.15947378e+00 ...  1.33067656e+00
     1.06628346e+00 -1.01727307e+00]
   ...
   [-4.54503655e-01 -3.75242531e-03 -2.42052972e-01 ... -4.45018142e-01
    -3.56792808e-01  1.65305626e+00]
   [ 4.31661934e-01 -4.40567344e-01  8.90839756e-01 ... -3.61372530e-01
    -7.34757721e-01  7.56591797e-01]
   [-6.29006922e-02  2.26471618e-01  5.21057606e-01 ...  2.31786340e-01
    -1.07727671e+00  1.16489983e+00]]

  [[-1.34708977e+00 -2.93532348e+00  2.07337784e-03 ... -1.07136993e-02
    -1.15677512e+00 -2.85353605e-02]
   [-1.83600330e+00 -1.28390384e+00  5.04585922e-01 ...  4.57631946e-01
    -4.78776515e-01 -1.24641821e-01]
   [-1.88095260e+00 -1.07083344e+00  5.65232992e-01 ...  5.19085944e-01
    -3.96689922e-01 -1.49304733e-01]
   ...
   [ 1.08296728e+00  5.47329009e-01  6.17370486e-01 ...  2.01669097e+00
    -2.88477629e-01 -1.80704892e+00]
   [-1.15234196e+00 -1.32611370e+00 -8.01332891e-02 ... -4.54871774e-01
    -2.87268043e-01  1.66955769e-01]
   [-3.03121686e-01 -6.83007896e-01 -1.06202829e+00 ...  7.68090069e-01
     3.68466318e-01 -7.76617289e-01]]

  [[-8.43631744e-01  1.70818186e+00  6.39258564e-01 ... -3.17088175e+00
     1.74215749e-01  3.40708590e+00]
   [ 4.95791852e-01 -3.30271900e-01 -2.15916872e+00 ... -2.12281060e+00
    -5.33408642e-01 -9.30221736e-01]
   [ 4.11442220e-01  8.31273079e-01 -2.88995314e+00 ...  1.20510161e+00
     3.83064449e-01 -5.46640992e-01]
   ...
   [ 2.74629772e-01  2.24563748e-01  6.93054423e-02 ...  1.79149485e+00
     6.91932201e-01 -1.58029288e-01]
   [-1.04013085e-01 -2.08568192e+00  1.21975407e-01 ... -1.10306241e-01
    -4.96909440e-01 -6.07418776e-01]
   [-4.11456041e-02 -9.40154910e-01 -2.28354841e-01 ... -5.63349724e-01
    -8.59609604e-01 -1.20323110e+00]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-False-32-8-27-5-4] q.shape1: (4, 5, 27)
q.shape2: (20, 27)
q.shape3: (20, 27)
q.shape4: (4, 5, 27)
q_liner: [[[-0.45098242 -1.8597653  -0.18044859 ...  0.44736135 -0.781291
   -1.3717852 ]
  [-1.5089675  -1.1255506   0.2868886  ... -0.59291077 -4.2512317
    1.4017425 ]
  [-0.5946903   1.0263848  -0.581638   ... -2.404116    1.5132208
   -2.4856858 ]
  [-0.31688586  0.5528781  -0.47048947 ... -3.4016237   0.32389942
    0.792212  ]
  [ 0.5705429  -1.4638315  -1.4060916  ...  0.13239647 -0.5641086
   -0.13941243]]

 [[-0.48622677  0.58664197 -0.8507686  ... -1.5951675   0.925034
   -0.5789255 ]
  [ 0.01250778  0.2590642  -1.4820707  ...  0.27701756  0.50881475
   -1.5133846 ]
  [ 1.8713679  -1.6441334  -0.23689702 ...  1.4759533   0.5980671
    1.3676003 ]
  [-1.7826596  -0.49967113 -0.13877717 ... -2.309278   -0.94425654
   -0.6702585 ]
  [-1.9854672  -0.1258095  -1.3325741  ... -1.2256528   0.3417048
   -1.306887  ]]

 [[ 0.08923486  0.40770042 -1.179379   ... -2.331579    1.0649294
   -1.4443758 ]
  [-0.9717777  -1.0941966   0.10684844 ... -1.3449765   1.5412539
    1.2202598 ]
  [-1.9089527  -0.49968353 -0.7305629  ... -0.31890056  0.05979536
   -0.012014  ]
  [ 0.8310764  -0.54699755 -2.0045779  ...  1.1674607  -0.8113641
    2.528547  ]
  [-0.6054805   0.17777057 -0.3048614  ... -3.8101263   0.3146161
    0.12864286]]

 [[-1.0738883   0.71441406  1.033029   ...  2.1741903  -0.05606913
   -2.216511  ]
  [ 2.8600929   2.6552117   1.1548573  ...  0.5743336  -0.509936
   -1.0215002 ]
  [-0.76020247 -2.2237751  -0.00880839 ... -1.8565425   0.76902795
    1.1017361 ]
  [ 0.56063336  2.2217882   1.0828176  ...  1.7795793  -0.5760088
    1.1000314 ]
  [-0.13495904 -2.4847577  -0.8736485  ... -0.48269773  0.6778818
    1.9465017 ]]]
q.shape5: (4, 5, 256)
q.shape6: (4, 8, 5, 32)
attn_res: [[[[-1.816547   -0.3495521   0.2079937  ... -0.42757976 -0.26867008
    -0.93475676]
   [ 1.4930425  -2.0854533   1.7868445  ... -2.725434    0.11511506
    -0.12302628]
   [-0.27526066 -1.233642    0.01429317 ...  0.48763072 -0.46220648
    -1.3002135 ]
   [ 0.37774357 -1.1686964   0.2601993  ... -1.1766689  -0.15675294
    -0.15661557]
   [ 0.7260292  -1.8565931   0.07483399 ... -0.5922148   0.63679814
    -0.3185727 ]]

  [[-1.5518532   0.0694391  -3.1525264  ...  0.56982833 -0.98220956
    -0.67328787]
   [-1.4049532   0.73789394 -1.9653988  ...  0.09246025 -0.03517137
    -0.45618403]
   [-0.3239324   1.2044983   1.1949637  ... -0.16807021  0.00571827
    -0.11057796]
   [-0.28973103  0.96564734  0.20933664 ...  0.13064565 -0.39433584
    -0.04220863]
   [-2.2377942   0.12676142 -2.5937846  ... -0.26685762 -0.6142252
    -0.9111365 ]]

  [[ 0.6681308   0.10612985 -0.01407216 ...  1.9944679   0.02597259
    -0.74883115]
   [ 0.02953915 -0.38170484 -0.9398417  ...  2.7309487  -0.24444053
    -1.1819438 ]
   [-0.9251646   0.8239346  -0.21311045 ...  2.0327542  -0.4330653
    -0.45269436]
   [-1.4972848   1.12509    -0.55232435 ...  1.9299675  -0.74983716
    -0.20799269]
   [ 0.060559    0.32955992 -0.15916377 ...  1.4768367  -0.23335342
    -0.30656075]]

  ...

  [[-1.6764549   0.8335366  -0.6530717  ... -2.03874    -1.9644032
    -1.3480743 ]
   [-0.45884603  0.8052085   0.7013218  ...  0.15491042  0.5221436
    -0.4086475 ]
   [-0.75721806  1.190844    1.2795433  ...  2.1369936   0.10216983
    -2.9118917 ]
   [-0.69012034  1.0077641   1.1074452  ...  1.9640265   0.1401025
    -2.5991495 ]
   [-1.4590151  -0.39826876  1.2313857  ... -1.5614924  -2.5810194
    -0.05432747]]

  [[-0.54843295  0.3801065   0.603457   ... -1.2845359   0.2441995
    -0.10634154]
   [-3.2917855   0.48887604  2.3143353  ... -0.93108225 -1.3882588
     0.4305929 ]
   [ 1.0636346   0.8828341   0.44591796 ...  0.9605551   0.2146078
     1.0169467 ]
   [ 0.5841731   0.05655849  0.42847776 ...  1.6219368   1.3457029
     1.3922528 ]
   [ 0.49298343  0.21755774  0.37395236 ...  0.39074785  1.1984894
     0.8251316 ]]

  [[-0.37402818 -0.17908573 -0.14413257 ... -2.1316254  -0.9948177
     2.0280895 ]
   [-0.7092611  -1.2756169   1.3069298  ... -1.3375051  -0.7224027
     0.29928046]
   [-0.01510194 -0.71161073  1.5207125  ... -0.13702354 -1.3387222
    -0.18538024]
   [-1.7327425  -1.5886188  -0.73192585 ... -3.0916429   0.19927414
     0.78028154]
   [-0.16875024 -1.0117074   0.9979513  ... -0.4340225  -0.733024
    -0.2911818 ]]]


 [[[ 1.1347599   2.1036801  -2.0272     ... -0.19127607  1.7430563
     1.3357136 ]
   [-1.5483637   0.7201501   0.49209565 ... -2.3318331   1.8128996
    -0.6608317 ]
   [-0.620216   -0.15625297 -0.63282764 ... -1.5936491   1.8157121
     0.9824804 ]
   [-0.6546466   1.2979944  -0.53930044 ... -1.7496531   1.9972508
     0.15571678]
   [-0.71171033  1.3712308  -0.42489314 ... -1.7918221   2.005683
     0.00913706]]

  [[-0.53237456  1.6268587   0.09424442 ...  1.435848   -0.4043125
     1.2417068 ]
   [-0.6864463   0.6177955  -0.5364646  ...  0.93755215 -0.9529681
     0.81230766]
   [ 0.24599779  0.18046924 -0.09520101 ...  0.77161354 -0.4925455
     0.3483158 ]
   [-0.56219494  1.3417138  -0.05915949 ...  1.2966926  -0.5551443
     1.0874381 ]
   [ 0.06486714 -0.11703826 -0.18025324 ...  0.13527592 -0.29875806
    -0.01885183]]

  [[-0.06064443  1.4263284  -1.07121    ... -0.2182313   1.7306343
    -1.0030811 ]
   [-1.7554904  -0.8885789   1.0699404  ... -2.127886    0.7570484
    -0.96311396]
   [-0.45297572  1.5881835  -1.1721748  ...  1.3813175   1.7668668
    -1.2861327 ]
   [-2.3422956  -1.6651024   1.3570961  ... -3.947016    0.7960014
    -1.2708142 ]
   [-0.61698854  0.8179874  -1.2118506  ... -0.25486174  1.8614951
    -1.8217473 ]]

  ...

  [[ 1.9862981   1.1664224  -0.6249749  ... -0.3042896  -1.3402573
    -1.2612207 ]
   [ 0.74774176 -0.6537042   0.08071843 ...  2.2982063  -0.74336416
    -0.50620383]
   [ 0.7814974  -0.35783598  0.084798   ...  0.5776341  -1.8409151
     0.833332  ]
   [ 0.09278512 -0.03359908  0.03453957 ...  0.08906709 -0.15084761
    -0.01301023]
   [ 1.944141    1.1334208  -0.59571403 ... -0.29799056 -1.3256941
    -1.2243003 ]]

  [[-1.5371082   0.5470138  -2.576969   ... -1.2532809  -2.3458865
     0.583465  ]
   [-1.5198677   0.04238291 -0.9684805  ... -1.4500142   1.2924944
    -0.40490046]
   [-1.5631586   0.39371908 -2.283064   ... -0.87120605 -1.3595961
     0.70568395]
   [-1.364279    1.2637516  -1.1614659  ... -0.03505528 -0.5150749
     0.8863558 ]
   [-1.3359138   0.38539374 -1.9327549  ... -1.2364383  -0.96308625
     0.18917355]]

  [[-0.20120935 -0.8065231   1.598071   ... -1.652105   -0.72402287
     0.16424721]
   [-1.8666546   2.6134768   0.81364363 ...  0.433884    0.22010958
     2.271439  ]
   [ 0.5665537  -1.3724488   1.266009   ... -0.49678338  0.2118785
    -0.49991354]
   [-0.68488795  0.34441623  1.1646795  ...  2.3321552   0.61685497
     0.65192854]
   [ 0.17062202 -0.81577325  1.1455396  ...  1.3844917   0.717541
    -0.17374787]]]


 [[[ 0.2411465  -0.9929614   0.532577   ... -0.6652973  -0.06652086
    -0.43925545]
   [ 0.5665357  -0.4536473   0.76904833 ... -0.67062646 -0.01052932
    -0.47066846]
   [ 0.9482763  -2.1883576  -0.21411324 ... -0.1656405   1.4085709
     1.3684003 ]
   [ 0.10374796 -0.81616247  0.7515382  ... -0.7643508  -0.36908257
    -0.29477924]
   [ 0.4480334  -1.6095943   0.67240757 ... -0.52272534  0.1600269
    -0.2720728 ]]

  [[-0.23564973  0.4269815   0.0291685  ...  0.20129342  0.09612404
     0.3721387 ]
   [ 0.088395   -0.15206525 -0.137473   ... -0.50051415 -0.11932456
     0.4908651 ]
   [ 0.5933268   1.0583633   0.5847201  ... -0.19186574  0.9232782
    -0.96428084]
   [ 2.6622245   0.67872626 -2.1292663  ... -0.9199471  -0.285441
    -0.09995496]
   [ 0.6317192   3.1718013   1.691111   ...  1.0547135   2.112488
    -2.323415  ]]

  [[-1.0583392  -0.09078412 -0.6988916  ...  1.1153873  -0.30812147
     0.2267806 ]
   [-0.11893999 -0.1537459  -0.31828135 ...  0.12200148  0.03150001
     0.42359117]
   [-1.3923849  -0.09256414 -0.8887349  ...  1.2081945  -0.5130012
     0.5333868 ]
   [ 0.36802304 -0.08586602  0.9884535  ...  2.0877254  -0.15875092
    -0.18532866]
   [ 0.66245735  0.42970175  1.5627303  ...  1.6996578  -1.4440383
     2.6653626 ]]

  ...

  [[-1.1990268  -1.2826025   1.1440616  ...  1.1817595   0.7905827
     0.26370382]
   [-0.79504097 -0.06885192  0.528824   ...  1.9131311  -0.16993546
     0.4030077 ]
   [-1.2660017  -2.1185024   1.6501886  ...  0.61417246  1.258937
     0.16113818]
   [-0.17228572 -0.52089286  0.460883   ...  0.3543368   0.30698773
    -0.24019495]
   [-0.79860765 -1.1238445   1.0681926  ...  1.0778719   1.4892913
    -0.0729528 ]]

  [[-0.2793137  -1.0720248   0.34033638 ... -0.60065407 -0.0481686
    -1.6729865 ]
   [ 0.4399844  -0.44148254  0.5984833  ... -0.30238423 -0.35848248
    -1.5033014 ]
   [ 1.5480384   0.35282028  0.62272465 ...  0.12471023  0.03858465
    -2.1298623 ]
   [ 2.6596537   2.4123597   1.2907314  ...  0.79796475 -0.8903305
    -2.7421076 ]
   [ 0.07169172  0.068328    0.06265852 ...  0.0155312  -0.06728822
    -0.11520293]]

  [[ 1.4781717  -0.62397516  0.5516779  ... -0.09574603 -1.7477268
    -1.4529104 ]
   [-2.5700758   0.31361234 -0.97197145 ... -0.61989987 -1.3025576
     0.8344033 ]
   [-0.4558538  -1.5048909   0.7966041  ... -1.551383    0.84535795
    -1.6910143 ]
   [ 0.80678886 -0.57668865  0.5356164  ... -0.02704809 -1.0010389
    -0.8425189 ]
   [-2.0428557  -0.59680223 -0.17007609 ... -1.1308151  -0.2332728
    -0.14071308]]]


 [[[ 0.9392371  -0.14835441  0.7436348  ... -0.10662711 -0.5697103
    -0.30778062]
   [ 0.51726943  0.07536143  0.2247606  ...  0.52510536 -0.33563197
    -0.5996598 ]
   [ 0.6608252   0.59922576  0.5920903  ...  0.23997521 -0.7105277
     0.4558764 ]
   [ 0.5948477   0.12951651  0.7155031  ...  0.13272125 -0.6373176
     0.14869832]
   [ 0.40471002 -0.02654374  0.2855991  ...  0.7405948  -0.40416145
    -0.45660836]]

  [[-1.1296895  -0.26031926 -1.3625786  ... -1.5006708  -0.8492819
     0.45897985]
   [ 0.99916494 -1.0769486  -1.2181196  ... -1.4283824  -2.7527025
     0.1406266 ]
   [-1.5352917  -0.11274344 -1.4327556  ... -1.9432768  -0.79091024
     0.7377855 ]
   [ 0.05785019 -0.75427836 -1.3190236  ... -1.5798447  -2.0669816
     0.35002673]
   [-0.08996308 -0.27952266 -0.38190028 ... -0.16164687 -0.43035546
    -0.3610468 ]]

  [[-0.28341657  0.42266297  0.25130725 ...  0.1840718   1.8885163
     1.0064446 ]
   [ 0.28983334  0.65451527  0.9604085  ...  0.41241094  0.1619906
     0.38817185]
   [-0.5837105   0.9641532   0.64551353 ... -0.7959633   0.9489082
     0.8933522 ]
   [-0.22849438 -0.20527968 -0.34760293 ...  0.9611325   2.997033
     1.1308179 ]
   [-0.00820416  0.84408873  1.2267729  ...  0.29832977  0.08072782
     0.3692263 ]]

  ...

  [[-0.4417341  -0.38511884  0.82302696 ... -1.7528574   0.44472563
    -0.01463291]
   [-0.56573     0.45573157 -0.01551834 ... -0.8255412   0.53757346
    -0.6987686 ]
   [-0.994636   -0.21737862  2.0148022  ... -2.2492619  -0.5165433
     1.1601657 ]
   [-0.49734983  0.4089237   0.6831462  ...  1.0616468   1.5936859
    -0.23798612]
   [-0.76737773 -0.00641102  1.428985   ... -0.8766205   0.40849376
     0.5406386 ]]

  [[ 0.51602966 -0.25339413 -0.6012464  ...  0.31535032 -0.36305937
     0.775434  ]
   [ 1.7242665   0.8476721  -1.3688527  ...  0.64973074 -1.3586432
     2.3749254 ]
   [-0.15233469 -0.0508361   0.06592844 ...  0.26153633 -0.08382654
     0.66321087]
   [ 2.3480315   0.3283779  -0.07845753 ...  1.5473244  -0.99383974
     2.616399  ]
   [ 0.64763963  0.4788928  -1.1704385  ...  0.3307001  -0.8464458
     1.5514867 ]]

  [[-0.31380945 -1.5585611  -1.3990065  ... -1.4937836  -0.47312617
     0.14676511]
   [-0.488111   -0.8563858  -0.52760804 ... -0.28899235  0.77647316
     0.31579882]
   [-0.32061103 -1.085851   -0.6052176  ... -0.02598566  0.9868912
     0.33973566]
   [-0.14507958 -1.4923052  -1.0864937  ... -1.1054946   0.2898276
    -0.08337229]
   [-0.21188931 -0.7220487  -1.4625635  ... -1.4666879  -0.39146262
     0.03027827]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-False-32-8-27-5-8] q.shape1: (8, 5, 27)
q.shape2: (40, 27)
q.shape3: (40, 27)
q.shape4: (8, 5, 27)
q_liner: [[[ 0.15200193  0.42109507  0.1894755  ... -1.7429329  -0.88422495
   -0.3164864 ]
  [-0.7228274   0.49029985  0.58301187 ...  2.1885214  -0.0600438
    2.0428016 ]
  [-0.5260736   0.6122724   1.230041   ... -2.247764    0.22396035
   -1.7408255 ]
  [ 0.3971978   0.6543124   0.09537844 ...  1.0527573   2.5283172
    1.3539605 ]
  [-2.2944772  -1.2713732  -0.40413117 ... -2.6895072   1.2463971
    1.2484484 ]]

 [[-1.1593062  -0.88011456 -1.8108406  ... -1.7323458   1.1656864
   -0.8288701 ]
  [ 0.9558411  -0.23498295  2.5545673  ... -3.0560327  -2.0548532
   -2.2333834 ]
  [-1.7470474  -2.3977683  -2.3310997  ...  0.24311657 -0.14915945
    0.71529585]
  [ 0.89870685  1.1873523  -0.10763843 ...  2.5449615   0.67048955
    0.58401346]
  [ 2.0645623   0.3715976   0.32978135 ...  1.3476607   0.29302907
   -0.27270532]]

 [[-0.00490406 -0.09373393  1.1604989  ... -0.68984926  1.4405506
    0.73424846]
  [-0.04013184 -0.74264437  0.7171273  ...  0.84781003 -0.8189953
    1.0422674 ]
  [ 1.3068575   1.0912939  -0.5706339  ...  0.6620283   0.5126465
    1.2609537 ]
  [-1.4994874   1.0570575  -2.6855764  ...  1.986622    1.5518485
   -0.7573723 ]
  [ 1.1151257  -2.2495382   0.6445344  ... -1.7265897  -0.9692527
    1.5563262 ]]

 ...

 [[-1.2600608   0.42844245 -1.0461015  ...  0.4404278   0.8438228
    0.35004786]
  [-0.80994964  0.90170777 -1.5636967  ...  1.9153154   0.15813263
    0.75824195]
  [-0.41504437  0.5501679  -0.46502814 ...  1.3531638   0.20270535
   -1.1872677 ]
  [-2.140977   -1.8058908  -2.543361   ... -1.3188152  -0.2109273
    3.014104  ]
  [ 0.30165464 -1.7570784  -0.5276766  ... -0.95511556  0.6305223
    2.6884043 ]]

 [[ 0.54159     2.0929532   1.2214144  ...  1.3534613  -2.23457
   -3.0139523 ]
  [-0.41575354  1.8297943   0.4623497  ... -0.0106837   0.28909513
   -1.1019404 ]
  [ 1.7901554  -2.319938    0.07372504 ...  1.7785084  -2.0408728
   -0.50145024]
  [-3.2801116   0.87907857  1.1032302  ...  1.1696819   2.6237779
   -2.4771411 ]
  [ 2.1882672   2.8574078   1.3916488  ... -0.65159124  0.67476016
   -2.5030303 ]]

 [[-0.2869474   0.19633447  1.8981183  ...  1.5710847  -1.9368707
    0.45920563]
  [ 1.1749982   0.24199866 -1.4054803  ...  0.47076377  0.1422315
    2.097656  ]
  [ 1.5478255   2.0425947   0.8884625  ... -1.2721355  -1.8794547
   -1.3773708 ]
  [-0.51357377  1.8262048   0.93602985 ... -1.289328    1.1409357
   -3.3090458 ]
  [-0.5917449   1.1871253   0.05737568 ...  2.3166168   0.7226818
    1.4457972 ]]]
q.shape5: (8, 5, 256)
q.shape6: (8, 8, 5, 32)
attn_res: [[[[-1.22433209e+00 -3.06415141e-01  1.11285913e+00 ... -1.16010404e+00
    -1.63813496e+00 -1.13535297e+00]
   [-1.56841493e+00 -9.91562068e-01  1.75053835e+00 ... -8.79235029e-01
    -2.52705503e+00 -4.44800019e-01]
   [-3.15899521e-01  2.58675313e+00 -6.59491539e-01 ... -2.15856719e+00
    -1.35062456e+00 -1.51299620e+00]
   [-9.85436440e-01  7.59444296e-01  6.30120873e-01 ... -7.27043971e-02
     6.29566133e-01  1.41214275e+00]
   [-1.51927316e+00 -9.22151327e-01  1.73579907e+00 ... -7.86341071e-01
    -2.56200767e+00 -1.83339536e-01]]

  [[-6.64978325e-01  2.49735594e-01 -2.63983428e-01 ...  5.32918870e-01
     2.66914442e-03  3.88631731e-01]
   [ 8.17986786e-01 -3.97963226e-01  1.20238578e+00 ...  3.33996534e-01
    -1.21902120e+00  1.71402705e+00]
   [-2.24787474e+00  5.08433998e-01  1.06021166e-02 ...  7.73179293e-01
     7.81271398e-01 -1.59239542e+00]
   [-7.25986511e-02 -2.65711881e-02 -5.10530993e-02 ...  3.95599455e-02
    -4.79554795e-02  1.11662105e-01]
   [-4.83743429e-01 -1.88921642e+00  2.34787488e+00 ...  1.00146413e-01
     7.23218322e-01 -8.22387099e-01]]

  [[ 8.46918344e-01 -1.22766566e+00  6.75657988e-02 ... -1.51472604e+00
     1.40327764e+00  3.90670061e-01]
   [ 8.09217036e-01  3.25689226e-01 -7.86749840e-01 ...  3.19224328e-01
    -9.64740217e-01  3.60917974e+00]
   [ 1.94229400e+00 -2.27652478e+00  4.65173036e-01 ... -2.40537739e+00
     2.39249539e+00  7.61375502e-02]
   [ 8.55584681e-01  1.34158278e+00 -7.73635209e-01 ...  1.31824458e+00
    -9.14087370e-02  8.06548059e-01]
   [ 1.85538530e+00 -1.15247023e+00 -8.48981589e-02 ... -1.11463141e+00
     9.58380818e-01  1.81480324e+00]]

  ...

  [[ 2.04817504e-01  7.50301480e-01 -1.14418232e+00 ...  4.69754785e-02
    -6.64919853e-01  6.21364951e-01]
   [ 2.63254523e-01  1.44028473e+00  7.47441471e-01 ...  5.01877129e-01
    -8.11534226e-01 -1.35917410e-01]
   [ 4.27275509e-01  6.86981380e-01 -4.57868963e-01 ... -2.10747749e-01
    -4.37963217e-01  1.12365627e+00]
   [ 3.85043502e-01  2.13216871e-01 -1.56075215e+00 ... -4.23947036e-01
     2.72904903e-01  1.31822479e+00]
   [ 8.90627682e-01  1.10978281e+00  2.63335139e-01 ...  1.23735256e-01
    -8.96514297e-01  6.44213319e-01]]

  [[ 6.96781635e-01 -2.40329534e-01 -5.27078211e-01 ... -9.00207683e-02
    -1.07323158e+00  8.25894833e-01]
   [-3.60734701e-01 -6.64042056e-01 -9.51043189e-01 ...  1.05360992e-01
    -6.99249506e-01  4.99894440e-01]
   [ 1.95111060e+00 -6.41531765e-01  6.22692704e-03 ... -7.07278371e-01
    -2.98281491e-01  1.51322687e+00]
   [-8.20931792e-01 -8.81077588e-01 -1.09388793e+00 ...  7.02114642e-01
     1.45188105e+00 -9.97869432e-01]
   [ 9.05522346e-01 -4.19143707e-01 -5.88508606e-01 ... -4.08015043e-01
    -1.37996089e+00  1.36521518e+00]]

  [[ 2.01964092e+00 -3.09442937e-01 -3.61090243e-01 ...  1.97740984e+00
    -2.84776926e-01  6.27335668e-01]
   [ 8.11072886e-01 -2.55719161e+00  3.38433161e-02 ...  1.79955125e+00
     3.29726607e-01 -1.89306331e+00]
   [ 1.32572496e+00 -2.23774791e+00 -1.12912023e+00 ...  2.63612986e+00
    -9.03625637e-02 -2.18180943e+00]
   [ 1.71520209e+00 -1.03641593e+00 -4.09012914e-01 ...  2.11174655e+00
    -1.86381608e-01 -4.76334482e-01]
   [ 1.41269803e+00 -2.13634777e+00 -1.56220889e+00 ...  2.89517426e+00
    -2.65740365e-01 -2.41635561e+00]]]


 [[[-9.76823270e-03  2.62329310e-01 -7.42339268e-02 ...  7.95877099e-01
     6.36960149e-01  3.38781059e-01]
   [-7.04822659e-01  1.91042817e+00  4.30178165e-01 ... -2.29877666e-01
     9.24095869e-01  1.92261195e+00]
   [-2.47735009e-02  5.49713194e-01  5.11896372e-01 ...  6.19875073e-01
     1.18036807e+00  1.31552875e+00]
   [-2.98020002e-02 -2.49603465e-02 -6.18569087e-04 ... -1.35123089e-01
     1.40414506e-01 -4.86308560e-02]
   [-5.50263375e-02  2.72363782e-01  5.47402918e-01 ...  1.12755448e-01
     5.87405503e-01  3.55976880e-01]]

  [[-1.08057812e-01 -1.10543823e+00  3.69580947e-02 ... -6.77279830e-01
     1.98347247e+00 -1.10926354e+00]
   [-2.02036291e-01 -1.24846077e+00  4.41431046e-01 ... -6.29351318e-01
     9.47343588e-01  4.42637503e-01]
   [-8.18184577e-04 -2.74949610e-01 -2.62544658e-02 ... -4.80300456e-01
     5.78404963e-01  8.47264659e-04]
   [-1.60554275e-02 -2.54796863e-01  1.12619877e-01 ... -1.60623506e-01
     3.82936060e-01 -2.92044193e-01]
   [ 1.90701842e-01 -1.01905978e+00 -9.67948377e-01 ...  2.29230076e-01
     1.99627018e+00 -1.18162923e-01]]

  [[-4.47802037e-01 -1.28283963e-01  1.51181996e+00 ... -7.46951520e-01
    -2.10672855e-01  6.28705561e-01]
   [-8.62054408e-01 -3.17173183e-01  3.27746654e+00 ... -1.49276233e+00
    -5.89384735e-01  1.33820152e+00]
   [-2.12571532e-01 -1.28443980e+00  1.10491621e+00 ... -1.12119615e+00
    -1.11078095e+00  1.38718024e-01]
   [-1.75154948e+00  2.72272849e+00 -3.40619445e-01 ... -1.42418563e+00
    -1.03130460e+00  2.24272513e+00]
   [-1.13445342e+00  1.15297294e+00  1.47226393e-01 ... -1.28299499e+00
    -1.11397648e+00  1.40048325e+00]]

  ...

  [[-3.00009996e-02 -4.14048135e-01  1.28318715e+00 ... -2.15203285e+00
     5.39437950e-01  3.56178999e-01]
   [ 1.73635900e+00  6.50147140e-01  8.53060603e-01 ...  1.07369506e+00
     3.66151094e-01  8.48611146e-02]
   [-2.97267228e-01  5.14731824e-01  7.55734026e-01 ... -7.95361996e-01
     4.81575698e-01  6.16653562e-02]
   [ 7.74851218e-02 -3.83566141e-01  1.30327177e+00 ... -2.74617004e+00
     8.18376958e-01  1.25169948e-01]
   [-2.63329089e-01  4.03477550e-01 -5.10378927e-02 ... -7.90628195e-01
     1.18057799e+00  4.98212904e-01]]

  [[-7.46015757e-02  1.49184299e+00 -5.39414644e-01 ... -1.34765148e-01
     5.98796964e-01  6.17144227e-01]
   [-4.12484944e-01  1.69943643e+00  1.67879224e-01 ...  1.68234378e-01
     9.18565869e-01 -1.36124060e-01]
   [ 3.66198063e-01  1.60284686e+00  4.59683806e-01 ... -4.59752083e-02
     7.51252294e-01  2.15325117e-01]
   [-1.35304993e-02 -2.16778919e-01 -6.67349845e-02 ...  8.75580132e-01
     1.37141562e+00  7.64506757e-01]
   [-6.35092616e-01  1.32872605e+00 -3.59897390e-02 ...  6.14219248e-01
     9.03942704e-01 -2.40375251e-01]]

  [[-1.42696428e+00  5.39948344e-02  3.20220172e-01 ... -7.62107491e-01
     4.24611568e-02  7.80946612e-01]
   [ 9.11483049e-01  1.52087927e-01 -5.14522374e-01 ...  1.03347592e-01
    -3.81001204e-01 -2.15157032e+00]
   [-1.80033648e+00  1.95501745e+00  5.20296037e-01 ... -1.11787245e-02
    -1.50030303e+00  3.28408390e-01]
   [-1.73924470e+00  1.35313499e+00  1.09847367e+00 ... -1.43094122e+00
    -2.82405376e-01  1.74396515e+00]
   [-2.11106449e-01  9.72933054e-01  2.30577797e-01 ... -7.51821637e-01
    -4.36588287e-01 -9.91975605e-01]]]


 [[[-8.21048498e-01  5.48232973e-01 -6.95828319e-01 ... -1.35176682e+00
     1.00670779e+00 -1.31350946e+00]
   [-7.81261265e-01  5.30178726e-01 -5.92998147e-01 ... -1.11509800e+00
     8.73599112e-01 -1.12757277e+00]
   [ 7.12006092e-02  4.53170419e-01  4.89607066e-01 ... -7.16482401e-02
     2.49242485e-01  1.01977348e+00]
   [-7.98809588e-01  6.18185103e-01 -5.87977886e-01 ... -1.35834134e+00
     1.05280435e+00 -1.41852129e+00]
   [-6.78007782e-01  2.00772658e-01 -3.48231733e-01 ...  4.65626597e-01
    -1.41909689e-01  4.92866635e-01]]

  [[ 1.24380493e+00  6.86752319e-01  7.54218102e-01 ...  1.11682415e-01
     7.52305567e-01  3.13183844e-01]
   [ 8.08735415e-02  1.46237209e-01  9.89529267e-02 ...  6.60787374e-02
    -3.17020155e-02  2.76948661e-01]
   [ 7.21234262e-01  2.76156664e+00  6.58763051e-01 ...  1.49143064e+00
     6.16187274e-01 -6.37054622e-01]
   [ 9.16396439e-01 -1.57947302e-01  1.48863152e-01 ...  1.84137076e-01
     1.08741629e+00  6.04209185e-01]
   [ 1.03609276e+00  1.46909416e-01  4.90032554e-01 ...  9.44002569e-02
     5.08877218e-01  1.01282626e-01]]

  [[ 1.47796905e+00  4.83767241e-01  3.64321977e-01 ...  1.24100983e+00
    -1.23710573e-01  8.96858156e-01]
   [ 5.25688112e-01 -2.17811346e+00 -1.80597305e+00 ... -1.21875632e+00
     1.74700022e+00 -9.36484158e-01]
   [-4.08389509e-01 -2.02873015e+00 -3.75934780e-01 ...  4.38934237e-01
     8.42589498e-01 -1.31344333e-01]
   [ 7.51629472e-01 -3.67083967e-01 -1.99438989e-01 ...  1.02018058e+00
     2.40190148e-01  4.48900461e-01]
   [-3.90146106e-01 -1.90815759e+00  5.54318875e-02 ...  6.49592996e-01
     6.02563083e-01  1.05887443e-01]]

  ...

  [[-5.60686767e-01 -9.85786796e-01 -9.43172693e-01 ... -2.03397274e-01
    -1.12864271e-01 -8.84362519e-01]
   [-4.88414079e-01 -3.02275926e-01 -2.88546920e-01 ... -4.84938920e-02
    -1.41402692e-01 -2.01711923e-01]
   [-1.65635657e+00 -1.72040153e+00 -4.76162940e-01 ...  4.47236657e-01
    -4.29948896e-01  2.39123315e-01]
   [-5.03059268e-01 -4.66460824e-01 -6.35511160e-01 ... -3.46573710e-01
    -8.91064778e-02 -5.99942088e-01]
   [-3.78970146e-01 -8.74397814e-01 -1.05379856e+00 ... -2.24606991e-01
    -2.56512836e-02 -1.01407218e+00]]

  [[-1.23240101e+00 -1.24601150e+00  1.89166880e+00 ...  1.59331357e+00
    -3.23892522e+00  1.38978708e+00]
   [-6.93697572e-01  1.16415274e+00 -1.31817794e+00 ... -7.00697154e-02
    -8.10754180e-01  1.24114990e+00]
   [-7.61962354e-01 -8.88492107e-01  1.12732780e+00 ...  8.37293863e-01
    -2.66082430e+00  1.05194974e+00]
   [-1.27713263e+00 -1.06117463e+00  1.67215943e+00 ...  1.54971743e+00
    -3.05322289e+00  1.39103293e+00]
   [-1.59794271e+00  8.65600765e-01 -1.85225880e+00 ...  4.02066767e-01
    -8.28197002e-01  1.45621789e+00]]

  [[-1.47475052e+00  9.65763927e-01  1.22397292e+00 ... -1.04929543e+00
     6.40537202e-01  5.16174316e-01]
   [-9.82325375e-01  4.61888701e-01  1.27024782e+00 ... -5.72686136e-01
     2.49918759e-01  4.94490594e-01]
   [-2.18773946e-01 -5.66122718e-02 -1.87195897e-01 ...  4.29058969e-01
     4.77506518e-01 -1.71340466e-01]
   [-7.71077812e-01  8.89526546e-01 -4.39153641e-01 ... -7.99170494e-01
     8.16737413e-01  1.14619449e-01]
   [-2.37217331e+00  1.97651720e+00  3.08051705e+00 ... -2.64595485e+00
    -1.10145837e-01  7.93674767e-01]]]


 ...


 [[[ 1.85956264e+00 -4.58713025e-01 -1.06535661e+00 ...  3.94469827e-01
     1.05268490e+00 -5.01171172e-01]
   [ 3.91542166e-01  5.68970561e-01 -4.13029373e-01 ... -3.16842556e-01
     4.64253545e-01  6.59792662e-01]
   [ 5.30737042e-01  2.06105137e+00 -3.23544860e-01 ... -9.77906048e-01
     1.95766437e+00  7.33709037e-01]
   [ 1.64852130e+00 -3.22529525e-02 -9.89522576e-01 ...  1.63906097e-01
     1.16771579e+00 -2.49964923e-01]
   [ 6.77521229e-01 -1.55961365e-01 -9.86958146e-01 ... -2.54126668e-01
    -7.06388175e-01  9.46394920e-01]]

  [[-4.87025499e-01 -4.63997602e-01 -6.98856711e-01 ...  1.47158635e+00
    -1.24603069e+00 -3.93498242e-02]
   [-4.52328175e-01 -2.56443210e-02 -7.98627257e-01 ... -2.76591033e-01
     3.47487569e-01 -4.12472546e-01]
   [-1.14195287e+00 -4.85432968e-02 -2.26520920e+00 ... -5.66660166e-01
     4.11385059e-01  3.35863233e-03]
   [-1.34053540e+00 -3.64241421e-01 -1.13421047e+00 ...  3.75708491e-01
    -2.77477175e-01 -9.42525506e-01]
   [-2.80018115e+00 -4.71778780e-01 -2.39926791e+00 ... -3.57245326e-01
     3.01699072e-01 -1.46618152e+00]]

  [[-4.25068259e-01 -1.43345952e+00  1.47302496e+00 ... -5.63528538e-02
     1.45544612e+00  1.44878364e+00]
   [ 1.98334292e-01  1.02951370e-01  1.37955010e+00 ...  3.04619014e-01
     9.68057290e-02  1.29915380e+00]
   [-1.04379170e-01 -5.79705000e-01  1.65793014e+00 ...  1.25229478e-01
     9.13870215e-01  1.65413833e+00]
   [-2.11878479e-01 -9.70403492e-01  1.43555498e+00 ...  8.74101371e-02
     7.45791614e-01  1.45128322e+00]
   [-6.68484986e-01  9.69550610e-02  1.29666662e+00 ... -2.34739017e+00
    -1.82573318e-01 -5.11338897e-02]]

  ...

  [[ 1.10829592e+00  1.98848224e+00 -8.89505148e-02 ... -9.13720012e-01
    -1.59567845e+00  4.87143934e-01]
   [-2.89956182e-01  6.53148353e-01 -2.42907047e-01 ... -7.04816222e-01
    -6.13986492e-01  2.07273930e-01]
   [ 1.55498004e+00  2.03353429e+00 -9.95997787e-02 ... -7.91067481e-01
    -1.53405869e+00  4.63711500e-01]
   [-1.21470809e+00  1.15637255e+00 -6.23898149e-01 ... -8.48686576e-01
    -2.35334849e+00  6.30035460e-01]
   [-1.70389736e+00  3.25167775e-01 -8.97205949e-01 ... -5.32570660e-01
    -1.89658213e+00  5.90738416e-01]]

  [[-6.50370359e-01  9.23267126e-01  7.03212202e-01 ... -3.18513215e-01
    -3.65520310e+00  1.40060246e+00]
   [ 2.13188395e-01 -2.85328436e+00  1.07474089e+00 ...  1.30939567e+00
    -9.04365540e-01  1.32303929e+00]
   [ 1.00858696e-01 -1.96349919e+00  1.04569447e+00 ...  9.29884434e-01
    -9.28482652e-01  1.21635914e+00]
   [ 2.91909367e-01 -1.02075672e+00  8.74071836e-01 ...  4.05344725e-01
    -1.84512347e-01  9.14825022e-01]
   [ 1.28324020e+00  1.20102739e+00 -6.55369639e-01 ... -1.24757588e+00
    -3.20725679e-01  2.41783798e-01]]

  [[ 1.20268893e+00 -9.24481213e-01 -3.55133104e+00 ...  9.49430943e-01
    -4.13235694e-01 -5.38837552e-01]
   [-3.39503497e-01 -1.45633721e+00 -6.17250144e-01 ...  1.68791556e+00
     2.33527094e-01 -1.67606378e+00]
   [-1.53841048e-01 -1.93517637e+00 -1.93604052e-01 ...  1.16711164e+00
    -1.34066296e+00  5.57705820e-01]
   [ 5.01302004e-01 -2.69711947e+00 -1.20299721e+00 ... -1.12195778e+00
    -8.18890691e-01 -9.50158417e-01]
   [ 2.79625237e-01 -4.70949233e-01 -1.18477643e+00 ...  5.70670605e-01
    -3.40700001e-02 -4.24959600e-01]]]


 [[[ 1.70081568e+00 -7.99403429e-01 -1.08830377e-01 ... -4.01027352e-01
     2.55287957e+00 -5.23045421e-01]
   [ 1.65317178e+00 -7.02303469e-01 -3.71508002e-02 ... -3.92184317e-01
     2.61564207e+00 -7.09911942e-01]
   [-8.40816915e-01  2.22997522e+00  5.05851090e-01 ...  2.71883190e-01
     2.59488797e+00 -8.73775184e-02]
   [-3.45914096e-01  8.40342343e-01  1.91143632e-01 ...  1.13777347e-01
     9.20580268e-01 -3.77862044e-02]
   [ 1.54935753e+00 -9.17498946e-01  8.63834992e-02 ... -3.01427722e-01
     2.13378048e+00 -1.45208740e+00]]

  [[ 3.47871602e-01  1.62674451e+00 -1.65491295e+00 ...  1.59072489e-01
     3.16316247e-01 -4.41888273e-02]
   [-1.99265070e-02  3.32385719e-01 -3.77844453e-01 ...  3.44968773e-02
     2.00263277e-01 -6.12022839e-02]
   [ 1.74358058e+00 -7.22942114e-01 -5.03674746e-02 ... -3.59365642e-01
    -5.96262515e-02 -5.24629116e-01]
   [ 1.98131919e+00 -1.50006521e+00  7.50636995e-01 ... -4.47873563e-01
    -5.32061934e-01 -4.02349085e-01]
   [-2.64424276e+00 -3.10030007e+00  1.86250186e+00 ...  3.69168162e-01
     1.19681096e+00  3.10399175e-01]]

  [[-7.03447223e-01  4.85316753e-01 -1.63466954e+00 ... -1.34615600e-01
     1.31756294e+00  1.15195677e-01]
   [-2.09393829e-01  5.57688355e-01 -3.66378948e-02 ... -8.23894620e-01
    -1.40672363e-02  3.21552992e-01]
   [-1.38808817e-01  1.67791200e+00 -6.70578957e-01 ...  4.41515088e-01
    -1.13974124e-01  1.37287426e+00]
   [-4.12263954e-03  9.66778100e-01 -2.63300121e-01 ... -1.44665492e+00
    -9.96831134e-02  6.44637108e-01]
   [ 1.73754960e-01  1.97224009e+00 -5.50037026e-01 ...  8.60859752e-01
    -6.34516895e-01  1.85537243e+00]]

  ...

  [[-2.87171692e-01  3.58641386e-01  8.05102110e-01 ...  5.18913209e-01
     2.30535293e+00 -1.75275505e+00]
   [-7.05322921e-01 -8.44889939e-01  5.04604757e-01 ... -1.18654108e+00
    -1.67923319e+00  2.12147665e+00]
   [-3.37462127e-01 -4.81761694e-01  4.25935000e-01 ... -7.78534532e-01
    -1.29680800e+00  1.50878036e+00]
   [-3.71844530e-01 -5.66082895e-01  4.17493254e-01 ... -1.04399204e+00
    -1.42416644e+00  1.78377569e+00]
   [-1.64514735e-01  5.03774524e-01  7.76873052e-01 ...  6.31641328e-01
     2.59842205e+00 -2.05125713e+00]]

  [[ 8.41234922e-01 -5.29671311e-01 -6.68534517e-01 ... -2.62896180e-01
    -1.44148421e+00  1.77871025e+00]
   [ 5.35716534e-01 -1.82208717e-01  1.05512202e+00 ...  1.74679577e+00
    -8.40537786e-01  1.03212094e+00]
   [ 5.05348802e-01 -1.90940350e-01  5.61517596e-01 ...  1.34597850e+00
    -7.98954725e-01  9.81463611e-01]
   [ 3.68238658e-01 -2.47420996e-01  1.72997743e-01 ...  6.95202410e-01
    -6.88667178e-01  9.17913795e-01]
   [ 9.12578225e-01 -3.12384903e-01  2.64984071e-01 ...  7.53181696e-01
    -1.30547047e+00  1.67893457e+00]]

  [[-7.18634188e-01 -2.95071423e-01  1.50517273e+00 ... -1.22196615e+00
     2.10434723e+00  5.58663964e-01]
   [-8.21144760e-01 -6.26902938e-01  2.06715226e+00 ... -1.99200904e+00
     2.58499241e+00  1.51175368e+00]
   [-6.19363427e-01  4.08367962e-01  1.18472409e+00 ... -1.53637135e+00
     1.02046001e+00  1.43875134e+00]
   [-8.10820103e-01 -3.23678017e-01  1.76125026e+00 ... -1.28120732e+00
     2.29911089e+00  5.17794430e-01]
   [-6.03848279e-01  6.05419040e-01  8.55436087e-01 ... -4.58809525e-01
     8.83878112e-01 -1.13144875e-01]]]


 [[[-1.28793514e+00  1.44450021e+00 -1.49882889e+00 ... -5.44707894e-01
    -1.27030945e+00 -9.12520051e-01]
   [-8.29266012e-01  1.04920423e+00 -1.25986743e+00 ... -4.09812421e-01
    -8.42477798e-01 -9.22773182e-01]
   [ 5.50602853e-01  6.15548432e-01 -1.19171238e+00 ...  4.01969254e-01
     6.06835246e-01  2.23868117e-01]
   [ 1.12438893e+00  7.74243951e-01 -1.39919746e+00 ...  7.91829765e-01
     1.29625893e+00  6.95868790e-01]
   [ 3.72325182e-01  6.66710436e-01 -1.43515968e+00 ...  9.85215127e-01
    -6.56033456e-01  3.79763991e-01]]

  [[-3.55818085e-02 -5.11913151e-02 -1.54235590e+00 ... -1.17897511e+00
     6.60786033e-02  1.63696933e+00]
   [ 2.96882391e-02  7.56841421e-01  3.29126179e-01 ... -1.29994333e+00
     1.17563999e+00 -7.63660312e-01]
   [ 1.47983444e+00  2.65125155e-01 -1.50207734e+00 ... -2.28019929e+00
    -1.08971989e+00  7.40599155e-01]
   [-6.32324040e-01  8.36035609e-01 -6.02161586e-01 ... -7.59856462e-01
     5.85448802e-01 -2.38133240e+00]
   [-2.22056508e-02  1.28594726e-01 -1.04774106e+00 ... -8.93809021e-01
     1.17241353e-01  9.54924464e-01]]

  [[-5.54600060e-01  6.83995545e-01  1.03655148e+00 ... -4.35710102e-02
     3.56906801e-02  4.82188538e-02]
   [ 2.65345275e-01  5.74784726e-02  4.58212614e-01 ...  1.44488052e-01
    -7.58129239e-01 -9.71913278e-01]
   [ 1.60174000e+00  2.99847066e-01  1.29859328e+00 ...  6.69636488e-01
     8.50925073e-02 -7.59188712e-01]
   [ 5.85059583e-01  6.58836663e-02  9.12581027e-01 ... -1.36658132e-01
    -1.03139699e+00 -1.26137090e+00]
   [-5.30040443e-01  1.62354827e+00  2.73301005e+00 ... -2.72288889e-01
     8.95288587e-01  4.34903145e-01]]

  ...

  [[ 1.06409466e+00  1.18671703e+00  6.03164315e-01 ...  2.16041660e+00
     1.53331852e+00 -9.26802576e-01]
   [ 9.49745476e-02  2.41320878e-01  4.00803596e-01 ...  6.72961950e-01
     4.45305407e-01 -6.31753877e-02]
   [ 4.80049670e-01  3.44387889e-01  6.39440060e-01 ...  1.45397794e+00
     7.87242293e-01 -4.30901647e-01]
   [-2.23055463e-02 -7.52694085e-02  1.74297452e-01 ...  1.74295306e-01
     5.17769217e-01 -2.54078388e-01]
   [ 1.09297156e+00  1.27662981e+00  6.57468498e-01 ...  2.27831101e+00
     1.53293025e+00 -8.62664163e-01]]

  [[ 8.70462656e-01 -5.41207492e-01 -1.78972989e-01 ... -1.09654203e-01
     1.56012464e+00 -1.00522435e+00]
   [-1.34982955e+00 -1.21679842e+00 -8.28653872e-01 ...  2.63957930e+00
    -1.26946044e+00  1.49878681e+00]
   [-9.71811831e-01 -8.00606668e-01 -6.39141858e-01 ...  2.20230389e+00
    -5.16644001e-01  8.00518513e-01]
   [ 6.11217283e-02 -1.54062212e-01 -4.18083280e-01 ...  6.22993588e-01
     2.74978280e-01 -4.30332124e-01]
   [ 8.54663730e-01  3.35934192e-01 -6.75937533e-02 ...  4.86053467e-01
     2.03074646e+00 -4.65035886e-01]]

  [[ 1.13653564e+00 -7.03826398e-02  2.89711565e-01 ... -3.52470994e-01
    -1.37787497e+00 -1.27432013e+00]
   [ 1.30120218e+00 -3.80137980e-01  3.47703159e-01 ...  1.07996613e-01
    -1.18446314e+00 -1.48495829e+00]
   [ 7.89030671e-01 -1.31247556e+00  1.40693128e-01 ...  8.18085313e-01
    -5.75227737e-02 -3.72978270e-01]
   [-7.86808610e-01 -1.24217672e-02  4.10275646e-02 ...  1.18299732e-02
     1.32718992e+00  1.23596434e-02]
   [-2.24897519e-01  1.69237852e-01  7.06076384e-01 ... -9.20990348e-01
    -2.07336560e-01  8.93001139e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-False-32-8-27-11-4] q.shape1: (4, 11, 27)
q.shape2: (44, 27)
q.shape3: (44, 27)
q.shape4: (4, 11, 27)
q_liner: [[[-0.08246311  1.2976369  -4.386915   ...  1.6648992   1.0225513
   -0.23413594]
  [-2.1036825   0.34269288 -1.3593392  ...  0.28710133 -2.3495028
   -0.5770221 ]
  [ 0.55015564  1.3115653  -2.7073863  ... -1.2594198   0.450877
   -0.5750791 ]
  ...
  [ 1.9723426   1.9014059  -0.07350484 ... -0.6233986  -1.8269871
   -3.14204   ]
  [ 0.5897575   0.5651129  -1.4288164  ...  1.6924045  -1.9481409
    1.4147217 ]
  [ 1.4633553  -0.39679056 -0.7927203  ...  0.4363156  -1.650817
    0.20362736]]

 [[-0.9566642   0.6318296  -0.99751896 ... -1.8659797  -0.01259731
    1.0842644 ]
  [-0.15104908  1.3874646   0.19238688 ... -2.0061364  -0.9589741
    0.54090524]
  [-0.31797698 -0.8425765   3.2394023  ...  0.84538174 -0.51091385
   -0.27457827]
  ...
  [ 0.33640513  1.8460543   2.5176854  ...  1.0853881   2.9914553
    2.6077735 ]
  [ 1.546665    0.5879998   0.41907552 ...  0.75106627  1.0203562
   -0.15183803]
  [-1.0632492   2.5393524   0.9687923  ... -1.3010052  -0.02241022
    1.0278877 ]]

 [[ 0.24715352  1.9982486  -1.0008467  ... -0.99167144  2.288722
   -0.38216916]
  [-1.7900983   1.6657426   0.72222143 ...  1.0981413  -0.52470183
   -1.220509  ]
  [-1.0200733  -0.02188973  0.9696115  ... -3.8275013   1.2366807
   -2.000785  ]
  ...
  [-1.0458595  -1.4305166  -1.8524687  ...  1.3384255  -2.3837926
   -1.3595229 ]
  [ 0.65088063 -0.07472718  0.7910718  ...  1.1668599   0.17494643
   -2.2131062 ]
  [-0.5484388  -0.3512259  -0.9518742  ... -0.37090048 -2.5363982
   -0.35450423]]

 [[-1.659759   -2.0460486   1.7956158  ...  0.7144731  -2.8808205
   -2.3229935 ]
  [-0.6778062  -1.0200877   2.5991158  ... -0.39864084 -0.1548618
   -1.7684385 ]
  [-0.9458304   1.8510628  -0.13740486 ... -1.860934    1.164453
    0.04018883]
  ...
  [ 0.38199356 -1.6202837  -1.9532994  ...  2.8872821  -0.4262538
   -0.07649663]
  [-1.2970152  -0.8319859  -1.2084574  ... -0.85649323  1.5001354
    1.9378235 ]
  [ 0.15252627  1.7864983  -2.6395547  ...  0.10763691  0.13296238
   -1.6784537 ]]]
q.shape5: (4, 11, 256)
q.shape6: (4, 8, 11, 32)
attn_res: [[[[-5.47236621e-01 -4.79893953e-01  6.26384199e-01 ...  7.49843419e-01
    -3.17945600e-01  2.85166532e-01]
   [-6.59596860e-01 -1.17995426e-01 -2.86564641e-02 ...  3.36281806e-01
    -4.97702837e-01  7.52104044e-01]
   [ 1.56676978e-01  5.24536818e-02  1.00172293e+00 ...  4.27967533e-02
     1.47631124e-01  1.00959085e-01]
   ...
   [-3.53001431e-02 -6.62635490e-02  2.93594718e-01 ...  1.31657332e-01
    -3.06700885e-01 -7.72359893e-02]
   [-5.29462248e-02 -1.66521922e-01  9.70615372e-02 ... -1.42433405e-01
     1.74791917e-01 -4.48174059e-01]
   [-6.01000428e-01 -2.99580574e-01  5.22308290e-01 ...  5.43383598e-01
    -7.28339076e-01  1.33979633e-01]]

  [[-1.86862469e-01  1.05888411e-01  7.35663056e-01 ...  5.13984323e-01
    -2.98209965e-01  1.03263736e-01]
   [-3.34254414e-01  2.45601535e-02  6.24697089e-01 ...  5.83428681e-01
    -7.07554042e-01  7.16278434e-01]
   [ 2.35238290e+00 -8.26660320e-02 -1.54567933e+00 ... -1.50280797e+00
     1.11141491e+00 -1.58879709e+00]
   ...
   [ 5.02128191e-02 -1.47237312e-02  2.13916656e-02 ... -6.91999346e-02
    -9.57406908e-02  7.40377158e-02]
   [-4.67798173e-01 -4.70691413e-01 -1.32948861e-01 ...  9.36838388e-01
    -5.90618253e-01  5.54854810e-01]
   [-7.47082382e-02 -5.62124401e-02 -6.20749593e-03 ...  2.16394603e-01
    -1.70110703e-01  1.79719239e-01]]

  [[-1.13365090e+00  3.83376122e-01  2.42719263e-01 ...  1.31032002e+00
     1.54708421e+00  8.46052289e-01]
   [-9.86032069e-01  3.17973763e-01  4.27077338e-02 ... -4.59470391e-01
    -6.21830165e-01  1.66980755e+00]
   [ 1.09586217e-01 -1.70382988e+00  2.18302533e-01 ... -5.20392179e-01
     9.70952392e-01 -7.73079455e-01]
   ...
   [-8.30866396e-01 -9.77393866e-01 -5.45822918e-01 ... -7.56012917e-01
     5.70402920e-01  8.57986271e-01]
   [-5.82329810e-01  1.64467677e-01 -3.62125456e-01 ... -9.48851556e-02
     5.07344723e-01  4.93083239e-01]
   [-8.63395855e-02  1.46366954e-01 -1.31467183e-03 ... -2.42660075e-01
    -1.02854788e-01  1.31896809e-01]]

  ...

  [[ 4.39087152e-01  9.17173982e-01 -7.78760672e-01 ... -2.19408825e-01
    -5.85174203e-01  4.33089167e-01]
   [ 1.57523483e-01  2.49810129e-01 -1.09234977e+00 ... -1.32275736e+00
     5.42123437e-01  6.27615869e-01]
   [ 4.82116818e-01  4.86921340e-01 -5.88740036e-03 ... -1.02269673e+00
    -7.81221449e-01 -5.51387250e-01]
   ...
   [ 2.37805605e-01  8.79047930e-01  7.00455382e-02 ... -1.05122721e+00
     1.66921586e-01  6.80144310e-01]
   [-1.46823451e-01  2.25078893e+00 -6.28001630e-01 ... -5.50478250e-02
    -3.68667573e-01  2.10896945e+00]
   [-4.32446867e-01  1.40580773e+00 -2.86126882e-01 ...  7.25828633e-02
     9.12398323e-02  1.24166572e+00]]

  [[-2.35744655e-01  1.56851336e-02  2.90883064e-01 ...  9.43470359e-01
    -7.74211228e-01  1.70282245e+00]
   [-3.08159828e-01  7.62255639e-02  2.64820039e-01 ...  4.34053302e-01
     4.08422574e-03  1.47383213e-01]
   [ 9.57912132e-02 -2.26509523e+00  1.43627092e-01 ...  1.88380629e-01
    -2.51700193e-01 -1.01498032e+00]
   ...
   [ 1.80871189e-01 -9.22925994e-02  9.54206645e-01 ...  3.33865196e-01
    -1.02377629e+00  7.43829310e-01]
   [ 1.30069822e-01 -1.75523624e-01  2.63015985e-01 ...  8.19275752e-02
    -2.16067046e-01  2.43481576e-01]
   [-7.28076994e-02  4.87585306e-01 -5.72089195e-01 ... -2.37841353e-01
     2.52050996e-01  5.79727530e-01]]

  [[ 2.40206107e-01  1.74920067e-01  3.63527566e-01 ...  2.75511980e-01
    -3.67828786e-01  2.66888201e-01]
   [-2.57069945e-01 -2.05376178e-01  7.03640163e-01 ...  2.41913289e-01
    -6.84481412e-02 -7.00290143e-01]
   [ 3.63001347e-01 -4.55397844e-01 -4.20434922e-02 ...  6.95642591e-01
     7.49061227e-01 -1.05164850e+00]
   ...
   [ 1.62748128e-01 -4.18089926e-02  1.04893732e+00 ...  2.23706797e-01
    -2.12542772e-01 -2.03562841e-01]
   [-8.50941181e-01 -3.65348935e-01 -7.42024064e-01 ...  1.31775093e+00
     7.28356063e-01 -9.18033600e-01]
   [ 8.16326439e-01  4.31555867e-01  7.85755813e-02 ...  1.01679814e+00
    -2.46589676e-01 -4.32144165e-01]]]


 [[[-8.98087800e-01 -1.28274739e+00  1.59536815e+00 ...  7.97032952e-01
     6.71077669e-01 -1.21339485e-01]
   [ 7.63804555e-01  1.67966580e+00 -6.93352669e-02 ...  6.80711806e-01
     6.20130301e-02  9.52847973e-02]
   [ 2.21886724e-01  3.32959503e-01 -2.79886931e-01 ...  8.01226795e-01
    -4.18295085e-01  7.18593538e-01]
   ...
   [ 4.08054084e-01  7.11669624e-01  7.42008269e-01 ...  4.74992186e-01
    -9.30303633e-01 -1.93331182e-01]
   [ 8.99838865e-01  1.17821515e+00 -1.20988774e+00 ...  1.04027987e+00
    -4.54762638e-01  1.29386032e+00]
   [ 6.48571372e-01  7.26971388e-01 -1.84204787e-01 ...  2.84899235e-01
     3.98756772e-01  3.92210275e-01]]

  [[ 1.62440643e-01 -9.57413837e-02  3.28589082e-02 ...  4.79140103e-01
    -4.89648819e-01  9.17405307e-01]
   [-5.02238452e-01 -5.45003265e-03 -2.39168942e-01 ...  1.09653664e+00
     1.76274106e-01  3.94068137e-02]
   [-2.25146145e-01  2.33943716e-01 -5.84575713e-01 ...  7.41249382e-01
    -2.84941141e-02  1.28855072e-02]
   ...
   [-6.68357074e-01  4.78805780e-01 -9.93302345e-01 ...  8.11536789e-01
    -3.26862067e-01 -4.64739799e-01]
   [-1.37010261e-01 -7.75631309e-01 -6.92176223e-01 ... -1.83915570e-01
    -1.45218968e+00  2.17339039e+00]
   [ 4.64969993e-01  3.84338379e-01 -7.32180178e-01 ... -4.42506850e-01
    -9.11599994e-02  1.25895917e-01]]

  [[ 5.73662639e-01 -6.38366342e-01 -9.65905413e-02 ... -7.98727751e-01
    -1.04734004e-02 -2.10764259e-03]
   [-1.52349138e+00 -1.66128314e+00  1.86037585e-01 ... -1.02636552e+00
     1.39992833e+00  1.23888481e+00]
   [ 1.36596453e+00 -1.88214910e+00  7.22793818e-01 ...  1.16989732e+00
    -5.57366669e-01 -1.39299989e+00]
   ...
   [ 3.47623974e-01 -1.58267868e+00  3.70367095e-02 ...  7.97379315e-01
    -4.35284615e-01 -6.45257354e-01]
   [-1.25013328e+00 -1.48402452e+00  4.80846882e-01 ... -7.35269547e-01
     1.59703422e+00  7.87762642e-01]
   [ 5.99983335e-01 -7.43352711e-01  2.29482204e-01 ...  6.00429296e-01
     4.31241959e-01 -1.10796607e+00]]

  ...

  [[-4.83920246e-01 -1.46727574e+00  3.03260994e+00 ... -9.22874153e-01
     1.14008963e+00  1.24594605e+00]
   [-3.25198829e-01  1.50611207e-01  2.94248372e-01 ... -1.65990353e-01
     2.17166245e-01  6.98917210e-01]
   [ 1.01008832e+00  2.16370440e+00 -1.21144247e+00 ... -5.61296105e-01
     8.43455493e-01  2.13119125e+00]
   ...
   [ 1.97684813e+00  9.04707968e-01 -1.12185848e+00 ...  1.27375454e-01
    -5.76852500e-01 -2.74372585e-02]
   [-4.12220418e-01  7.63924420e-01  9.92054105e-01 ... -4.20086086e-01
     8.24721694e-01  2.14216757e+00]
   [ 1.16517508e+00  4.74753559e-01 -2.95643866e-01 ... -4.57003325e-01
    -4.41241376e-02  4.36601788e-03]]

  [[-3.36935461e-01  4.67504263e-01  9.19425726e-01 ... -8.78007412e-02
    -5.69205403e-01 -1.12809432e+00]
   [ 8.38032067e-01 -4.56335664e-01 -4.93207932e-01 ... -1.58316660e+00
     2.30297074e-01 -4.85190660e-01]
   [ 3.43618155e-01 -8.08218718e-01 -2.99268842e-01 ... -1.56272030e+00
    -8.84343982e-02 -8.38672459e-01]
   ...
   [ 8.24856400e-01  2.70609140e-01  6.32489920e-01 ...  1.50904453e+00
    -4.07643706e-01  4.87899542e-01]
   [ 2.69664764e-01 -7.15962708e-01 -3.29230070e-01 ... -6.51182234e-01
    -1.38365245e+00 -5.23887575e-02]
   [ 8.34656477e-01 -7.48503566e-01  1.40968531e-01 ... -7.99472928e-01
    -7.16705441e-01 -5.01383901e-01]]

  [[-3.62992287e-04  1.99396163e-03 -7.38232434e-01 ... -1.97916590e-02
     2.80617863e-01 -1.40765381e+00]
   [ 9.88915980e-01 -1.62251517e-02  5.03912270e-01 ... -4.99730036e-02
     1.08718860e+00 -4.27625954e-01]
   [ 4.13185477e-01  1.84794128e-01  4.23469067e-01 ...  5.33387721e-01
     5.84696054e-01 -8.89721811e-02]
   ...
   [ 5.09807050e-01 -5.11205792e-01  1.45053074e-01 ...  5.23981035e-01
     1.08483994e+00  5.41165844e-02]
   [ 6.27302885e-01 -2.77222216e-01 -6.07599378e-01 ... -5.09704888e-01
     1.49475053e-01 -6.57512307e-01]
   [-1.12769119e-01 -1.10648596e+00 -4.90555644e-01 ...  1.92301169e-01
     1.90695226e-01  1.04301643e+00]]]


 [[[-1.31867692e-01  9.53308761e-01  6.53856754e-01 ...  6.85903788e-01
    -8.37609842e-02  1.66034436e+00]
   [ 3.80221963e-01  7.04934299e-01 -2.31963351e-01 ... -1.16590917e-01
     6.58425272e-01  4.18487638e-02]
   [ 1.02675438e+00  5.66390812e-01  7.22663760e-01 ... -1.75373602e+00
     7.80452549e-01  4.98947084e-01]
   ...
   [ 3.27617943e-01 -6.57787919e-01 -4.10258174e-01 ...  3.31973135e-01
     2.87048310e-01 -6.07835576e-02]
   [ 3.32320452e-01  3.96606684e-01 -6.78217530e-01 ...  4.90013748e-01
     4.25589442e-01  1.01047373e+00]
   [-9.83105600e-02  5.00948966e-01  6.19869351e-01 ...  2.18970597e-01
     5.79792678e-01  2.14979470e-01]]

  [[-1.19777572e+00 -1.72031283e+00  5.83552837e-01 ...  3.85776222e-01
    -1.60946512e+00 -1.07351434e+00]
   [ 2.34686360e-02 -5.72991818e-02  2.50156224e-02 ... -7.35891104e-01
    -8.94337445e-02  3.83419484e-01]
   [-1.41949368e+00 -5.98662555e-01  3.67848247e-01 ...  9.18083549e-01
    -1.66615868e+00  5.66309392e-01]
   ...
   [-2.99480110e-01  4.54560935e-01  2.51441926e-01 ...  6.83375359e-01
     7.58863986e-01 -7.93009639e-01]
   [-5.33582270e-01  1.32522255e-01  1.38273966e+00 ... -3.39184493e-01
     5.63024096e-02  3.57395768e-01]
   [-2.33814746e-01 -7.73487628e-01  2.00813800e-01 ... -3.68400544e-01
    -8.47646058e-01  6.31949246e-01]]

  [[-2.82561231e+00  1.42381454e+00  1.50794327e+00 ... -1.18189335e+00
     1.16470897e+00  2.04235053e+00]
   [-6.10940397e-01 -4.57305461e-02  6.10084906e-02 ... -4.47711378e-01
     1.24468052e+00 -7.64139950e-01]
   [ 3.56368929e-01 -7.40246028e-02 -7.50441730e-01 ...  1.53628564e+00
    -7.61605263e-01 -4.16853637e-01]
   ...
   [-3.40045273e-01  1.35681555e-02  1.65750772e-01 ... -1.64923579e-01
     7.15583980e-01 -6.74226046e-01]
   [-6.24324739e-01  7.80046761e-01  2.77125627e-01 ... -1.46945381e+00
    -1.23743355e-01  1.02605331e+00]
   [-1.11168802e+00 -1.90360382e-01  2.41744176e-01 ... -7.93072999e-01
     1.07947254e+00  4.27807242e-01]]

  ...

  [[ 7.87174940e-01 -4.09369707e-01 -6.37152195e-01 ... -3.67425442e-01
     8.67446661e-01 -4.55804408e-01]
   [-5.71606494e-03  4.53185067e-02 -3.17823917e-01 ...  7.12454766e-02
     4.14142162e-01 -1.34132266e-01]
   [ 1.23843312e-01  1.45875621e+00  4.95294929e-01 ...  2.06744647e+00
     4.13152248e-01  8.90121400e-01]
   ...
   [-6.05000705e-02  1.34414148e+00 -4.12423432e-01 ...  1.87720656e+00
    -1.37759477e-01  1.30121326e+00]
   [ 1.18688107e+00  4.68385518e-01 -5.21162033e-01 ... -3.08844715e-01
     6.19203985e-01 -7.99054205e-01]
   [ 2.11473003e-01  1.08077669e+00  2.45222032e-01 ... -9.36102390e-01
     1.82582065e-01 -1.48607209e-01]]

  [[-3.73827249e-01 -3.69999975e-01 -8.36803675e-01 ... -2.30709016e-01
    -3.14492226e-01 -5.68245769e-01]
   [-2.03506872e-01  2.29132593e-01  5.20407856e-01 ... -1.50221631e-01
    -5.91884792e-01 -1.13071024e+00]
   [-3.95310402e-01 -1.65351987e-01 -5.67289054e-01 ... -1.05407417e+00
    -1.04542412e-01  1.64791152e-01]
   ...
   [ 1.15420252e-01 -8.86201560e-01 -3.15901637e-01 ... -1.36301529e+00
     5.49318790e-01 -4.97347295e-01]
   [ 7.79246867e-01 -1.03712714e+00 -2.66690493e-01 ... -4.91523266e-01
     2.68224776e-01 -1.82313204e+00]
   [-7.79594243e-01  7.24497437e-02 -6.75855339e-01 ...  1.58572465e-01
    -4.63986278e-01 -7.13472009e-01]]

  [[-6.84902295e-02  1.17284350e-01  9.45729390e-03 ...  1.16983786e-01
     2.29468703e-01 -2.02006340e-01]
   [-1.77271828e-01 -1.25168532e-01  3.06215845e-02 ...  1.73776165e-01
     1.93024635e-01 -4.17427272e-01]
   [ 1.13141036e+00  6.46049753e-02  6.12304866e-01 ...  6.82712674e-01
     4.14561808e-01  4.89982277e-01]
   ...
   [-7.60859787e-01 -6.77287102e-01  8.38191986e-01 ... -1.16839099e+00
     6.54332280e-01  8.83062720e-01]
   [-4.25647497e-01  6.24695569e-02 -7.40227178e-02 ...  1.47317678e-01
     2.25549906e-01 -4.28361356e-01]
   [-7.14251697e-01 -7.78464198e-01  5.80131590e-01 ... -6.18946016e-01
     7.07320690e-01 -3.92350376e-01]]]


 [[[ 5.70569932e-03  9.56466794e-01 -3.56151521e-01 ... -1.06465280e+00
     6.84228539e-01  3.47140640e-01]
   [ 8.57388675e-01  1.42940485e+00 -3.69078040e-01 ...  1.13511264e+00
    -1.56476498e+00  1.36357009e-01]
   [ 1.81996310e+00  7.06210792e-01  2.45785093e+00 ... -2.40274239e+00
    -1.02610298e-01  2.31381798e+00]
   ...
   [ 1.52179822e-02  5.47002733e-01 -1.74908984e+00 ... -1.32391304e-01
    -5.10451317e-01  1.11968920e-01]
   [ 1.35345435e+00  9.45069671e-01  6.73125446e-01 ... -1.41850710e-01
    -7.86145329e-01  9.98736262e-01]
   [ 7.52379656e-01  6.36168242e-01  3.35038781e-01 ... -1.26816022e+00
    -4.93728846e-01  1.55101109e+00]]

  [[ 9.72999185e-02  5.53266630e-02 -3.87375057e-02 ...  6.45228982e-01
     4.23890144e-01  3.68311197e-01]
   [ 8.40799361e-02  1.23026752e+00 -5.60181260e-01 ...  1.70937389e-01
     6.18017793e-01  8.62891078e-01]
   [ 7.12559402e-01 -6.20694876e-01 -8.99094999e-01 ...  5.45076251e-01
     1.11907530e+00  6.22640371e-01]
   ...
   [-8.56086388e-02 -6.98166192e-02  1.11343944e+00 ...  5.00373542e-01
     1.21833742e+00 -1.78220659e-01]
   [-3.64272594e-01  5.03598213e-01  1.84842646e+00 ...  4.24378961e-01
    -4.96588647e-01 -5.63682437e-01]
   [ 1.12644482e+00 -9.29217339e-01 -1.99002790e+00 ...  9.87443388e-01
     2.31144714e+00  8.29281658e-02]]

  [[-1.50685990e+00 -1.67208529e+00  2.27113795e+00 ...  1.41583443e+00
     8.55534136e-01  6.15527213e-01]
   [-8.80008101e-01 -1.44837415e+00  1.01270115e+00 ...  8.10307980e-01
     8.59812438e-01  2.65511185e-01]
   [-1.65781714e-02 -4.75167364e-01  9.24852565e-02 ... -6.67810068e-02
     3.43236268e-01 -1.34895951e-01]
   ...
   [-4.42181200e-01 -3.47821414e-01  1.47149146e-01 ...  2.86523283e-01
     5.08705556e-01  2.62003601e-01]
   [ 1.32479262e+00 -9.38562095e-01 -1.24117362e+00 ...  9.76965427e-01
    -9.13248658e-01 -9.77042854e-01]
   [ 1.10857475e+00 -1.07006884e+00 -3.02116364e-01 ...  4.23525751e-01
    -1.62581399e-01 -5.32076836e-01]]

  ...

  [[ 1.91695631e-01 -2.96176583e-01  2.58973360e-01 ... -6.74029663e-02
    -2.20467314e-01 -1.99662089e-01]
   [-3.40985000e-01 -1.35867405e+00 -1.70899391e+00 ...  1.64367151e+00
    -1.70082140e+00  8.78079832e-01]
   [ 9.35034335e-01 -2.96071720e+00  1.88783622e+00 ...  1.19549143e+00
     7.52544940e-01 -1.63154387e+00]
   ...
   [-1.75196767e-01 -1.84232521e+00  1.32671297e+00 ...  9.20204520e-01
     1.41514361e+00 -5.20415664e-01]
   [ 2.15377957e-01 -5.76373637e-01  4.04446602e-01 ...  3.05869374e-02
    -4.82417375e-01 -7.65913010e-01]
   [-8.28911006e-01 -4.92976755e-01  6.45134211e-01 ...  2.44562015e-01
     4.50153470e-01  1.05762982e+00]]

  [[-3.05087358e-01 -9.57887173e-02 -9.20094848e-01 ...  1.77456051e-01
    -4.82527167e-01  1.42573461e-01]
   [ 9.06276345e-01  1.37122250e+00 -5.66584766e-01 ... -2.48356968e-01
     5.22298157e-01  1.07604802e+00]
   [ 1.19811702e+00  6.71005607e-01 -8.65672708e-01 ...  2.09824100e-01
     3.47637624e-01  1.59054911e+00]
   ...
   [-6.89008296e-01 -4.28672463e-01 -8.28581989e-01 ...  1.22641587e+00
     2.17412263e-02  2.65776843e-01]
   [-5.39997295e-02  2.59761274e-01 -3.36953074e-01 ...  8.34278107e-01
     1.59479260e-01  1.19191980e+00]
   [-2.55547851e-01 -2.97574103e-01 -5.77007592e-01 ...  1.46270359e+00
     4.52153608e-02  5.14280856e-01]]

  [[ 1.90110803e+00 -1.25975394e+00 -4.24362004e-01 ... -1.96657673e-01
    -7.64629319e-02  8.15313458e-01]
   [-4.09043998e-01 -7.06083000e-01 -3.02731705e+00 ...  1.28399980e+00
     4.46721286e-01 -4.41026241e-01]
   [ 2.25087118e+00 -5.12103140e-01  1.07027471e+00 ...  3.13525558e-01
     6.17722511e-01  2.85349154e+00]
   ...
   [ 7.67547011e-01 -1.65940195e-01  1.20503283e+00 ...  1.40997991e-01
     4.89641465e-02  2.34444052e-01]
   [ 1.96823752e+00  1.37012199e-01  1.21077061e+00 ...  1.07612118e-01
     5.19524932e-01  1.78351867e+00]
   [-1.73432350e-01 -1.02902067e+00 -8.57874811e-01 ...  4.96811509e-01
     4.33061719e-01 -2.00361878e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-False-32-8-27-11-8] q.shape1: (8, 11, 27)
q.shape2: (88, 27)
q.shape3: (88, 27)
q.shape4: (8, 11, 27)
q_liner: [[[ 0.7224421  -0.4349443   3.4143312  ...  0.35247484  1.755044
    1.3171575 ]
  [ 2.726345    1.2628067  -1.7939713  ... -0.06979546  0.00453782
    3.1302361 ]
  [-1.1040715  -0.15600364  1.9368501  ... -0.5825903  -0.65041417
   -2.2147686 ]
  ...
  [ 2.2915697   0.908618    1.0856221  ... -1.3256544   0.3059599
   -0.8404981 ]
  [-0.40498114 -0.5691511   2.6631112  ...  0.8738295   0.4198153
    1.1513562 ]
  [-0.4481117  -0.92076814  3.5576978  ...  2.7185454   3.3272922
   -0.97112256]]

 [[-1.1616747  -1.7085901  -0.06308014 ... -0.84628963  0.9343368
   -0.6217179 ]
  [ 0.4018707   0.30482602  0.46497503 ...  0.11524689  0.10966628
   -0.6314564 ]
  [ 2.181069   -1.1074287   1.3467315  ...  0.3924123   0.333957
    0.59106386]
  ...
  [ 3.5478017   0.51425123 -2.1266656  ... -1.1019756  -0.78907716
    2.1269352 ]
  [-1.6231765  -2.7684586   0.24566987 ... -0.25909057 -0.6573771
   -1.6647071 ]
  [ 2.5132887   0.55106294  0.7015406  ...  1.2227943   0.7392053
    1.8680627 ]]

 [[ 0.27821246 -1.1018684   1.7200263  ... -1.7082299  -0.4673362
   -2.2366893 ]
  [ 2.7587233   1.7226602   0.80260444 ...  1.1995286  -0.92798245
    0.2717521 ]
  [ 0.64558136  0.08447142  0.4400963  ...  1.3089368   1.2809186
   -1.5577403 ]
  ...
  [-1.0232698  -1.5747494   1.018051   ...  0.00518736 -0.4626458
    0.8344153 ]
  [ 1.1266454   0.38148978  2.193111   ... -1.535103    0.7982023
   -0.95043397]
  [-0.9965041  -1.8504593   1.8635492  ...  1.692321    1.8115427
   -0.7349715 ]]

 ...

 [[ 2.0749588   2.2624092   0.34631866 ... -3.2463973   1.0677856
    1.5288495 ]
  [ 0.26497793  1.3373191   3.0214698  ...  0.41106525 -0.168928
    0.03355249]
  [ 0.5420742   1.2251354  -3.826573   ... -0.3492088  -0.03093641
    0.7989888 ]
  ...
  [-3.2419846  -1.4931114   0.72515845 ...  1.7054092  -0.04060049
   -2.0626805 ]
  [ 0.9767814   0.28908026 -1.5257835  ... -3.0712612  -0.89618737
   -0.34019697]
  [ 0.62380505  1.7282047  -0.0089727  ...  3.7021785  -0.5753088
    1.6830212 ]]

 [[ 2.0232096   0.64801383  0.06984097 ...  0.75521886  0.41255075
    0.5661507 ]
  [ 0.1846309   0.6487752  -2.7815032  ...  0.88175464 -0.7132604
   -0.08390007]
  [-1.9218032   0.28904673 -1.1362168  ... -2.5849714  -0.15884835
   -1.8206904 ]
  ...
  [-1.7156733  -0.79765487 -1.7961345  ... -0.48244846  1.5824316
    0.23448431]
  [-0.93504095 -0.5579303  -1.3916396  ... -1.3223844  -0.33638978
   -0.6543721 ]
  [-3.1369114  -1.0516436   3.0829988  ...  0.66301984  1.6387496
   -2.8189466 ]]

 [[ 0.5203575   2.510916   -2.5926096  ... -0.47947776 -2.6331599
    1.5112784 ]
  [ 0.2482923   0.10941231 -1.2460439  ...  1.8010229  -0.24936317
   -0.89507395]
  [-0.4074848   0.35642445  1.1563052  ... -0.9337908  -0.3271042
    0.46405247]
  ...
  [ 0.87635964  0.15448402  0.44426605 ... -1.1368421   0.7098688
   -0.3491225 ]
  [-2.248125    0.22241627 -1.8704771  ... -1.2285389   0.29145718
   -0.22001871]
  [-1.0332358   0.15769057 -1.6133977  ...  0.13136601  1.1417925
   -0.2518325 ]]]
q.shape5: (8, 11, 256)
q.shape6: (8, 8, 11, 32)
attn_res: [[[[ 1.32303131e+00  1.85968682e-01 -1.08508575e+00 ...  2.22405100e+00
     7.79667720e-02  2.01804996e+00]
   [ 1.54855502e+00  1.70498729e+00 -6.58982635e-01 ... -7.09770203e-01
    -1.14412260e+00 -2.20730472e+00]
   [ 2.26489973e+00  9.85280633e-01 -6.79646969e-01 ... -5.68250954e-01
    -1.36451900e+00 -1.27132785e+00]
   ...
   [ 4.90405560e-01 -1.33343562e-02  6.89003170e-02 ...  6.44028187e-05
     4.11924832e-02  1.19329393e-01]
   [ 6.32342994e-02 -8.88042524e-02  1.50656432e-01 ... -5.70915788e-02
     4.51664813e-02  9.37322900e-02]
   [ 1.17152631e+00 -2.90623903e-01  1.50936067e-01 ...  1.38560325e-01
    -1.25924990e-01  5.69244742e-01]]

  [[-4.62468356e-01 -6.08880997e-01  1.53020114e-01 ...  6.17594600e-01
     4.66670305e-01  9.95308518e-01]
   [-8.81988883e-01  4.43131775e-01 -1.11338127e+00 ... -7.24679753e-02
    -4.45305914e-01  4.81042936e-02]
   [ 1.66897431e-01 -1.99918225e-02  4.63339925e-01 ...  3.22864980e-01
     9.13091838e-01 -1.65576696e+00]
   ...
   [ 5.79559952e-02  1.00676931e-01  5.71782827e-01 ...  1.13380194e-01
     1.50787365e+00 -2.07973552e+00]
   [-1.93574682e-01 -6.05136275e-01  4.06637490e-01 ...  3.09143364e-01
     6.77487314e-01  1.17979205e+00]
   [-1.00365794e+00 -4.57776815e-01  1.21661581e-01 ...  9.50923145e-01
     2.83565819e-01  1.36386907e+00]]

  [[-4.75502044e-01  8.86480391e-01 -8.43556643e-01 ...  8.54564428e-01
     5.85590720e-01 -1.76237595e+00]
   [-9.58506107e-01  7.52082348e-01 -5.00318646e-01 ...  1.39723921e+00
     3.39196324e-01 -1.45396554e+00]
   [-9.74781334e-01 -3.64511669e-01 -1.00890845e-02 ... -1.71686813e-01
    -1.10694557e-01 -1.74801797e-03]
   ...
   [-3.55619431e-01 -1.53855848e+00 -9.10605490e-02 ...  9.39437509e-01
    -8.76209676e-01  1.30395025e-01]
   [ 5.94224632e-02  4.79108691e-01 -9.29064035e-01 ... -4.94158030e-01
     9.21984553e-01 -2.42150569e+00]
   [-7.21229911e-01  7.48465478e-01 -6.55628920e-01 ...  2.16876879e-01
     5.59012949e-01 -8.77513923e-03]]

  ...

  [[-3.45347881e-01 -2.90303409e-01 -2.43714795e-01 ...  6.91129804e-01
     8.12446058e-01 -1.42997074e+00]
   [-1.02451849e+00  6.28892243e-01 -4.68928926e-02 ...  4.13119048e-03
    -3.54630589e-01  3.55470151e-01]
   [-4.07293499e-01 -1.22685635e+00  1.00342691e+00 ... -1.87550753e-01
    -7.29916751e-01 -6.13737285e-01]
   ...
   [-1.49780154e-01  2.09786177e-01  3.50444674e-01 ... -1.20256126e+00
    -1.01484144e+00 -5.29698789e-01]
   [ 2.10457295e-01  6.37697160e-01 -7.94095218e-01 ... -5.71121275e-02
     2.25213677e-01 -1.85330272e+00]
   [-1.56140089e-01 -2.12650388e-01 -6.35782257e-02 ...  3.12016606e-01
     7.71780670e-01 -1.69795740e+00]]

  [[ 1.35932231e+00 -6.79358393e-02  1.04293382e+00 ...  7.93567002e-01
    -7.87167728e-01 -1.74464211e-01]
   [ 1.51020646e+00 -1.35801524e-01 -9.39139247e-01 ... -3.27381194e-01
    -1.65913492e-01 -5.99585287e-02]
   [ 1.57173955e+00  2.41082489e-01 -1.05973303e+00 ... -3.86693716e-01
     2.34818742e-01 -5.90528920e-03]
   ...
   [ 1.68702269e+00 -1.35877371e-01 -5.09029448e-01 ... -2.95902729e-01
    -7.19080120e-02 -2.12848842e-01]
   [ 2.93582320e-01  2.31842130e-01  4.64747101e-01 ...  1.98142633e-01
    -1.71801180e-01  2.65972279e-02]
   [ 1.48073447e+00 -5.85172772e-01  1.02387798e+00 ...  6.38008177e-01
    -9.79755223e-01 -1.00138700e+00]]

  [[ 4.59588468e-02 -1.82579851e+00 -5.29224336e-01 ...  3.84724766e-01
     1.52986503e+00  1.64561236e+00]
   [ 4.62070435e-01 -9.02606726e-01 -6.59615517e-01 ...  8.94290328e-01
     6.13016486e-01  6.57865047e-01]
   [-7.04725087e-01 -6.11024648e-02 -4.21672642e-01 ...  3.03369492e-01
     6.07058465e-01  2.59703726e-01]
   ...
   [ 9.85697448e-01 -8.40068102e-01 -1.34553027e+00 ...  1.36015490e-01
     1.47577810e+00  2.67278731e-01]
   [-1.24002904e-01 -1.35161483e+00 -3.00833195e-01 ... -4.96092020e-03
     1.73258936e+00  1.72280812e+00]
   [-6.74949527e-01  4.50063646e-01  4.44862157e-01 ...  5.35951197e-01
     1.05374679e-01  7.23146677e-01]]]


 [[[ 3.04059207e-01  6.36527240e-01 -1.47334993e-01 ... -1.64772797e+00
     1.38766551e+00  3.00414205e-01]
   [-1.08648971e-01 -4.93292600e-01  5.58705807e-01 ...  1.07199162e-01
     2.51276404e-01 -6.89734578e-01]
   [-4.11073327e-01 -7.27829337e-01  4.24592942e-01 ...  4.74491417e-01
     3.71783555e-01 -6.42568946e-01]
   ...
   [-6.46759927e-01 -8.72481346e-01  6.61520720e-01 ...  1.15441287e+00
     2.96903640e-01 -6.45734593e-02]
   [-1.53754628e+00  2.50795543e-01  7.69521058e-01 ... -6.26937672e-02
     5.45903385e-01 -6.26733303e-01]
   [-8.18776548e-01 -3.19230646e-01  1.05404413e+00 ...  9.95669067e-02
     8.30182374e-01 -3.59932274e-01]]

  [[ 4.40795064e-01  1.28988671e+00  7.58541942e-01 ...  3.65957230e-01
     5.69418147e-02  2.52301216e-01]
   [-1.08036995e+00  4.13904458e-01 -1.64391875e+00 ... -1.54495388e-02
    -1.39699328e+00  4.09387946e-01]
   [-8.90331268e-01  5.46627939e-01  2.27509618e-01 ...  1.74999607e+00
     3.91845167e-01  2.82267541e-01]
   ...
   [-3.49271685e-01  1.62965178e-01 -1.07931964e-01 ...  5.92529476e-01
    -3.14997137e-03  2.89215595e-02]
   [ 1.97358251e-01  1.23628497e+00  4.68190968e-01 ...  9.07309294e-01
     4.92090642e-01  8.36676806e-02]
   [ 7.06828833e-02  4.60674107e-01  6.02924824e-01 ...  3.24921876e-01
     1.04718253e-01 -1.58915073e-02]]

  [[-5.57510614e-01 -5.09987473e-01  6.30468726e-01 ...  7.69963562e-01
     4.42239642e-01 -4.51951087e-01]
   [ 9.74367619e-01 -3.63871783e-01  1.63257852e-01 ...  3.90116483e-01
    -1.14126422e-01  9.46107507e-01]
   [ 8.74933422e-01 -2.29577199e-01  6.09138906e-01 ...  8.84460807e-01
     2.43377648e-02 -2.81008214e-01]
   ...
   [ 8.91624451e-01  4.08101797e-01 -4.37614173e-02 ... -1.60821840e-01
     1.67268962e-01  7.54083395e-01]
   [ 6.02795780e-01 -2.83723585e-02 -2.82449611e-02 ...  1.57923549e-01
     5.05919158e-01 -4.15483534e-01]
   [ 1.51768231e+00 -6.86107695e-01 -5.19433677e-01 ...  8.20886135e-01
    -1.61538184e+00  4.96454686e-01]]

  ...

  [[-1.57902586e+00  1.60392618e+00  4.98112470e-01 ... -3.06251001e+00
    -1.26948917e+00  1.17690742e+00]
   [-7.96128094e-01  6.86939240e-01 -7.49222040e-01 ... -7.10792899e-01
    -1.04385346e-01 -5.61846972e-01]
   [ 1.04798627e+00  2.49246344e-01  5.36284000e-02 ... -9.86390710e-01
     1.79935217e-01 -1.54566932e+00]
   ...
   [-9.74590797e-03  3.01074475e-01 -8.88849974e-01 ...  1.25127518e+00
     7.66667426e-01 -1.48682380e+00]
   [-8.39365497e-02  3.30495954e-01  2.08055079e-02 ... -4.31468070e-01
     9.75702107e-02 -4.90752608e-01]
   [-8.79599690e-01  5.56961477e-01 -2.73981988e-01 ... -8.26965094e-01
    -2.33744651e-01 -5.18609211e-03]]

  [[ 2.18177915e-01  3.75920087e-01 -1.73046142e-01 ...  3.12273353e-01
    -8.70148003e-01  4.43976790e-01]
   [ 1.49292004e+00 -4.42330390e-01 -5.02446771e-01 ... -5.19972861e-01
    -1.29072702e+00  1.83554709e-01]
   [-4.08912331e-01  4.46648002e-02  5.34598649e-01 ...  5.91553271e-01
     3.92279118e-01  3.50876719e-01]
   ...
   [ 4.40375626e-01 -3.40813816e-01  4.54079300e-01 ...  7.10333824e-01
     1.88737869e-01 -1.69086742e+00]
   [-3.33246201e-01  3.97728056e-01  8.45651627e-01 ...  3.75661761e-01
     4.40471530e-01 -2.92434156e-01]
   [-5.97713590e-01  7.07387149e-01  1.10987830e+00 ... -1.62755579e-01
     5.37062526e-01 -7.13493824e-01]]

  [[-6.25758767e-01  3.62788022e-01  4.90565360e-01 ... -2.00903744e-01
     1.03189516e+00  9.96129394e-01]
   [-5.56732893e-01  2.48509452e-01  1.31714070e+00 ...  6.55948997e-01
     5.42508066e-01  2.26574019e-01]
   [ 4.17039216e-01 -1.89683452e-01  1.58584964e+00 ... -3.41448486e-01
     7.44572043e-01  1.75883138e+00]
   ...
   [-6.01711422e-02  2.75277108e-01  7.05172479e-01 ... -1.32267624e-01
     8.54523420e-01  9.51952755e-01]
   [-4.58167911e-01  1.13799334e-01  6.38064981e-01 ... -1.06530651e-01
     3.37709486e-01  8.21551919e-01]
   [ 8.64298284e-01  9.02237177e-01 -3.70619306e-03 ... -7.55505562e-01
     1.51475942e+00  6.20114505e-01]]]


 [[[-8.79022419e-01 -1.41467440e+00  2.23258591e+00 ...  1.94698438e-01
     1.04598963e+00  6.99545443e-01]
   [-9.86165643e-01 -9.57526982e-01  1.32847679e+00 ... -1.31870911e-01
     2.25467634e+00  9.00838554e-01]
   [-6.74185812e-01 -7.33415425e-01 -6.17454112e-01 ...  8.45995903e-01
     5.77553771e-02  2.97775745e-01]
   ...
   [ 1.93730183e-03  4.90175709e-02 -2.34132096e-01 ... -3.29150915e-01
    -4.74755198e-01  8.12553406e-01]
   [-4.00807001e-02 -5.16615510e-02 -6.99892044e-02 ... -1.35391444e-01
    -2.40930438e-01  5.86221397e-01]
   [-4.77582842e-01 -7.56255865e-01  1.30282152e+00 ...  1.55566156e-01
     3.23009849e-01  6.84235692e-01]]

  [[-6.24801636e-01  9.66501176e-01  4.37519431e-01 ...  3.32718074e-01
     2.17932165e-01  7.02677965e-01]
   [-1.68360859e-01  9.06942189e-02  4.91727233e-01 ...  1.11227818e-01
    -2.22268581e-01  4.97780621e-01]
   [-5.88134050e-01  9.00355697e-01  1.44987881e+00 ...  9.09610271e-01
     2.35656679e-01  2.48194122e+00]
   ...
   [ 7.77949572e-01  3.28872180e+00  8.70770097e-01 ... -1.43625392e-02
     2.44648290e+00  5.80120265e-01]
   [-2.82438844e-01  1.42575824e+00  9.03268218e-01 ...  6.92423522e-01
     6.28143549e-01  1.52442908e+00]
   [-3.89265150e-01  7.67607033e-01  1.08027053e+00 ... -4.93158072e-01
     3.67083848e-01  2.04487324e-01]]

  [[-1.10404277e+00  1.46109974e+00 -3.15255880e-01 ... -2.82739073e-01
    -1.17372370e+00 -5.19764900e-01]
   [ 9.30368621e-03 -8.13819766e-01  4.69204277e-01 ... -5.37284195e-01
     1.92178607e-01 -6.03315175e-01]
   [-2.33284682e-01  1.09060431e+00  3.24554116e-01 ... -6.16126895e-01
     7.32649505e-01 -4.36240107e-01]
   ...
   [-1.24095678e+00  9.87018228e-01  5.07372558e-01 ... -3.30073163e-02
     4.08886969e-01 -1.93648905e-01]
   [ 3.25830340e-01  1.47535205e+00 -1.84478033e-02 ... -8.89459908e-01
    -4.46084559e-01 -5.53783357e-01]
   [-1.62954068e+00  2.98392326e-01  8.68431807e-01 ... -5.17879307e-01
     3.76725703e-01  1.06745410e+00]]

  ...

  [[ 4.08598840e-01  2.80426949e-01 -1.00325656e+00 ... -5.82214773e-01
    -1.95393875e-01  9.83803421e-02]
   [ 9.82816890e-02 -3.35006058e-01  6.76174879e-01 ... -9.77704942e-01
     4.94132310e-01 -4.61372823e-01]
   [-5.80664992e-01 -1.28677261e+00  9.77274716e-01 ...  1.97210424e-02
     1.38800931e+00  1.90443265e+00]
   ...
   [ 1.07414424e-01 -3.02135289e-01  1.16910212e-01 ... -1.78027630e-01
     5.39759338e-01  3.01955909e-01]
   [-1.15596652e-01  6.12482548e-01 -4.13266391e-01 ... -2.97797501e-01
    -4.64773774e-02  5.47684193e-01]
   [ 1.91729173e-01 -8.77790973e-02 -1.76413998e-01 ... -8.06268096e-01
     1.05495371e-01 -5.01971185e-01]]

  [[ 4.81504619e-01 -1.01415431e+00  4.48905200e-01 ... -6.51863694e-01
    -7.66830444e-01 -2.47298181e-01]
   [-4.82239515e-01 -1.07553172e+00  8.46548438e-01 ...  3.02726269e+00
     2.02926137e-02 -5.90119421e-01]
   [ 3.86009276e-01 -4.94855136e-01  1.06712317e+00 ...  1.83846831e-01
    -8.20840120e-01 -6.60138369e-01]
   ...
   [-1.99906737e-01 -2.62415767e-01  7.36988306e-01 ...  5.51186562e-01
     3.57344896e-02 -6.09054208e-01]
   [ 1.39235961e+00 -4.57722694e-02  1.08508086e+00 ...  2.61741787e-01
     7.53814578e-01 -6.40840411e-01]
   [ 1.20680666e+00 -7.25321293e-01  1.15869832e+00 ... -5.21722674e-01
    -2.63733119e-01 -1.01185131e+00]]

  [[-6.54650927e-01  1.00637460e+00  2.48776650e+00 ...  4.20675397e-01
     3.69114697e-01  1.05843115e+00]
   [ 8.87853861e-01 -2.77592373e+00 -1.22236049e+00 ...  2.14797229e-01
    -1.25969434e+00  1.80662632e+00]
   [ 6.17638230e-01 -7.71168232e-01 -2.71403342e-01 ...  2.96678483e-01
    -2.69154608e-02  1.16800427e+00]
   ...
   [-1.05702877e+00  9.26556528e-01  1.81078166e-02 ... -9.11841333e-01
     7.37722069e-02  4.74169374e-01]
   [-1.94785130e+00  9.49998945e-02 -4.34801310e-01 ... -1.68020892e+00
     1.42634585e-02  8.53957832e-01]
   [-1.21087193e+00  1.15588188e+00 -8.86267304e-01 ... -1.57509577e+00
     1.82912901e-01  4.10269916e-01]]]


 ...


 [[[ 1.15977049e+00 -4.09412980e-01  1.48405683e+00 ... -7.53775775e-01
    -1.01703775e+00  3.61025333e-01]
   [ 1.38718590e-01  2.12515652e-01 -9.63664770e-01 ... -3.29809576e-01
    -5.29660165e-01  2.82165170e-01]
   [-3.31119895e-01  1.47756964e-01 -6.51156008e-01 ... -8.84200573e-01
    -6.27739370e-01 -5.03793120e-01]
   ...
   [ 1.57433796e+00  6.88547075e-01 -8.08739185e-01 ... -2.51296020e+00
    -1.67946947e+00 -4.94304389e-01]
   [ 1.31234264e+00 -2.41307482e-01 -4.50911313e-01 ... -4.51290041e-01
    -2.52611578e-01  2.98068911e-01]
   [ 3.62168491e-01  1.25108421e-01 -5.76131523e-01 ... -5.00924826e-01
    -6.72146320e-01 -1.65072083e-01]]

  [[-2.02576935e-01 -2.64605641e-01  8.25169504e-01 ... -3.05398762e-01
    -3.06313455e-01 -1.08032870e+00]
   [-2.46477544e-01 -1.05543137e-02  1.89204961e-01 ... -4.76297557e-01
     6.02928877e-01 -7.89357185e-01]
   [-5.43844849e-02 -3.89495492e-02 -1.26538366e-01 ...  2.27159098e-01
     1.09570399e-01 -7.02760577e-01]
   ...
   [-1.84446886e-01  4.41441000e-01  5.06262243e-01 ...  1.41457903e+00
     1.47690153e+00  1.53099954e+00]
   [ 2.27044374e-02  5.60028136e-01  2.33857781e-01 ... -9.71095443e-01
     1.43273282e+00  2.26207912e-01]
   [ 2.41001919e-02  1.32405937e-01  2.67979145e-01 ...  1.27929568e+00
    -5.08562684e-01 -3.42044353e-01]]

  [[-3.25559646e-01 -2.82284170e-01  5.37566364e-01 ...  5.76528668e-01
     4.25012618e-01 -6.10143393e-02]
   [-1.52042651e+00  4.65396762e-01 -1.28776848e-01 ... -7.27964699e-01
     1.41712606e+00 -1.23530403e-01]
   [ 6.44122660e-01 -4.70986426e-01  1.29595712e-01 ...  2.06843257e-01
    -2.28968188e-01 -2.25278288e-01]
   ...
   [ 3.01245153e-01 -4.89055842e-01  8.36427882e-02 ...  3.57806146e-01
     4.05290902e-01 -6.69107616e-01]
   [-1.59116638e+00 -4.68234330e-01 -1.14620531e+00 ... -9.26573157e-01
     1.18211830e+00 -1.84426224e+00]
   [-8.89138103e-01  4.08152342e-02  6.50491774e-01 ... -2.50984788e-01
     5.41734099e-01  3.45794767e-01]]

  ...

  [[-3.55867982e-01 -6.42735779e-01  1.12180269e+00 ... -9.78620112e-01
    -1.28976727e+00  2.28035641e+00]
   [-1.91468930e+00 -2.50185251e-01 -4.67447132e-01 ...  1.23944327e-01
     2.87503541e-01  3.46171916e-01]
   [ 2.62528539e-01  1.12964296e+00 -4.13273573e-01 ...  7.68823445e-01
     3.97392631e-01 -3.10514927e-01]
   ...
   [ 6.03831327e-03  4.14950121e-03  8.27060454e-03 ... -1.62840672e-02
    -6.77257450e-03  1.85637525e-03]
   [-5.35861969e-01 -3.98372233e-01  1.17333794e+00 ... -1.19621658e+00
    -1.56615663e+00  1.96474123e+00]
   [ 2.00721741e-01 -2.12198228e-01  8.22655082e-01 ... -9.46224511e-01
    -4.34228718e-01  9.39361870e-01]]

  [[ 1.80850554e+00 -1.48149228e+00  3.66360843e-02 ... -3.26701790e-01
    -1.65997779e+00 -7.58520365e-01]
   [ 3.70507658e-01  6.09900802e-02 -7.06816554e-01 ... -4.96855229e-01
    -4.07051593e-02  6.53156996e-01]
   [ 2.44350410e+00  3.50735672e-02  4.52526629e-01 ... -1.11012387e+00
    -8.80963027e-01 -2.21076131e+00]
   ...
   [-1.01127958e+00 -8.40107679e-01 -4.52555656e-01 ...  5.25513291e-01
    -6.17511213e-01  4.94064242e-01]
   [ 1.92862600e-01 -6.44161940e-01 -3.92603278e-01 ... -1.09109625e-01
    -2.01839581e-02 -1.34724855e+00]
   [ 2.19546750e-01 -1.11321759e+00  2.51625985e-01 ... -2.15958163e-01
    -4.34738398e-01 -9.51468587e-01]]

  [[-4.77255940e-01 -2.96872914e-01 -4.76312995e-01 ...  5.83658889e-02
    -3.86613488e-01  7.45691359e-01]
   [-9.48200822e-02 -5.61402082e-01  2.58104175e-01 ... -2.09458962e-01
     5.22024572e-01  1.51162839e+00]
   [-9.82040286e-01 -1.83990389e-01  1.01871681e+00 ...  1.44926995e-01
     7.71354973e-01  1.46798182e+00]
   ...
   [-9.09148574e-01  4.91304576e-01  1.33214444e-01 ... -1.52300224e-01
     2.42598206e-01 -4.40416902e-01]
   [-1.77541018e+00  3.64888012e-01  5.18771231e-01 ... -4.80916798e-01
    -1.18147023e-01  8.16968143e-01]
   [ 6.49180114e-02  3.90921414e-01  1.01945311e-01 ...  5.53815126e-01
     4.23582345e-01  4.38757360e-01]]]


 [[[-1.54549801e+00  1.26078987e+00  3.40294838e-01 ... -1.01716852e+00
     4.83356178e-01  1.23326242e+00]
   [-1.32116854e-01 -2.21819329e+00  1.10607222e-01 ...  1.55947304e+00
     3.12268853e-01  2.23834276e+00]
   [ 2.05739713e+00 -5.84093034e-01  1.20432639e+00 ...  1.48603809e+00
    -7.65337408e-01 -7.21814752e-01]
   ...
   [ 1.03344762e+00 -1.17522907e+00  1.57944429e+00 ...  7.98684776e-01
     7.18355924e-03  9.89164948e-01]
   [ 5.18097937e-01 -2.27047086e+00  9.68054950e-01 ...  1.89052486e+00
     3.32221389e+00  1.16528153e+00]
   [ 1.58572578e+00 -2.54476047e+00  7.97629356e-01 ...  1.60726011e+00
     2.17554331e+00  1.06432796e+00]]

  [[-1.20746391e-02 -3.29022884e-01 -3.10007900e-01 ... -9.06812370e-01
     2.45611119e+00 -2.46953607e+00]
   [-4.89777446e-01 -3.61811131e-01  2.87460834e-01 ... -1.21013403e+00
     4.21874911e-01 -1.38790655e+00]
   [ 4.35454786e-01 -1.01825929e+00  5.11451125e-01 ... -1.60243773e+00
     3.16303253e-01 -7.64707565e-01]
   ...
   [ 4.05977309e-01 -3.50158304e-01  1.09851909e+00 ... -1.90380955e+00
     4.46837425e-01 -1.46673846e+00]
   [-5.90632260e-01 -4.86330301e-01 -2.16068879e-01 ...  1.71551585e-01
     5.97895682e-01 -9.85500574e-01]
   [-1.56679958e-01 -1.43146023e-01  1.01901710e+00 ... -1.27776170e+00
     6.55081809e-01 -6.93887174e-01]]

  [[-9.91693854e-01  8.25869322e-01  1.59935057e-02 ... -3.67825814e-02
     1.11219549e+00 -1.23609853e+00]
   [-8.04476142e-01  1.61779463e-01 -1.25835454e+00 ...  7.86569715e-02
     1.93743002e+00 -2.67697382e+00]
   [-6.37218654e-01  5.60451210e-01 -3.15911770e-01 ... -1.71001077e-01
     1.32591391e+00 -2.17534947e+00]
   ...
   [-1.62193048e+00 -4.38739419e-01 -9.11090374e-01 ...  2.17579171e-01
     8.02368701e-01 -2.31073594e+00]
   [-9.78792131e-01 -2.87288129e-01  7.10526228e-01 ...  8.48223716e-02
     5.03494218e-03 -9.10685658e-01]
   [-9.06025231e-01  1.06564653e+00 -3.67266715e-01 ...  9.62840617e-01
     1.28341187e-02 -1.61181593e+00]]

  ...

  [[-1.01978138e-01  7.36040175e-02  2.93091029e-01 ... -5.96999228e-01
    -8.20884287e-01  1.08209908e-01]
   [ 2.46468738e-01 -8.72800201e-02 -2.09658647e+00 ...  2.03521681e+00
     2.14516103e-01  6.70883834e-01]
   [-1.34537458e+00  1.25487351e+00 -1.12135267e+00 ... -3.19983453e-01
    -1.69297171e+00 -1.19589853e+00]
   ...
   [ 3.67408246e-01 -3.35258283e-02 -5.79468012e-01 ... -2.92085797e-01
    -7.37331808e-01  9.14923728e-01]
   [-1.57527223e-01 -4.61008132e-01 -9.06490505e-01 ...  5.37792206e-01
    -3.02565843e-01  2.13546246e-01]
   [-1.30411637e+00  9.17844653e-01 -9.17613089e-01 ... -1.01106417e+00
    -7.12455332e-01  1.05230562e-01]]

  [[-5.62288284e-01  5.42850792e-02  8.10115516e-01 ...  3.65317643e-01
    -8.38060856e-01 -1.19248438e+00]
   [ 5.28948903e-01  7.70974517e-01  7.46214688e-01 ... -1.72665823e+00
    -1.17414784e+00 -4.39748198e-01]
   [-1.10247815e+00 -7.19228387e-02  1.01330101e+00 ...  5.25126874e-01
    -1.10646403e+00  2.62538135e-01]
   ...
   [-7.03217983e-01  4.99204576e-01  8.35959673e-01 ...  2.94983119e-01
    -5.23310661e-01 -8.91649783e-01]
   [-2.25288808e-01  1.28203809e+00  9.35315967e-01 ...  7.00408161e-01
    -4.59906459e-03 -5.60342669e-01]
   [-2.71746248e-01 -4.78595734e-01  1.03931963e+00 ... -3.30825233e+00
    -1.75693142e+00  5.17006397e-01]]

  [[ 2.47535184e-01 -6.78856432e-01  5.95084250e-01 ...  6.04809970e-02
    -1.19058952e-01  1.27928340e+00]
   [ 6.96788490e-01 -1.61281061e+00  8.79633486e-01 ...  2.55791336e-01
    -8.22249055e-01  1.71692121e+00]
   [ 3.87603760e-01  2.11612391e+00 -7.41588056e-01 ... -6.82667270e-02
    -3.25613171e-01  5.19744396e-01]
   ...
   [ 4.07707393e-01  1.38768935e+00  6.15562379e-01 ...  9.40575123e-01
    -3.89918476e-01 -3.21556956e-01]
   [ 2.97075212e-01  1.30927074e+00 -1.54760635e+00 ...  3.08196247e-01
    -4.89582628e-01  6.68217599e-01]
   [ 5.42326272e-01  7.73510575e-01  3.81412983e-01 ...  6.84003055e-01
    -2.10783437e-01 -3.17981780e-01]]]


 [[[-1.51528358e+00 -1.47544861e+00  1.21930146e+00 ...  2.10377619e-01
     1.44775105e+00  1.46550155e+00]
   [-5.86764634e-01 -2.81878591e-01 -3.46677810e-01 ... -1.10298109e+00
    -1.78157461e+00 -2.00617820e-01]
   [-4.63834316e-01 -1.79562831e+00  6.52303994e-01 ... -2.26502150e-01
    -1.05772424e+00  4.90460098e-01]
   ...
   [-1.66229695e-01 -1.81947514e-01  3.46270442e-01 ... -2.15626299e-01
    -2.81594604e-01  2.89203167e-01]
   [-5.26000798e-01 -8.00060093e-01  1.19247876e-01 ... -3.54540974e-01
     2.60668486e-01  8.60242128e-01]
   [-3.62903982e-01  9.36302483e-01  1.01086056e+00 ...  6.90571666e-02
     3.19983542e-01  7.56695807e-01]]

  [[ 3.23335230e-01 -2.21100226e-01 -8.38937342e-01 ...  8.97745848e-01
     2.58015990e-01  4.04278785e-02]
   [-1.48306265e-01  1.92633301e-01  4.32318389e-01 ...  5.36582589e-01
     4.43488151e-01  2.23660376e-02]
   [ 2.11016759e-01  4.36678410e-01  9.13977385e-01 ...  2.29777908e+00
     9.84577596e-01  1.92808241e-01]
   ...
   [-1.04426718e+00  4.61784214e-01  1.15522885e+00 ...  1.20859146e+00
    -1.17587566e+00  1.81379676e+00]
   [ 4.05890256e-01 -7.16979802e-01  2.27823168e-01 ... -3.39175463e-02
     2.26076454e-01 -4.39359426e-01]
   [-3.63834977e-01 -9.42648113e-01  5.91054976e-01 ... -6.66119397e-01
    -2.03453824e-01  4.74575669e-01]]

  [[-8.29727352e-01 -5.52249789e-01  1.26785543e-02 ... -5.76329291e-01
    -1.37552798e-01 -1.81847557e-01]
   [ 6.58771217e-01 -5.70816875e-01 -2.04583943e-01 ...  1.79388976e+00
     4.32536811e-01 -1.50163627e+00]
   [-2.28278920e-01  1.42520130e+00  6.33420348e-01 ... -1.00156820e+00
     4.09036636e-01  1.75501555e-01]
   ...
   [-1.82006985e-01 -2.09998345e+00 -5.00311069e-02 ... -1.33447587e+00
    -1.64330816e+00 -1.85830295e-01]
   [-1.49546492e+00  6.37487948e-01 -3.17720354e-01 ...  1.92057014e+00
    -2.49394035e+00 -5.24155676e-01]
   [-8.37749004e-01 -9.04044449e-01 -4.68748897e-01 ... -3.24691862e-01
    -5.05454719e-01 -4.16478515e-01]]

  ...

  [[ 4.10545915e-01  2.57493526e-01  6.18779659e-03 ...  5.51923811e-01
    -3.57357413e-01  4.38439697e-01]
   [-3.11531335e-01 -1.19476771e+00  1.11211002e+00 ... -2.21140295e-01
     1.46610034e+00  1.21338356e+00]
   [ 6.52299941e-01  7.87012205e-02 -8.02716374e-01 ...  6.78363442e-01
     7.24432766e-01 -3.93950820e-01]
   ...
   [-3.88967574e-01  1.68006644e-01 -2.52337724e-01 ... -2.40337163e-01
    -1.93123803e-01  1.41796398e+00]
   [ 3.54855537e-01 -6.55579805e-01  8.54944170e-01 ... -5.34323812e-01
    -4.68589187e-01  1.29073131e+00]
   [-6.98896348e-02  2.51635075e-01  5.78953028e-01 ...  2.57540345e-01
    -1.19697416e+00  1.29433322e+00]]

  [[-1.60664141e+00  1.59030414e+00  1.44113851e+00 ...  5.03145576e-01
     3.78277063e-01 -1.61649078e-01]
   [ 4.02190238e-01  7.30962038e-01 -6.43795609e-01 ...  1.20302141e+00
     4.24712896e-01 -3.07951063e-01]
   [-1.57721293e+00  1.12526409e-01 -4.81702983e-01 ...  5.21702051e-01
    -9.12978232e-01 -1.86672628e+00]
   ...
   [ 1.19582844e+00  6.00591838e-01  6.92324281e-01 ...  2.18218112e+00
    -3.26418430e-01 -1.96972752e+00]
   [-1.23513079e+00 -1.44483209e+00 -6.61071241e-02 ... -5.19302726e-01
    -3.29158098e-01  1.85228676e-01]
   [ 3.33543830e-02 -9.96513009e-01 -1.30889559e+00 ...  6.85186207e-01
     3.63192797e-01 -7.24361062e-01]]

  [[-7.50788391e-01  1.42729437e+00  5.22316635e-01 ... -2.64449668e+00
     1.36785269e-01  2.80022526e+00]
   [-1.07193902e-01 -7.14000404e-01 -5.08456647e-01 ... -5.72184920e-01
    -7.22074747e-01 -1.92219448e+00]
   [ 1.21465944e-01 -1.76704347e-01 -1.16408551e+00 ...  3.66907954e-01
    -1.17117912e-02 -1.06762874e+00]
   ...
   [ 4.60827321e-01  2.53209230e-02  6.46683395e-01 ...  1.69284630e+00
     5.51289618e-01  2.36072600e-01]
   [-8.83454382e-02 -2.19856524e+00  1.03184253e-01 ... -1.61240712e-01
    -5.16649902e-01 -6.11337364e-01]
   [ 1.90829426e-01 -7.04484463e-01 -1.93689466e-01 ...  2.50799656e-01
    -4.41140771e-01 -2.41706371e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-True-32-8-27-5-4] q.shape1: (4, 5, 27)
q.shape2: (20, 27)
q.shape3: (20, 27)
q.shape4: (4, 5, 27)
q_liner: [[[-0.45098242 -1.8597653  -0.18044859 ...  0.44736135 -0.781291
   -1.3717852 ]
  [-1.5089675  -1.1255506   0.2868886  ... -0.59291077 -4.2512317
    1.4017425 ]
  [-0.5946903   1.0263848  -0.581638   ... -2.404116    1.5132208
   -2.4856858 ]
  [-0.31688586  0.5528781  -0.47048947 ... -3.4016237   0.32389942
    0.792212  ]
  [ 0.5705429  -1.4638315  -1.4060916  ...  0.13239647 -0.5641086
   -0.13941243]]

 [[-0.48622677  0.58664197 -0.8507686  ... -1.5951675   0.925034
   -0.5789255 ]
  [ 0.01250778  0.2590642  -1.4820707  ...  0.27701756  0.50881475
   -1.5133846 ]
  [ 1.8713679  -1.6441334  -0.23689702 ...  1.4759533   0.5980671
    1.3676003 ]
  [-1.7826596  -0.49967113 -0.13877717 ... -2.309278   -0.94425654
   -0.6702585 ]
  [-1.9854672  -0.1258095  -1.3325741  ... -1.2256528   0.3417048
   -1.306887  ]]

 [[ 0.08923486  0.40770042 -1.179379   ... -2.331579    1.0649294
   -1.4443758 ]
  [-0.9717777  -1.0941966   0.10684844 ... -1.3449765   1.5412539
    1.2202598 ]
  [-1.9089527  -0.49968353 -0.7305629  ... -0.31890056  0.05979536
   -0.012014  ]
  [ 0.8310764  -0.54699755 -2.0045779  ...  1.1674607  -0.8113641
    2.528547  ]
  [-0.6054805   0.17777057 -0.3048614  ... -3.8101263   0.3146161
    0.12864286]]

 [[-1.0738883   0.71441406  1.033029   ...  2.1741903  -0.05606913
   -2.216511  ]
  [ 2.8600929   2.6552117   1.1548573  ...  0.5743336  -0.509936
   -1.0215002 ]
  [-0.76020247 -2.2237751  -0.00880839 ... -1.8565425   0.76902795
    1.1017361 ]
  [ 0.56063336  2.2217882   1.0828176  ...  1.7795793  -0.5760088
    1.1000314 ]
  [-0.13495904 -2.4847577  -0.8736485  ... -0.48269773  0.6778818
    1.9465017 ]]]
q.shape5: (4, 5, 256)
q.shape6: (4, 8, 5, 32)
attn_res: [[[[-3.11466146e+00 -4.94310409e-02  2.41583332e-01 ... -5.47118604e-01
    -7.93433428e-01 -1.44048834e+00]
   [-1.54133439e-01 -5.38820386e-01 -2.57655978e-01 ...  1.10009098e+00
    -1.65995216e+00 -1.48950541e+00]
   [-3.64273429e-01 -1.24552703e+00  1.04929358e-02 ...  6.04958475e-01
    -4.68437016e-01 -1.40291762e+00]
   [-3.58640134e-01 -7.59201050e-01 -7.56588936e-01 ... -4.97009680e-02
    -7.98570812e-02 -2.42486984e-01]
   [ 7.26029217e-01 -1.85659313e+00  7.48339891e-02 ... -5.92214823e-01
     6.36798143e-01 -3.18572700e-01]]

  [[ 7.10569501e-01  1.27802145e+00  3.61967421e+00 ... -3.83061856e-01
    -7.87928224e-01  2.98055261e-01]
   [-1.52036715e+00  1.23150754e+00  1.62441552e-01 ...  1.51386768e-01
     1.39424396e+00 -1.07207119e+00]
   [-2.28761137e-02  1.41092753e+00  2.00461555e+00 ... -2.53508806e-01
     1.64330900e-01  2.38279514e-02]
   [ 9.82197672e-02  1.10592890e+00  8.16541493e-01 ...  1.86128557e-01
    -3.68099749e-01  1.24618568e-01]
   [-2.23779416e+00  1.26761422e-01 -2.59378457e+00 ... -2.66857624e-01
    -6.14225209e-01 -9.11136508e-01]]

  [[ 8.99731874e-01 -1.07991453e-02  1.42772889e+00 ... -1.69819966e-01
     1.02373290e+00 -7.14466751e-01]
   [ 1.17343092e+00  3.11095476e-01  1.36215556e+00 ...  2.87827909e-01
     7.72627831e-01 -4.84830737e-01]
   [ 7.31312931e-01  1.21530458e-01  1.38633668e-01 ...  1.78513980e+00
     1.17226943e-01 -7.24777102e-01]
   [ 2.10355818e-01  1.22138947e-01  4.42859605e-02 ...  3.60352397e-01
    -3.46193723e-02 -3.41845080e-02]
   [ 6.05590045e-02  3.29559922e-01 -1.59163773e-01 ...  1.47683668e+00
    -2.33353421e-01 -3.06560755e-01]]

  ...

  [[ 1.42704010e-01  2.50247121e+00  6.64162517e-01 ...  7.44760454e-01
     3.16121960e+00 -3.60760748e-01]
   [ 1.03162535e-01  1.80906820e+00  4.80131537e-01 ...  5.38396776e-01
     2.28528571e+00 -2.60798514e-01]
   [-6.79503500e-01  1.34643376e+00  1.26748252e+00 ...  2.48357916e+00
     3.92316699e-01 -3.16055822e+00]
   [-6.57318711e-01  1.25533545e+00  1.19117737e+00 ...  2.33801246e+00
     3.23889941e-01 -3.00710702e+00]
   [-1.45901513e+00 -3.98268759e-01  1.23138571e+00 ... -1.56149244e+00
    -2.58101940e+00 -5.43274730e-02]]

  [[-5.22160172e-01  7.45041132e-01  3.46485704e-01 ... -2.68873048e+00
    -5.65279007e-01 -1.05369818e+00]
   [-5.07040858e-01 -2.46965349e-01  3.64371121e-01 ...  1.21229160e+00
     4.52636182e-01  6.64585233e-01]
   [-5.00843585e-01  6.52725875e-01  3.34121555e-01 ... -2.33510256e+00
    -4.78317708e-01 -9.03026342e-01]
   [-5.64396322e-01 -6.39362752e-01  3.46254647e-01 ...  3.57830554e-01
     1.74194288e+00  6.35067880e-01]
   [ 4.92983431e-01  2.17557743e-01  3.73952359e-01 ...  3.90747845e-01
     1.19848943e+00  8.25131595e-01]]

  [[ 1.25885761e+00  2.37093225e-01  1.50933599e+00 ...  1.53495157e+00
    -1.97094440e+00 -5.07596135e-01]
   [-1.00335407e+00 -1.30772591e+00 -3.62628996e-01 ... -1.74420285e+00
    -1.00987256e-01  3.68729234e-04]
   [ 5.24201632e-01 -4.69439000e-01  1.35764897e+00 ...  5.38626909e-01
    -1.29833162e+00 -4.25298274e-01]
   [-1.67635417e+00 -1.56757116e+00 -9.96847212e-01 ... -3.09978390e+00
     3.47793698e-01  7.86297381e-01]
   [-1.68750241e-01 -1.01170743e+00  9.97951329e-01 ... -4.34022486e-01
    -7.33024001e-01 -2.91181803e-01]]]


 [[[ 1.98240411e+00  2.36497116e+00  9.78774965e-01 ...  6.22272074e-01
    -5.47697902e-01 -8.65370810e-01]
   [-9.20031786e-01  6.39004588e-01 -1.98978412e+00 ... -2.13265467e+00
     2.22274160e+00  1.59751976e+00]
   [-7.13431656e-01 -5.32401025e-01 -5.81680715e-01 ... -1.64823401e+00
     1.78782368e+00  1.11341095e+00]
   [-1.67085707e+00  7.69821942e-01  3.10820997e-01 ... -2.63037014e+00
     2.12040663e+00 -4.81274456e-01]
   [-7.11710334e-01  1.37123084e+00 -4.24893141e-01 ... -1.79182208e+00
     2.00568295e+00  9.13706422e-03]]

  [[-8.22070241e-01 -3.10668111e+00  1.32660973e+00 ...  1.79480195e+00
    -1.47816074e+00 -7.83999681e-01]
   [-3.85663927e-01 -2.28435469e+00  1.06179094e+00 ...  1.89647567e+00
    -1.42230904e+00 -4.85296488e-01]
   [ 4.64669287e-01  4.23306644e-01 -4.16204594e-02 ...  6.85007095e-01
    -3.39180321e-01  2.53784478e-01]
   [-5.75804472e-01  1.54159713e+00  1.27917960e-01 ...  1.42353606e+00
    -4.08685297e-01  1.20055330e+00]
   [ 6.48671389e-02 -1.17038265e-01 -1.80253237e-01 ...  1.35275915e-01
    -2.98758060e-01 -1.88518316e-02]]

  [[-2.48900318e+00 -1.79340458e+00  1.46385944e+00 ... -4.25349522e+00
     8.31379175e-01 -1.33566833e+00]
   [-1.91511071e+00 -1.11322927e+00  1.39523792e+00 ... -2.31934738e+00
     5.93779743e-01 -8.32189798e-01]
   [-1.35679638e+00  1.17934239e+00 -1.08496892e+00 ...  3.04682016e+00
     1.72471225e+00 -2.00169635e+00]
   [-2.34681845e+00 -1.66831744e+00  1.35971642e+00 ... -3.95463753e+00
     7.97538340e-01 -1.27326798e+00]
   [-6.16988540e-01  8.17987382e-01 -1.21185064e+00 ... -2.54861742e-01
     1.86149514e+00 -1.82174730e+00]]

  ...

  [[ 5.76521456e-01 -3.92353088e-01  1.43735790e+00 ... -1.18458259e+00
    -2.28447390e+00  7.48842582e-02]
   [ 7.80181229e-01 -4.10023540e-01 -6.32057786e-02 ...  7.83332646e-01
    -1.88871014e+00  1.06960392e+00]
   [ 7.44099736e-01 -4.10895854e-01  1.97392613e-01 ...  4.58842397e-01
    -1.94836152e+00  8.86235416e-01]
   [ 7.96470881e-01 -2.88415790e-01  2.96489060e-01 ...  7.64555156e-01
    -1.29488182e+00 -1.11680292e-01]
   [ 1.94414103e+00  1.13342083e+00 -5.95714033e-01 ... -2.97990561e-01
    -1.32569408e+00 -1.22430027e+00]]

  [[ 2.91115761e-01  6.50435209e-01 -6.58972025e-01 ... -3.63634616e-01
     7.90442407e-01 -3.40523630e-01]
   [-1.49780440e+00 -2.08002210e-01 -1.05220747e+00 ... -1.61240637e+00
     1.49100029e+00 -5.40977359e-01]
   [-2.62271500e+00 -7.56966591e-01 -1.28651452e+00 ... -2.38749290e+00
     1.91530311e+00 -6.60333931e-01]
   [-1.58377862e+00  1.31747532e+00 -9.54089046e-01 ... -6.58811748e-01
    -4.80028033e-01  4.32858855e-01]
   [-1.33591378e+00  3.85393739e-01 -1.93275487e+00 ... -1.23643827e+00
    -9.63086247e-01  1.89173549e-01]]

  [[ 2.14759231e+00 -1.80004859e+00  1.37028801e+00 ...  8.66575003e-01
     6.01693869e-01 -1.68666077e+00]
   [-1.71106982e+00  3.06991839e+00  9.88401234e-01 ...  6.16316557e-01
     1.84107348e-02  2.30640459e+00]
   [ 1.20016396e+00 -1.53058755e+00  1.51128340e+00 ... -4.45940316e-01
    -4.42036688e-02 -9.69887435e-01]
   [-6.57857299e-01  3.50680470e-01  1.17873466e+00 ...  2.36186504e+00
     6.05038166e-01  6.33921385e-01]
   [ 1.70622021e-01 -8.15773249e-01  1.14553964e+00 ...  1.38449168e+00
     7.17540979e-01 -1.73747867e-01]]]


 [[[-3.67517084e-01 -1.40418863e+00  1.02650535e+00 ... -8.60561490e-01
    -9.43708777e-01 -1.32589245e+00]
   [-3.50008190e-01 -1.41935909e+00  9.73468006e-01 ... -8.46074045e-01
    -8.86522770e-01 -1.27177203e+00]
   [ 7.83082724e-01 -2.00344682e+00 -1.88881493e+00 ... -3.88607159e-02
     2.34341359e+00  1.77701211e+00]
   [ 3.90875041e-01 -7.95274734e-01  7.76221037e-01 ... -6.76689208e-01
    -1.26491010e-01 -5.77881813e-01]
   [ 4.48033392e-01 -1.60959435e+00  6.72407568e-01 ... -5.22725344e-01
     1.60026893e-01 -2.72072792e-01]]

  [[-5.39161026e-01  2.96989173e-01 -8.23955461e-02 ... -6.77895188e-01
    -4.52504814e-01  2.29103971e+00]
   [-1.60945177e-01  3.41772199e-01 -3.24435949e-01 ... -7.07404852e-01
    -4.33353394e-01  2.01006413e+00]
   [ 5.02131045e-01 -8.21846485e-01 -4.07579750e-01 ... -1.35958540e+00
    -2.11586237e-01  4.77948070e-01]
   [ 2.66448617e+00  6.79302812e-01 -2.13107491e+00 ... -9.20728505e-01
    -2.85683483e-01 -1.00039862e-01]
   [ 6.31719172e-01  3.17180133e+00  1.69111097e+00 ...  1.05471349e+00
     2.11248803e+00 -2.32341504e+00]]

  [[-8.56066644e-01 -1.59382463e+00 -1.08180845e+00 ...  1.21520996e+00
     9.94748652e-01 -5.53020239e-01]
   [-1.76135525e-01 -2.28271455e-01 -4.72627312e-01 ...  1.80150151e-01
     4.68136072e-02  6.29732907e-01]
   [-1.88834727e+00 -2.08168387e-01 -1.53490007e+00 ...  9.86128151e-01
    -2.65212834e-01  1.54030891e-02]
   [ 2.15790465e-01 -2.12610319e-01  7.00282693e-01 ...  2.04680252e+00
     1.92528591e-01 -9.17613924e-01]
   [ 6.62457347e-01  4.29701746e-01  1.56273031e+00 ...  1.69965780e+00
    -1.44403827e+00  2.66536260e+00]]

  ...

  [[-1.50541615e+00 -2.24150801e+00  1.67806053e+00 ...  4.03206974e-01
     1.34031808e+00  5.02510607e-01]
   [-9.32889760e-01 -8.62455904e-01  8.38189244e-01 ...  9.62813556e-01
     1.94562042e+00  2.70830989e-01]
   [-1.28229856e+00 -2.16257834e+00  1.67762601e+00 ...  6.09024405e-01
     1.27218783e+00  1.50803059e-01]
   [-1.68889701e-01 -5.31103790e-01  4.64334726e-01 ...  3.46396595e-01
     3.03183436e-01 -2.53575563e-01]
   [-7.98607647e-01 -1.12384450e+00  1.06819260e+00 ...  1.07787192e+00
     1.48929131e+00 -7.29527995e-02]]

  [[ 1.16975546e+00  8.52428302e-02  7.00532615e-01 ... -5.54131389e-01
     1.03104329e+00 -2.38283873e+00]
   [ 4.80588347e-01  3.50216031e-02  2.87810415e-01 ... -2.27662161e-01
     4.23599094e-01 -9.78977680e-01]
   [ 2.71763325e+00  2.49664378e+00  1.31095922e+00 ...  8.35702002e-01
    -9.26792443e-01 -2.75247335e+00]
   [ 2.69006920e+00  2.46882892e+00  1.30883682e+00 ...  8.16583693e-01
    -9.15813386e-01 -2.75827241e+00]
   [ 7.16917217e-02  6.83280006e-02  6.26585186e-02 ...  1.55312046e-02
    -6.72882199e-02 -1.15202926e-01]]

  [[ 2.07357049e+00 -1.09168756e+00  1.14507961e+00 ...  1.32363662e-01
    -1.93942094e+00 -1.73903358e+00]
   [-2.94298863e+00  1.69582337e-01 -8.43151629e-01 ... -5.66726983e-01
    -1.32100856e+00  1.06696236e+00]
   [-4.92901325e-01 -1.58708179e+00  8.91523838e-01 ... -1.62351084e+00
     9.63014722e-01 -1.80368292e+00]
   [ 9.54022467e-01 -6.81930542e-01  6.33362830e-01 ... -3.19841728e-02
    -1.18372178e+00 -9.96272981e-01]
   [-2.04285574e+00 -5.96802235e-01 -1.70076087e-01 ... -1.13081515e+00
    -2.33272806e-01 -1.40713081e-01]]]


 [[[-1.36539125e+00  3.99001861e+00  1.82504904e+00 ...  2.71722007e+00
    -2.13403296e+00 -1.27270484e+00]
   [ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [-8.86147082e-01  3.31521010e+00 -1.27382085e-01 ...  2.10838199e+00
    -9.06850100e-01  5.18912494e-01]
   [ 6.41727030e-01  2.78322220e-01  8.15137148e-01 ...  4.87083197e-02
    -7.19945908e-01  2.27760822e-01]
   [ 4.04710025e-01 -2.65437365e-02  2.85599113e-01 ...  7.40594804e-01
    -4.04161453e-01 -4.56608355e-01]]

  [[-1.72874451e+00 -1.38999566e-01 -1.50308096e+00 ... -2.18552446e+00
    -9.65826750e-01  8.21308732e-01]
   [ 1.63499975e+00 -1.22317386e+00 -1.23824036e+00 ... -1.87219763e+00
    -3.46480608e+00  4.96511281e-01]
   [-1.54298425e+00 -1.09050408e-01 -1.43105137e+00 ... -2.07192707e+00
    -8.65790665e-01  7.70116389e-01]
   [ 9.80277807e-02 -7.82336593e-01 -1.30364287e+00 ... -1.72589326e+00
    -2.21849585e+00  3.31898272e-01]
   [-8.99630785e-02 -2.79522657e-01 -3.81900281e-01 ... -1.61646873e-01
    -4.30355459e-01 -3.61046791e-01]]

  [[-3.83048743e-01 -1.34622410e-01  5.23657739e-01 ...  2.00962234e+00
     4.01713324e+00  1.50390995e+00]
   [-3.14454138e-01  7.15992987e-01  4.84121084e-01 ... -1.46193922e-01
     2.25698161e+00  1.41382349e+00]
   [-1.43309578e-01  7.82568514e-01  3.17028344e-01 ... -9.00348067e-01
     6.60269499e-01  8.19622815e-01]
   [-2.93400913e-01 -2.19052285e-03  6.31414771e-01 ...  1.78829825e+00
     3.40895128e+00  1.32216918e+00]
   [-8.20415840e-03  8.44088733e-01  1.22677290e+00 ...  2.98329771e-01
     8.07278231e-02  3.69226307e-01]]

  ...

  [[-3.43964863e+00  1.76467967e+00 -4.91847187e-01 ... -2.94439507e+00
     6.36553438e-03 -2.25371647e+00]
   [-1.34280777e+00  1.11434019e+00 -2.17566937e-01 ... -2.61773348e+00
     1.16411412e+00 -1.89793897e+00]
   [-9.98304665e-01 -2.01299310e-01  2.06421638e+00 ... -2.28251982e+00
    -5.32287657e-01  1.19722819e+00]
   [-4.48342085e-01  4.94553089e-01  7.22635686e-01 ...  1.14879727e+00
     1.62489200e+00 -2.03462183e-01]
   [-7.67377734e-01 -6.41102344e-03  1.42898500e+00 ... -8.76620471e-01
     4.08493757e-01  5.40638626e-01]]

  [[ 2.49081564e+00  4.08738613e-01  2.92430639e-01 ...  1.94235575e+00
    -1.04949737e+00  3.23688745e+00]
   [ 2.38345766e+00  4.66665387e-01  2.88687021e-01 ...  1.91100168e+00
    -1.01226521e+00  3.14875817e+00]
   [ 2.71513134e-01  1.22993872e-01  4.10767645e-02 ...  2.66099036e-01
    -1.22710705e-01  4.06193972e-01]
   [ 2.39906907e+00  3.42722505e-01 -8.36200714e-02 ...  1.56130743e+00
    -1.00723565e+00  2.62545562e+00]
   [ 6.47639632e-01  4.78892803e-01 -1.17043853e+00 ...  3.30700099e-01
    -8.46445799e-01  1.55148673e+00]]

  [[-3.54359806e-01 -8.07993174e-01 -1.71507049e+00 ...  8.07633758e-01
     1.32376218e+00  1.29001403e+00]
   [-2.47105026e+00  6.66096866e-01 -6.42035723e-01 ...  2.40999937e-01
     1.53816772e+00  2.07757878e+00]
   [-6.61912262e-01 -4.33638692e-02 -5.70383847e-01 ...  2.54325092e-01
     6.82826221e-01  8.00043881e-01]
   [-3.89981240e-01 -5.16794622e-01 -1.28948712e+00 ... -1.43740320e+00
    -5.26798725e-01  1.43266052e-01]
   [-2.11889312e-01 -7.22048700e-01 -1.46256351e+00 ... -1.46668792e+00
    -3.91462624e-01  3.02782655e-02]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-True-32-8-27-5-8] q.shape1: (8, 5, 27)
q.shape2: (40, 27)
q.shape3: (40, 27)
q.shape4: (8, 5, 27)
q_liner: [[[ 0.15200193  0.42109507  0.1894755  ... -1.7429329  -0.88422495
   -0.3164864 ]
  [-0.7228274   0.49029985  0.58301187 ...  2.1885214  -0.0600438
    2.0428016 ]
  [-0.5260736   0.6122724   1.230041   ... -2.247764    0.22396035
   -1.7408255 ]
  [ 0.3971978   0.6543124   0.09537844 ...  1.0527573   2.5283172
    1.3539605 ]
  [-2.2944772  -1.2713732  -0.40413117 ... -2.6895072   1.2463971
    1.2484484 ]]

 [[-1.1593062  -0.88011456 -1.8108406  ... -1.7323458   1.1656864
   -0.8288701 ]
  [ 0.9558411  -0.23498295  2.5545673  ... -3.0560327  -2.0548532
   -2.2333834 ]
  [-1.7470474  -2.3977683  -2.3310997  ...  0.24311657 -0.14915945
    0.71529585]
  [ 0.89870685  1.1873523  -0.10763843 ...  2.5449615   0.67048955
    0.58401346]
  [ 2.0645623   0.3715976   0.32978135 ...  1.3476607   0.29302907
   -0.27270532]]

 [[-0.00490406 -0.09373393  1.1604989  ... -0.68984926  1.4405506
    0.73424846]
  [-0.04013184 -0.74264437  0.7171273  ...  0.84781003 -0.8189953
    1.0422674 ]
  [ 1.3068575   1.0912939  -0.5706339  ...  0.6620283   0.5126465
    1.2609537 ]
  [-1.4994874   1.0570575  -2.6855764  ...  1.986622    1.5518485
   -0.7573723 ]
  [ 1.1151257  -2.2495382   0.6445344  ... -1.7265897  -0.9692527
    1.5563262 ]]

 ...

 [[-1.2600608   0.42844245 -1.0461015  ...  0.4404278   0.8438228
    0.35004786]
  [-0.80994964  0.90170777 -1.5636967  ...  1.9153154   0.15813263
    0.75824195]
  [-0.41504437  0.5501679  -0.46502814 ...  1.3531638   0.20270535
   -1.1872677 ]
  [-2.140977   -1.8058908  -2.543361   ... -1.3188152  -0.2109273
    3.014104  ]
  [ 0.30165464 -1.7570784  -0.5276766  ... -0.95511556  0.6305223
    2.6884043 ]]

 [[ 0.54159     2.0929532   1.2214144  ...  1.3534613  -2.23457
   -3.0139523 ]
  [-0.41575354  1.8297943   0.4623497  ... -0.0106837   0.28909513
   -1.1019404 ]
  [ 1.7901554  -2.319938    0.07372504 ...  1.7785084  -2.0408728
   -0.50145024]
  [-3.2801116   0.87907857  1.1032302  ...  1.1696819   2.6237779
   -2.4771411 ]
  [ 2.1882672   2.8574078   1.3916488  ... -0.65159124  0.67476016
   -2.5030303 ]]

 [[-0.2869474   0.19633447  1.8981183  ...  1.5710847  -1.9368707
    0.45920563]
  [ 1.1749982   0.24199866 -1.4054803  ...  0.47076377  0.1422315
    2.097656  ]
  [ 1.5478255   2.0425947   0.8884625  ... -1.2721355  -1.8794547
   -1.3773708 ]
  [-0.51357377  1.8262048   0.93602985 ... -1.289328    1.1409357
   -3.3090458 ]
  [-0.5917449   1.1871253   0.05737568 ...  2.3166168   0.7226818
    1.4457972 ]]]
q.shape5: (8, 5, 256)
q.shape6: (8, 8, 5, 32)
attn_res: [[[[-2.85531402e-01  2.69219112e+00 -7.05115914e-01 ... -2.20056581e+00
    -1.42207849e+00 -1.50255430e+00]
   [-6.32570982e-01  1.76571095e+00 -4.64479327e-02 ... -1.14658058e+00
    -4.14379686e-01 -2.16777921e-02]
   [-3.13729465e-01  2.60178232e+00 -6.67155862e-01 ... -2.16729856e+00
    -1.35023570e+00 -1.52036202e+00]
   [-9.84656453e-01  7.61677384e-01  6.28505826e-01 ... -7.17819408e-02
     6.34186149e-01  1.41396189e+00]
   [-1.51927316e+00 -9.22151327e-01  1.73579907e+00 ... -7.86341071e-01
    -2.56200767e+00 -1.83339536e-01]]

  [[-3.77448559e+00  7.22709358e-01 -8.97636414e-01 ...  9.43689644e-01
     5.43996215e-01 -1.92996919e+00]
   [ 7.13844717e-01 -8.01756620e-01  1.20674932e+00 ...  2.63547838e-01
    -1.71980464e+00  2.24513197e+00]
   [-3.60838938e+00  6.15327179e-01 -9.31630433e-01 ...  8.98586392e-01
     4.57177579e-01 -1.67624974e+00]
   [-7.51432180e-01 -2.75024891e-01 -5.28424919e-01 ...  4.09465194e-01
    -4.96362954e-01  1.15575826e+00]
   [-4.83743429e-01 -1.88921642e+00  2.34787488e+00 ...  1.00146413e-01
     7.23218322e-01 -8.22387099e-01]]

  [[ 1.98329806e+00 -2.41091871e+00  5.08558631e-01 ... -2.54115391e+00
     2.47379947e+00  7.55731985e-02]
   [ 1.82857132e+00  4.29029137e-01 -9.30722117e-01 ...  7.73959637e-01
    -1.34891343e+00  4.96356821e+00]
   [ 1.98063052e+00 -2.39932299e+00  5.02750576e-01 ... -2.52799726e+00
     2.45820856e+00  9.48263705e-02]
   [ 8.55044663e-01  1.34234810e+00 -7.73616076e-01 ...  1.31956363e+00
    -9.07663852e-02  8.06150913e-01]
   [ 1.85538530e+00 -1.15247023e+00 -8.48981589e-02 ... -1.11463141e+00
     9.58380818e-01  1.81480324e+00]]

  ...

  [[-6.25429690e-01  6.63461566e-01 -3.00163245e+00 ...  6.27778769e-02
    -2.25764871e+00  8.06122601e-01]
   [-4.13069427e-02  6.68921947e-01 -2.35185790e+00 ... -3.56462263e-02
    -1.92940402e+00  9.97143865e-01]
   [ 2.26247489e-01  7.79640913e-01 -2.84591317e-02 ... -3.89249742e-01
    -1.12013721e+00  1.63795137e+00]
   [-6.13659441e-01  8.79813969e-01  2.06929222e-02 ... -3.10365260e-01
    -1.27923250e+00  1.46296525e+00]
   [ 8.90627682e-01  1.10978281e+00  2.63335139e-01 ...  1.23735256e-01
    -8.96514297e-01  6.44213319e-01]]

  [[ 3.14210415e-01  6.14732265e-01 -1.81110144e+00 ... -2.07979038e-01
    -3.98098540e+00  1.43709564e+00]
   [-5.86282432e-01 -8.06382060e-01 -1.68956161e-01 ...  2.56740823e-02
    -3.03501153e+00  2.00216579e+00]
   [ 2.23912549e+00 -6.07160211e-01  1.01277553e-01 ... -8.60611916e-01
    -4.74129796e-01  1.76457572e+00]
   [-7.76194990e-01 -1.57274270e+00  8.21185708e-01 ...  1.18154585e+00
     8.45841527e-01 -7.61916041e-02]
   [ 9.05522346e-01 -4.19143707e-01 -5.88508606e-01 ... -4.08015043e-01
    -1.37996089e+00  1.36521518e+00]]

  [[ 2.03462052e+00 -4.06877708e+00 -5.07656872e-01 ...  3.58838916e+00
     5.27664423e-01 -3.68832159e+00]
   [ 6.17803991e-01 -2.99872208e+00  3.61176044e-01 ...  1.64964581e+00
     5.53493977e-01 -2.11224294e+00]
   [ 1.20093334e+00 -2.59716463e+00 -1.27141130e+00 ...  2.75666738e+00
    -4.75202650e-02 -2.67876077e+00]
   [ 1.32761025e+00 -1.78774226e+00 -5.41534543e-01 ...  2.22842216e+00
    -9.86781865e-02 -1.63601184e+00]
   [ 1.41269803e+00 -2.13634777e+00 -1.56220889e+00 ...  2.89517426e+00
    -2.65740365e-01 -2.41635561e+00]]]


 [[[ 4.71318752e-01 -8.93623888e-01  1.30160117e+00 ...  1.27133057e-01
    -1.44584310e+00 -1.67781484e+00]
   [ 1.34187296e-01  6.06338799e-01  7.94616342e-01 ...  1.13006747e+00
     6.45395875e-01  1.49260271e+00]
   [ 8.72777104e-02  7.69713700e-01  6.30427599e-01 ...  1.28724682e+00
     8.91090989e-01  1.80132186e+00]
   [ 8.51773832e-04  8.32153298e-03  7.24737160e-03 ...  1.28572881e-02
     9.58935544e-03  1.97125934e-02]
   [-5.50263375e-02  2.72363782e-01  5.47402918e-01 ...  1.12755448e-01
     5.87405503e-01  3.55976880e-01]]

  [[ 2.39387095e-01 -1.93955708e+00  1.09751868e+00 ... -4.53254998e-01
     2.12689972e+00 -1.60217667e+00]
   [ 3.54142636e-01 -1.91113758e+00  9.45200205e-01 ... -7.93717384e-01
     2.14330053e+00 -8.98502052e-01]
   [-1.98133290e-02 -9.68567252e-01 -2.20920742e-02 ... -1.85294747e+00
     2.05010629e+00  8.59636068e-03]
   [-1.58162303e-02 -2.54743427e-01  1.12559937e-01 ... -1.60492450e-01
     3.83261293e-01 -2.92659312e-01]
   [ 1.90701842e-01 -1.01905978e+00 -9.67948377e-01 ...  2.29230076e-01
     1.99627018e+00 -1.18162923e-01]]

  [[-7.27827474e-02 -1.61262655e+00  1.14025509e+00 ... -1.08142221e+00
    -1.15989506e+00 -5.14200367e-02]
   [-9.05602336e-01 -3.07395697e-01  3.32278705e+00 ... -1.52635646e+00
    -5.87428570e-01  1.36048162e+00]
   [-1.02690637e-01 -1.56264746e+00  1.21692514e+00 ... -1.09552503e+00
    -1.13716030e+00 -4.01914120e-04]
   [-3.42318445e-01 -1.10669363e+00  1.55814111e+00 ... -1.25003290e+00
    -6.83699131e-01  3.26158136e-01]
   [-1.13445342e+00  1.15297294e+00  1.47226393e-01 ... -1.28299499e+00
    -1.11397648e+00  1.40048325e+00]]

  ...

  [[-7.41986096e-01 -8.31632257e-01  1.94829023e+00 ... -1.76745510e+00
    -8.02157819e-01  4.00118530e-01]
   [-6.01825595e-01 -7.75156319e-01  1.88816667e+00 ... -1.93073273e+00
    -5.93675375e-01  3.29098254e-01]
   [-8.05798292e-01 -7.52087414e-01  1.47922146e+00 ... -1.88832903e+00
    -1.74110413e-01  7.12585926e-01]
   [ 6.10189848e-02 -3.93686622e-01  1.30785882e+00 ... -2.78190875e+00
     8.21734369e-01  1.25850797e-01]
   [-2.63329089e-01  4.03477550e-01 -5.10378927e-02 ... -7.90628195e-01
     1.18057799e+00  4.98212904e-01]]

  [[ 9.08309594e-02  2.27096009e+00 -1.58781528e+00 ... -1.51047671e+00
     3.27231824e-01  1.72770524e+00]
   [-1.07279861e+00  2.01589894e+00 -4.30161595e-01 ...  3.57013285e-01
     6.77739084e-01 -4.51942056e-01]
   [-7.49187708e-01  1.23530900e+00 -2.95299798e-01 ...  5.83371401e-01
     9.25756335e-01 -8.07508528e-02]
   [-2.39448138e-02 -2.10379690e-01 -5.43020964e-02 ...  8.73366475e-01
     1.38661814e+00  7.56279171e-01]
   [-6.35092616e-01  1.32872605e+00 -3.59897390e-02 ...  6.14219248e-01
     9.03942704e-01 -2.40375251e-01]]

  [[-2.21766520e+00  2.95918655e+00  9.69152272e-01 ...  2.29393244e-02
    -1.70641804e+00  7.02791512e-02]
   [-1.93797785e-03  2.58598011e-03  8.46924842e-04 ...  2.00462655e-05
    -1.49120810e-03  6.14156961e-05]
   [-2.19820452e+00  2.93884492e+00  9.64402974e-01 ...  8.37390497e-03
    -1.69069815e+00  6.56412393e-02]
   [-1.73947155e+00  1.41059756e+00  1.11855984e+00 ... -1.47189593e+00
    -3.34458798e-01  1.81945240e+00]
   [-2.11106449e-01  9.72933054e-01  2.30577797e-01 ... -7.51821637e-01
    -4.36588287e-01 -9.91975605e-01]]]


 [[[-7.40304410e-01  5.13094902e-01 -6.82792783e-01 ... -1.52381265e+00
     1.05792427e+00 -1.49076867e+00]
   [-6.62660122e-01  4.59280729e-01 -6.11180425e-01 ... -1.36399281e+00
     9.46967542e-01 -1.33441448e+00]
   [ 1.19762361e+00  2.71913648e-01  1.36885667e+00 ... -8.87349010e-01
     3.90216887e-01  7.83191144e-01]
   [-7.54301906e-01  6.04002059e-01 -5.69832861e-01 ... -1.43584812e+00
     1.07614541e+00 -1.50719488e+00]
   [-6.78007782e-01  2.00772658e-01 -3.48231733e-01 ...  4.65626597e-01
    -1.41909689e-01  4.92866635e-01]]

  [[-7.71869659e-01 -3.92125010e-01 -4.26876694e-01 ...  2.21506819e-01
    -5.34757614e-01  2.06072140e+00]
   [ 1.59251720e-01 -1.39173836e-01  2.44902015e-01 ... -1.23334050e-01
    -2.92226553e-01  1.41340041e+00]
   [ 2.20877245e-01 -7.90901721e-01 -5.91926694e-01 ...  2.43997201e-01
     1.48744130e+00  1.07144320e+00]
   [ 6.62061214e-01  3.50848496e-01 -9.27644521e-02 ...  6.49205625e-01
     1.50612462e+00  7.76194215e-01]
   [ 1.03609276e+00  1.46909416e-01  4.90032554e-01 ...  9.44002569e-02
     5.08877218e-01  1.01282626e-01]]

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [ 1.22983062e+00  1.26645219e+00 -2.73369932e+00 ...  1.41376865e+00
     9.92543459e-01 -3.72253925e-01]
   [ 1.20474851e+00 -5.49305618e-01 -2.13632059e+00 ... -2.25324094e-01
     1.37045622e+00 -5.94478130e-01]
   [ 2.04944563e+00  1.32423389e+00 -4.01331097e-01 ...  1.37080777e+00
    -1.18255563e-01  8.27286601e-01]
   [-3.90146106e-01 -1.90815759e+00  5.54318875e-02 ...  6.49592996e-01
     6.02563083e-01  1.05887443e-01]]

  ...

  [[ 8.18486273e-01 -1.16572356e+00  8.87063205e-01 ...  2.10855889e+00
    -8.41646969e-01 -3.78957599e-01]
   [ 4.96204168e-01 -1.55217886e+00 -2.29434013e-01 ...  1.33450377e+00
    -5.34057319e-01 -1.11696446e+00]
   [-1.11310378e-01 -1.98075986e+00 -2.03733444e+00 ... -1.07587621e-01
     4.13264669e-02 -2.17504120e+00]
   [-7.22192764e-01 -1.71081090e+00 -9.57641184e-01 ...  4.52065825e-01
    -2.63726830e-01 -7.82476127e-01]
   [-3.78970146e-01 -8.74397814e-01 -1.05379856e+00 ... -2.24606991e-01
    -2.56512836e-02 -1.01407218e+00]]

  [[ 1.50253261e-02 -2.30341887e+00  1.45531595e+00 ...  1.21479750e-01
    -4.10066128e+00  1.14953387e+00]
   [-2.00580525e+00  5.23970544e-01 -1.96023488e+00 ...  6.11358345e-01
    -1.34154844e+00  1.72360075e+00]
   [-5.61798632e-01 -9.83919024e-01  1.59332991e-01 ...  2.33217344e-01
    -2.39701247e+00  1.05433893e+00]
   [-6.35422766e-01  9.51812863e-01 -1.28315985e+00 ... -1.68607801e-01
    -9.61931527e-01  1.13656211e+00]
   [-1.59794271e+00  8.65600765e-01 -1.85225880e+00 ...  4.02066767e-01
    -8.28197002e-01  1.45621789e+00]]

  [[-9.98441756e-01  1.51268101e+00 -1.07151294e+00 ... -9.26277936e-01
     1.14997387e+00  2.13104948e-01]
   [-2.33805704e+00  2.14042044e+00  2.88553452e+00 ... -2.85430813e+00
    -1.34540647e-01  8.41024876e-01]
   [-2.70607416e-02  1.87333953e-02  2.15611886e-03 ... -3.23955715e-02
     2.53775977e-02  1.94294727e-03]
   [-1.16940379e+00  1.34904110e+00 -6.66012943e-01 ... -1.21200871e+00
     1.23865020e+00  1.73829943e-01]
   [-2.37217331e+00  1.97651720e+00  3.08051705e+00 ... -2.64595485e+00
    -1.10145837e-01  7.93674767e-01]]]


 ...


 [[[ 5.69146276e-01  2.95203733e+00 -5.87562263e-01 ... -1.11750185e+00
     2.73155260e+00  1.37862122e+00]
   [ 2.71376073e-01  1.61988938e+00 -7.42670357e-01 ... -8.91571581e-01
     6.77134633e-01  1.64267969e+00]
   [ 5.81468046e-01  2.84077120e+00 -6.07209027e-01 ... -1.08300006e+00
     2.61719203e+00  1.35957277e+00]
   [ 1.83369470e+00  1.58039570e-01 -1.23865604e+00 ...  1.16603948e-01
     1.30231524e+00 -2.21811280e-01]
   [ 6.77521229e-01 -1.55961365e-01 -9.86958146e-01 ... -2.54126668e-01
    -7.06388175e-01  9.46394920e-01]]

  [[-3.14285183e+00 -8.34112540e-02 -2.97251725e+00 ... -6.89057410e-01
    -1.58198392e+00  1.16413164e+00]
   [-1.84047651e+00 -3.03004414e-01 -1.74632037e+00 ...  5.28462768e-01
    -1.60463023e+00  6.01364911e-01]
   [-2.82740211e+00 -1.53381139e-01 -2.66028953e+00 ... -3.86571825e-01
    -1.50828838e+00  9.15215731e-01]
   [-1.58174479e+00 -5.04268527e-01 -1.41123891e+00 ...  7.84100294e-01
    -7.26876855e-01 -6.52429044e-01]
   [-2.80018115e+00 -4.71778780e-01 -2.39926791e+00 ... -3.57245326e-01
     3.01699072e-01 -1.46618152e+00]]

  [[-1.03486145e+00  9.70804155e-01  1.63316524e+00 ... -4.15153551e+00
    -5.61976731e-01 -5.11659622e-01]
   [-2.56127030e-01 -1.32596838e+00  2.03031540e+00 ...  5.00007391e-01
     1.94122481e+00  2.40137124e+00]
   [-4.38831002e-02 -4.84191567e-01  1.73454630e+00 ...  2.46426389e-01
     9.71697569e-01  1.79329646e+00]
   [-2.06808627e-01 -9.60563064e-01  1.44210565e+00 ...  9.60444510e-02
     7.39737689e-01  1.46626687e+00]
   [-6.68484986e-01  9.69550610e-02  1.29666662e+00 ... -2.34739017e+00
    -1.82573318e-01 -5.11338897e-02]]

  ...

  [[ 1.91192412e+00  2.39865708e+00 -1.22130655e-01 ... -8.86377394e-01
    -1.81831002e+00  4.91194725e-01]
   [ 1.53217280e+00  2.25040269e+00 -1.85338035e-01 ... -8.81073415e-01
    -1.89146066e+00  5.12907267e-01]
   [ 1.78592956e+00  2.31523943e+00 -7.31390864e-02 ... -8.94940019e-01
    -1.70660996e+00  5.07902503e-01]
   [-1.21847463e+00  1.16582918e+00 -6.40308976e-01 ... -8.37075055e-01
    -2.40711975e+00  6.66279495e-01]
   [-1.70389736e+00  3.25167775e-01 -8.97205949e-01 ... -5.32570660e-01
    -1.89658213e+00  5.90738416e-01]]

  [[-9.76650640e-02  3.86900485e-01  6.00566268e-01 ... -2.98781186e-01
    -2.57238865e-01  6.89770162e-01]
   [-1.21664867e-01  4.05651957e-01  6.07692122e-01 ... -2.97384322e-01
    -3.84465694e-01  7.17517614e-01]
   [ 8.53619725e-02 -2.29492474e+00  1.02992737e+00 ...  1.06797826e+00
    -1.18828022e+00  1.31090546e+00]
   [ 2.78447449e-01 -1.70974493e+00  7.21431673e-01 ...  6.57173634e-01
    -7.63125181e-01  1.06190383e+00]
   [ 1.28324020e+00  1.20102739e+00 -6.55369639e-01 ... -1.24757588e+00
    -3.20725679e-01  2.41783798e-01]]

  [[ 4.87220466e-01 -3.33908558e+00 -7.63660550e-01 ... -2.24332023e+00
    -1.05899119e+00 -9.41444695e-01]
   [-2.69639462e-01 -2.22694182e+00  1.48544014e-02 ... -3.54783773e-01
    -9.28331494e-01  2.13149250e-01]
   [-3.52080822e-01 -1.55262411e+00 -2.24960268e-01 ...  6.38807178e-01
    -8.00739467e-01  5.97951949e-01]
   [ 5.24602532e-01 -2.69985819e+00 -1.26328290e+00 ... -1.30444992e+00
    -7.37598240e-01 -1.03816473e+00]
   [ 2.79625237e-01 -4.70949233e-01 -1.18477643e+00 ...  5.70670605e-01
    -3.40700001e-02 -4.24959600e-01]]]


 [[[ 1.88525140e-01 -2.57467175e+00 -8.81884754e-01 ...  1.40706265e+00
    -5.59807718e-01 -1.58409178e+00]
   [ 9.05615807e-01 -2.08594346e+00 -5.26774585e-01 ...  1.43310994e-01
    -4.39803123e-01 -4.84051704e-02]
   [ 2.07502618e-01  5.74444570e-02 -1.60917655e-01 ... -5.94622679e-02
     5.70736468e-01  6.22955322e-01]
   [-1.16688776e+00  2.83476520e+00  6.44793510e-01 ...  3.83810282e-01
     3.10543537e+00 -1.27465874e-01]
   [ 1.54935753e+00 -9.17498946e-01  8.63834992e-02 ... -3.01427722e-01
     2.13378048e+00 -1.45208740e+00]]

  [[ 1.83410659e-01  1.54116917e+00 -1.62550181e-01 ...  5.18308043e-01
    -2.39024520e+00  1.66355968e+00]
   [ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [ 2.41365552e+00 -1.89522111e+00  9.08841968e-01 ... -5.77095151e-01
    -5.57896852e-01 -5.68771541e-01]
   [ 2.30960989e+00 -1.74861562e+00  8.75012398e-01 ... -5.22083104e-01
    -6.20220900e-01 -4.69015568e-01]
   [-2.64424276e+00 -3.10030007e+00  1.86250186e+00 ...  3.69168162e-01
     1.19681096e+00  3.10399175e-01]]

  [[-2.88584971e+00 -2.87206173e-01 -1.73950449e-01 ... -5.28070807e-01
    -6.99624181e-01  9.66182053e-01]
   [-1.25225174e+00  2.46007299e+00  4.43622798e-01 ...  2.66836405e+00
    -4.46317494e-01  1.87234235e+00]
   [ 6.60178512e-02  2.23101211e+00 -3.49445552e-01 ...  1.40356338e+00
    -6.79942966e-01  1.99007440e+00]
   [ 1.19293481e-03  9.68705475e-01 -2.51973927e-01 ... -1.45759213e+00
    -1.10324033e-01  6.47129893e-01]
   [ 1.73754960e-01  1.97224009e+00 -5.50037026e-01 ...  8.60859752e-01
    -6.34516895e-01  1.85537243e+00]]

  ...

  [[-7.22590864e-01 -8.61469686e-01  5.07493198e-01 ... -1.20267022e+00
    -1.70957828e+00  2.15579033e+00]
   [-7.21042335e-01 -8.55435967e-01  5.09348869e-01 ... -1.19294691e+00
    -1.68687737e+00  2.13393855e+00]
   [-3.17400813e-01 -5.97647250e-01  3.56065154e-01 ... -9.46327090e-01
    -1.42023599e+00  1.71366179e+00]
   [-3.80094737e-01 -5.78642726e-01  4.26756293e-01 ... -1.06715548e+00
    -1.45576465e+00  1.82335269e+00]
   [-1.64514735e-01  5.03774524e-01  7.76873052e-01 ...  6.31641328e-01
     2.59842205e+00 -2.05125713e+00]]

  [[ 1.58408964e+00 -3.46379936e-01 -1.30211580e+00 ... -8.20137739e-01
    -1.89749980e+00  2.70986676e+00]
   [-6.33375525e-01 -9.65298563e-02  3.96263897e-02 ...  7.46989608e-01
     4.78298753e-01 -4.74920928e-01]
   [ 2.18549907e-01 -1.25277877e-01 -3.38238269e-01 ...  2.50192583e-02
    -3.54236066e-01  5.74521661e-01]
   [ 2.02283263e-01 -2.90927261e-01 -3.87887120e-01 ...  1.35095537e-01
    -5.44052780e-01  7.59471655e-01]
   [ 9.12578225e-01 -3.12384903e-01  2.64984071e-01 ...  7.53181696e-01
    -1.30547047e+00  1.67893457e+00]]

  [[-6.06475294e-01  1.95157599e+00 -6.06737256e-01 ...  5.32386124e-01
    -9.27640140e-01 -2.10229850e+00]
   [-5.12153625e-01  1.86098981e+00 -2.59743631e-02 ... -7.55287051e-01
    -1.01627040e+00  4.58369017e-01]
   [-6.53602302e-01  6.24338508e-01  1.25347924e+00 ... -1.89358282e+00
     7.11325705e-01  1.93854213e+00]
   [-7.97744095e-01 -6.69054508e-01  2.06335235e+00 ... -2.07245350e+00
     2.59222531e+00  1.67841530e+00]
   [-6.03848279e-01  6.05419040e-01  8.55436087e-01 ... -4.58809525e-01
     8.83878112e-01 -1.13144875e-01]]]


 [[[ 1.13207221e+00  7.85829246e-01 -1.40907919e+00 ...  8.00258875e-01
     1.32074940e+00  7.41523683e-01]
   [-9.10228729e-01  1.66828930e-01 -1.41881034e-01 ... -1.57697177e+00
     5.17911553e-01 -1.12380540e+00]
   [ 5.25188804e-01  5.71883380e-01 -1.01651478e+00 ...  9.44653600e-02
     1.01334834e+00  5.98875210e-02]
   [ 1.12453485e+00  7.74188995e-01 -1.39918709e+00 ...  7.91919827e-01
     1.29639113e+00  6.95968747e-01]
   [ 3.72325182e-01  6.66710436e-01 -1.43515968e+00 ...  9.85215127e-01
    -6.56033456e-01  3.79763991e-01]]

  [[-8.80204558e-01  1.50134885e+00  1.62366867e+00 ... -9.26100731e-01
     2.95038080e+00 -1.89100254e+00]
   [-8.73497605e-01  1.29944503e+00  1.24452972e+00 ... -8.93126726e-01
     2.68922615e+00 -1.38624454e+00]
   [-8.76575291e-01  1.33205569e+00  1.29276574e+00 ... -8.98703337e-01
     2.72535586e+00 -1.46269500e+00]
   [-1.76500106e+00  2.55896688e+00 -2.12360692e+00 ... -1.18836558e+00
     1.58677626e+00 -2.35035753e+00]
   [-2.22056508e-02  1.28594726e-01 -1.04774106e+00 ... -8.93809021e-01
     1.17241353e-01  9.54924464e-01]]

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [ 1.73819423e+00 -6.55305460e-02  1.19282460e+00 ...  1.80252895e-01
    -8.50873590e-01 -1.49156642e+00]
   [ 1.90159655e+00  3.25262547e-01  1.50147128e+00 ...  7.12901831e-01
     1.62727803e-01 -7.92115688e-01]
   [ 7.32579529e-01  8.26676935e-02  1.05352318e+00 ... -1.22514144e-01
    -1.04542851e+00 -1.26955867e+00]
   [-5.30040443e-01  1.62354827e+00  2.73301005e+00 ... -2.72288889e-01
     8.95288587e-01  4.34903145e-01]]

  ...

  [[ 5.36678791e-01 -1.13263750e+00 -1.17002118e+00 ... -1.11001432e+00
     1.51836026e+00 -3.06289840e+00]
   [-2.87593342e-03 -7.89056942e-02  3.55898738e-01 ...  4.72485632e-01
     4.47162241e-02  1.03856660e-01]
   [ 8.87442231e-02 -4.76220429e-01  9.95322406e-01 ...  1.40275276e+00
     4.30781215e-01 -2.09153771e-01]
   [-7.12817311e-02 -2.40537912e-01  5.57001352e-01 ...  5.56994379e-01
     1.65463185e+00 -8.11956704e-01]
   [ 1.09297156e+00  1.27662981e+00  6.57468498e-01 ...  2.27831101e+00
     1.53293025e+00 -8.62664163e-01]]

  [[-1.42217267e+00 -1.29347098e+00 -8.67008269e-01 ...  2.73373222e+00
    -1.41143954e+00  1.64393151e+00]
   [-1.41386533e+00 -1.29157853e+00 -8.63593757e-01 ...  2.72628331e+00
    -1.39838219e+00  1.64022803e+00]
   [-9.78738010e-01 -9.15654719e-01 -7.98890591e-01 ...  2.45544386e+00
    -7.33113050e-01  1.23866487e+00]
   [ 2.70380080e-02 -1.12842202e-01 -3.11187476e-01 ...  9.45869625e-01
     4.63422328e-01  2.31159776e-01]
   [ 8.54663730e-01  3.35934192e-01 -6.75937533e-02 ...  4.86053467e-01
     2.03074646e+00 -4.65035886e-01]]

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [ 1.31917226e+00 -9.42832008e-02 -1.57432213e-01 ...  1.46290466e-01
    -1.10285878e+00 -2.56250453e+00]
   [ 5.26230931e-01 -1.41352713e+00 -7.98658252e-01 ...  5.64671993e-01
     1.96866125e-01 -9.06494915e-01]
   [-7.94974446e-01 -5.78201842e-03  3.48394141e-02 ...  2.74032354e-04
     1.32948458e+00  1.37224570e-02]
   [-2.24897519e-01  1.69237852e-01  7.06076384e-01 ... -9.20990348e-01
    -2.07336560e-01  8.93001139e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-True-32-8-27-11-4] q.shape1: (4, 11, 27)
q.shape2: (44, 27)
q.shape3: (44, 27)
q.shape4: (4, 11, 27)
q_liner: [[[-0.08246311  1.2976369  -4.386915   ...  1.6648992   1.0225513
   -0.23413594]
  [-2.1036825   0.34269288 -1.3593392  ...  0.28710133 -2.3495028
   -0.5770221 ]
  [ 0.55015564  1.3115653  -2.7073863  ... -1.2594198   0.450877
   -0.5750791 ]
  ...
  [ 1.9723426   1.9014059  -0.07350484 ... -0.6233986  -1.8269871
   -3.14204   ]
  [ 0.5897575   0.5651129  -1.4288164  ...  1.6924045  -1.9481409
    1.4147217 ]
  [ 1.4633553  -0.39679056 -0.7927203  ...  0.4363156  -1.650817
    0.20362736]]

 [[-0.9566642   0.6318296  -0.99751896 ... -1.8659797  -0.01259731
    1.0842644 ]
  [-0.15104908  1.3874646   0.19238688 ... -2.0061364  -0.9589741
    0.54090524]
  [-0.31797698 -0.8425765   3.2394023  ...  0.84538174 -0.51091385
   -0.27457827]
  ...
  [ 0.33640513  1.8460543   2.5176854  ...  1.0853881   2.9914553
    2.6077735 ]
  [ 1.546665    0.5879998   0.41907552 ...  0.75106627  1.0203562
   -0.15183803]
  [-1.0632492   2.5393524   0.9687923  ... -1.3010052  -0.02241022
    1.0278877 ]]

 [[ 0.24715352  1.9982486  -1.0008467  ... -0.99167144  2.288722
   -0.38216916]
  [-1.7900983   1.6657426   0.72222143 ...  1.0981413  -0.52470183
   -1.220509  ]
  [-1.0200733  -0.02188973  0.9696115  ... -3.8275013   1.2366807
   -2.000785  ]
  ...
  [-1.0458595  -1.4305166  -1.8524687  ...  1.3384255  -2.3837926
   -1.3595229 ]
  [ 0.65088063 -0.07472718  0.7910718  ...  1.1668599   0.17494643
   -2.2131062 ]
  [-0.5484388  -0.3512259  -0.9518742  ... -0.37090048 -2.5363982
   -0.35450423]]

 [[-1.659759   -2.0460486   1.7956158  ...  0.7144731  -2.8808205
   -2.3229935 ]
  [-0.6778062  -1.0200877   2.5991158  ... -0.39864084 -0.1548618
   -1.7684385 ]
  [-0.9458304   1.8510628  -0.13740486 ... -1.860934    1.164453
    0.04018883]
  ...
  [ 0.38199356 -1.6202837  -1.9532994  ...  2.8872821  -0.4262538
   -0.07649663]
  [-1.2970152  -0.8319859  -1.2084574  ... -0.85649323  1.5001354
    1.9378235 ]
  [ 0.15252627  1.7864983  -2.6395547  ...  0.10763691  0.13296238
   -1.6784537 ]]]
q.shape5: (4, 11, 256)
q.shape6: (4, 8, 11, 32)
attn_res: [[[[-8.69775236e-01 -7.83433795e-01  1.29327428e+00 ...  1.59407413e+00
    -8.08839560e-01  4.48358744e-01]
   [-2.94552863e-01  5.98550379e-01  6.91059589e-01 ...  2.41293049e+00
    -2.95958853e+00  9.77635562e-01]
   [-3.10980439e-01  2.28687644e+00  1.23281610e+00 ...  2.69716835e+00
    -1.68833590e+00  1.80128908e+00]
   ...
   [ 4.97418821e-01 -3.89605045e-01  1.77821541e+00 ...  8.63675594e-01
    -1.28697872e+00 -4.54684645e-01]
   [ 3.54258865e-02 -1.74026906e-01  1.06718965e-01 ... -1.38367414e-01
     2.51154244e-01 -4.69002396e-01]
   [-6.01000428e-01 -2.99580574e-01  5.22308290e-01 ...  5.43383598e-01
    -7.28339076e-01  1.33979633e-01]]

  [[-4.27433938e-01  5.66519439e-01  1.89552224e+00 ... -4.95959908e-01
     1.64002275e+00 -2.34491229e+00]
   [-2.22845301e-01  4.18161452e-01  1.40795517e+00 ... -6.92085505e-01
     1.20571947e+00 -1.96214449e+00]
   [ 2.46222806e+00 -9.14782062e-02 -1.60492849e+00 ... -1.57133234e+00
     1.14804769e+00 -1.64281142e+00]
   ...
   [ 8.54577124e-02 -4.65106815e-02 -2.84652878e-02 ... -1.68735310e-01
    -1.27706220e-02 -3.15984525e-02]
   [-4.85543460e-01 -1.01038063e+00 -6.04821801e-01 ...  7.30422914e-01
    -2.07749158e-01 -5.20002581e-02]
   [-7.47082382e-02 -5.62124401e-02 -6.20749593e-03 ...  2.16394603e-01
    -1.70110703e-01  1.79719239e-01]]

  [[-7.42750108e-01  6.53545737e-01  4.54722136e-01 ...  1.60635543e+00
     1.65618002e+00  8.62370610e-01]
   [-9.07006025e-01  5.11318028e-01  3.68329048e-01 ...  1.64892793e+00
     1.95196724e+00  6.82971060e-01]
   [-6.39206111e-01 -2.99885583e+00 -1.09981692e+00 ...  1.22615194e+00
     2.26454520e+00 -7.59962946e-02]
   ...
   [-8.29673231e-01 -9.77870405e-01 -5.51367402e-01 ... -7.79353440e-01
     5.78519285e-01  8.47469509e-01]
   [-5.82239747e-01  1.64715230e-01 -3.63189489e-01 ... -9.48849469e-02
     5.11685848e-01  4.98152107e-01]
   [-8.63395855e-02  1.46366954e-01 -1.31467183e-03 ... -2.42660075e-01
    -1.02854788e-01  1.31896809e-01]]

  ...

  [[-1.48501551e+00 -1.47142386e+00  2.09207550e-01 ...  7.02102065e-01
    -7.07588494e-01 -3.13506031e+00]
   [-3.49199533e-01  1.34960914e+00 -1.79847586e+00 ... -1.26032960e+00
     5.35955727e-01 -1.95659235e-01]
   [-1.48141789e+00 -1.46260548e+00  2.02390194e-01 ...  6.95515156e-01
    -7.03488648e-01 -3.12612772e+00]
   ...
   [-7.31870532e-02  1.65461111e+00 -8.80273998e-01 ... -3.95667762e-01
     2.84390152e-01  1.25169837e+00]
   [-1.51554629e-01  2.25225782e+00 -6.29273951e-01 ... -4.98201214e-02
    -3.67305726e-01  2.11158037e+00]
   [-4.32446867e-01  1.40580773e+00 -2.86126882e-01 ...  7.25828633e-02
     9.12398323e-02  1.24166572e+00]]

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [ 6.11594379e-01 -1.23063743e+00 -3.12067091e-01 ...  7.33789980e-01
    -1.12528563e+00  1.68076801e+00]
   [ 9.73436058e-01 -2.89646840e+00 -4.50038224e-01 ... -8.29485059e-02
    -1.79909909e+00 -9.31763589e-01]
   ...
   [-1.07172024e+00  7.31825233e-02  3.59488666e-01 ...  1.05141115e+00
     1.62585080e-01  3.00369561e-01]
   [-3.10641620e-02 -1.65988907e-01  1.75039954e-02 ...  9.64834988e-02
     1.31224170e-01  5.90577722e-02]
   [-7.28076994e-02  4.87585306e-01 -5.72089195e-01 ... -2.37841353e-01
     2.52050996e-01  5.79727530e-01]]

  [[-6.03450060e-01 -2.19000593e-01 -1.08645022e-01 ...  2.36290979e+00
    -1.51431888e-01 -9.61266339e-01]
   [ 1.63082510e-01  2.07873106e-01 -4.76746038e-02 ...  2.04824710e+00
    -2.17289478e-01 -9.27686334e-01]
   [ 4.50435847e-01 -6.71367764e-01  8.89131576e-02 ...  2.04416037e+00
     7.78661430e-01 -2.28670645e+00]
   ...
   [ 5.25981367e-01  4.25095141e-01  2.77278513e-01 ...  6.11848176e-01
    -2.20521092e-02  1.31918281e-01]
   [-5.31912446e-01 -1.74551740e-01 -7.24522591e-01 ...  1.74600506e+00
     7.54883826e-01 -1.09205949e+00]
   [ 8.16326439e-01  4.31555867e-01  7.85755813e-02 ...  1.01679814e+00
    -2.46589676e-01 -4.32144165e-01]]]


 [[[ 1.14191914e+00  1.50013101e+00 -1.95082223e+00 ...  1.56951141e+00
    -2.72405553e+00  2.38202977e+00]
   [ 1.46516442e+00  2.56747270e+00  6.86002076e-01 ... -4.22981828e-01
     1.34379351e+00  6.01764321e-01]
   [ 8.37216318e-01  1.31412542e+00 -1.75142539e+00 ...  1.30449879e+00
    -2.02941632e+00  1.87123239e+00]
   ...
   [ 3.84395897e-01  6.93757355e-01  7.92697072e-01 ...  4.84076440e-01
    -9.85105157e-01 -2.37143710e-01]
   [ 6.99834406e-01  1.27535045e+00 -1.12636697e+00 ...  1.38689399e+00
    -1.30992436e+00  1.11265719e+00]
   [ 6.48571372e-01  7.26971388e-01 -1.84204787e-01 ...  2.84899235e-01
     3.98756772e-01  3.92210275e-01]]

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [ 4.46008593e-01  2.38635927e-01  2.02892447e+00 ... -3.40416282e-01
     1.76683688e+00  1.07851535e-01]
   [-1.46695662e+00 -2.28288695e-01 -2.07712078e+00 ...  2.64246058e+00
    -6.57551169e-01 -3.84054363e-01]
   ...
   [-7.26786971e-01  2.36756414e-01 -1.55639684e+00 ...  1.42526734e+00
    -9.09003198e-01  1.22400597e-01]
   [-1.34795532e-01 -7.97599971e-01 -7.07151115e-01 ... -1.72133923e-01
    -1.48398268e+00  2.21883130e+00]
   [ 4.64969993e-01  3.84338379e-01 -7.32180178e-01 ... -4.42506850e-01
    -9.11599994e-02  1.25895917e-01]]

  [[ 6.87055349e-01 -8.01961124e-01  8.76420736e-01 ...  2.74021840e+00
     1.49420989e+00 -3.68064094e+00]
   [-1.60956419e+00 -1.63233161e+00  4.45242822e-01 ... -1.28541911e+00
     1.73554981e+00  1.54319441e+00]
   [-1.40639663e-01 -1.00326288e+00  6.83031917e-01 ...  1.05362844e+00
     1.20895910e+00 -1.26384461e+00]
   ...
   [ 3.59489053e-01 -1.57633448e+00  1.96672566e-02 ...  8.65184844e-01
    -4.91390914e-01 -6.59810603e-01]
   [-1.26646972e+00 -1.48338759e+00  4.84615266e-01 ... -7.31137633e-01
     1.60774696e+00  7.89163530e-01]
   [ 5.99983335e-01 -7.43352711e-01  2.29482204e-01 ...  6.00429296e-01
     4.31241959e-01 -1.10796607e+00]]

  ...

  [[ 1.99562752e+00 -2.55661559e+00 -9.28616822e-02 ... -1.80475688e+00
     1.24859595e+00 -2.52430749e+00]
   [ 1.93033075e+00 -2.47296309e+00 -8.98232535e-02 ... -1.74570537e+00
     1.20774198e+00 -2.44171214e+00]
   [ 1.45300460e+00  2.33511424e+00 -9.32816625e-01 ... -1.02462089e+00
     1.92009902e+00  2.58707628e-02]
   ...
   [ 1.90618658e+00  9.42978919e-01 -1.09939456e+00 ...  2.02100277e-01
    -6.79276347e-01  1.91884879e-02]
   [-4.35952872e-01  7.76728570e-01  1.00815976e+00 ... -4.04876024e-01
     8.26009810e-01  2.22688127e+00]
   [ 1.16517508e+00  4.74753559e-01 -2.95643866e-01 ... -4.57003325e-01
    -4.41241376e-02  4.36601788e-03]]

  [[ 3.43114823e-01 -1.19770694e+00 -8.90281677e-01 ... -1.32593071e+00
    -2.66887403e+00  6.07350707e-01]
   [ 1.47972560e+00  5.34748316e-01  9.44046021e-01 ...  2.11969161e+00
    -6.05929911e-01  4.49739784e-01]
   [ 4.24121618e-01 -7.54245341e-01 -3.24322373e-01 ... -5.83228707e-01
    -2.17957187e+00  4.06491965e-01]
   ...
   [ 7.13110685e-01  3.40241939e-01  9.05164242e-01 ...  1.85635114e+00
    -4.62730169e-01  7.20720649e-01]
   [ 1.05101533e-01 -8.00254583e-01 -2.67546564e-01 ... -5.98239660e-01
    -1.57142496e+00  8.18647891e-02]
   [ 8.34656477e-01 -7.48503566e-01  1.40968531e-01 ... -7.99472928e-01
    -7.16705441e-01 -5.01383901e-01]]

  [[ 5.70026040e-01 -4.58333015e-01 -1.37727940e+00 ... -7.91358426e-02
     1.55597103e+00 -1.31409454e+00]
   [ 1.56853521e+00 -1.09900787e-01  1.33954942e+00 ...  4.20615375e-01
     2.07129502e+00 -4.46888447e-01]
   [ 1.46626842e+00 -1.32865191e-01  1.43332255e+00 ...  5.55969477e-01
     1.96586251e+00 -4.86378074e-01]
   ...
   [ 1.06087899e+00  3.17745745e-01  1.03227293e+00 ...  6.31959260e-01
     1.23627329e+00 -1.56842947e-01]
   [ 7.39012301e-01 -3.56078237e-01 -4.96965587e-01 ... -5.31629741e-01
     1.49336100e-01 -5.07708609e-01]
   [-1.12769119e-01 -1.10648596e+00 -4.90555644e-01 ...  1.92301169e-01
     1.90695226e-01  1.04301643e+00]]]


 [[[ 7.54729688e-01 -4.57551539e-01  1.57605469e-01 ...  8.08583915e-01
     2.46321782e-01 -2.70383626e-01]
   [ 7.76403248e-01  1.16304278e+00 -2.03483844e+00 ...  6.97463453e-01
     6.74023867e-01  1.69933283e+00]
   [ 3.06501031e-01  2.69015729e-01 -5.47630668e-01 ...  2.90971279e-01
     2.17135757e-01  4.40725029e-01]
   ...
   [ 4.40518260e-01 -7.97963083e-01 -5.68154871e-01 ...  3.32092583e-01
     2.53998488e-01 -7.81501085e-02]
   [ 1.42057836e-01  3.43062490e-01 -9.38069463e-01 ...  8.51073921e-01
     5.23921192e-01  1.10068941e+00]
   [-9.83105600e-02  5.00948966e-01  6.19869351e-01 ...  2.18970597e-01
     5.79792678e-01  2.14979470e-01]]

  [[-1.09478104e+00 -2.11850476e+00  7.15485930e-01 ... -1.67707889e-03
    -1.58719325e+00 -1.58244038e+00]
   [-9.60709393e-01 -2.91209936e-01  4.23576348e-02 ...  6.87497795e-01
    -1.06474316e+00  2.05069214e-01]
   [-2.04308438e+00 -7.18767881e-01  1.27225593e-01 ...  1.41835129e+00
    -2.28514075e+00  3.34999084e-01]
   ...
   [-3.18768442e-01  6.24701440e-01  1.12735115e-01 ...  5.17457485e-01
     9.85108435e-01 -1.12218821e+00]
   [-4.38240647e-01 -3.66636783e-01  5.72178602e-01 ...  3.12213689e-01
    -7.57666826e-02 -9.36497629e-01]
   [-2.33814746e-01 -7.73487628e-01  2.00813800e-01 ... -3.68400544e-01
    -8.47646058e-01  6.31949246e-01]]

  [[-1.31107128e+00 -3.84751856e-01  2.87090421e-01 ... -1.26909053e+00
     1.71347439e+00  4.04918879e-01]
   [-1.18930137e+00 -2.92058229e-01  4.78764236e-01 ... -1.17995954e+00
     1.49660635e+00  3.73580605e-01]
   [ 1.24285214e-01 -2.78055280e-01 -4.51082617e-01 ...  2.67805886e+00
    -1.22533011e+00 -4.84919667e-01]
   ...
   [-2.05689982e-01 -6.11060262e-02  8.24479759e-02 ... -1.13010742e-01
     7.19259083e-01 -8.75041366e-01]
   [-1.98422194e+00  9.59484816e-01  1.09480107e+00 ... -5.59318662e-01
     7.39404619e-01  1.37200809e+00]
   [-1.11168802e+00 -1.90360382e-01  2.41744176e-01 ... -7.93072999e-01
     1.07947254e+00  4.27807242e-01]]

  ...

  [[-2.83251762e-01  1.43734646e+00  6.67077601e-01 ... -2.01587796e+00
     5.00855483e-02 -7.42803156e-01]
   [ 3.72156072e+00  1.30622554e+00 -1.27565777e+00 ... -4.70941067e-01
     2.20214820e+00 -2.34952903e+00]
   [-3.71965766e-01  7.78490067e-01 -2.16248035e-01 ... -1.36871862e+00
     9.07402635e-01 -7.94394016e-01]
   ...
   [ 2.48607591e-01  6.45227015e-01 -8.49509180e-01 ...  1.30888641e+00
    -4.33159351e-01  1.14458168e+00]
   [ 1.22094774e+00  4.25622195e-01 -5.39985657e-01 ... -3.69599432e-01
     6.20877743e-01 -8.42103302e-01]
   [ 2.11473003e-01  1.08077669e+00  2.45222032e-01 ... -9.36102390e-01
     1.82582065e-01 -1.48607209e-01]]

  [[ 2.24905348e+00 -2.38411024e-01 -1.12501132e+00 ...  4.21072096e-01
    -2.14775777e+00  2.86331439e+00]
   [ 6.39277041e-01 -1.00680602e+00 -1.46070576e+00 ... -2.78993940e+00
     5.08884132e-01 -4.19258475e-01]
   [ 1.44034541e+00 -3.51402879e-01 -1.20737338e+00 ... -3.32022458e-01
    -1.34769201e+00  1.62184930e+00]
   ...
   [ 5.34093261e-01 -1.00052583e+00 -1.24587107e+00 ... -2.54754281e+00
     3.74144673e-01 -4.63531494e-01]
   [ 7.78082192e-01 -1.04269540e+00 -2.51035720e-01 ... -5.03013372e-01
     2.56376415e-01 -1.83793485e+00]
   [-7.79594243e-01  7.24497437e-02 -6.75855339e-01 ...  1.58572465e-01
    -4.63986278e-01 -7.13472009e-01]]

  [[-1.66106081e+00 -1.26562262e+00 -6.69642150e-01 ... -1.65390539e+00
    -5.95834330e-02 -1.96530688e+00]
   [-1.89857101e+00 -3.70544255e-01 -1.10146213e+00 ... -1.02118218e+00
    -1.33800969e-01 -1.67003763e+00]
   [-8.04688632e-01 -1.35074937e+00  2.62590110e-01 ... -1.43342733e+00
     4.96251822e-01 -7.52405524e-02]
   ...
   [-4.78884429e-01 -1.21521282e+00  5.57571709e-01 ... -8.91647816e-01
     8.60865712e-01 -3.89657408e-01]
   [-3.85063291e-01  4.55264226e-02 -1.34719700e-01 ...  2.27931648e-01
     2.26654604e-01 -5.97750425e-01]
   [-7.14251697e-01 -7.78464198e-01  5.80131590e-01 ... -6.18946016e-01
     7.07320690e-01 -3.92350376e-01]]]


 [[[-8.35666418e-01  2.35665369e+00 -2.98543954e+00 ... -1.11331058e+00
     5.81655443e-01  1.25254881e+00]
   [-7.64925122e-01  1.88857043e+00 -2.71708918e+00 ... -1.13816750e+00
     5.38936436e-01  1.23213494e+00]
   [-3.90757650e-01 -7.67554462e-01 -1.21297204e+00 ... -1.22888422e+00
     2.92607695e-01  9.38828826e-01]
   ...
   [-3.87105048e-02  5.71767569e-01 -1.99930024e+00 ...  3.61807853e-01
    -8.63678455e-01  4.86692302e-02]
   [ 1.40289819e+00  9.79594588e-01  6.97715700e-01 ... -1.47032678e-01
    -8.14864516e-01  1.03522170e+00]
   [ 7.52379656e-01  6.36168242e-01  3.35038781e-01 ... -1.26816022e+00
    -4.93728846e-01  1.55101109e+00]]

  [[-5.31879663e-01 -1.66693699e+00  1.65395796e+00 ...  2.28845978e+00
    -5.81250131e-01  6.43408954e-01]
   [ 3.68619263e-02 -1.53083599e+00  1.53174222e-01 ...  1.87926185e+00
     8.93213809e-01  1.75743103e-01]
   [ 7.49882877e-01 -1.28710055e+00 -1.74022281e+00 ...  1.27576494e+00
     2.70384717e+00 -4.20345098e-01]
   ...
   [ 3.32449406e-01  7.85184741e-01  7.68238544e-01 ...  1.89220726e-01
     7.71058798e-02 -4.22256947e-01]
   [-3.90732735e-01  6.24449432e-01  1.94623172e+00 ...  3.99140775e-01
    -8.01854908e-01 -6.32828593e-01]
   [ 1.12644482e+00 -9.29217339e-01 -1.99002790e+00 ...  9.87443388e-01
     2.31144714e+00  8.29281658e-02]]

  [[ 9.86161649e-01 -3.54059982e+00 -1.00404310e+00 ...  1.75373709e+00
     1.44772851e+00  1.56085217e+00]
   [ 2.20775652e+00 -2.34923339e+00 -1.49602222e+00 ...  8.25441122e-01
     6.86277330e-01  2.06190705e-01]
   [ 1.00719109e-01 -1.96246020e-02 -5.64485304e-02 ... -1.10164154e-02
    -8.79573636e-03 -4.22091857e-02]
   ...
   [-3.97568226e-01 -1.04206705e+00  5.16050696e-01 ...  5.74734807e-01
     7.71699905e-01 -1.43862665e-01]
   [ 1.32536757e+00 -9.37661588e-01 -1.24165821e+00 ...  9.75103378e-01
    -9.14541185e-01 -9.75325048e-01]
   [ 1.10857475e+00 -1.07006884e+00 -3.02116364e-01 ...  4.23525751e-01
    -1.62581399e-01 -5.32076836e-01]]

  ...

  [[ 1.08464170e+00 -3.14320850e+00  2.16825676e+00 ...  1.20569062e+00
     9.76694882e-01 -1.91030514e+00]
   [-3.47889751e-01 -1.47953153e+00 -2.02754068e+00 ...  1.89913559e+00
    -1.95181477e+00  8.85092080e-01]
   [ 1.00040495e+00 -3.04537916e+00  1.92178667e+00 ...  1.24637151e+00
     8.04585457e-01 -1.74597299e+00]
   ...
   [ 1.08222067e-01 -2.01947379e+00  1.39677465e+00 ...  8.07401836e-01
     6.10928703e-03 -4.04371232e-01]
   [ 2.15658829e-01 -5.77125251e-01  4.04974103e-01 ...  3.06268558e-02
    -4.83046532e-01 -7.66911924e-01]
   [-8.28911006e-01 -4.92976755e-01  6.45134211e-01 ...  2.44562015e-01
     4.50153470e-01  1.05762982e+00]]

  [[-2.91827321e-01  2.33797836e+00 -6.76878154e-01 ...  3.07585418e-01
    -6.02930009e-01  1.39609087e+00]
   [-3.58789623e-01  1.43569970e+00 -8.88626218e-01 ...  1.29305273e-01
    -7.29621887e-01  8.15410256e-01]
   [ 3.78639549e-02 -2.22518146e-01  2.85996478e-02 ... -2.39653051e-01
    -8.59279335e-01  3.92080575e-01]
   ...
   [-3.91992688e-01 -9.40754414e-01 -8.51484179e-01 ...  7.24584341e-01
    -3.68330657e-01  3.86567444e-01]
   [-1.92153268e-02  2.24594444e-01 -3.19716036e-01 ...  8.56503785e-01
     1.53002560e-01  1.23726368e+00]
   [-2.55547851e-01 -2.97574103e-01 -5.77007592e-01 ...  1.46270359e+00
     4.52153608e-02  5.14280856e-01]]

  [[ 2.88793296e-01  1.42087162e+00 -4.16270822e-01 ...  2.79881501e+00
     9.87419784e-01 -2.00565743e+00]
   [ 2.48613644e+00 -2.19465876e+00 -1.44002736e+00 ... -2.63956904e-01
    -2.60207206e-01  6.85240448e-01]
   [ 1.04597425e+00 -2.79253840e-01 -5.94569206e-01 ...  1.62728286e+00
     4.03336942e-01 -9.07531857e-01]
   ...
   [ 8.75674188e-01 -9.45843682e-02  1.19649482e+00 ...  1.34862676e-01
    -1.32760769e-02  2.44801596e-01]
   [ 2.01437044e+00  1.40223578e-01  1.23914945e+00 ...  1.10134460e-01
     5.31701922e-01  1.82532215e+00]
   [-1.73432350e-01 -1.02902067e+00 -8.57874811e-01 ...  4.96811509e-01
     4.33061719e-01 -2.00361878e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-True-32-8-27-11-8] q.shape1: (8, 11, 27)
q.shape2: (88, 27)
q.shape3: (88, 27)
q.shape4: (8, 11, 27)
q_liner: [[[ 0.7224421  -0.4349443   3.4143312  ...  0.35247484  1.755044
    1.3171575 ]
  [ 2.726345    1.2628067  -1.7939713  ... -0.06979546  0.00453782
    3.1302361 ]
  [-1.1040715  -0.15600364  1.9368501  ... -0.5825903  -0.65041417
   -2.2147686 ]
  ...
  [ 2.2915697   0.908618    1.0856221  ... -1.3256544   0.3059599
   -0.8404981 ]
  [-0.40498114 -0.5691511   2.6631112  ...  0.8738295   0.4198153
    1.1513562 ]
  [-0.4481117  -0.92076814  3.5576978  ...  2.7185454   3.3272922
   -0.97112256]]

 [[-1.1616747  -1.7085901  -0.06308014 ... -0.84628963  0.9343368
   -0.6217179 ]
  [ 0.4018707   0.30482602  0.46497503 ...  0.11524689  0.10966628
   -0.6314564 ]
  [ 2.181069   -1.1074287   1.3467315  ...  0.3924123   0.333957
    0.59106386]
  ...
  [ 3.5478017   0.51425123 -2.1266656  ... -1.1019756  -0.78907716
    2.1269352 ]
  [-1.6231765  -2.7684586   0.24566987 ... -0.25909057 -0.6573771
   -1.6647071 ]
  [ 2.5132887   0.55106294  0.7015406  ...  1.2227943   0.7392053
    1.8680627 ]]

 [[ 0.27821246 -1.1018684   1.7200263  ... -1.7082299  -0.4673362
   -2.2366893 ]
  [ 2.7587233   1.7226602   0.80260444 ...  1.1995286  -0.92798245
    0.2717521 ]
  [ 0.64558136  0.08447142  0.4400963  ...  1.3089368   1.2809186
   -1.5577403 ]
  ...
  [-1.0232698  -1.5747494   1.018051   ...  0.00518736 -0.4626458
    0.8344153 ]
  [ 1.1266454   0.38148978  2.193111   ... -1.535103    0.7982023
   -0.95043397]
  [-0.9965041  -1.8504593   1.8635492  ...  1.692321    1.8115427
   -0.7349715 ]]

 ...

 [[ 2.0749588   2.2624092   0.34631866 ... -3.2463973   1.0677856
    1.5288495 ]
  [ 0.26497793  1.3373191   3.0214698  ...  0.41106525 -0.168928
    0.03355249]
  [ 0.5420742   1.2251354  -3.826573   ... -0.3492088  -0.03093641
    0.7989888 ]
  ...
  [-3.2419846  -1.4931114   0.72515845 ...  1.7054092  -0.04060049
   -2.0626805 ]
  [ 0.9767814   0.28908026 -1.5257835  ... -3.0712612  -0.89618737
   -0.34019697]
  [ 0.62380505  1.7282047  -0.0089727  ...  3.7021785  -0.5753088
    1.6830212 ]]

 [[ 2.0232096   0.64801383  0.06984097 ...  0.75521886  0.41255075
    0.5661507 ]
  [ 0.1846309   0.6487752  -2.7815032  ...  0.88175464 -0.7132604
   -0.08390007]
  [-1.9218032   0.28904673 -1.1362168  ... -2.5849714  -0.15884835
   -1.8206904 ]
  ...
  [-1.7156733  -0.79765487 -1.7961345  ... -0.48244846  1.5824316
    0.23448431]
  [-0.93504095 -0.5579303  -1.3916396  ... -1.3223844  -0.33638978
   -0.6543721 ]
  [-3.1369114  -1.0516436   3.0829988  ...  0.66301984  1.6387496
   -2.8189466 ]]

 [[ 0.5203575   2.510916   -2.5926096  ... -0.47947776 -2.6331599
    1.5112784 ]
  [ 0.2482923   0.10941231 -1.2460439  ...  1.8010229  -0.24936317
   -0.89507395]
  [-0.4074848   0.35642445  1.1563052  ... -0.9337908  -0.3271042
    0.46405247]
  ...
  [ 0.87635964  0.15448402  0.44426605 ... -1.1368421   0.7098688
   -0.3491225 ]
  [-2.248125    0.22241627 -1.8704771  ... -1.2285389   0.29145718
   -0.22001871]
  [-1.0332358   0.15769057 -1.6133977  ...  0.13136601  1.1417925
   -0.2518325 ]]]
q.shape5: (8, 11, 256)
q.shape6: (8, 8, 11, 32)
attn_res: [[[[ 2.55478454e+00  1.82757497e-01  1.13002539e+00 ... -1.10603772e-01
     2.97788620e-01  1.18644178e+00]
   [ 1.85808420e-01  1.32918777e-02  8.21862891e-02 ... -8.04416742e-03
     2.16580443e-02  8.62894207e-02]
   [ 7.87969410e-01  9.80823100e-01  1.42472959e+00 ... -1.88401425e+00
     2.01393276e-01  1.54891634e+00]
   ...
   [ 1.85604143e+00  3.15864980e-01  6.52537048e-01 ... -2.59767115e-01
    -1.35578096e-01  7.83478677e-01]
   [ 4.33876142e-02 -5.54634705e-02  1.88283086e-01 ... -8.30766410e-02
     1.67318135e-02  1.22188672e-01]
   [ 1.17152631e+00 -2.90623903e-01  1.50936067e-01 ...  1.38560325e-01
    -1.25924990e-01  5.69244742e-01]]

  [[-1.24841094e+00 -1.09278488e+00 -1.25198925e+00 ... -1.96604216e+00
    -7.62160838e-01 -2.98628831e+00]
   [-1.64248991e+00  5.31429291e-01 -2.50670123e+00 ... -3.42405736e-01
    -1.56617904e+00  5.49960196e-01]
   [-3.56491327e-01 -2.09973526e+00  2.02871203e+00 ...  3.20614964e-01
    -9.10376608e-01 -7.67791092e-01]
   ...
   [-5.08877277e-01 -3.19803208e-02 -3.73150975e-01 ... -3.12556654e-01
     1.46169975e-01 -5.65623164e-01]
   [-1.99946612e-01 -6.16905630e-01  3.99899721e-01 ...  3.10215801e-01
     6.57802939e-01  1.23893046e+00]
   [-1.00365794e+00 -4.57776815e-01  1.21661581e-01 ...  9.50923145e-01
     2.83565819e-01  1.36386907e+00]]

  [[-1.81560934e+00  3.50365579e-01 -3.20438087e-01 ... -3.62959802e-02
     3.30804873e+00 -2.33204889e+00]
   [-1.12885153e+00  2.17839122e-01 -1.99231759e-01 ... -2.25669555e-02
     2.05677271e+00 -1.44994676e+00]
   [-1.23290551e+00 -7.71932863e-03 -3.01858246e-01 ...  4.41173837e-02
     1.40171826e-01 -4.56884563e-01]
   ...
   [-3.80717695e-01 -1.66703546e+00 -1.90887257e-01 ...  1.09655428e+00
    -1.10516894e+00  1.05902418e-01]
   [ 6.07376695e-02  4.89712417e-01 -9.49626327e-01 ... -5.05094826e-01
     9.42390084e-01 -2.47509909e+00]
   [-7.21229911e-01  7.48465478e-01 -6.55628920e-01 ...  2.16876879e-01
     5.59012949e-01 -8.77513923e-03]]

  ...

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [-1.36634454e-01  1.03272521e+00  1.93395466e-02 ...  1.03297830e+00
     3.61871481e-01 -2.39648175e+00]
   [-3.95805866e-01 -3.75169963e-01  1.86956060e+00 ... -2.97500706e+00
    -2.70161152e+00  6.70012236e-01]
   ...
   [-1.51336342e-01  2.77489126e-01  3.68353754e-01 ... -1.35095119e+00
    -1.11495566e+00 -5.21059752e-01]
   [ 2.16812223e-01  6.56952977e-01 -8.18073571e-01 ... -5.88366091e-02
     2.32014194e-01 -1.90926456e+00]
   [-1.56140089e-01 -2.12650388e-01 -6.35782257e-02 ...  3.12016606e-01
     7.71780670e-01 -1.69795740e+00]]

  [[ 1.44150245e+00 -1.66902220e+00 -1.25370800e+00 ... -1.59926069e+00
    -1.10770047e+00  1.68616831e+00]
   [ 1.59396577e+00 -5.04392862e-01 -1.06825566e+00 ... -1.34425700e+00
    -6.63829744e-01  1.23295355e+00]
   [ 8.07784200e-01  7.53575861e-01 -1.41597211e+00 ... -7.27425992e-01
     3.18378180e-01  1.68354249e+00]
   ...
   [ 1.36864245e+00 -3.09147775e-01 -1.08992565e+00 ... -5.92648447e-01
     1.47261649e-01 -5.03014326e-02]
   [ 2.71738112e-01  2.37544566e-01  4.61962014e-01 ...  1.93361923e-01
    -1.65879503e-01  2.77429111e-02]
   [ 1.48073447e+00 -5.85172772e-01  1.02387798e+00 ...  6.38008177e-01
    -9.79755223e-01 -1.00138700e+00]]

  [[-1.66896939e+00  9.21379626e-01  1.19695449e+00 ... -6.96311235e-01
     2.51643109e+00  1.99747694e+00]
   [-1.24852085e+00  8.55018675e-01  9.63441849e-01 ... -7.86888599e-01
     2.58085608e+00  1.81705761e+00]
   [-2.68119931e-01  3.50912780e-01  2.75557995e-01 ... -4.37454164e-01
     1.25910926e+00  7.16006160e-01]
   ...
   [ 1.38305175e+00 -1.18332684e+00 -1.38214993e+00 ...  8.48321617e-02
     1.81398201e+00  4.57192838e-01]
   [-1.23971246e-01 -1.36039042e+00 -3.07699561e-01 ... -7.89205916e-03
     1.73900938e+00  1.72305405e+00]
   [-6.74949527e-01  4.50063646e-01  4.44862157e-01 ...  5.35951197e-01
     1.05374679e-01  7.23146677e-01]]]


 [[[-1.37279916e+00 -1.53557253e+00  1.34774351e+00 ...  2.49318409e+00
     4.29327101e-01 -9.45353732e-02]
   [-1.81439567e+00 -5.91149330e-01  7.25653410e-01 ...  1.74965644e+00
     1.82557791e-01 -3.26988995e-01]
   [-1.36472797e+00 -6.91840410e-01  7.27230549e-01 ...  1.58164465e+00
     2.03457609e-01 -2.11227283e-01]
   ...
   [-6.75641000e-01 -8.67508948e-01  7.06131160e-01 ...  1.16381466e+00
     2.75739342e-01 -5.44224195e-02]
   [-1.64161599e+00  3.22052479e-01  8.65560532e-01 ... -1.10084020e-01
     5.15944541e-01 -6.37201607e-01]
   [-8.18776548e-01 -3.19230646e-01  1.05404413e+00 ...  9.95669067e-02
     8.30182374e-01 -3.59932274e-01]]

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [-1.86001122e+00 -1.57746077e+00  2.10757136e+00 ... -5.55080831e-01
     1.10097110e+00 -1.73327431e-01]
   [-1.15157449e+00 -1.05816603e+00  1.30677390e+00 ... -5.65559149e-01
     6.79786742e-01 -2.00468436e-01]
   ...
   [ 5.35945632e-02  7.85662457e-02 -2.51475364e-01 ... -2.98200250e-02
    -1.15074120e-01 -1.27082929e-01]
   [ 6.51118755e-01  1.50806379e+00  5.45884609e-01 ...  5.60989380e-01
     5.65997183e-01 -1.84917711e-02]
   [ 7.06828833e-02  4.60674107e-01  6.02924824e-01 ...  3.24921876e-01
     1.04718253e-01 -1.58915073e-02]]

  [[-9.89496291e-01 -2.28034067e+00 -4.65770274e-01 ...  9.05292690e-01
     1.31671894e+00 -2.62397647e+00]
   [ 2.73619533e+00 -1.19982255e+00 -8.90243173e-01 ...  8.88069630e-01
    -2.49271941e+00  6.38128161e-01]
   [ 2.65486687e-01 -9.36597407e-01 -2.26501405e-01 ...  7.89906383e-01
     2.64253348e-01 -1.54404020e+00]
   ...
   [ 8.88795495e-01  4.19449747e-01 -1.31677315e-01 ... -1.44587338e-01
     1.60444871e-01  7.86565661e-01]
   [ 6.20679557e-01 -3.09345461e-02 -7.91751519e-02 ...  2.12947577e-01
     4.52699184e-01 -4.27538782e-01]
   [ 1.51768231e+00 -6.86107695e-01 -5.19433677e-01 ...  8.20886135e-01
    -1.61538184e+00  4.96454686e-01]]

  ...

  [[-1.93900931e+00  9.56776202e-01 -7.22770751e-01 ... -3.64780903e+00
    -1.20873117e+00  5.78473091e-01]
   [-1.91978967e+00  9.52506959e-01 -7.18067110e-01 ... -3.63153648e+00
    -1.20011437e+00  5.64615130e-01]
   [ 1.13323271e+00  2.74490207e-01  2.91604567e-02 ... -1.04665899e+00
     1.68503299e-01 -1.63648713e+00]
   ...
   [-9.65423230e-03  3.01193088e-01 -8.90445411e-01 ...  1.25340295e+00
     7.67022312e-01 -1.48774993e+00]
   [-8.38350430e-02  3.29421639e-01  2.05519088e-02 ... -4.30834860e-01
     9.83346775e-02 -4.91602421e-01]
   [-8.79599690e-01  5.56961477e-01 -2.73981988e-01 ... -8.26965094e-01
    -2.33744651e-01 -5.18609211e-03]]

  [[-1.29923272e+00  1.53244448e+00  1.97592986e+00 ...  6.29627824e-01
    -5.29890582e-02 -6.03037596e-01]
   [-1.68376660e+00  1.11880088e+00  1.63602149e+00 ...  3.54732335e-01
     3.78833115e-01 -3.69499624e-02]
   [-6.39277697e-01  9.33872238e-02  2.67779320e-01 ... -4.15774658e-02
     3.14840168e-01  2.70498097e-01]
   ...
   [ 4.73732054e-01  8.08765292e-01  1.01117052e-01 ... -2.74987817e-01
     5.65101087e-01 -1.03257787e+00]
   [-3.34460080e-01  4.02308077e-01  8.45288515e-01 ...  3.72240096e-01
     4.41988498e-01 -2.88152218e-01]
   [-5.97713590e-01  7.07387149e-01  1.10987830e+00 ... -1.62755579e-01
     5.37062526e-01 -7.13493824e-01]]

  [[-3.36533010e-01  1.90447044e+00  5.47249496e-01 ...  1.87709844e+00
     1.82404280e+00  3.79020646e-02]
   [-1.02109659e+00  1.38053238e-01  1.20828986e+00 ...  9.08815742e-01
    -6.33765817e-01 -1.07515180e+00]
   [ 2.16193271e+00  7.69874811e-01  1.73297727e+00 ...  8.60440552e-01
    -7.19912201e-02  1.73657095e+00]
   ...
   [-1.96994394e-02  2.75630414e-01  6.84226573e-01 ... -1.27146736e-01
     8.62534940e-01  9.46446359e-01]
   [ 1.35823786e-01 -1.24995194e-01  4.45521057e-01 ...  1.08402841e-01
     4.50459361e-01  7.95582473e-01]
   [ 8.64298284e-01  9.02237177e-01 -3.70619306e-03 ... -7.55505562e-01
     1.51475942e+00  6.20114505e-01]]]


 [[[-2.26368761e+00 -1.32969999e+00 -1.74184334e+00 ...  1.12960064e+00
     4.66800362e-01  1.27265155e-01]
   [-2.00869989e+00 -1.01412058e+00 -1.68652332e+00 ...  1.20897388e+00
     3.23379546e-01 -2.22038627e-02]
   [-7.67917573e-01 -5.37955046e-01 -1.35505867e+00 ...  1.40620744e+00
     1.99594706e-01 -1.24814615e-01]
   ...
   [-1.86823606e-02 -1.97873592e-01  2.40139455e-01 ...  3.75839919e-01
     3.05520892e-01  3.93872522e-03]
   [-6.42579496e-02 -2.13937238e-01  2.39238322e-01 ...  3.07306379e-01
     2.60626197e-01  5.58849871e-02]
   [-4.77582842e-01 -7.56255865e-01  1.30282152e+00 ...  1.55566156e-01
     3.23009849e-01  6.84235692e-01]]

  [[-1.38347304e+00  1.00602376e+00 -5.52631974e-01 ...  1.71281469e+00
    -1.08262527e+00  3.53664368e-01]
   [-1.29324949e+00  1.02489829e+00 -2.19189316e-01 ...  1.64533544e+00
    -8.89300585e-01  7.50101089e-01]
   [-6.49460316e-01  8.96787763e-01  1.72321784e+00 ...  1.11043537e+00
     1.84710830e-01  2.80992126e+00]
   ...
   [ 7.75210500e-01  3.29163098e+00  8.70719433e-01 ... -1.48697887e-02
     2.44690657e+00  5.81471682e-01]
   [-3.07237267e-01  1.42511952e+00  9.03173983e-01 ...  6.95866287e-01
     6.14094555e-01  1.54046512e+00]
   [-3.89265150e-01  7.67607033e-01  1.08027053e+00 ... -4.93158072e-01
     3.67083848e-01  2.04487324e-01]]

  [[ 9.36926007e-02 -3.22689843e+00  1.71103254e-01 ... -1.21090794e+00
    -2.02136135e+00 -1.11706996e+00]
   [-2.79869437e-01 -2.15468264e+00 -4.93416935e-02 ... -1.08508527e+00
    -9.89084840e-01 -8.45869660e-01]
   [-3.73899668e-01  3.88945580e-01  9.36176896e-01 ... -2.59674668e-01
     2.19871950e+00 -3.25751901e-01]
   ...
   [-1.39570498e+00  7.62282014e-01 -3.17624569e-01 ... -1.34943962e-01
     6.70537233e-01 -5.93995750e-01]
   [ 3.40779126e-01  1.47536576e+00 -3.60522345e-02 ... -9.02792335e-01
    -4.53548223e-01 -5.60013354e-01]
   [-1.62954068e+00  2.98392326e-01  8.68431807e-01 ... -5.17879307e-01
     3.76725703e-01  1.06745410e+00]]

  ...

  [[-1.13498032e+00 -2.11556292e+00  1.68736053e+00 ...  1.70813143e-01
     2.19372201e+00  2.58187437e+00]
   [-1.10655975e+00 -1.53254223e+00  7.80538976e-01 ... -3.08028579e-01
     5.36256671e-01  9.48726416e-01]
   [-9.95369136e-01 -1.90533495e+00  1.39209235e+00 ...  1.01499483e-01
     1.91331494e+00  2.24692750e+00]
   ...
   [ 1.19967394e-01 -3.34568113e-01  1.12565741e-01 ... -2.24164128e-01
     5.40539086e-01  2.91081905e-01]
   [-2.71856487e-01  6.62626743e-01 -4.27140683e-01 ... -3.39427233e-01
    -8.66104513e-02  3.27952534e-01]
   [ 1.91729173e-01 -8.77790973e-02 -1.76413998e-01 ... -8.06268096e-01
     1.05495371e-01 -5.01971185e-01]]

  [[ 1.72602996e-01  2.11062336e+00  4.68108654e+00 ...  4.12132263e-01
    -1.02812219e+00 -2.57971549e+00]
   [-8.60962033e-01  4.15421426e-01  2.73034000e+00 ...  1.54259801e-02
     2.29192257e-01 -1.45125151e+00]
   [ 4.99950141e-01  1.37053442e+00  2.87182164e+00 ...  6.75544381e-01
     1.74942791e-01 -1.37292433e+00]
   ...
   [-1.18098535e-01  9.27825347e-02  7.67346978e-01 ... -6.23830199e-01
     7.15241581e-03 -6.62179053e-01]
   [ 1.45703506e+00  1.39258608e-01  1.18960261e+00 ...  3.19821090e-01
     9.68956411e-01 -5.63906431e-01]
   [ 1.20680666e+00 -7.25321293e-01  1.15869832e+00 ... -5.21722674e-01
    -2.63733119e-01 -1.01185131e+00]]

  [[ 6.37745976e-01  3.53443789e+00 -2.27697301e+00 ... -9.76260841e-01
     5.63374698e-01 -1.29292980e-01]
   [ 4.04194981e-01  2.91727233e+00 -1.54645419e+00 ... -1.02003634e+00
     4.51286286e-01 -1.20281160e-01]
   [-3.43784750e-01  5.98550618e-01  1.53447270e+00 ... -9.83640492e-01
     1.65576681e-01  2.34840378e-01]
   ...
   [-5.87273955e-01  1.71326256e+00  5.75283527e-01 ... -4.17494923e-01
     2.85412192e-01  1.98020786e-01]
   [-2.11977816e+00  3.21846396e-01 -3.86474699e-01 ... -1.80514109e+00
     1.15860865e-01  7.81069756e-01]
   [-1.21087193e+00  1.15588188e+00 -8.86267304e-01 ... -1.57509577e+00
     1.82912901e-01  4.10269916e-01]]]


 ...


 [[[-5.81752360e-01  3.44163746e-01 -2.49595785e+00 ... -2.93711782e-01
     1.03746641e+00 -9.60568607e-01]
   [-1.49139479e-01  8.82306769e-02 -6.39869988e-01 ... -7.52966851e-02
     2.65967458e-01 -2.46253774e-01]
   [-5.17336488e-01  2.97487199e-01 -2.33543038e+00 ... -2.84436375e-01
     9.81735647e-01 -8.38425398e-01]
   ...
   [ 1.85172391e+00  6.88915908e-01 -8.86410713e-01 ... -2.82224727e+00
    -1.87406564e+00 -4.96018529e-01]
   [ 1.32482708e+00 -2.43602991e-01 -4.55200940e-01 ... -4.55583215e-01
    -2.55014688e-01  3.00904512e-01]
   [ 3.62168491e-01  1.25108421e-01 -5.76131523e-01 ... -5.00924826e-01
    -6.72146320e-01 -1.65072083e-01]]

  [[-1.08642913e-01  4.94845331e-01 -9.10507381e-01 ...  1.79240718e-01
    -1.56138957e-01 -1.95835400e+00]
   [-2.68791735e-01  1.88738406e-01 -2.11162627e-01 ...  1.95018947e-03
    -5.61707079e-01 -1.93135965e+00]
   [-4.12897766e-01 -3.35227340e-01  9.08069611e-01 ... -2.63537973e-01
    -9.68743563e-01 -1.20778990e+00]
   ...
   [-1.62071332e-01  4.46958005e-01  5.65382063e-01 ...  1.48923206e+00
     1.48068130e+00  1.56304622e+00]
   [ 4.44034278e-01 -2.04093724e-01 -2.64475703e-01 ... -9.03847754e-01
     4.64929491e-01 -1.76124597e+00]
   [ 2.41001919e-02  1.32405937e-01  2.67979145e-01 ...  1.27929568e+00
    -5.08562684e-01 -3.42044353e-01]]

  [[ 8.12354863e-01 -1.94242382e+00  2.53800416e+00 ... -5.59932087e-04
    -5.57049394e-01  2.05057526e+00]
   [ 4.13025171e-01 -2.59389281e-02 -2.59224892e-01 ...  1.13577497e+00
     2.95841026e+00 -2.97223043e+00]
   [ 7.99629569e-01 -9.85594332e-01  1.37959301e+00 ...  7.09049582e-01
    -3.19452167e-01  1.00953162e+00]
   ...
   [ 4.16173428e-01 -5.01366317e-01  6.83909655e-02 ...  3.94708157e-01
     3.79981875e-01 -7.26426959e-01]
   [-1.56855214e+00 -4.76175427e-01 -1.17017829e+00 ... -9.29960370e-01
     1.17733037e+00 -1.88426721e+00]
   [-8.89138103e-01  4.08152342e-02  6.50491774e-01 ... -2.50984788e-01
     5.41734099e-01  3.45794767e-01]]

  ...

  [[-3.33693504e+00  2.52770519e+00 -2.81408250e-01 ...  6.57395184e-01
     7.28161275e-01 -2.09349346e+00]
   [-1.96665144e+00 -7.60261059e-01 -5.08257270e-01 ... -3.21491510e-02
     6.99217200e-01  8.36895406e-01]
   [-3.55896473e-01  2.16685653e+00 -7.73211122e-01 ...  1.23213840e+00
     2.32373103e-01 -1.97820783e+00]
   ...
   [ 5.37172928e-02 -3.81488323e-01  4.79379147e-01 ... -2.97695398e-01
    -3.64379108e-01  5.50756097e-01]
   [-5.49640775e-01 -4.08615798e-01  1.20350850e+00 ... -1.22697544e+00
    -1.60642779e+00  2.01526117e+00]
   [ 2.00721741e-01 -2.12198228e-01  8.22655082e-01 ... -9.46224511e-01
    -4.34228718e-01  9.39361870e-01]]

  [[ 9.74743068e-01 -4.56221074e-01  8.52239251e-01 ...  8.89442861e-01
    -6.04839087e-01 -2.97298819e-01]
   [ 7.57520139e-01  1.77382290e+00  2.61249840e-01 ... -2.29002476e+00
    -1.75549507e-01  1.06816673e+00]
   [ 1.66542470e-01 -2.96084404e-01 -1.26760912e+00 ...  8.15469325e-02
     4.60680157e-01  6.96373820e-01]
   ...
   [-1.09702098e+00 -8.37583423e-01 -5.00708103e-01 ...  5.46397507e-01
    -5.78725755e-01  5.43211699e-01]
   [ 1.64058670e-01 -6.34329081e-01 -4.36089993e-01 ... -1.20245546e-01
     4.80881333e-02 -1.38670194e+00]
   [ 2.19546750e-01 -1.11321759e+00  2.51625985e-01 ... -2.15958163e-01
    -4.34738398e-01 -9.51468587e-01]]

  [[-2.57644463e+00  3.59935611e-01  1.04213428e+00 ... -6.26056910e-01
    -5.16646028e-01  1.65048623e+00]
   [-2.32692957e-02  1.12777805e+00 -2.71035820e-01 ... -8.31319749e-01
     1.27803993e+00  1.24677789e+00]
   [-1.12399721e+00  7.84025133e-01  2.94780552e-01 ... -7.45897472e-01
     4.99859780e-01  1.42394948e+00]
   ...
   [-8.80785942e-01  5.62168717e-01  9.62531418e-02 ... -2.35306099e-01
     2.95695186e-01 -4.03274387e-01]
   [-1.80555260e+00  3.71082872e-01  5.27578712e-01 ... -4.89081562e-01
    -1.20152846e-01  8.30838144e-01]
   [ 6.49180114e-02  3.90921414e-01  1.01945311e-01 ...  5.53815126e-01
     4.23582345e-01  4.38757360e-01]]]


 [[[-5.58018446e-01 -2.59619570e+00 -8.55319083e-01 ...  1.77737689e+00
    -1.69964403e-01  2.62572360e+00]
   [-5.71741402e-01 -2.53597188e+00 -7.75540829e-01 ...  1.67979658e+00
    -1.54332072e-01  2.63889980e+00]
   [-3.03634554e-01 -3.01727086e-01  4.37284321e-01 ... -2.98006594e-01
     8.49179924e-02  9.68526900e-01]
   ...
   [ 7.69319773e-01 -9.32197213e-01  1.77951670e+00 ...  6.89521253e-01
    -5.24875522e-02  9.84754384e-01]
   [ 4.66630101e-01 -2.24785018e+00  9.65893567e-01 ...  1.89549518e+00
     3.35151196e+00  1.16855180e+00]
   [ 1.58572578e+00 -2.54476047e+00  7.97629356e-01 ...  1.60726011e+00
     2.17554331e+00  1.06432796e+00]]

  [[ 1.15905404e+00 -1.74042296e+00  1.22544169e+00 ... -2.43289232e+00
     8.34249079e-01 -1.43135464e+00]
   [ 1.05719721e+00 -8.71141255e-01  3.00047565e+00 ... -5.17996848e-01
     1.37865746e+00 -1.65410876e-01]
   [ 1.00851488e+00 -1.46385074e+00  1.43720388e+00 ... -2.39670181e+00
     8.63785744e-01 -1.31345642e+00]
   ...
   [ 4.20442045e-01 -3.50320548e-01  1.25352955e+00 ... -2.04647827e+00
     4.21821773e-01 -1.50310111e+00]
   [-5.93016207e-01 -4.86405551e-01 -2.14733422e-01 ...  1.71686143e-01
     5.96841455e-01 -9.85887408e-01]
   [-1.56679958e-01 -1.43146023e-01  1.01901710e+00 ... -1.27776170e+00
     6.55081809e-01 -6.93887174e-01]]

  [[-1.90798426e+00 -6.87051892e-01 -2.62374550e-01 ...  1.05238163e+00
     7.58074582e-01 -1.61847258e+00]
   [ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [-1.04696083e+00  8.39102328e-01 -7.53290832e-01 ...  5.45104183e-02
     6.84192598e-01 -2.91862392e+00]
   ...
   [-1.74058425e+00 -5.38189888e-01 -1.27251911e+00 ...  3.60746324e-01
     8.24135542e-01 -2.65114212e+00]
   [-1.00933301e+00 -3.47437292e-01  6.24679923e-01 ...  1.56430081e-01
    -3.72718871e-02 -1.01788855e+00]
   [-9.06025231e-01  1.06564653e+00 -3.67266715e-01 ...  9.62840617e-01
     1.28341187e-02 -1.61181593e+00]]

  ...

  [[ 9.33918133e-02 -3.38961601e-01 -2.66901922e+00 ...  2.79383445e+00
     6.91826820e-01  5.42460322e-01]
   [ 1.28744230e-01 -4.41653967e-01 -2.56017137e+00 ...  2.69068551e+00
     6.61756516e-01  5.93239427e-01]
   [ 9.10353512e-02 -1.32295895e+00 -1.02454340e+00 ...  8.19358110e-01
    -1.56150430e-01  7.95906782e-01]
   ...
   [ 3.75553906e-01 -7.09119886e-02 -6.56312823e-01 ... -2.30068296e-01
    -6.60074890e-01  8.88773739e-01]
   [-1.83948874e-01 -3.98976862e-01 -9.74370480e-01 ...  5.48821986e-01
    -3.51456195e-01  2.69939184e-01]
   [-1.30411637e+00  9.17844653e-01 -9.17613089e-01 ... -1.01106417e+00
    -7.12455332e-01  1.05230562e-01]]

  [[ 1.71476221e+00  1.15988874e+00  1.87364972e+00 ...  7.84420729e-01
    -9.89434898e-01 -1.31717193e+00]
   [ 1.21469164e+00  9.15790677e-01  1.51445305e+00 ...  8.36512685e-01
    -7.81823397e-01 -7.51220703e-01]
   [-7.34086037e-01 -4.96707380e-01  4.04226005e-01 ... -1.68514550e+00
    -9.44302738e-01  1.40023923e+00]
   ...
   [-8.53290737e-01  5.75351179e-01  4.58847225e-01 ...  2.83664525e-01
    -1.36248678e-01 -2.64593065e-02]
   [-8.17043185e-01  7.56789982e-01  8.71214151e-01 ...  2.03953177e-01
    -2.88370430e-01 -5.53507984e-01]
   [-2.71746248e-01 -4.78595734e-01  1.03931963e+00 ... -3.30825233e+00
    -1.75693142e+00  5.17006397e-01]]

  [[ 5.06350219e-01  1.32385290e+00 -2.56270099e+00 ...  7.18286395e-01
    -5.20129800e-01  1.70674831e-01]
   [-8.60643014e-02 -5.06062925e-01  3.42647552e-01 ...  1.40352920e-01
     2.73786128e-01  9.83596802e-01]
   [-1.20731622e-01 -4.40794557e-01  4.96990860e-01 ...  1.47657827e-01
     2.87844688e-01  8.02182794e-01]
   ...
   [ 4.83587325e-01  1.17127752e+00  2.16478527e-01 ...  4.38830018e-01
    -1.37858763e-01 -4.47489709e-01]
   [ 2.97087967e-01  1.30885541e+00 -1.55114603e+00 ...  3.06451321e-01
    -4.89314169e-01  6.69429898e-01]
   [ 5.42326272e-01  7.73510575e-01  3.81412983e-01 ...  6.84003055e-01
    -2.10783437e-01 -3.17981780e-01]]]


 [[[-8.50064814e-01 -1.42857540e+00 -2.80589685e-02 ...  1.06838666e-01
     2.70102191e+00  2.05848503e+00]
   [-8.01909447e-01 -1.34764802e+00 -2.64694560e-02 ...  1.00786358e-01
     2.54801178e+00  1.94187391e+00]
   [-7.39975095e-01 -1.24520814e+00 -1.92725305e-02 ...  1.00393958e-01
     2.34488606e+00  1.78072655e+00]
   ...
   [-1.10716790e-01 -4.82840538e-01  1.02218136e-01 ... -2.92010844e-01
    -2.80653030e-01  2.73010671e-01]
   [-4.93608594e-01 -7.87164927e-01  8.42456520e-02 ... -3.55253577e-01
     2.32951015e-01  8.28024864e-01]
   [-3.62903982e-01  9.36302483e-01  1.01086056e+00 ...  6.90571666e-02
     3.19983542e-01  7.56695807e-01]]

  [[ 2.15103090e-01  1.06647146e+00  3.78134817e-01 ... -4.99942660e-01
     2.03401983e-01 -2.14995074e+00]
   [ 1.86021164e-01  1.06425250e+00  4.02105391e-01 ... -4.55459952e-01
     1.80872709e-01 -2.06586719e+00]
   [ 2.85228193e-01  4.62182492e-01  1.63079369e+00 ...  3.25105000e+00
     1.49038994e+00 -7.06218839e-01]
   ...
   [-1.22752881e+00  8.45273733e-01  1.60493612e+00 ...  1.85636365e+00
    -9.09007907e-01  2.42010379e+00]
   [ 4.98922676e-01 -5.89296818e-01  2.38539934e-01 ...  1.16451643e-01
     5.18669486e-01 -2.74631023e-01]
   [-3.63834977e-01 -9.42648113e-01  5.91054976e-01 ... -6.66119397e-01
    -2.03453824e-01  4.74575669e-01]]

  [[-1.85111642e+00  2.09157920e+00  2.86882460e-01 ... -5.19811690e-01
     2.05612481e-01  2.51445770e-01]
   [-1.71900618e+00  1.87039769e+00  5.85890561e-02 ... -5.48945487e-01
     1.52490377e-01  3.29988152e-02]
   [-1.82015598e+00  2.03473568e+00  2.39021882e-01 ... -5.28222561e-01
     1.89370483e-01  2.05119595e-01]
   ...
   [-2.54207969e-01 -2.30750942e+00  2.49396116e-02 ... -1.54902601e+00
    -1.76857054e+00 -2.61515677e-01]
   [-1.50543833e+00  6.42960489e-01 -3.16290647e-01 ...  1.91602492e+00
    -2.50301194e+00 -5.18292606e-01]
   [-8.37749004e-01 -9.04044449e-01 -4.68748897e-01 ... -3.24691862e-01
    -5.05454719e-01 -4.16478515e-01]]

  ...

  [[-3.81195068e-01  4.62803870e-01  1.15634763e+00 ...  3.82096797e-01
    -3.00082088e+00  1.37392557e+00]
   [-3.28766286e-01  4.89813745e-01  8.62709224e-01 ...  5.14064789e-01
    -2.50129128e+00  1.07106447e+00]
   [ 4.66503650e-02  6.71103001e-01 -1.28830421e+00 ...  1.47852957e+00
     1.18475926e+00 -1.13030350e+00]
   ...
   [-6.54701531e-01  1.72166839e-01 -1.96638465e-01 ... -4.09423411e-01
    -3.71878386e-01  1.77383614e+00]
   [ 3.65034461e-01 -9.31289017e-01  1.12766314e+00 ... -5.63041151e-01
    -5.46963930e-01  1.28839183e+00]
   [-6.98896348e-02  2.51635075e-01  5.78953028e-01 ...  2.57540345e-01
    -1.19697416e+00  1.29433322e+00]]

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [-2.04000378e+00 -1.42655981e+00  5.60651064e-01 ...  5.08479953e-01
    -5.31973898e-01 -1.38490915e-01]
   [-2.08994722e+00 -1.18981481e+00  6.28036678e-01 ...  5.76762140e-01
    -4.40766633e-01 -1.65894151e-01]
   ...
   [ 1.20329702e+00  6.08143330e-01  6.85967207e-01 ...  2.24076819e+00
    -3.20530683e-01 -2.00783205e+00]
   [-1.28037989e+00 -1.47345948e+00 -8.90369415e-02 ... -5.05413115e-01
    -3.19186598e-01  1.85506403e-01]
   [ 3.33543830e-02 -9.96513009e-01 -1.30889559e+00 ...  6.85186207e-01
     3.63192797e-01 -7.24361062e-01]]

  [[-9.37368631e-01  1.89797997e+00  7.10287333e-01 ... -3.52320218e+00
     1.93573058e-01  3.78565121e+00]
   [ 5.50879896e-01 -3.66968811e-01 -2.39907646e+00 ... -2.35867858e+00
    -5.92676342e-01 -1.03357971e+00]
   [ 4.57158029e-01  9.23636794e-01 -3.21105909e+00 ...  1.33900177e+00
     4.25627172e-01 -6.07378900e-01]
   ...
   [ 4.50780898e-01  2.43479609e-02  6.61099553e-01 ...  1.70800352e+00
     5.58783352e-01  2.34279603e-01]
   [-1.27451032e-01 -2.30846000e+00  1.40785784e-01 ... -1.66719645e-01
    -5.59109092e-01 -6.49723411e-01]
   [ 1.90829426e-01 -7.04484463e-01 -1.93689466e-01 ...  2.50799656e-01
    -4.41140771e-01 -2.41706371e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-False-32-8-27-5-4] q.shape1: (4, 5, 27)
q.shape2: (20, 27)
q.shape3: (20, 27)
q.shape4: (4, 5, 27)
q_liner: [[[-0.45098242 -1.8597655  -0.18044868 ...  0.44736165 -0.7812911
   -1.3717854 ]
  [-1.5089675  -1.1255506   0.2868886  ... -0.59291077 -4.2512317
    1.4017425 ]
  [-0.5946903   1.0263848  -0.581638   ... -2.404116    1.5132208
   -2.4856858 ]
  [-0.31688586  0.5528781  -0.47048947 ... -3.4016237   0.32389942
    0.792212  ]
  [ 0.5705429  -1.4638315  -1.4060916  ...  0.13239647 -0.5641086
   -0.13941243]]

 [[-0.48622677  0.58664197 -0.8507686  ... -1.5951675   0.925034
   -0.5789255 ]
  [ 0.01250784  0.25906408 -1.4820709  ...  0.27701774  0.5088146
   -1.5133849 ]
  [ 1.8713679  -1.6441332  -0.23689705 ...  1.4759529   0.59806687
    1.3676002 ]
  [-1.7826599  -0.49967122 -0.13877729 ... -2.3092782  -0.94425666
   -0.67025876]
  [-1.9854672  -0.1258095  -1.3325741  ... -1.2256528   0.3417048
   -1.306887  ]]

 [[ 0.08923486  0.40770042 -1.179379   ... -2.331579    1.0649294
   -1.4443758 ]
  [-0.9717777  -1.0941966   0.10684844 ... -1.3449765   1.5412539
    1.2202598 ]
  [-1.9089527  -0.49968353 -0.7305629  ... -0.31890056  0.05979536
   -0.012014  ]
  [ 0.8310763  -0.54699767 -2.0045776  ...  1.1674603  -0.8113642
    2.5285468 ]
  [-0.6054805   0.17777057 -0.3048614  ... -3.8101263   0.3146161
    0.12864286]]

 [[-1.0738884   0.71441424  1.0330291  ...  2.1741905  -0.05606912
   -2.2165117 ]
  [ 2.8600929   2.6552117   1.1548573  ...  0.5743336  -0.509936
   -1.0215002 ]
  [-0.7602025  -2.2237754  -0.00880858 ... -1.8565426   0.769028
    1.1017362 ]
  [ 0.56063324  2.2217884   1.0828177  ...  1.7795794  -0.57600886
    1.1000314 ]
  [-0.13495904 -2.4847577  -0.8736484  ... -0.4826979   0.6778818
    1.9465017 ]]]
q.shape5: (4, 5, 256)
q.shape6: (4, 8, 5, 32)
attn_res: [[[[-1.56702709e+00 -4.69070792e-01  1.03741959e-01 ... -4.60170656e-02
    -6.94522262e-01 -1.22118497e+00]
   [ 1.34373820e+00 -1.87690783e+00  1.60815990e+00 ... -2.45289063e+00
     1.03603557e-01 -1.10723637e-01]
   [-2.47734562e-01 -1.11027777e+00  1.28638595e-02 ...  4.38867569e-01
    -4.15985912e-01 -1.17019224e+00]
   [ 3.39969158e-01 -1.05182672e+00  2.34179348e-01 ... -1.05900204e+00
    -1.41077667e-01 -1.40954018e-01]
   [ 6.53426409e-01 -1.67093396e+00  6.73505664e-02 ... -5.32993376e-01
     5.73118508e-01 -2.86715448e-01]]

  [[-1.44017529e+00  9.08970088e-02 -2.84626102e+00 ...  5.18329620e-01
    -8.43587518e-01 -6.35888755e-01]
   [-1.26445794e+00  6.64104521e-01 -1.76885891e+00 ...  8.32142383e-02
    -3.16542238e-02 -4.10565615e-01]
   [-2.91539192e-01  1.08404827e+00  1.07546723e+00 ... -1.51263207e-01
     5.14646620e-03 -9.95201692e-02]
   [-2.60757893e-01  8.69082689e-01  1.88403070e-01 ...  1.17581084e-01
    -3.54902267e-01 -3.79877687e-02]
   [-2.17446494e+00  2.18828678e-01 -2.36754990e+00 ... -2.19945759e-01
    -4.03808087e-01 -9.30400312e-01]]

  [[ 6.01317883e-01  9.55170020e-02 -1.26648396e-02 ...  1.79502106e+00
     2.33753193e-02 -6.73947930e-01]
   [ 2.65852436e-02 -3.43534321e-01 -8.45857382e-01 ...  2.45785379e+00
    -2.19996437e-01 -1.06374931e+00]
   [-8.32648098e-01  7.41541147e-01 -1.91799387e-01 ...  1.82947874e+00
    -3.89758766e-01 -4.07424927e-01]
   [-1.38203096e+00  9.40560341e-01 -1.78886414e-01 ...  1.86726308e+00
    -5.10746241e-01 -3.19562137e-01]
   [ 3.88046026e-01  2.92600483e-01  3.86031151e-01 ...  1.26619840e+00
     1.69493631e-01 -5.40767193e-01]]

  ...

  [[-1.51166654e+00  7.55853951e-01 -5.82133770e-01 ... -1.82383823e+00
    -1.76628685e+00 -1.22697937e+00]
   [-6.25697851e-01  8.96329403e-01  4.85139132e-01 ... -9.24069583e-02
     2.77800620e-01 -6.17886186e-01]
   [-6.81496263e-01  1.07175970e+00  1.15158892e+00 ...  1.92329419e+00
     9.19528306e-02 -2.62070251e+00]
   [-6.14558876e-01  1.02183807e+00  1.02718234e+00 ...  1.80180430e+00
     2.71175802e-01 -2.35579133e+00]
   [-1.31311369e+00 -3.58441949e-01  1.10824716e+00 ... -1.40534306e+00
    -2.32291722e+00 -4.88947928e-02]]

  [[-4.93589729e-01  3.42095882e-01  5.43111324e-01 ... -1.15608239e+00
     2.19779581e-01 -9.57073569e-02]
   [-2.96260691e+00  4.39988405e-01  2.08290172e+00 ... -8.37974072e-01
    -1.24943292e+00  3.87533605e-01]
   [ 8.92996788e-01  7.83096433e-01  4.43976194e-01 ...  8.27526569e-01
     2.33507901e-01  9.29447770e-01]
   [ 5.25755763e-01  5.09026647e-02  3.85629952e-01 ...  1.45974302e+00
     1.21113253e+00  1.25302744e+00]
   [ 4.43685055e-01  1.95801958e-01  3.36557090e-01 ...  3.51673007e-01
     1.07864046e+00  7.42618382e-01]]

  [[-3.36625367e-01 -1.61177158e-01 -1.29719317e-01 ... -1.91846287e+00
    -8.95335913e-01  1.82528055e+00]
   [-6.38334990e-01 -1.14805508e+00  1.17623675e+00 ... -1.20375454e+00
    -6.50162339e-01  2.69352406e-01]
   [-1.35917366e-02 -6.40449643e-01  1.36864114e+00 ... -1.23321176e-01
    -1.20484984e+00 -1.66842222e-01]
   [-1.55946827e+00 -1.42975676e+00 -6.58733368e-01 ... -2.78247857e+00
     1.79346740e-01  7.02253282e-01]
   [-1.51875153e-01 -9.10536647e-01  8.98156166e-01 ... -3.90620172e-01
    -6.59721553e-01 -2.62063622e-01]]]


 [[[ 1.02128386e+00  1.89331222e+00 -1.82447994e+00 ... -1.72148481e-01
     1.56875062e+00  1.20214224e+00]
   [-1.19669223e+00  9.87060606e-01  1.21227115e-01 ... -2.09882474e+00
     1.88477004e+00 -3.89605850e-01]
   [-5.58194518e-01 -1.40627280e-01 -5.69545448e-01 ... -1.43428445e+00
     1.63414097e+00  8.84232581e-01]
   [-5.89181960e-01  1.16819477e+00 -4.85370159e-01 ... -1.57468796e+00
     1.79752541e+00  1.40145004e-01]
   [-6.41471267e-01  1.22276855e+00 -3.73080522e-01 ... -1.61741722e+00
     1.81115055e+00  9.81786847e-03]]

  [[-4.79137063e-01  1.46417272e+00  8.48199651e-02 ...  1.29226327e+00
    -3.63881230e-01  1.11753619e+00]
   [-6.17801607e-01  5.56016088e-01 -4.82818186e-01 ...  8.43796670e-01
    -8.57671201e-01  7.31076896e-01]
   [-1.96516514e-01  1.30504143e+00 -7.34060109e-02 ...  1.39488995e+00
    -5.56907535e-01  1.10439324e+00]
   [-5.05975485e-01  1.20754218e+00 -5.32435626e-02 ...  1.16702330e+00
    -4.99629915e-01  9.78694141e-01]
   [-5.28654695e-01  1.49967635e+00 -1.44985661e-01 ...  1.10563707e+00
    -4.28476721e-01  1.09400499e+00]]

  [[-5.45800179e-02  1.28369570e+00 -9.64088976e-01 ... -1.96408287e-01
     1.55757093e+00 -9.02773023e-01]
   [-1.57994211e+00 -7.99721777e-01  9.62946594e-01 ... -1.91509902e+00
     6.81343615e-01 -8.66802871e-01]
   [-4.07678127e-01  1.42936504e+00 -1.05495703e+00 ...  1.24318564e+00
     1.59017980e+00 -1.15751910e+00]
   [-2.10425615e+00 -1.42341876e+00  1.12815070e+00 ... -3.52821827e+00
     8.19252193e-01 -1.23219848e+00]
   [-5.55289865e-01  7.36188412e-01 -1.09066534e+00 ... -2.29375750e-01
     1.67534554e+00 -1.63957262e+00]]

  ...

  [[ 1.78766823e+00  1.04978013e+00 -5.62477350e-01 ... -2.73860663e-01
    -1.20623159e+00 -1.13509858e+00]
   [ 6.72967494e-01 -5.88333845e-01  7.26466626e-02 ...  2.06838560e+00
    -6.69027686e-01 -4.55583543e-01]
   [ 7.03347564e-01 -3.22052389e-01  7.63184875e-02 ...  5.19870460e-01
    -1.65682352e+00  7.49998629e-01]
   [ 1.76716125e+00  1.03831005e+00 -5.32337427e-01 ... -2.81604230e-01
    -1.18445826e+00 -1.15401649e+00]
   [ 1.74972701e+00  1.02007866e+00 -5.36142588e-01 ... -2.68191457e-01
    -1.19312465e+00 -1.10187018e+00]]

  [[-1.38562608e+00  4.97253239e-01 -2.32874918e+00 ... -1.11612606e+00
    -2.11440587e+00  5.38027108e-01]
   [-1.36788023e+00  3.81446704e-02 -8.71632397e-01 ... -1.30501246e+00
     1.16324496e+00 -3.64410460e-01]
   [-1.41172481e+00  3.60568404e-01 -2.05526376e+00 ... -7.84336805e-01
    -1.22450542e+00  6.37136102e-01]
   [-1.22785115e+00  1.13737667e+00 -1.04531920e+00 ... -3.15497518e-02
    -4.63567317e-01  7.97720253e-01]
   [-1.20292854e+00  3.48198861e-01 -1.74205816e+00 ... -1.10957623e+00
    -8.67623329e-01  1.73768699e-01]]

  [[-2.29939491e-01 -7.30436504e-01  1.43328142e+00 ... -1.49916875e+00
    -6.26002610e-01  1.82993069e-01]
   [-1.69371414e+00  2.34341836e+00  7.66104400e-01 ...  4.71501976e-01
     2.19430193e-01  2.05184984e+00]
   [ 5.09898067e-01 -1.23520386e+00  1.13940787e+00 ... -4.47105110e-01
     1.90690711e-01 -4.49921936e-01]
   [-6.20306075e-01  2.81837165e-01  1.09023380e+00 ...  2.04171205e+00
     5.31314671e-01  5.88144839e-01]
   [ 1.53559953e-01 -7.34196007e-01  1.03098571e+00 ...  1.24604261e+00
     6.45786822e-01 -1.56373143e-01]]]


 [[[ 2.17031792e-01 -8.93665195e-01  4.79319304e-01 ... -5.98767519e-01
    -5.98687977e-02 -3.95329833e-01]
   [ 5.09882033e-01 -4.08282518e-01  6.92143381e-01 ... -6.03563726e-01
    -9.47645307e-03 -4.23601657e-01]
   [ 8.53448570e-01 -1.96952188e+00 -1.92701951e-01 ... -1.49076492e-01
     1.26771402e+00  1.23156023e+00]
   [ 9.33731347e-02 -7.34546065e-01  6.76384211e-01 ... -6.87915623e-01
    -3.32174242e-01 -2.65301049e-01]
   [ 4.03230011e-01 -1.44863486e+00  6.05166674e-01 ... -4.70452726e-01
     1.44024298e-01 -2.44865417e-01]]

  [[ 1.28284931e-01  1.80260074e+00  8.02773774e-01 ...  6.39983892e-01
     1.08295596e+00 -8.38819623e-01]
   [-2.33669370e-01  6.38764322e-01  3.22900042e-02 ...  3.52664411e-01
     3.36706728e-01  1.20647103e-01]
   [ 3.69532198e-01  1.04311824e+00  5.01114488e-01 ... -3.79459411e-01
     6.92921519e-01 -1.69010401e-01]
   [ 2.39660072e+00  6.13580525e-01 -1.91486013e+00 ... -8.26972127e-01
    -2.55018294e-01 -9.21954438e-02]
   [ 5.78466296e-01  2.83318162e+00  1.51391399e+00 ...  9.15881634e-01
     1.89619613e+00 -2.07890582e+00]]

  [[-9.52505350e-01 -8.17057341e-02 -6.29002333e-01 ...  1.00384855e+00
    -2.77309299e-01  2.04102457e-01]
   [ 2.73053259e-01  6.28243983e-02  5.18802285e-01 ...  7.96359479e-01
    -6.45851016e-01  1.63498950e+00]
   [-1.25314629e+00 -8.33077654e-02 -7.99861372e-01 ...  1.08737493e+00
    -4.61701035e-01  4.80048001e-01]
   [ 3.31220865e-01 -7.72794411e-02  8.89608383e-01 ...  1.87895274e+00
    -1.42876074e-01 -1.66795671e-01]
   [ 5.96211553e-01  3.86731416e-01  1.40645719e+00 ...  1.52969158e+00
    -1.29963422e+00  2.39882588e+00]]

  ...

  [[-1.11893308e+00 -1.13183689e+00  1.04869068e+00 ...  1.15212512e+00
     7.66782999e-01  3.08210671e-01]
   [-7.15536833e-01 -6.19668663e-02  4.75941539e-01 ...  1.72181797e+00
    -1.52941853e-01  3.62706870e-01]
   [-1.14136088e+00 -1.90706718e+00  1.48624456e+00 ...  5.57256401e-01
     1.13050377e+00  1.45132214e-01]
   [-1.37537205e+00 -7.27325559e-01  1.08424604e+00 ...  3.12203312e+00
    -1.30527735e+00 -1.49004191e-01]
   [-7.18746841e-01 -1.01146007e+00  9.61373270e-01 ...  9.70084667e-01
     1.34036195e+00 -6.56575412e-02]]

  [[-2.51382381e-01 -9.64822173e-01  3.06302726e-01 ... -5.40588498e-01
    -4.33517694e-02 -1.50568771e+00]
   [ 1.39548868e-01 -4.44400877e-01  6.35194302e-01 ... -3.66480410e-01
    -5.53633869e-01 -1.56284726e+00]
   [ 1.39373016e+00  3.12609255e-01  5.70497930e-01 ...  1.06231719e-01
     2.56087184e-02 -1.93411589e+00]
   [ 2.39282703e+00  2.16998625e+00  1.16325188e+00 ...  7.17327178e-01
    -8.04124117e-01 -2.46965456e+00]
   [-2.01281309e-02 -2.24964213e+00 -2.41621196e-01 ... -7.50214159e-01
     1.15825593e+00 -1.19672751e+00]]

  [[ 1.33035421e+00 -5.61577678e-01  4.96510059e-01 ... -8.61714482e-02
    -1.57295406e+00 -1.30761945e+00]
   [-2.31306839e+00  2.82251120e-01 -8.74774277e-01 ... -5.57909966e-01
    -1.17230201e+00  7.50962913e-01]
   [-4.29361492e-01 -1.27234125e+00  6.23594999e-01 ... -1.42590845e+00
     6.96448684e-01 -1.53579104e+00]
   [ 6.86049998e-01 -6.24845862e-01 -1.42237008e-01 ... -6.09106362e-01
    -1.63264334e+00 -9.89313781e-01]
   [-1.83857000e+00 -5.37121832e-01 -1.53068632e-01 ... -1.01773357e+00
    -2.09945753e-01 -1.26641542e-01]]]


 [[[ 7.67067909e-01  2.64365971e-03  4.51253802e-01 ...  1.88307747e-01
    -4.73680645e-01 -1.15011103e-01]
   [ 2.69057572e-01  7.08511531e-01 -7.47541487e-02 ...  8.43941391e-01
    -3.33656490e-01 -1.41332954e-01]
   [ 5.96109092e-01  5.20269752e-01  5.28493166e-01 ...  2.29458556e-01
    -6.36419475e-01  4.01237667e-01]
   [ 6.20582402e-01  2.96906531e-01  6.94273531e-01 ...  2.68908083e-01
    -6.76946938e-01 -1.84208825e-02]
   [ 3.64239186e-01 -2.38895416e-02  2.57039368e-01 ...  6.66535258e-01
    -3.63745302e-01 -4.10947442e-01]]

  [[-1.01672137e+00 -2.34287217e-01 -1.22632098e+00 ... -1.35060477e+00
    -7.64353573e-01  4.13082212e-01]
   [ 8.99248242e-01 -9.69253778e-01 -1.09630787e+00 ... -1.28554416e+00
    -2.47743273e+00  1.26563907e-01]
   [-1.38176250e+00 -1.01469062e-01 -1.28947985e+00 ... -1.74894953e+00
    -7.11818993e-01  6.64007008e-01]
   [ 5.20644225e-02 -6.78850293e-01 -1.18712139e+00 ... -1.42186046e+00
    -1.86028266e+00  3.15024167e-01]
   [-9.35102165e-01 -3.20369542e-01 -1.20892096e+00 ... -7.98875272e-01
    -5.75031161e-01  1.29331261e-01]]

  [[-2.55074948e-01  3.80396664e-01  2.26176441e-01 ...  1.65664583e-01
     1.69966483e+00  9.05800164e-01]
   [ 2.60849953e-01  5.89063644e-01  8.64367664e-01 ...  3.71169806e-01
     1.45791799e-01  3.49354774e-01]
   [-6.02355778e-01  8.40670526e-01  6.86249614e-01 ... -3.12309831e-01
     1.66170740e+00  1.10639513e+00]
   [-2.05644920e-01 -1.84751809e-01 -3.12842876e-01 ...  8.65019202e-01
     2.69733024e+00  1.01773620e+00]
   [-7.38390628e-03  7.59679854e-01  1.10409570e+00 ...  2.68496662e-01
     7.26548582e-02  3.32303584e-01]]

  ...

  [[-5.49745440e-01 -2.54665464e-01  9.06367421e-01 ... -1.18115699e+00
     6.49969697e-01  2.37556696e-02]
   [-1.57753897e+00 -8.09494674e-01 -3.09269875e-01 ... -1.68715429e+00
     7.31943011e-01 -1.29754329e+00]
   [-9.05243337e-01 -1.89556539e-01  1.82428300e+00 ... -1.99810290e+00
    -4.48364288e-01  1.04659271e+00]
   [-4.47614819e-01  3.68031293e-01  6.14831507e-01 ...  9.55482125e-01
     1.43431747e+00 -2.14187413e-01]
   [-6.90640092e-01 -5.77002764e-03  1.28608632e+00 ... -7.88958609e-01
     3.67644310e-01  4.86574799e-01]]

  [[ 4.64426517e-01 -2.28054374e-01 -5.41122139e-01 ...  2.83815145e-01
    -3.26753676e-01  6.97891057e-01]
   [ 1.85270298e+00  5.70341527e-01 -1.19638240e+00 ...  6.28725469e-01
    -1.14734221e+00  1.83232367e+00]
   [ 1.37614739e+00 -1.01428771e+00  2.38318399e-01 ...  4.56527501e-01
     3.03979635e-01 -9.37716663e-01]
   [ 2.11364722e+00  3.02497864e-01 -6.97543323e-02 ...  1.39769375e+00
    -8.95362020e-01  2.35998964e+00]
   [ 5.82875848e-01  4.31003600e-01 -1.05339491e+00 ...  2.97629923e-01
    -7.61801302e-01  1.39633799e+00]]

  [[-2.82428324e-01 -1.40270448e+00 -1.25910592e+00 ... -1.34440517e+00
    -4.25813526e-01  1.32088333e-01]
   [-6.54487193e-01 -1.90926719e+00 -1.03985667e+00 ... -1.17665696e+00
    -1.70531482e-01  4.23851490e-01]
   [-3.76650244e-01 -1.25653672e+00 -1.04679728e+00 ... -6.09375834e-01
     6.08650088e-01  3.15298289e-01]
   [-1.51076615e-01 -1.38982916e+00 -1.07708681e+00 ... -9.48211133e-01
     3.37444454e-01 -3.88458371e-04]
   [-1.90700263e-01 -6.49843812e-01 -1.31630707e+00 ... -1.32001901e+00
    -3.52316290e-01  2.72502825e-02]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-False-32-8-27-5-8] q.shape1: (8, 5, 27)
q.shape2: (40, 27)
q.shape3: (40, 27)
q.shape4: (8, 5, 27)
q_liner: [[[ 0.15200195  0.42109513  0.18947552 ... -1.7429332  -0.884225
   -0.31648648]
  [-0.7228274   0.49029985  0.58301187 ...  2.1885214  -0.0600438
    2.0428016 ]
  [-0.5260736   0.6122724   1.230041   ... -2.247764    0.22396035
   -1.7408255 ]
  [ 0.3971978   0.6543124   0.09537844 ...  1.0527573   2.5283172
    1.3539605 ]
  [-2.2944772  -1.2713732  -0.40413117 ... -2.6895072   1.2463971
    1.2484484 ]]

 [[-1.1593062  -0.88011456 -1.8108406  ... -1.7323458   1.1656864
   -0.8288701 ]
  [ 0.9558412  -0.23498295  2.5545676  ... -3.0560331  -2.0548534
   -2.2333834 ]
  [-1.7470472  -2.397768   -2.3310997  ...  0.24311645 -0.14915928
    0.7152957 ]
  [ 0.8987072   1.1873528  -0.1076384  ...  2.544962    0.67048955
    0.5840135 ]
  [ 2.0645623   0.3715976   0.32978135 ...  1.3476607   0.29302907
   -0.27270532]]

 [[-0.00490406 -0.09373393  1.1604989  ... -0.68984926  1.4405506
    0.73424846]
  [-0.04013184 -0.74264437  0.7171273  ...  0.84781003 -0.8189953
    1.0422674 ]
  [ 1.3068575   1.0912939  -0.5706339  ...  0.6620283   0.5126465
    1.2609537 ]
  [-1.4994876   1.0570574  -2.6855764  ...  1.9866219   1.5518488
   -0.75737226]
  [ 1.1151257  -2.2495382   0.6445344  ... -1.7265897  -0.9692527
    1.5563262 ]]

 ...

 [[-1.2600608   0.42844266 -1.0461015  ...  0.44042793  0.8438229
    0.35004798]
  [-0.80994964  0.90170777 -1.5636967  ...  1.9153154   0.15813263
    0.75824195]
  [-0.41504437  0.5501679  -0.46502814 ...  1.3531638   0.20270535
   -1.1872677 ]
  [-2.140977   -1.8058906  -2.5433607  ... -1.3188152  -0.21092741
    3.014104  ]
  [ 0.30165464 -1.7570784  -0.5276766  ... -0.95511556  0.6305223
    2.6884043 ]]

 [[ 0.54159     2.0929532   1.2214144  ...  1.3534613  -2.23457
   -3.0139523 ]
  [-0.41575354  1.8297943   0.4623497  ... -0.0106837   0.28909513
   -1.1019404 ]
  [ 1.7901554  -2.319938    0.07372504 ...  1.7785084  -2.0408728
   -0.50145024]
  [-3.2801118   0.87907857  1.1032302  ...  1.169682    2.623778
   -2.4771414 ]
  [ 2.188267    2.8574073   1.3916485  ... -0.65159106  0.6747604
   -2.50303   ]]

 [[-0.28694752  0.1963344   1.8981187  ...  1.5710845  -1.9368709
    0.45920575]
  [ 1.1749982   0.24199866 -1.4054803  ...  0.47076377  0.1422315
    2.097656  ]
  [ 1.5478255   2.0425947   0.88846236 ... -1.2721353  -1.8794543
   -1.3773707 ]
  [-0.5135738   1.8262048   0.93603    ... -1.289328    1.1409359
   -3.309046  ]
  [-0.5917451   1.1871253   0.05737558 ...  2.3166168   0.72268176
    1.4457974 ]]]
q.shape5: (8, 5, 256)
q.shape6: (8, 8, 5, 32)
attn_res: [[[[-1.10189903e+00 -2.75773942e-01  1.00157332e+00 ... -1.04409361e+00
    -1.47432160e+00 -1.02181768e+00]
   [-1.41157341e+00 -8.92405868e-01  1.57548451e+00 ... -7.91311443e-01
    -2.27434969e+00 -4.00319725e-01]
   [-2.83711791e-01  2.32169557e+00 -5.86623490e-01 ... -1.93937886e+00
    -1.21788192e+00 -1.36057186e+00]
   [-8.83381307e-01  6.46011949e-01  6.07748330e-01 ... -4.58651595e-02
     5.52984118e-01  1.27753627e+00]
   [-1.37542951e+00 -7.53719330e-01  1.54225731e+00 ... -7.70005882e-01
    -2.34606671e+00 -2.07543463e-01]]

  [[-5.98480105e-01  2.24761978e-01 -2.37585008e-01 ...  4.79626894e-01
     2.40210257e-03  3.49768847e-01]
   [ 7.24396229e-01 -3.65033180e-01  1.06750906e+00 ...  3.02280605e-01
    -1.10113990e+00  1.55627716e+00]
   [-2.02308726e+00  4.57590759e-01  9.54174995e-03 ...  6.95861399e-01
     7.03144312e-01 -1.43315601e+00]
   [-4.02823746e-01 -1.85063684e+00  2.52712059e+00 ...  1.14448808e-01
     7.44482636e-01 -9.15467322e-01]
   [-7.95715451e-01 -1.63129854e+00  2.02739072e+00 ...  1.80224866e-01
     7.02831268e-01 -9.24400389e-01]]

  [[ 7.62226820e-01 -1.10489964e+00  6.08094297e-02 ... -1.36325395e+00
     1.26295018e+00  3.51602972e-01]
   [ 7.28295267e-01  2.93120295e-01 -7.08074808e-01 ...  2.87301719e-01
    -8.68266165e-01  3.24826193e+00]
   [ 1.74806428e+00 -2.04887247e+00  4.18655694e-01 ... -2.16483927e+00
     2.15324593e+00  6.85237795e-02]
   [ 7.70026147e-01  1.20742464e+00 -6.96271658e-01 ...  1.18642008e+00
    -8.22678357e-02  7.25892961e-01]
   [ 1.66984689e+00 -1.03722322e+00 -7.64083192e-02 ... -1.00316834e+00
     8.62542868e-01  1.63332307e+00]]

  ...

  [[ 1.84335917e-01  6.75271392e-01 -1.02976346e+00 ...  4.22780067e-02
    -5.98427653e-01  5.59228182e-01]
   [ 2.36929104e-01  1.29625630e+00  6.72697425e-01 ...  4.51689392e-01
    -7.30380774e-01 -1.22325674e-01]
   [ 3.84548068e-01  6.18283153e-01 -4.12082165e-01 ... -1.89672947e-01
    -3.94166797e-01  1.01129067e+00]
   [ 3.46538931e-01  1.91895306e-01 -1.40467656e+00 ... -3.81552309e-01
     2.45614141e-01  1.18640232e+00]
   [ 8.01565051e-01  9.98804629e-01  2.37001687e-01 ...  1.11361787e-01
    -8.06863070e-01  5.79792023e-01]]

  [[ 4.17515993e-01 -5.28795600e-01 -2.82391250e-01 ... -4.60648797e-02
    -1.30667233e+00  1.12591839e+00]
   [-3.24660927e-01 -5.97637355e-01 -8.55939329e-01 ...  9.48248282e-02
    -6.29323840e-01  4.49904323e-01]
   [ 1.75599945e+00 -5.77378511e-01  5.60425222e-03 ... -6.36550546e-01
    -2.68453360e-01  1.36190426e+00]
   [-7.32251763e-01 -7.80083060e-01 -1.02246571e+00 ...  6.27543271e-01
     1.22323883e+00 -8.67956519e-01]
   [ 8.14970732e-01 -3.77229393e-01 -5.29657483e-01 ... -3.67213726e-01
    -1.24196422e+00  1.22869372e+00]]

  [[ 1.81767678e+00 -2.78498590e-01 -3.24981213e-01 ...  1.77966881e+00
    -2.56299227e-01  5.64602137e-01]
   [ 7.29965806e-01 -2.30147243e+00  3.04589272e-02 ...  1.61959612e+00
     2.96753943e-01 -1.70375705e+00]
   [ 1.19315243e+00 -2.01397276e+00 -1.01620841e+00 ...  2.37251663e+00
    -8.13263506e-02 -1.96362805e+00]
   [ 1.54368186e+00 -9.32774603e-01 -3.68111670e-01 ...  1.90057194e+00
    -1.67743400e-01 -4.28701341e-01]
   [ 1.27142835e+00 -1.92271280e+00 -1.40598786e+00 ...  2.60565639e+00
    -2.39166304e-01 -2.17472005e+00]]]


 [[[-8.79152119e-03  2.36096501e-01 -6.68105111e-02 ...  7.16289282e-01
     5.73264062e-01  3.04903030e-01]
   [-6.34340405e-01  1.71938539e+00  3.87160271e-01 ... -2.06889898e-01
     8.31686437e-01  1.73035085e+00]
   [-2.22962201e-02  4.94741708e-01  4.60706621e-01 ...  5.57887197e-01
     1.06233144e+00  1.18397558e+00]
   [ 1.37819916e-01 -2.71161407e-01  8.81054103e-01 ... -1.10494450e-01
    -7.29313850e-01 -9.19940948e-01]
   [-4.95236218e-02  2.45127529e-01  4.92662668e-01 ...  1.01480186e-01
     5.28664589e-01  3.20379198e-01]]

  [[-9.72519815e-02 -9.94894385e-01  3.32623720e-02 ... -6.09551907e-01
     1.78512526e+00 -9.98337328e-01]
   [-1.81832626e-01 -1.12361479e+00  3.97287846e-01 ... -5.66416264e-01
     8.52609158e-01  3.98373842e-01]
   [-7.01408863e-01 -5.66101253e-01  2.22069651e-01 ... -9.14199710e-01
    -1.70621037e-01  1.58734179e+00]
   [ 1.45710751e-01 -9.83357131e-01 -6.45874679e-01 ...  8.24520141e-02
     1.81047583e+00 -3.14343274e-01]
   [ 1.71631664e-01 -9.17153835e-01 -8.71153533e-01 ...  2.06307054e-01
     1.79664314e+00 -1.06346630e-01]]

  [[ 6.16908312e-01 -7.79185176e-01  2.23508573e+00 ... -5.51486492e-01
    -7.30545342e-01  7.52319157e-01]
   [-7.86931753e-01 -2.82485187e-01  2.94611239e+00 ... -1.36027944e+00
    -5.09737134e-01  1.20540392e+00]
   [-1.87947005e-01 -1.15818751e+00  9.97312129e-01 ... -1.00867796e+00
    -1.00148904e+00  1.25462025e-01]
   [-1.57639420e+00  2.45045471e+00 -3.06557119e-01 ... -1.28176701e+00
    -9.28174019e-01  2.01845193e+00]
   [-1.02690518e+00  1.03961992e+00  1.30480170e-01 ... -1.16411531e+00
    -9.90285993e-01  1.26116478e+00]]

  ...

  [[-2.70009339e-02 -3.72643381e-01  1.15486825e+00 ... -1.93682921e+00
     4.85494137e-01  3.20561141e-01]
   [ 1.56272292e+00  5.85132360e-01  7.67754495e-01 ...  9.66325462e-01
     3.29535902e-01  7.63750374e-02]
   [-2.65043318e-01  4.58322644e-01  6.97273016e-01 ... -7.48094320e-01
     4.40496206e-01  5.45029081e-02]
   [ 6.97365999e-02 -3.45209539e-01  1.17294455e+00 ... -2.47155261e+00
     7.36539245e-01  1.12652980e-01]
   [-4.52753544e-01  1.21304750e-01  5.20596743e-01 ... -1.22551227e+00
     8.29265773e-01  5.64739525e-01]]

  [[-6.71413243e-02  1.34265864e+00 -4.85473216e-01 ... -1.21288702e-01
     5.38917243e-01  5.55429995e-01]
   [-3.51335406e-01  1.51315808e+00  1.25820562e-01 ...  1.71663553e-01
     8.22310746e-01 -9.26503092e-02]
   [ 3.29578221e-01  1.44256163e+00  4.13715035e-01 ... -4.13774103e-02
     6.76127017e-01  1.93792820e-01]
   [-1.21773770e-02 -1.95101023e-01 -6.00614399e-02 ...  7.88022101e-01
     1.23427379e+00  6.88056111e-01]
   [-5.71583331e-01  1.19585347e+00 -3.23907137e-02 ...  5.52797258e-01
     8.13548326e-01 -2.16337770e-01]]

  [[-1.28426814e+00  4.85955179e-02  2.88198233e-01 ... -6.85896873e-01
     3.82149220e-02  7.02852070e-01]
   [ 5.91474175e-02  7.49346554e-01  3.55910324e-02 ... -5.68106830e-01
    -4.72099930e-01 -1.12620366e+00]
   [-1.62030351e+00  1.75951695e+00  4.68266755e-01 ... -1.00608505e-02
    -1.35027313e+00  2.95567393e-01]
   [-1.13842809e+00  1.37362933e+00  7.96772301e-01 ... -1.23377538e+00
    -4.03192818e-01  4.77466345e-01]
   [-2.06636816e-01  8.97844791e-01  2.14792371e-01 ... -6.76467359e-01
    -4.05733973e-01 -8.92250419e-01]]]


 [[[-7.24960983e-01  4.89220709e-01 -6.18362904e-01 ... -1.22624516e+00
     9.05881703e-01 -1.17000341e+00]
   [-5.27687669e-01  4.24599677e-01 -4.34792489e-01 ... -1.12473392e+00
     7.84289479e-01 -8.62299204e-01]
   [ 7.36474395e-02  2.45665491e-01  4.31485444e-01 ... -9.33390260e-02
    -6.38527051e-03  7.86636531e-01]
   [-7.18928516e-01  5.56366563e-01 -5.29179931e-01 ... -1.22250700e+00
     9.47523713e-01 -1.27666891e+00]
   [ 5.62926829e-01 -1.70756012e-01  3.47928107e-01 ... -3.90981227e-01
    -1.40755683e-01  1.46338463e+00]]

  [[ 1.11942470e+00  6.18077219e-01  6.78796232e-01 ...  1.00514144e-01
     6.77074909e-01  2.81865507e-01]
   [ 3.17883909e-01 -7.31555104e-01 -5.56343794e-01 ...  3.25302154e-01
     1.60065019e+00  1.41158986e+00]
   [ 6.80590153e-01  2.49084520e+00  6.17818773e-01 ...  1.32952964e+00
     5.57067752e-01 -5.69199502e-01]
   [ 8.24756861e-01 -1.42152697e-01  1.33976892e-01 ...  1.65723220e-01
     9.78674531e-01  5.43788314e-01]
   [ 1.02108312e+00  1.47516370e-01  5.11201799e-01 ...  4.90530729e-02
     4.65023726e-01  1.02833375e-01]]

  [[ 1.34171784e+00  4.47280020e-01  3.02226454e-01 ...  1.13018107e+00
    -1.02021955e-01  8.03677797e-01]
   [ 4.75357115e-01 -1.95874619e+00 -1.62491858e+00 ... -1.09542906e+00
     1.57161176e+00 -8.41545522e-01]
   [-3.67550731e-01 -1.82585752e+00 -3.38341117e-01 ...  3.95040870e-01
     7.58330524e-01 -1.18209876e-01]
   [ 6.76467001e-01 -3.30374897e-01 -1.79495275e-01 ...  9.18162704e-01
     2.16170967e-01  4.04010445e-01]
   [-3.43781680e-01 -1.70977318e+00  3.35506797e-02 ...  5.93083143e-01
     5.48238814e-01  9.30738375e-02]]

  ...

  [[-5.04618049e-01 -8.87207925e-01 -8.48855495e-01 ... -1.83057666e-01
    -1.01577803e-01 -7.95926332e-01]
   [-4.39572662e-01 -2.72048175e-01 -2.59692222e-01 ... -4.36445773e-02
    -1.27262384e-01 -1.81540757e-01]
   [-1.47990394e+00 -1.56376767e+00 -4.16823268e-01 ...  4.30379719e-01
    -3.98077190e-01  2.10202605e-01]
   [-4.52753335e-01 -4.19814676e-01 -5.71960032e-01 ... -3.11916292e-01
    -8.01958442e-02 -5.39947867e-01]
   [-3.41073215e-01 -7.86957800e-01 -9.48418677e-01 ... -2.02146336e-01
    -2.30861511e-02 -9.12665009e-01]]

  [[-1.10916090e+00 -1.12141037e+00  1.70250189e+00 ...  1.43398225e+00
    -2.91503263e+00  1.25080836e+00]
   [-6.24328077e-01  1.04773748e+00 -1.18636060e+00 ... -6.30626380e-02
    -7.29678750e-01  1.11703503e+00]
   [-5.83176732e-01 -6.08296037e-01  1.03705454e+00 ...  7.17886090e-01
    -2.36522865e+00  1.02674413e+00]
   [-1.14941931e+00 -9.55057025e-01  1.50494313e+00 ...  1.39474547e+00
    -2.74790025e+00  1.25192940e+00]
   [-1.57274556e+00  6.52692139e-01 -1.47006285e+00 ...  5.34399569e-01
    -1.07262039e+00  1.45283842e+00]]

  [[-1.32727563e+00  8.69187534e-01  1.10157573e+00 ... -9.44365859e-01
     5.76483428e-01  4.64556992e-01]
   [-1.20413828e+00  2.87591875e-01  6.05950117e-01 ...  1.34417295e-01
     1.12659240e+00 -1.03056431e-02]
   [-1.96391368e+00  1.50419343e+00  2.25284672e+00 ... -1.80158174e+00
     2.02003196e-01  4.96658146e-01]
   [-8.38156104e-01  7.86856771e-01  1.79987758e-01 ... -1.19121909e-01
     5.75050712e-01  5.17423272e-01]
   [-2.13495636e+00  1.77886546e+00  2.77246571e+00 ... -2.38135958e+00
    -9.91312414e-02  7.14307189e-01]]]


 ...


 [[[ 1.67360604e+00 -4.12841737e-01 -9.58820760e-01 ...  3.55022848e-01
     9.47416186e-01 -4.51054007e-01]
   [ 5.04675865e-01  9.32085633e-01 -3.38148654e-01 ... -1.14834380e+00
     1.40711382e-01 -2.90938079e-01]
   [ 4.77663338e-01  1.85494614e+00 -2.91190356e-01 ... -8.80115390e-01
     1.76189804e+00  6.60337985e-01]
   [ 1.48366904e+00 -2.90275365e-02 -8.90570462e-01 ...  1.47515416e-01
     1.05094409e+00 -2.24968418e-01]
   [ 6.15390420e-01 -1.11208856e-01 -8.94065499e-01 ... -2.39751324e-01
    -6.08770728e-01  8.65371704e-01]]

  [[-4.38322991e-01 -4.17597890e-01 -6.28971040e-01 ...  1.32442760e+00
    -1.12142742e+00 -3.54148224e-02]
   [-1.58525515e+00 -2.21204907e-01 -1.68092132e+00 ... -4.34320331e-01
     5.12784600e-01 -1.05947852e+00]
   [-1.02775764e+00 -4.36889455e-02 -2.03868842e+00 ... -5.09994149e-01
     3.70246589e-01  3.02281976e-03]
   [-1.20648181e+00 -3.27817261e-01 -1.02078927e+00 ...  3.38137776e-01
    -2.49729440e-01 -8.48272920e-01]
   [-2.52016306e+00 -4.24600869e-01 -2.15934134e+00 ... -3.21520716e-01
     2.71529108e-01 -1.31956363e+00]]

  [[-3.37161690e-01 -1.20043635e+00  1.40427208e+00 ... -2.06641704e-02
     1.23531938e+00  1.36114919e+00]
   [ 1.74122617e-01  8.16695541e-02  1.24354541e+00 ...  2.68695533e-01
     9.45464522e-02  1.16554475e+00]
   [-9.39411968e-02 -5.21734416e-01  1.49213731e+00 ...  1.12706594e-01
     8.22483122e-01  1.48872459e+00]
   [-1.90690547e-01 -8.73363018e-01  1.29199934e+00 ...  7.86690786e-02
     6.71212018e-01  1.30615473e+00]
   [-6.01636469e-01  8.72595161e-02  1.16699994e+00 ... -2.11265135e+00
    -1.64315969e-01 -4.60204668e-02]]

  ...

  [[ 9.97466385e-01  1.78963435e+00 -8.00554752e-02 ... -8.22347999e-01
    -1.43611097e+00  4.38429534e-01]
   [-2.60960549e-01  5.87833524e-01 -2.18616307e-01 ... -6.34334564e-01
    -5.52587986e-01  1.86546624e-01]
   [ 1.32061303e+00  1.88651752e+00 -8.39292482e-02 ... -8.12539697e-01
    -1.38507104e+00  3.48766178e-01]
   [-1.10437465e+00  1.03190339e+00 -5.67957163e-01 ... -7.62503684e-01
    -2.11794376e+00  5.69884181e-01]
   [-1.53350770e+00  2.92651147e-01 -8.07485223e-01 ... -4.79313672e-01
    -1.70692408e+00  5.31664431e-01]]

  [[-5.85333526e-01  8.30940425e-01  6.32890999e-01 ... -2.86661774e-01
    -3.28968287e+00  1.26054204e+00]
   [ 1.91869557e-01 -2.56795597e+00  9.67266738e-01 ...  1.17845619e+00
    -8.13928902e-01  1.19073546e+00]
   [ 1.32964224e-01 -1.74583900e+00  9.02621269e-01 ...  8.02566230e-01
    -8.46888661e-01  1.09176326e+00]
   [ 2.62718350e-01 -9.18681383e-01  7.86664605e-01 ...  3.64810467e-01
    -1.66061223e-01  8.23342621e-01]
   [ 1.15491605e+00  1.08092451e+00 -5.89832664e-01 ... -1.12281823e+00
    -2.88653165e-01  2.17605442e-01]]

  [[ 1.08242023e+00 -8.32033098e-01 -3.19619823e+00 ...  8.54487777e-01
    -3.71912122e-01 -4.84953821e-01]
   [-3.05553168e-01 -1.31070340e+00 -5.55525064e-01 ...  1.51912403e+00
     2.10174382e-01 -1.50845742e+00]
   [-1.64741963e-01 -1.78084064e+00 -1.87289804e-01 ...  1.11975050e+00
    -1.16290259e+00  4.03483748e-01]
   [ 4.51171726e-01 -2.42740750e+00 -1.08269727e+00 ... -1.00976229e+00
    -7.37001598e-01 -8.55142653e-01]
   [ 4.37384039e-01 -1.91210341e+00 -1.35850167e+00 ... -6.82220757e-02
    -6.54098749e-01 -6.57951832e-01]]]


 [[[ 1.53073406e+00 -7.19463050e-01 -9.79473442e-02 ... -3.60924602e-01
     2.29759145e+00 -4.70740914e-01]
   [ 1.48785460e+00 -6.32073104e-01 -3.34357172e-02 ... -3.52965862e-01
     2.35407782e+00 -6.38920724e-01]
   [-6.94869339e-01  1.63818240e+00  3.37636828e-01 ...  4.00092214e-01
     2.25584888e+00 -2.48358935e-01]
   [ 9.20523643e-01  5.71662784e-02  2.52679944e-01 ... -1.90984532e-01
     2.43108082e+00 -1.10859334e+00]
   [ 1.50569642e+00 -7.94944048e-01 -8.54807347e-03 ... -3.03171962e-01
     2.22646379e+00 -9.72814679e-01]]

  [[ 3.13084364e-01  1.46406996e+00 -1.48942161e+00 ...  1.43165231e-01
     2.84684688e-01 -3.97699475e-02]
   [ 1.64129126e+00 -8.74922156e-01  2.72518694e-01 ... -3.19865406e-01
    -3.64184141e-01 -3.20167392e-01]
   [ 1.56922257e+00 -6.50648057e-01 -4.53306437e-02 ... -3.23429108e-01
    -5.36635220e-02 -4.72166359e-01]
   [ 1.78766012e+00 -1.05407095e+00  3.51281494e-01 ... -3.77645969e-01
    -3.23024929e-01 -4.15071726e-01]
   [-2.37981844e+00 -2.79026985e+00  1.67625165e+00 ...  3.32251340e-01
     1.07713020e+00  2.79359221e-01]]

  [[-5.83881319e-01  7.94915438e-01 -1.55956912e+00 ...  6.03142083e-02
     1.06200647e+00  4.40236509e-01]
   [-6.95387006e-01  7.50279188e-01 -1.22672093e+00 ... -3.47956836e-01
     9.53963101e-01  3.40246499e-01]
   [-1.24927908e-01  1.51012063e+00 -6.03521049e-01 ...  3.97363633e-01
    -1.02576733e-01  1.23558700e+00]
   [-4.21184659e-01  8.28552425e-01 -2.62134254e-01 ... -1.37838113e+00
    -1.90924242e-01  7.19943821e-01]
   [ 1.56379476e-01  1.77501583e+00 -4.95033294e-01 ...  7.74773717e-01
    -5.71065128e-01  1.66983509e+00]]

  ...

  [[-2.58454531e-01  3.22777241e-01  7.24592030e-01 ...  4.67021793e-01
     2.07481742e+00 -1.57747960e+00]
   [-6.34790540e-01 -7.60400832e-01  4.54144269e-01 ... -1.06788683e+00
    -1.51130986e+00  1.90932858e+00]
   [-3.22917312e-01 -4.15649533e-01  4.25522029e-01 ... -6.62968516e-01
    -1.02694988e+00  1.24718368e+00]
   [-3.60730082e-01 -5.07572174e-01  4.02265817e-01 ... -9.16704118e-01
    -1.28450739e+00  1.59583175e+00]
   [-1.88916221e-01  4.44561601e-01  7.37804711e-01 ...  5.80599368e-01
     2.31314921e+00 -1.82982993e+00]]

  [[ 7.57111371e-01 -4.76704210e-01 -6.01680994e-01 ... -2.36606568e-01
    -1.29733586e+00  1.60083926e+00]
   [ 4.82144833e-01 -1.63987845e-01  9.49609816e-01 ...  1.57211626e+00
    -7.56483912e-01  9.28908765e-01]
   [ 2.05420703e-01 -3.99868906e-01  7.49914289e-01 ...  1.40800357e+00
    -7.73634315e-01  6.96812510e-01]
   [ 3.32820058e-01 -2.45088726e-01  9.56979096e-02 ...  7.14001238e-01
    -6.54815435e-01  8.42403173e-01]
   [ 8.21320415e-01 -2.81146467e-01  2.38485366e-01 ...  6.77863240e-01
    -1.17492354e+00  1.51104128e+00]]

  [[-6.54688954e-01 -2.31139600e-01  1.36716628e+00 ... -1.14343262e+00
     1.87201738e+00  5.69182813e-01]
   [-7.39030302e-01 -5.64212620e-01  1.86043692e+00 ... -1.79280829e+00
     2.32649326e+00  1.36057830e+00]
   [-5.57427168e-01  3.67531270e-01  1.06625152e+00 ... -1.38273418e+00
     9.18413997e-01  1.29487622e+00]
   [-7.31060505e-01 -2.87055254e-01  1.58380246e+00 ... -1.15192628e+00
     2.06717753e+00  4.61431861e-01]
   [-5.93997240e-01  5.07736325e-01  8.98755372e-01 ... -5.41500509e-01
     9.47924495e-01 -9.02354717e-04]]]


 [[[-1.15914154e+00  1.30005026e+00 -1.34894609e+00 ... -4.90236998e-01
    -1.14327860e+00 -8.21267784e-01]
   [-7.46339440e-01  9.44283843e-01 -1.13388062e+00 ... -3.68831217e-01
    -7.58230031e-01 -8.30495775e-01]
   [ 4.95542496e-01  5.53993583e-01 -1.07254100e+00 ...  3.61772358e-01
     5.46151757e-01  2.01481342e-01]
   [ 1.01222944e+00  6.97144330e-01 -1.26004326e+00 ...  7.13272095e-01
     1.16630507e+00  6.26621664e-01]
   [ 4.87387240e-01  7.05754817e-01 -1.48120320e+00 ...  9.94350314e-01
    -4.12753433e-01  4.41542715e-01]]

  [[-3.20232138e-02 -4.60721217e-02 -1.38812017e+00 ... -1.06107771e+00
     5.94704412e-02  1.47327232e+00]
   [ 2.67191902e-02  6.81157351e-01  2.96213776e-01 ... -1.16994905e+00
     1.05807662e+00 -6.87294483e-01]
   [ 1.33185101e+00  2.38612548e-01 -1.35186982e+00 ... -2.05217910e+00
    -9.80747998e-01  6.66539311e-01]
   [-5.84890008e-01  7.48307347e-01 -5.72636127e-01 ... -6.96264744e-01
     5.40922344e-01 -2.09714603e+00]
   [ 2.23373055e-01 -2.89779454e-01 -5.46640933e-01 ... -8.58616173e-01
    -1.02189630e-01  1.78972125e-01]]

  [[-8.42442214e-01  5.40670037e-01  5.75718403e-01 ... -6.82023987e-02
    -1.51987508e-01 -2.78406531e-01]
   [ 2.38810748e-01  5.17305583e-02  4.12391543e-01 ...  1.30039275e-01
    -6.82316244e-01 -8.74721944e-01]
   [ 1.44156563e+00  2.69862592e-01  1.16873443e+00 ...  6.02672756e-01
     7.65834153e-02 -6.83269620e-01]
   [ 5.26554048e-01  5.92951998e-02  8.21323216e-01 ... -1.22992449e-01
    -9.28257465e-01 -1.13523424e+00]
   [-5.83314419e-01  1.44906902e+00  2.37507653e+00 ... -2.64465541e-01
     7.69216537e-01  3.38556200e-01]]

  ...

  [[ 9.57685113e-01  1.06804526e+00  5.42847931e-01 ...  1.94437492e+00
     1.37998652e+00 -8.34122181e-01]
   [ 3.83359879e-01 -4.11480129e-01 -2.88695514e-01 ... -1.04462504e-02
     1.24353850e+00 -1.75691533e+00]
   [ 4.15828139e-01  7.48614669e-02  6.24114394e-01 ...  1.27611637e+00
     1.28938782e+00 -7.10869312e-01]
   [ 6.56661630e-01  7.22677529e-01  5.62905133e-01 ...  1.56610513e+00
     1.41467643e+00 -7.62982965e-01]
   [ 9.83673632e-01  1.14893031e+00  5.91727078e-01 ...  2.05047560e+00
     1.37970769e+00 -7.76439905e-01]]

  [[ 7.83416450e-01 -4.87086862e-01 -1.61075413e-01 ... -9.86886322e-02
     1.40411258e+00 -9.04701352e-01]
   [-1.21484685e+00 -1.09511852e+00 -7.45788813e-01 ...  2.37562108e+00
    -1.14251411e+00  1.34890842e+00]
   [-8.74630809e-01 -7.20546126e-01 -5.75228035e-01 ...  1.98207366e+00
    -4.64979738e-01  7.20467150e-01]
   [-3.22597951e-01  2.74061859e-02  7.33696222e-02 ...  4.77943242e-01
     9.53330219e-01 -1.60923076e+00]
   [ 8.22290421e-01  2.18061551e-01 -2.84042001e-01 ...  2.35507876e-01
     1.68761647e+00 -1.25965524e+00]]

  [[ 9.13591504e-01 -4.31674160e-02  2.76240468e-01 ... -3.24329972e-01
    -1.07327080e+00 -1.13109159e+00]
   [ 1.17108214e+00 -3.42124104e-01  3.12932849e-01 ...  9.71969664e-02
    -1.06601691e+00 -1.33646286e+00]
   [ 1.13517451e+00 -1.21195114e+00  7.58293867e-02 ...  7.83273101e-01
    -4.09219563e-01 -1.15586948e+00]
   [-7.08127856e-01 -1.11794965e-02  3.69249508e-02 ...  1.06469607e-02
     1.19447112e+00  1.11236172e-02]
   [-1.08015388e-01  1.45491317e-01  6.24188662e-01 ... -8.18454564e-01
    -2.65983343e-01  6.21557117e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-False-32-8-27-11-4] q.shape1: (4, 11, 27)
q.shape2: (44, 27)
q.shape3: (44, 27)
q.shape4: (4, 11, 27)
q_liner: [[[-0.08246318  1.297637   -4.3869157  ...  1.6648993   1.0225514
   -0.23413606]
  [-2.1036825   0.34269288 -1.3593392  ...  0.28710133 -2.3495028
   -0.5770221 ]
  [ 0.55015564  1.3115653  -2.7073863  ... -1.2594198   0.450877
   -0.5750791 ]
  ...
  [ 1.9723426   1.9014058  -0.07350472 ... -0.62339854 -1.8269873
   -3.1420405 ]
  [ 0.5897575   0.5651129  -1.4288164  ...  1.6924045  -1.9481409
    1.4147217 ]
  [ 1.4633553  -0.39679056 -0.7927203  ...  0.4363156  -1.650817
    0.20362736]]

 [[-0.9566642   0.6318296  -0.99751896 ... -1.8659797  -0.01259731
    1.0842644 ]
  [-0.15104908  1.3874646   0.19238688 ... -2.0061364  -0.9589741
    0.54090524]
  [-0.31797707 -0.84257644  3.2394025  ...  0.8453818  -0.5109138
   -0.27457815]
  ...
  [ 0.33640504  1.8460547   2.517686   ...  1.085388    2.9914563
    2.6077745 ]
  [ 1.546665    0.5879998   0.41907552 ...  0.75106627  1.0203562
   -0.15183803]
  [-1.0632492   2.5393524   0.9687923  ... -1.3010052  -0.02241022
    1.0278877 ]]

 [[ 0.24715352  1.9982486  -1.0008467  ... -0.99167144  2.288722
   -0.38216916]
  [-1.7900983   1.6657426   0.72222143 ...  1.0981413  -0.52470183
   -1.220509  ]
  [-1.0200733  -0.02188973  0.9696115  ... -3.8275013   1.2366807
   -2.000785  ]
  ...
  [-1.0458595  -1.4305166  -1.8524687  ...  1.3384255  -2.3837926
   -1.3595229 ]
  [ 0.65088063 -0.07472718  0.7910718  ...  1.1668599   0.17494643
   -2.2131062 ]
  [-0.5484388  -0.3512259  -0.9518742  ... -0.37090048 -2.5363982
   -0.35450423]]

 [[-1.6597594  -2.0460486   1.7956158  ...  0.7144732  -2.8808208
   -2.3229933 ]
  [-0.67780596 -1.0200878   2.5991154  ... -0.39864108 -0.15486184
   -1.768438  ]
  [-0.9458305   1.8510628  -0.13740489 ... -1.8609341   1.1644534
    0.04018895]
  ...
  [ 0.38199356 -1.6202837  -1.9532994  ...  2.8872821  -0.4262538
   -0.07649663]
  [-1.2970152  -0.8319859  -1.2084574  ... -0.85649323  1.5001354
    1.9378235 ]
  [ 0.15252627  1.7864983  -2.6395547  ...  0.10763691  0.13296238
   -1.6784537 ]]]
q.shape5: (4, 11, 256)
q.shape6: (4, 8, 11, 32)
attn_res: [[[[-5.67015886e-01 -7.92597473e-01  6.83330476e-01 ...  5.03605567e-02
     5.40350378e-01  4.78779495e-01]
   [-6.67033255e-01 -4.51856285e-01  8.49767998e-02 ... -2.89714098e-01
     3.32637489e-01  8.51852655e-01]
   [ 1.56478986e-01  3.69465537e-02  9.94778633e-01 ...  9.20057893e-02
     4.41416502e-02  8.79463851e-02]
   ...
   [-3.29181254e-01 -8.54799449e-01  2.73077488e-01 ... -8.52646649e-01
     7.83051014e-01 -2.09681249e+00]
   [-6.42008603e-01 -6.85225546e-01  9.71108377e-01 ...  9.61113274e-01
    -3.95403981e-01 -9.69728082e-02]
   [-6.44800544e-01 -5.47839701e-01  4.73242342e-01 ...  1.49182379e-01
    -2.84885466e-01 -5.89085937e-01]]

  [[-1.68176189e-01  9.52995047e-02  6.62096739e-01 ...  4.62585777e-01
    -2.68388927e-01  9.29372311e-02]
   [-3.00828874e-01  2.21040994e-02  5.62227249e-01 ...  5.25085628e-01
    -6.36798501e-01  6.44650459e-01]
   [ 2.11523056e+00 -7.66764283e-02 -1.39024591e+00 ... -1.35095346e+00
     9.97807205e-01 -1.42808127e+00]
   ...
   [-4.26953107e-01 -9.70790148e-01 -6.30095720e-01 ...  6.71087384e-01
    -3.77055734e-01  1.71019211e-01]
   [-4.42424923e-01 -4.25001174e-01 -8.44850093e-02 ...  8.30675602e-01
    -5.21475077e-01  4.39102709e-01]
   [ 1.09383142e+00 -4.45902944e-01 -2.58861572e-01 ... -1.40261543e+00
    -1.60417467e-01  5.18881857e-01]]

  [[-1.02028608e+00  3.45038295e-01  2.18447283e-01 ...  1.17928827e+00
     1.39237618e+00  7.61447132e-01]
   [-8.87428880e-01  2.86176354e-01  3.84369865e-02 ... -4.13522929e-01
    -5.59647322e-01  1.50282681e+00]
   [ 9.86273661e-02 -1.53344691e+00  1.96472436e-01 ... -4.68353063e-01
     8.73857439e-01 -6.95771337e-01]
   ...
   [-7.47779727e-01 -8.79655063e-01 -4.91240740e-01 ... -6.80410922e-01
     5.13363123e-01  7.72187293e-01]
   [-5.05484402e-01  5.69798708e-01 -1.50162265e-01 ...  5.16953230e-01
     6.40214682e-01  1.18146491e+00]
   [-3.46083157e-02  1.10835946e+00  4.05768216e-01 ...  1.17634964e+00
     3.32567334e-01  1.82683325e+00]]

  ...

  [[ 3.95178258e-01  8.25456917e-01 -7.00884700e-01 ... -1.97467908e-01
    -5.26656926e-01  3.89780611e-01]
   [ 1.41410932e-01  2.24472255e-01 -9.83064055e-01 ... -1.19031167e+00
     4.87739384e-01  5.64094067e-01]
   [ 4.26107109e-01  4.33565795e-01  7.24680722e-05 ... -9.19799089e-01
    -6.95991516e-01 -4.98163462e-01]
   ...
   [ 1.78167880e-01  7.80328155e-01  7.26394355e-02 ... -9.99998450e-01
     1.27290100e-01  6.44286215e-01]
   [-1.32141292e-01  2.02570987e+00 -5.65201461e-01 ... -4.95430641e-02
    -3.31800848e-01  1.89807284e+00]
   [-4.57994044e-01  1.24447858e+00 -2.39099681e-01 ... -3.80729958e-02
     3.81052457e-02  1.17919207e+00]]

  [[-1.90605253e-01 -2.16882452e-02  2.48568028e-01 ...  8.79864335e-01
    -7.28116632e-01  1.59914804e+00]
   [ 1.89989269e-01 -6.63103312e-02  9.91827309e-01 ...  4.08301890e-01
    -9.62487936e-01  7.27992296e-01]
   [ 8.62120464e-02 -2.03858542e+00  1.29264385e-01 ...  1.69542506e-01
    -2.26530090e-01 -9.13482189e-01]
   ...
   [ 1.83820158e-01 -6.21863082e-02  8.29534113e-01 ...  3.66263390e-01
    -8.90538812e-01  7.88428545e-01]
   [-5.95205843e-01  7.47465640e-02 -1.47445053e-01 ...  1.24000466e+00
    -3.22300524e-01  1.88636899e+00]
   [-6.61939383e-02  5.80882609e-01 -5.53099811e-01 ... -5.87874018e-02
     4.00111288e-01  7.34933913e-01]]

  [[ 2.00354859e-01 -2.10307494e-01  3.55871171e-01 ...  7.08514571e-01
     5.58844861e-03 -4.46488321e-01]
   [ 8.01426023e-02 -1.38881683e-01  7.02294052e-01 ...  3.11677642e-02
     2.56119892e-02 -4.59857106e-01]
   [ 2.75859773e-01 -3.79215956e-01 -1.14274472e-02 ...  5.98094821e-01
     6.53031409e-01 -9.17627513e-01]
   ...
   [ 1.46473140e-01 -3.76282074e-02  9.44043696e-01 ...  2.01336175e-01
    -1.91288531e-01 -1.83206618e-01]
   [-7.80437589e-01 -4.28289503e-01 -5.84980786e-01 ...  1.08958638e+00
     5.47809958e-01 -5.46340942e-01]
   [ 4.88507032e-01  5.81339359e-01 -2.60150820e-01 ...  1.23528767e+00
    -1.62985414e-01 -2.90847689e-01]]]


 [[[-8.07615817e-01 -1.15343344e+00  1.43600094e+00 ...  7.18166769e-01
     6.04099751e-01 -1.09548345e-01]
   [ 6.70689166e-01  1.51304793e+00 -7.39425421e-02 ...  6.09986544e-01
     8.60902220e-02  6.79533482e-02]
   [ 1.99698210e-01  2.99663723e-01 -2.51898557e-01 ...  7.21104145e-01
    -3.76465738e-01  6.46733940e-01]
   ...
   [ 2.80711442e-01  6.47476673e-01  6.08128905e-01 ...  4.13769066e-01
    -6.80703521e-01 -2.66057223e-01]
   [ 8.09855103e-01  1.06039369e+00 -1.08889925e+00 ...  9.36251938e-01
    -4.09286350e-01  1.16447425e+00]
   [ 5.83714366e-01  6.54274285e-01 -1.65784597e-01 ...  2.56409258e-01
     3.58881384e-01  3.52989554e-01]]

  [[ 3.03827763e-01  1.29115507e-01 -5.12937367e-01 ...  5.21179378e-01
    -5.65751493e-01  1.26247871e+00]
   [-4.51809943e-01 -6.74882904e-03 -2.16003001e-01 ...  9.87456918e-01
     1.56779349e-01  3.68127972e-02]
   [-3.24884832e-01  4.56397980e-01 -3.85215998e-01 ...  2.06359178e-01
     2.03139335e-01 -2.41527349e-01]
   ...
   [-5.83517909e-01  3.96603614e-01 -9.02297735e-01 ...  6.98595762e-01
    -3.20195675e-01 -3.81480187e-01]
   [-1.19667098e-01 -6.89145207e-01 -6.35410130e-01 ... -1.64294243e-01
    -1.30669153e+00  1.96469653e+00]
   [ 4.24772084e-01  3.69495243e-01 -6.50876462e-01 ... -3.91570985e-01
    -3.46668959e-02  1.00992978e-01]]

  [[ 4.35992539e-01 -6.77330792e-02  7.08684266e-01 ... -4.37932611e-01
    -7.99217373e-02 -3.86620015e-01]
   [-1.37114215e+00 -1.49515486e+00  1.67433918e-01 ... -9.23729122e-01
     1.25993562e+00  1.11499655e+00]
   [ 1.22936797e+00 -1.69393408e+00  6.50514364e-01 ...  1.05290747e+00
    -5.01630008e-01 -1.25369966e+00]
   ...
   [ 1.77795917e-01 -1.71863925e+00 -2.58015990e-01 ...  6.99040115e-01
    -5.67659259e-01 -2.81275243e-01]
   [-1.12885773e+00 -1.34067547e+00  4.35453862e-01 ... -6.63354754e-01
     1.44311678e+00  7.07236350e-01]
   [ 4.68275249e-01 -7.75296807e-01  2.05964625e-01 ...  8.42780769e-02
     3.18009347e-01 -1.33161342e+00]]

  ...

  [[-4.35528249e-01 -1.32054794e+00  2.72934937e+00 ... -8.30586791e-01
     1.02608109e+00  1.12135136e+00]
   [-2.92690009e-01  1.35519803e-01  2.64881879e-01 ... -1.49408817e-01
     1.95471093e-01  6.29044533e-01]
   [ 9.68384385e-01  1.93266404e+00 -1.10002923e+00 ... -4.92356628e-01
     7.30344832e-01  1.89750266e+00]
   ...
   [ 1.79710197e+00  8.46315801e-01 -1.02185929e+00 ...  1.02212682e-01
    -4.94679511e-01 -2.29311138e-02]
   [-2.61961013e-01  7.17249036e-01  8.32757711e-01 ... -3.88518721e-01
     7.40213931e-01  1.91696346e+00]
   [ 1.04985452e+00  4.65070605e-01 -2.48642802e-01 ... -4.44283724e-01
    -5.76451607e-03  1.73774380e-02]]

  [[-3.03241760e-01  4.20753926e-01  8.27482998e-01 ... -7.90206343e-02
    -5.12284815e-01 -1.01528490e+00]
   [ 5.94880402e-01 -3.90488327e-01 -2.97912419e-01 ... -1.48364568e+00
     1.26145035e-01 -5.88918865e-01]
   [ 3.11016411e-01 -7.41012156e-01 -2.74431109e-01 ... -1.40376711e+00
    -8.56206715e-02 -7.62922406e-01]
   ...
   [ 7.42370963e-01  2.43548334e-01  5.69241107e-01 ...  1.35814023e+00
    -3.66879433e-01  4.39109683e-01]
   [ 2.95521557e-01 -6.69120431e-01 -3.43272895e-01 ... -5.42296410e-01
    -1.29878581e+00 -4.65594307e-02]
   [ 7.49634504e-01 -6.73455656e-01  1.28297463e-01 ... -7.20099926e-01
    -6.45827115e-01 -4.52732503e-01]]

  [[ 2.67501920e-02 -3.17874774e-02 -6.80766940e-01 ... -2.45863404e-02
     2.58562535e-01 -1.24960649e+00]
   [ 8.90024424e-01 -1.46026462e-02  4.53520834e-01 ... -4.49757390e-02
     9.78469729e-01 -3.84863317e-01]
   [ 5.18837035e-01 -3.43106315e-02  2.82099843e-01 ...  4.46254402e-01
     5.67110717e-01  1.97172537e-02]
   ...
   [ 5.51524043e-01 -6.00758612e-01  1.97055086e-01 ...  3.55607361e-01
     1.00557077e+00  1.54501259e-01]
   [ 5.65220594e-01 -2.50021100e-01 -5.48405051e-01 ... -4.58824426e-01
     1.36296079e-01 -5.93254685e-01]
   [-7.92791694e-02 -1.00367284e+00 -4.50505495e-01 ...  1.75545990e-01
     2.13013202e-01  9.15101767e-01]]]


 [[[-6.96952129e-03  1.06113052e+00  2.47535631e-01 ...  7.14721978e-01
     3.08157448e-02  1.78216028e+00]
   [ 3.44690800e-01  6.35286033e-01 -2.07512826e-01 ... -1.07321993e-01
     5.93518198e-01  3.78406867e-02]
   [ 9.66113329e-01  5.24013162e-01  6.71557784e-01 ... -1.61869454e+00
     7.18194723e-01  4.52035785e-01]
   ...
   [ 3.11139524e-01 -5.34943581e-01 -3.09644312e-01 ...  3.94547164e-01
     2.95455545e-01 -1.67163350e-02]
   [ 2.99088448e-01  3.56946051e-01 -6.10395670e-01 ...  4.41012323e-01
     3.83030474e-01  9.09426272e-01]
   [-8.84265453e-02  4.51626688e-01  5.56991458e-01 ...  1.97941184e-01
     5.22200465e-01  1.92892075e-01]]

  [[-1.06816161e+00 -1.56335998e+00  5.29700339e-01 ...  3.51257741e-01
    -1.45914686e+00 -9.58811462e-01]
   [-4.67805564e-03 -1.01494297e-01  3.93753797e-02 ... -6.62341475e-01
    -1.17894515e-01  3.07785511e-01]
   [-1.27174354e+00 -5.98183692e-01  2.79025197e-01 ...  8.94257247e-01
    -1.55506420e+00  5.54872990e-01]
   ...
   [-2.70248055e-01  4.08330739e-01  2.24233150e-01 ...  6.17442250e-01
     6.81971908e-01 -7.12844789e-01]
   [-4.80224073e-01  1.19270012e-01  1.24446583e+00 ... -3.05265933e-01
     5.06721474e-02  3.21656257e-01]
   [-1.96576849e-01 -7.18304992e-01  1.86559856e-01 ... -3.25054348e-01
    -7.78824389e-01  5.79773366e-01]]

  [[-2.51272297e+00  1.43403637e+00  1.79101861e+00 ... -1.17834103e+00
     8.71739447e-01  1.87789154e+00]
   [-6.22375846e-01  2.49532327e-01  7.77534619e-02 ... -1.14532697e+00
     1.16850102e+00 -8.21605742e-01]
   [ 1.65188804e-01  3.70854698e-03 -5.83100319e-01 ...  1.31947613e+00
    -6.23090982e-01 -2.51339614e-01]
   ...
   [-3.00986886e-01  4.74936478e-02  1.41073540e-01 ... -2.49061361e-01
     6.14022911e-01 -5.63402951e-01]
   [-5.86113095e-01  7.99117625e-01  2.57042170e-01 ... -1.57042813e+00
    -9.52432007e-02  8.78738821e-01]
   [-9.59128857e-01 -1.63643301e-01  1.81809664e-01 ... -6.82621241e-01
     9.33641493e-01  3.88466865e-01]]

  ...

  [[ 7.41429687e-01 -3.30519229e-01 -5.53599119e-01 ... -2.75802106e-01
     7.49965131e-01 -3.50943536e-01]
   [ 1.33902752e+00 -3.52847576e-02  4.01394427e-01 ... -1.04733562e+00
     2.21624419e-01 -4.91805166e-01]
   [ 1.27876133e-01  1.33299792e+00  4.50860500e-01 ...  1.89384747e+00
     3.55651855e-01  8.35229278e-01]
   ...
   [ 3.29637975e-02  1.19197106e+00 -4.25272763e-01 ...  1.67751384e+00
    -1.00232482e-01  1.19522190e+00]
   [ 1.85871494e+00 -2.42058903e-01 -3.92896563e-01 ... -2.63016254e-01
     5.86810172e-01 -1.03957582e+00]
   [ 2.09099635e-01  9.71636593e-01  2.30301112e-01 ... -8.58015776e-01
     1.62213370e-01 -1.38929412e-01]]

  [[-3.36444438e-01 -3.32999945e-01 -7.53123283e-01 ... -2.07638100e-01
    -2.83042967e-01 -5.11421084e-01]
   [-1.83156192e-01  2.06219226e-01  4.68367100e-01 ... -1.35199234e-01
    -5.32696009e-01 -1.01763892e+00]
   [-3.52348894e-01 -1.48649499e-01 -5.21878004e-01 ... -9.42702353e-01
    -8.52958038e-02  1.51940778e-01]
   ...
   [ 9.74712893e-02 -7.89189339e-01 -2.84923196e-01 ... -1.22189343e+00
     4.83368307e-01 -4.61115956e-01]
   [ 6.94580555e-01 -9.41497326e-01 -2.53357530e-01 ... -4.63508844e-01
     2.46645749e-01 -1.62781072e+00]
   [-7.38585234e-01 -2.06068382e-01 -4.07559812e-01 ...  2.39458501e-01
    -3.15944999e-01 -1.05142820e+00]]

  [[-2.33136602e-02 -4.26201910e-01  3.26057643e-01 ... -3.22625130e-01
     4.12973732e-01  1.56904906e-02]
   [-9.24166441e-01  1.65892586e-01  8.26066017e-01 ... -8.77461791e-01
     2.97421515e-01  1.71986890e+00]
   [ 1.01826942e+00  5.81443273e-02  5.51073968e-01 ...  6.14442289e-01
     3.73104990e-01  4.40984219e-01]
   ...
   [-6.82266593e-01 -7.41059721e-01  8.27144682e-01 ... -1.08673382e+00
     6.66682243e-01  6.62538052e-01]
   [-4.11010385e-01  4.24305797e-02 -5.51547036e-02 ...  1.55249596e-01
     2.51872540e-01 -4.53393698e-01]
   [-6.42826676e-01 -7.00617671e-01  5.22118509e-01 ... -5.57051539e-01
     6.36588573e-01 -3.53114963e-01]]]


 [[[ 5.13499975e-03  8.60820055e-01 -3.20536494e-01 ... -9.58187222e-01
     6.15805566e-01  3.12426388e-01]
   [ 7.69331932e-01  1.29024982e+00 -3.50964606e-01 ...  9.76531506e-01
    -1.38428152e+00  1.07138723e-01]
   [ 1.63816440e+00  6.36221111e-01  2.22013712e+00 ... -2.16008258e+00
    -1.06643245e-01  2.08045673e+00]
   ...
   [ 6.78905100e-02  6.19647264e-01 -1.40949726e+00 ... -1.28271013e-01
    -3.84112477e-01  2.67067790e-01]
   [ 1.22997391e+00  8.68819892e-01  5.90213358e-01 ... -2.35753581e-01
    -6.55928135e-01  9.16332781e-01]
   [ 6.71961725e-01  5.87159216e-01  2.83029586e-01 ... -1.14824486e+00
    -4.40750539e-01  1.40367401e+00]]

  [[ 3.17075878e-01  3.88282806e-01  1.19357660e-01 ...  4.75877702e-01
     5.66922903e-01  2.23164752e-01]
   [ 7.56720230e-02  1.10724092e+00 -5.04162967e-01 ...  1.53843746e-01
     5.56215942e-01  7.76601911e-01]
   [ 6.38496280e-01 -5.15882134e-01 -8.33077967e-01 ...  4.94046867e-01
     1.02578866e+00  5.78332484e-01]
   ...
   [-9.32714939e-02 -7.25287050e-02  1.01483893e+00 ...  4.61402833e-01
     1.09046245e+00 -1.68205500e-01]
   [-3.27845305e-01  4.53238398e-01  1.66358352e+00 ...  3.81941050e-01
    -4.46929842e-01 -5.07314265e-01]
   [ 1.01380038e+00 -8.36295485e-01 -1.79102504e+00 ...  8.88699472e-01
     2.08030224e+00  7.46354684e-02]]

  [[-1.35617375e+00 -1.50487661e+00  2.04402423e+00 ...  1.27425110e+00
     7.69980609e-01  5.53974569e-01]
   [-7.92007148e-01 -1.30353677e+00  9.11430776e-01 ...  7.29277194e-01
     7.73831308e-01  2.38960132e-01]
   [ 7.80947626e-01 -9.54028308e-01 -7.05696225e-01 ...  6.20970309e-01
    -3.13246280e-01 -8.10560286e-01]
   ...
   [-3.97963017e-01 -3.13039273e-01  1.32434323e-01 ...  2.57871181e-01
     4.57834959e-01  2.35803276e-01]
   [ 1.19231284e+00 -8.44706059e-01 -1.11705601e+00 ...  8.79268765e-01
    -8.21923673e-01 -8.79338384e-01]
   [ 7.15175569e-01 -1.24196482e+00 -2.61666030e-01 ...  3.30515206e-01
     1.39026374e-01 -5.09308457e-01]]

  ...

  [[-1.90778196e-01 -7.64875591e-01  3.06433231e-01 ...  3.50682139e-01
    -9.35827374e-01  3.38574082e-01]
   [-3.07108968e-01 -1.22256029e+00 -1.53816497e+00 ...  1.47939622e+00
    -1.53072023e+00  7.90563405e-01]
   [ 8.41188729e-01 -2.66540408e+00  1.69990110e+00 ...  1.07626462e+00
     6.77438200e-01 -1.46864748e+00]
   ...
   [-1.57677084e-01 -1.65809286e+00  1.19404173e+00 ...  8.28184009e-01
     1.27362919e+00 -4.68374014e-01]
   [ 1.94587871e-01 -5.21089733e-01  3.65173519e-01 ...  2.87709497e-02
    -4.29370224e-01 -6.89912438e-01]
   [-7.46806443e-01 -4.46989328e-01  5.76055765e-01 ...  2.24367470e-01
     4.00748491e-01  9.53863919e-01]]

  [[-4.01342005e-01  6.14137053e-02 -9.20332491e-01 ...  1.61144197e-01
    -3.96494061e-01  8.28395784e-02]
   [ 6.58285439e-01  1.41735840e+00 -6.24441087e-01 ... -2.21741512e-01
     5.16968429e-01  9.11988795e-01]
   [ 1.06851864e+00  6.82310879e-01 -8.01805079e-01 ...  1.99156851e-01
     2.92654335e-01  1.47831345e+00]
   ...
   [-5.20695627e-01 -6.35172963e-01 -5.50711334e-01 ...  1.02564263e+00
    -2.34760419e-01  1.59982219e-01]
   [-3.65699194e-02  2.45227292e-01 -3.16716969e-01 ...  7.47060597e-01
     1.29644170e-01  1.09244871e+00]
   [-2.29992941e-01 -2.67816663e-01 -5.19306719e-01 ...  1.31643331e+00
     4.06938456e-02  4.62852806e-01]]

  [[ 1.89366364e+00 -1.39253414e+00 -5.05520999e-01 ...  2.97791868e-01
     1.04940861e-01  1.16354513e+00]
   [-3.68139625e-01 -6.35474801e-01 -2.72458577e+00 ...  1.15559983e+00
     4.02049243e-01 -3.96923840e-01]
   [ 2.02578378e+00 -4.60893154e-01  9.63247001e-01 ...  2.82173276e-01
     5.55950463e-01  2.56814241e+00]
   ...
   [ 1.02139920e-01  7.73276389e-01  5.01870632e-01 ...  5.21274328e-01
     1.32453606e-01 -2.84538567e-01]
   [ 1.72171104e+00  1.03173465e-01  1.29276395e+00 ...  2.80606419e-01
     5.10869622e-01  1.38153434e+00]
   [-1.56089127e-01 -9.26118493e-01 -7.72087455e-01 ...  4.47130382e-01
     3.89755517e-01 -1.80325732e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-False-32-8-27-11-8] q.shape1: (8, 11, 27)
q.shape2: (88, 27)
q.shape3: (88, 27)
q.shape4: (8, 11, 27)
q_liner: [[[ 0.7224422  -0.4349445   3.4143314  ...  0.3524749   1.7550441
    1.3171579 ]
  [ 2.726345    1.2628067  -1.7939713  ... -0.06979546  0.00453782
    3.1302361 ]
  [-1.1040715  -0.15600364  1.9368501  ... -0.5825903  -0.65041417
   -2.2147686 ]
  ...
  [ 2.29157     0.908618    1.0856221  ... -1.3256541   0.30595994
   -0.84049827]
  [-0.40498114 -0.5691511   2.6631112  ...  0.8738295   0.4198153
    1.1513562 ]
  [-0.4481117  -0.92076814  3.5576978  ...  2.7185454   3.3272922
   -0.97112256]]

 [[-1.1616747  -1.7085901  -0.06308014 ... -0.84628963  0.9343368
   -0.6217179 ]
  [ 0.4018707   0.30482602  0.46497503 ...  0.11524689  0.10966628
   -0.6314564 ]
  [ 2.1810687  -1.1074287   1.3467315  ...  0.39241254  0.3339569
    0.5910638 ]
  ...
  [ 3.547802    0.51425123 -2.1266663  ... -1.1019756  -0.78907746
    2.1269357 ]
  [-1.6231765  -2.7684586   0.24566987 ... -0.25909057 -0.6573771
   -1.6647071 ]
  [ 2.5132887   0.55106294  0.7015406  ...  1.2227943   0.7392053
    1.8680627 ]]

 [[ 0.27821246 -1.1018684   1.7200263  ... -1.7082299  -0.4673362
   -2.2366893 ]
  [ 2.7587233   1.7226602   0.80260444 ...  1.1995286  -0.92798245
    0.2717521 ]
  [ 0.64558136  0.08447142  0.4400963  ...  1.3089368   1.2809186
   -1.5577403 ]
  ...
  [-1.0232698  -1.5747494   1.018051   ...  0.00518736 -0.4626458
    0.8344153 ]
  [ 1.1266454   0.38148978  2.193111   ... -1.535103    0.7982023
   -0.95043397]
  [-0.9965041  -1.8504593   1.8635492  ...  1.692321    1.8115427
   -0.7349715 ]]

 ...

 [[ 2.074959    2.2624094   0.34631863 ... -3.2463975   1.0677857
    1.5288497 ]
  [ 0.26497793  1.3373191   3.0214698  ...  0.41106525 -0.168928
    0.03355249]
  [ 0.5420742   1.2251356  -3.8265731  ... -0.34920886 -0.03093657
    0.798989  ]
  ...
  [-3.2419846  -1.4931114   0.72515845 ...  1.7054092  -0.04060049
   -2.0626805 ]
  [ 0.9767814   0.28908023 -1.5257838  ... -3.0712612  -0.89618737
   -0.34019688]
  [ 0.62380505  1.7282047  -0.0089727  ...  3.7021785  -0.5753088
    1.6830212 ]]

 [[ 2.0232098   0.64801407  0.06984086 ...  0.7552189   0.41255075
    0.56615067]
  [ 0.18463086  0.6487753  -2.7815037  ...  0.88175464 -0.71326035
   -0.08390006]
  [-1.9218032   0.28904673 -1.1362168  ... -2.5849714  -0.15884835
   -1.8206904 ]
  ...
  [-1.7156733  -0.79765487 -1.7961345  ... -0.48244846  1.5824316
    0.23448431]
  [-0.93504095 -0.5579304  -1.3916398  ... -1.322384   -0.33638978
   -0.6543722 ]
  [-3.1369116  -1.0516435   3.082999   ...  0.6630197   1.6387494
   -2.8189464 ]]

 [[ 0.5203575   2.510916   -2.5926096  ... -0.47947776 -2.6331599
    1.5112784 ]
  [ 0.2482923   0.10941231 -1.2460439  ...  1.8010229  -0.24936317
   -0.89507395]
  [-0.4074848   0.3564243   1.156305   ... -0.9337906  -0.32710424
    0.46405238]
  ...
  [ 0.8763598   0.15448405  0.44426623 ... -1.1368421   0.7098689
   -0.3491226 ]
  [-2.248125    0.22241627 -1.8704771  ... -1.2285389   0.29145718
   -0.22001871]
  [-1.0332358   0.15769057 -1.6133977  ...  0.13136601  1.1417925
   -0.2518325 ]]]
q.shape5: (8, 11, 256)
q.shape6: (8, 8, 11, 32)
attn_res: [[[[ 1.21430421e+00  1.95367038e-01 -9.86171126e-01 ...  1.98731732e+00
     5.10460660e-02  1.77679396e+00]
   [ 1.40532982e+00  1.44045365e+00 -5.27803421e-01 ... -6.27148807e-01
    -9.30281162e-01 -1.97408175e+00]
   [ 2.04509163e+00  8.85950387e-01 -6.11198664e-01 ... -5.07280111e-01
    -1.24272060e+00 -1.14945841e+00]
   ...
   [ 1.32808387e+00 -9.84156057e-02  1.12253278e-01 ...  5.49309433e-01
    -1.93467927e+00 -5.95808983e-01]
   [ 1.83262920e+00  6.42086387e-01 -4.19836551e-01 ... -3.67607504e-01
    -1.15683258e+00 -9.10497606e-01]
   [ 1.05437362e+00 -2.61561543e-01  1.35842443e-01 ...  1.24704324e-01
    -1.13332309e-01  5.12320518e-01]]

  [[-5.00326991e-01 -5.06486714e-01  3.12148966e-03 ...  5.54592490e-01
     3.35715950e-01  9.56450045e-01]
   [-7.70857930e-01  4.96236384e-01 -9.66503322e-01 ... -5.41272722e-02
    -2.64923990e-01  1.42728493e-01]
   [ 1.50207609e-01 -1.79931298e-02  4.17006552e-01 ...  2.90578544e-01
     8.21782351e-01 -1.49019027e+00]
   ...
   [ 6.50554150e-02  2.42546260e-01  3.48378122e-01 ...  2.83440828e-01
     1.38445520e+00 -1.78110909e+00]
   [-1.54654801e-01 -4.92315620e-01  3.04457396e-01 ...  2.72951275e-01
     6.44148588e-01  9.92902935e-01]
   [-9.12903547e-01 -5.15863299e-01  2.18485624e-01 ...  8.71827960e-01
     2.18937352e-01  1.18633258e+00]]

  [[-4.69289452e-01  7.93021441e-01 -7.65970290e-01 ...  6.38635933e-01
     5.17525077e-01 -1.47592926e+00]
   [-1.04003274e+00  6.65258706e-01 -4.51359272e-01 ...  1.26560330e+00
     3.35381448e-01 -1.31179380e+00]
   [-8.78557622e-01 -3.26175332e-01 -1.07492357e-02 ... -1.50817394e-01
    -9.96448696e-02 -4.94710729e-03]
   ...
   [-3.13847840e-01 -1.37600148e+00 -9.70614478e-02 ...  8.37983072e-01
    -7.79090881e-01  8.28723833e-02]
   [ 5.55953942e-02  4.49211538e-01 -7.94007897e-01 ... -4.90786701e-01
     9.09446836e-01 -2.16512012e+00]
   [-6.49106920e-01  6.73619151e-01 -5.90066254e-01 ...  1.95189327e-01
     5.03111839e-01 -7.89755210e-03]]

  ...

  [[-3.33397865e-01 -2.62789369e-01 -1.07285954e-01 ...  3.67383868e-01
     4.90355611e-01 -1.30703402e+00]
   [-9.22066689e-01  5.66003144e-01 -4.22036871e-02 ...  3.71815264e-03
    -3.19167495e-01  3.19923133e-01]
   [-3.68259788e-01 -1.09755015e+00  8.98916304e-01 ... -1.65264934e-01
    -6.59302115e-01 -5.56451440e-01]
   ...
   [-2.21505284e-01  1.96496695e-01  3.18922728e-01 ... -1.16578996e+00
    -9.90111649e-01 -4.12990332e-01]
   [ 1.27243757e-01  5.81158459e-01 -7.11112082e-01 ... -1.08970411e-01
     1.49704084e-01 -1.62113333e+00]
   [-1.35383606e-01 -3.08974952e-01 -1.91549093e-01 ...  4.15296525e-01
     7.18355238e-01 -1.56317389e+00]]

  [[ 1.25201023e+00 -6.88264370e-02  9.09437478e-01 ...  6.97375178e-01
    -7.00078905e-01 -1.56375408e-01]
   [ 1.37135565e+00 -1.13144882e-01 -8.17847252e-01 ... -2.82987386e-01
    -1.59908265e-01 -5.66149838e-02]
   [ 1.41456556e+00  2.16974214e-01 -9.53759849e-01 ... -3.48024458e-01
     2.11336926e-01 -5.31485491e-03]
   ...
   [ 1.71713471e+00  1.32508755e-01 -4.54625249e-01 ... -1.96862981e-01
    -2.41059214e-02 -1.50328413e-01]
   [ 1.46285653e+00 -6.25709593e-01  1.39684689e+00 ...  9.26967442e-01
    -1.10487700e+00 -8.42395127e-01]
   [ 1.34272611e+00 -5.13755739e-01  9.21667337e-01 ...  5.77723384e-01
    -8.79723549e-01 -8.99160624e-01]]

  [[ 4.13629375e-02 -1.64321923e+00 -4.76301789e-01 ...  3.46252590e-01
     1.37687886e+00  1.48105156e+00]
   [ 4.16469485e-01 -8.15060854e-01 -5.92675507e-01 ...  8.06153417e-01
     5.52232087e-01  5.91825843e-01]
   [-2.70232320e-01 -5.88975608e-01 -7.65304983e-01 ...  5.48543215e-01
     7.37306476e-01  2.63970852e-01]
   ...
   [ 8.87127399e-01 -7.56061733e-01 -1.21097696e+00 ...  1.22414306e-01
     1.32819986e+00  2.40550935e-01]
   [-1.11602575e-01 -1.21645379e+00 -2.70749748e-01 ... -4.46459372e-03
     1.55933058e+00  1.55052745e+00]
   [ 3.87127437e-02 -5.42808831e-01 -2.84451246e-01 ...  9.71410871e-01
     4.33796287e-01  7.04505801e-01]]]


 [[[ 2.73378432e-01  5.57699919e-01 -1.03941485e-01 ... -1.48270452e+00
     1.25513875e+00  2.63130486e-01]
   [-9.77840126e-02 -4.43963170e-01  5.02835155e-01 ...  9.64791700e-02
     2.26148680e-01 -6.20761037e-01]
   [-3.94432008e-01 -6.45707130e-01  5.70508420e-01 ...  3.09781313e-01
     3.93033177e-01 -6.68909967e-01]
   ...
   [-2.93609321e-01 -6.38796985e-01  9.56644714e-01 ...  5.62237322e-01
     7.71669000e-02 -4.07319427e-01]
   [-1.38379180e+00  2.25716159e-01  6.92568660e-01 ... -5.64243346e-02
     4.91312802e-01 -5.64060032e-01]
   [-9.06590700e-01 -5.65422118e-01  1.32119787e+00 ...  7.92021751e-02
     9.38407838e-01 -3.16813141e-02]]

  [[ 6.46291748e-02  1.15162313e+00  9.25112605e-01 ...  1.90021113e-01
     3.05479258e-01 -7.09059387e-02]
   [-1.18940246e+00  3.80001813e-01 -1.30664659e+00 ... -1.05088152e-01
    -1.08396924e+00  1.73362538e-01]
   [-8.01297843e-01  4.91965353e-01  2.04758912e-01 ...  1.57499647e+00
     3.52660716e-01  2.54040956e-01]
   ...
   [-1.49099696e+00 -8.06108594e-01  1.25392735e+00 ...  2.66315758e-01
     6.99963689e-01 -4.57678363e-02]
   [ 1.58892810e-01  1.10147834e+00  3.99084032e-01 ...  7.90956497e-01
     4.24051106e-01  7.27497339e-02]
   [-4.83651236e-02  4.36621845e-01  5.47261178e-01 ...  4.69822586e-01
     1.13277301e-01  6.39434159e-03]]

  [[-4.80182678e-01 -4.41876322e-01  5.56158423e-01 ...  6.72816515e-01
     4.15135384e-01 -3.74941587e-01]
   [ 6.80304885e-01 -2.30802193e-01  2.04429239e-01 ...  6.48176134e-01
    -1.86460242e-02  7.94600546e-01]
   [ 8.84120107e-01 -1.43147126e-01  4.81888890e-01 ...  6.88107491e-01
     1.13250881e-01 -8.45288113e-02]
   ...
   [ 1.38621271e+00  8.37669969e-01  9.66259986e-02 ...  1.98860466e-01
     4.72786844e-01  5.44517599e-02]
   [ 5.42516053e-01 -2.55354084e-02 -2.54204869e-02 ...  1.42131254e-01
     4.55327511e-01 -3.73935342e-01]
   [ 1.13654244e+00 -1.26374853e+00 -5.94699442e-01 ...  1.06376266e+00
    -1.00665057e+00 -4.42790866e-01]]

  ...

  [[-1.42977691e+00  1.50997365e+00  4.37664658e-01 ... -2.68158841e+00
    -1.16268051e+00  1.05820346e+00]
   [-7.16515660e-01  6.18245244e-01 -6.74299836e-01 ... -6.39714420e-01
    -9.39470381e-02 -5.05662024e-01]
   [ 9.45053279e-01  2.38694832e-01  4.85500842e-02 ... -8.78917992e-01
     1.61043525e-01 -1.39802921e+00]
   ...
   [-1.99474078e-02  3.36684346e-01 -8.10267806e-01 ...  1.19536543e+00
     6.65902793e-01 -1.33116090e+00]
   [-2.66535908e-01  1.40933192e+00 -1.68265656e-01 ...  8.40118945e-01
    -3.11801046e-01 -3.38576585e-01]
   [-5.50515115e-01  5.11174560e-01 -2.15692818e-01 ... -7.74040818e-01
    -1.43968865e-01 -2.71022797e-01]]

  [[ 1.96360067e-01  3.38328004e-01 -1.55741438e-01 ...  2.81046152e-01
    -7.83133149e-01  3.99579197e-01]
   [ 1.34362817e+00 -3.98097277e-01 -4.52202052e-01 ... -4.67975557e-01
    -1.16165423e+00  1.65199265e-01]
   [-3.65528971e-01  4.20011356e-02  4.93706226e-01 ...  5.21207631e-01
     3.53339434e-01  2.90772825e-01]
   ...
   [ 3.19833279e-01 -6.33634925e-02  7.76863873e-01 ...  5.29089034e-01
     2.56699562e-01 -1.95207572e+00]
   [-2.95496583e-01  3.69723737e-01  7.53824294e-01 ...  3.45492840e-01
     3.72324765e-01 -2.58169651e-01]
   [-4.37480152e-01  8.09769273e-01  1.02907848e+00 ... -4.97010678e-01
     6.60119891e-01 -1.02402699e+00]]

  [[-5.63182771e-01  3.26509178e-01  4.41508770e-01 ... -1.80813551e-01
     9.28705692e-01  8.96516383e-01]
   [-4.98677611e-01  2.08694786e-01  1.20291805e+00 ...  5.57697654e-01
     4.88842785e-01  2.34998554e-01]
   [ 4.09964919e-01 -1.63653865e-01  1.41248190e+00 ... -3.84977758e-01
     7.24050522e-01  1.62685943e+00]
   ...
   [ 1.84514895e-01  3.63179833e-01  5.35923481e-01 ...  3.03171962e-01
     9.90146458e-01  7.95229137e-01]
   [-4.21291351e-01  1.18817650e-01  8.57229471e-01 ... -1.48841143e-02
     5.96742392e-01  9.82198119e-01]
   [ 7.27238953e-01  7.83828735e-01  6.76016062e-02 ... -6.69153988e-01
     1.38852024e+00  6.04394913e-01]]]


 [[[-7.99952149e-01 -1.29546809e+00  2.01614928e+00 ...  1.92318410e-01
     9.53911841e-01  6.44336224e-01]
   [-8.87548983e-01 -8.61774504e-01  1.19562924e+00 ... -1.18683748e-01
     2.02920842e+00  8.10754597e-01]
   [-6.06236756e-01 -6.57211721e-01 -5.56815326e-01 ...  7.62462139e-01
     5.22737801e-02  2.63654977e-01]
   ...
   [ 5.14155209e-01 -2.56278396e-01 -2.99385428e-01 ...  2.60004401e-01
    -3.25936139e-01  9.49435711e-01]
   [-6.32858992e-01 -9.84936535e-01  1.38231182e+00 ... -8.12655091e-02
     5.20140707e-01  9.83083010e-01]
   [-4.29668754e-01 -6.79789722e-01  1.17221427e+00 ...  1.40322417e-01
     2.90795088e-01  6.14536643e-01]]

  [[-5.62321484e-01  8.69850993e-01  3.93767416e-01 ...  2.99446344e-01
     1.96138948e-01  6.32410169e-01]
   [-1.51524812e-01  8.16249326e-02  4.42554832e-01 ...  1.00105204e-01
    -2.00041324e-01  4.48002785e-01]
   [-5.30903518e-01  8.07812274e-01  1.30700397e+00 ...  8.20464313e-01
     2.11759135e-01  2.23628116e+00]
   ...
   [ 7.00154543e-01  2.95984983e+00  7.83693135e-01 ... -1.29262432e-02
     2.20183492e+00  5.22108376e-01]
   [-2.64560938e-01  1.37446749e+00  9.19277072e-01 ...  1.37048200e-01
     7.55904853e-01  6.99814856e-01]
   [-3.33450049e-01  6.59322143e-01  9.79734659e-01 ... -4.53989476e-01
     3.19668353e-01  1.51570886e-01]]

  [[-9.53416526e-01  1.30904460e+00 -2.74996638e-01 ... -2.66875595e-01
    -1.02468348e+00 -4.70613271e-01]
   [-7.34875143e-01 -5.60728848e-01  3.47761244e-01 ... -1.88582584e-01
    -7.77569473e-01 -6.64631248e-01]
   [-2.09956124e-01  9.81544018e-01  2.92098612e-01 ... -5.54514170e-01
     6.59384310e-01 -3.92616093e-01]
   ...
   [-1.11117244e+00  8.50478351e-01  4.80478466e-01 ...  2.69357227e-02
     2.90235579e-01 -1.92147076e-01]
   [ 4.99617219e-01  1.29731274e+00  2.82076336e-02 ... -8.64189327e-01
    -2.38994986e-01 -5.12898326e-01]
   [-1.46691573e+00  2.76466906e-01  7.83053458e-01 ... -4.68465865e-01
     3.53129357e-01  9.56063747e-01]]

  ...

  [[ 3.92673671e-01  4.06375468e-01 -8.89274478e-01 ... -2.60544926e-01
    -8.67725462e-02  8.00718963e-02]
   [ 8.84534046e-02 -3.01505536e-01  6.08557522e-01 ... -8.79934371e-01
     4.44719166e-01 -4.15235549e-01]
   [-5.22598386e-01 -1.15809536e+00  8.79547238e-01 ...  1.77488960e-02
     1.24920821e+00  1.71398926e+00]
   ...
   [ 9.66728777e-02 -2.71921754e-01  1.05219305e-01 ... -1.60224900e-01
     4.85783428e-01  2.71760345e-01]
   [-1.04036905e-01  5.51234245e-01 -3.71939957e-01 ... -2.68017620e-01
    -4.18296382e-02  4.92915511e-01]
   [ 1.72556221e-01 -7.90011659e-02 -1.58772618e-01 ... -7.25641310e-01
     9.49458554e-02 -4.51774120e-01]]

  [[ 4.33353990e-01 -9.12738800e-01  4.04014528e-01 ... -5.86677194e-01
    -6.90147519e-01 -2.22568184e-01]
   [-4.34015542e-01 -9.67978418e-01  7.61893630e-01 ...  2.72453594e+00
     1.82633381e-02 -5.31107426e-01]
   [ 3.47408354e-01 -4.45369601e-01  9.60410535e-01 ...  1.65462315e-01
    -7.38756120e-01 -5.94124258e-01]
   ...
   [-1.17702685e-01 -2.31725857e-01  9.91754830e-01 ...  3.57169002e-01
    -6.13559633e-02 -5.91242969e-01]
   [ 1.25656903e+00 -8.02352056e-02  9.73269045e-01 ...  1.92151964e-01
     6.26688838e-01 -5.75582981e-01]
   [ 1.34372270e+00 -5.14276505e-01  1.41382933e+00 ... -4.91896838e-01
    -2.55720377e-01 -9.13248241e-01]]

  [[-5.89185774e-01  9.05737102e-01  2.23898983e+00 ...  3.78607869e-01
     3.32203299e-01  9.52588081e-01]
   [ 7.99068391e-01 -2.49833083e+00 -1.10012436e+00 ...  1.93317309e-01
    -1.13372481e+00  1.62596369e+00]
   [ 5.49762428e-01 -6.80570424e-01 -2.58626819e-01 ...  2.45512605e-01
    -2.46542990e-02  1.05427623e+00]
   ...
   [-9.51325953e-01  8.33900928e-01  1.62975267e-02 ... -8.20656955e-01
     6.63950369e-02  4.26752448e-01]
   [-1.76935565e+00  8.60294253e-02 -3.47018480e-01 ... -1.54106355e+00
     1.10824481e-02  7.66723752e-01]
   [-1.08978462e+00  1.04029369e+00 -7.97640502e-01 ... -1.41758609e+00
     1.64621606e-01  3.69242907e-01]]]


 ...


 [[[ 1.04057884e+00 -3.65653127e-01  1.33510268e+00 ... -6.77752137e-01
    -9.15333450e-01  3.22917491e-01]
   [ 3.44459981e-01  9.08236802e-02 -6.65953994e-01 ... -3.98713857e-01
    -5.49227059e-01  4.07694161e-01]
   [-2.72252828e-01  1.10588998e-01 -5.98873377e-01 ... -8.46343696e-01
    -5.76786280e-01 -3.91833276e-01]
   ...
   [ 1.41690385e+00  6.19692326e-01 -7.27865160e-01 ... -2.26166391e+00
    -1.51152241e+00 -4.44873929e-01]
   [ 1.12389362e+00 -2.30034798e-01 -4.27551150e-01 ... -4.50677425e-01
    -2.97751993e-01  2.31265858e-01]
   [ 3.23576808e-01  6.95001483e-02 -1.09837306e+00 ... -5.93767822e-01
    -3.21236461e-01 -5.73535450e-02]]

  [[-6.93099424e-02 -8.06742847e-01  8.43311965e-01 ... -6.20516837e-01
    -2.73458064e-01 -2.31947136e+00]
   [-2.07544908e-01  1.69324875e-03  2.33536974e-01 ... -1.68798357e-01
     4.12255824e-01 -7.93007433e-01]
   [-1.28407538e-01  2.69621730e-01  3.90892923e-02 ... -2.19195932e-02
     6.20089650e-01 -1.00706697e-01]
   ...
   [-1.66002214e-01  3.97296935e-01  4.55636144e-01 ...  1.27312124e+00
     1.32921171e+00  1.37789965e+00]
   [ 3.39653939e-02  5.12247264e-01  3.11262995e-01 ... -5.32114625e-01
     1.10240269e+00  8.36705565e-02]
   [ 1.55748911e-02 -1.05891697e-01  3.76196623e-01 ...  9.22345042e-01
     2.87457481e-02 -1.47092175e+00]]

  [[-2.93003559e-01 -2.54055679e-01  4.83809799e-01 ...  5.18875837e-01
     3.82511318e-01 -5.49129248e-02]
   [-1.38420856e+00  4.15156603e-01 -1.01812065e-01 ... -6.48173273e-01
     1.27957594e+00 -1.19163573e-01]
   [ 5.25335908e-01 -4.28548902e-01  1.51298568e-01 ...  2.32244477e-01
    -1.34806693e-01 -2.95448661e-01]
   ...
   [ 1.38475746e-01 -4.36962008e-01 -9.77300629e-02 ...  4.53921437e-01
     4.68413144e-01 -6.77605748e-01]
   [-1.43204951e+00 -4.21410859e-01 -1.03158450e+00 ... -8.33915770e-01
     1.06390643e+00 -1.65983593e+00]
   [-7.95671105e-01  2.72055827e-02  5.88857055e-01 ... -2.24537775e-01
     4.74835038e-01  3.15239727e-01]]

  ...

  [[-2.10886061e-01 -4.74005640e-01  1.13106072e+00 ... -1.16507864e+00
    -1.26220441e+00  2.04856515e+00]
   [-1.72322011e+00 -2.25166529e-01 -4.20702368e-01 ...  1.11550003e-01
     2.58753151e-01  3.11554492e-01]
   [ 2.28373483e-01  1.26420581e+00 -2.10871130e-01 ...  8.15332457e-02
    -7.96975717e-02 -4.10255156e-02]
   ...
   [-2.35500169e+00  8.94814357e-02 -1.08946480e-01 ... -6.08489990e-01
     3.25145245e-01  2.99513906e-01]
   [-5.41850150e-01 -3.56394798e-01  1.05306733e+00 ... -1.09155023e+00
    -1.40111303e+00  1.77574146e+00]
   [-3.28795135e-01 -6.32193625e-01  5.71555495e-01 ... -9.05484080e-01
    -1.80358648e-01  1.28702939e+00]]

  [[ 1.62765491e+00 -1.33334291e+00  3.29725184e-02 ... -2.94031769e-01
    -1.49398005e+00 -6.82668388e-01]
   [ 1.93361506e-01 -1.36451125e-02 -6.14863813e-01 ... -3.60868603e-01
    -4.95783538e-02  5.26021421e-01]
   [ 2.20095849e+00  3.62806693e-02  4.07804787e-01 ... -1.00525129e+00
    -7.93217361e-01 -1.98684239e+00]
   ...
   [-8.95953536e-01 -7.19013631e-01 -4.03126538e-01 ...  4.24666107e-01
    -5.58519304e-01  4.67020273e-01]
   [ 1.77882627e-01 -5.89164734e-01 -3.97541881e-01 ... -9.66592282e-02
    -1.69503316e-03 -1.18847859e+00]
   [ 1.18751153e-01 -1.08804822e+00  1.21069416e-01 ... -1.99705467e-01
    -4.81202304e-01 -7.03940213e-01]]

  [[-7.38455176e-01 -1.71981126e-01 -4.30915117e-01 ...  5.21974824e-02
    -3.07294816e-01  5.33013165e-01]
   [-9.86618325e-02 -4.98298824e-01  1.92375883e-01 ... -2.03319013e-01
     4.62413996e-01  1.39709830e+00]
   [-8.83836329e-01 -1.65591046e-01  9.16844964e-01 ...  1.30434066e-01
     6.94219172e-01  1.32118380e+00]
   ...
   [-8.18233490e-01  4.42174017e-01  1.19892977e-01 ... -1.37070268e-01
     2.18338370e-01 -3.96375149e-01]
   [-1.62424326e+00  2.95197338e-01  4.69363928e-01 ... -4.26332593e-01
    -1.10425092e-01  7.11630821e-01]
   [ 5.84260821e-02  3.51829052e-01  9.17509422e-02 ...  4.98433948e-01
     3.81223947e-01  3.94881815e-01]]]


 [[[-1.39094818e+00  1.13471091e+00  3.06265235e-01 ... -9.15451884e-01
     4.35020387e-01  1.10993624e+00]
   [-7.80531317e-02 -2.08305764e+00  1.29794091e-01 ...  1.46709943e+00
     2.73278922e-01  2.05284619e+00]
   [ 1.72965527e+00 -7.28800654e-01  1.35864329e+00 ...  1.51326454e+00
    -5.71336448e-01 -4.85637754e-01]
   ...
   [ 9.30102766e-01 -1.05770600e+00  1.42149973e+00 ...  7.18816161e-01
     6.46519661e-03  8.90248537e-01]
   [ 4.66113240e-01 -2.04325867e+00  8.71262908e-01 ...  1.70134306e+00
     2.99001050e+00  1.04885650e+00]
   [ 1.40804100e+00 -2.32210398e+00  7.60907888e-01 ...  1.47407889e+00
     1.97639084e+00  9.83586073e-01]]

  [[-1.25038093e-02 -2.94363528e-01 -2.71596611e-01 ... -8.33407938e-01
     2.21281004e+00 -2.22845626e+00]
   [-4.40799713e-01 -3.25630039e-01  2.58714795e-01 ... -1.08912075e+00
     3.79687339e-01 -1.24911582e+00]
   [ 6.36778772e-01 -7.90999651e-01  8.49643171e-01 ... -1.82081580e+00
     6.41111195e-01 -9.76312220e-01]
   ...
   [ 4.39429432e-01 -4.26334679e-01  1.06695867e+00 ... -1.86886168e+00
     4.55452412e-01 -1.41151142e+00]
   [-5.30725241e-01 -4.46230710e-01 -1.86975151e-01 ...  1.33711457e-01
     5.32465637e-01 -8.92182291e-01]
   [ 1.88930258e-01 -2.38757372e-01  5.91547728e-01 ... -1.13304865e+00
     9.56508279e-01 -7.99867511e-01]]

  [[-9.25552785e-01  1.12684810e+00  3.76928121e-01 ... -2.18073189e-01
     1.59032035e+00 -1.14864087e+00]
   [-8.56576324e-01  2.62233406e-01 -1.14798677e+00 ...  7.84507319e-02
     1.85198224e+00 -2.50243282e+00]
   [-6.86192214e-01  2.00725481e-01 -3.43154699e-01 ...  1.90381967e-02
     1.36444366e+00 -2.11067128e+00]
   ...
   [-1.45973766e+00 -3.94865543e-01 -8.19981337e-01 ...  1.95821226e-01
     7.22131789e-01 -2.07966232e+00]
   [-9.35377836e-01  9.12893116e-02  5.54867446e-01 ...  3.05952698e-01
     4.29756403e-01 -1.39303887e+00]
   [-8.18779767e-01  9.82970834e-01 -3.34682643e-01 ...  8.74236286e-01
     6.39159828e-02 -1.48706663e+00]]

  ...

  [[-2.63191648e-02 -8.55470002e-01  8.60580921e-01 ... -1.67544615e+00
    -1.44934297e+00  9.31366026e-01]
   [ 2.21316293e-01 -8.01024958e-02 -1.88571417e+00 ...  1.82949305e+00
     1.91516131e-01  6.04139864e-01]
   [-1.21083724e+00  1.12938619e+00 -1.00921726e+00 ... -2.87985116e-01
    -1.52367449e+00 -1.07630885e+00]
   ...
   [ 3.30667526e-01 -3.01731974e-02 -5.21521270e-01 ... -2.62877166e-01
    -6.63598597e-01  8.23431432e-01]
   [ 2.27649584e-01  1.44775867e-01 -9.74750042e-01 ...  4.27071005e-01
    -5.37648201e-01  2.31448516e-01]
   [-1.17132640e+00  8.24551046e-01 -8.22138429e-01 ... -9.19350266e-01
    -6.45599604e-01  1.05909839e-01]]

  [[-5.13848186e-01  7.06664920e-02  7.44746208e-01 ...  3.23330820e-01
    -7.58172095e-01 -1.07888687e+00]
   [ 4.76053923e-01  6.93877339e-01  6.71593487e-01 ... -1.55399215e+00
    -1.05673301e+00 -3.95773172e-01]
   [-9.97883916e-01 -3.78564671e-02  9.19824779e-01 ...  4.78389323e-01
    -9.82331872e-01  1.81271002e-01]
   ...
   [-6.32896185e-01  4.49284106e-01  7.52363622e-01 ...  2.65484840e-01
    -4.70979512e-01 -8.02484810e-01]
   [-1.38215005e-01  1.19154096e+00  9.25849915e-01 ...  6.13773167e-01
    -6.50340915e-02 -5.47787905e-01]
   [-2.44571596e-01 -4.30736005e-01  9.35387611e-01 ... -2.97742653e+00
    -1.58123815e+00  4.65305805e-01]]

  [[ 2.18809202e-01 -5.99633873e-01  5.51481247e-01 ...  6.01673983e-02
    -1.04667723e-01  1.13315594e+00]
   [ 6.14322662e-01 -1.41503644e+00  8.42867255e-01 ...  2.48670787e-01
    -7.32024074e-01  1.48664784e+00]
   [ 3.48843366e-01  1.90451133e+00 -6.67429328e-01 ... -6.14400730e-02
    -2.93051600e-01  4.67769921e-01]
   ...
   [ 3.66936743e-01  1.24892068e+00  5.54005921e-01 ...  8.46517503e-01
    -3.50926578e-01 -2.89401174e-01]
   [ 2.84664035e-01  1.19622242e+00 -1.38225245e+00 ...  2.95753121e-01
    -4.41631317e-01  5.76165438e-01]
   [ 3.17377806e-01  7.78875947e-01  5.50578713e-01 ...  7.22341418e-01
    -1.98021621e-01 -3.64834726e-01]]]


 [[[-1.36375499e+00 -1.32790351e+00  1.09737122e+00 ...  1.89339876e-01
     1.30297589e+00  1.31895125e+00]
   [-5.31971514e-01 -2.61570811e-01 -3.07893544e-01 ... -9.86106098e-01
    -1.59629595e+00 -1.80353612e-01]
   [-4.15174037e-01 -1.61696541e+00  5.78365147e-01 ... -2.14726776e-01
    -9.57022369e-01  4.46940005e-01]
   ...
   [-4.22921151e-01  1.01357445e-01 -1.43296629e-01 ... -1.02296174e+00
    -1.75878024e+00 -2.08623990e-01]
   [-5.61593115e-01 -8.99019599e-01  2.00808942e-01 ... -1.69715926e-01
     3.96337926e-01  7.78820157e-01]
   [-3.26613575e-01  8.42672110e-01  9.09774542e-01 ...  6.21514879e-02
     2.87985235e-01  6.81026280e-01]]

  [[ 1.25591993e-01 -2.63584316e-01 -8.46712947e-01 ...  6.32204175e-01
     6.78785443e-02  3.15633804e-01]
   [-1.33475795e-01  1.73370242e-01  3.89086306e-01 ...  4.82924521e-01
     3.99139225e-01  2.01297365e-02]
   [ 2.08086014e-01  3.58420044e-01  8.32332313e-01 ...  2.05037332e+00
     9.00965810e-01  1.60676390e-01]
   ...
   [-9.30747509e-01  4.18388665e-01  1.05209255e+00 ...  1.15717733e+00
    -1.02711797e+00  1.61520708e+00]
   [-4.09056433e-02 -3.87932152e-01  2.28019565e-01 ...  6.48672640e-01
     3.75635803e-01  5.96524537e-01]
   [-2.66377062e-01 -5.23450971e-01  6.65453196e-01 ... -8.09507251e-01
    -1.77260697e-01 -3.67632806e-01]]

  [[-9.06469226e-01 -4.31205332e-01 -2.20682546e-02 ... -3.13444018e-01
    -3.95786971e-01 -2.19443947e-01]
   [ 5.92894018e-01 -5.13735056e-01 -1.84125572e-01 ...  1.61450064e+00
     3.89283121e-01 -1.35147262e+00]
   [-2.05450878e-01  1.28268147e+00  5.70078552e-01 ... -9.01411653e-01
     3.68132889e-01  1.57951429e-01]
   ...
   [-1.63806230e-01 -1.88998508e+00 -4.50279862e-02 ... -1.20102835e+00
    -1.47897744e+00 -1.67247236e-01]
   [-1.34662640e+00  5.72480738e-01 -2.91787446e-01 ...  1.72641826e+00
    -2.24556780e+00 -4.77383316e-01]
   [-4.99464393e-01 -8.07882071e-01 -6.85226440e-01 ... -2.36907959e-01
    -1.13581598e+00 -2.38638759e-01]]

  ...

  [[ 3.69491309e-01  2.31744200e-01  5.56895137e-03 ...  4.96731430e-01
    -3.21621537e-01  3.94595653e-01]
   [-2.80946225e-01 -1.07528424e+00  1.00080264e+00 ... -1.99483618e-01
     1.31928051e+00  1.09310687e+00]
   [ 5.87069988e-01  7.08310455e-02 -7.22444713e-01 ...  6.10526919e-01
     6.51989579e-01 -3.54555756e-01]
   ...
   [-2.36376658e-01  1.72799993e-02 -2.82022357e-01 ... -2.80891418e-01
    -1.92462921e-01  1.32393408e+00]
   [ 4.13815796e-01 -2.25912392e-01  6.55840278e-01 ... -3.47768903e-01
    -6.43799007e-01  7.92632520e-01]
   [-6.29006326e-02  2.26471633e-01  5.21057844e-01 ...  2.31786400e-01
    -1.07727706e+00  1.16490018e+00]]

  [[-1.44856715e+00  1.42562604e+00  1.29702830e+00 ...  4.52809542e-01
     3.38223577e-01 -1.45538956e-01]
   [ 3.61971289e-01  6.57865763e-01 -5.79416156e-01 ...  1.08271909e+00
     3.82241577e-01 -2.77155906e-01]
   [-1.41949165e+00  1.01273783e-01 -4.33532834e-01 ...  4.69532102e-01
    -8.21680665e-01 -1.68005431e+00]
   ...
   [ 1.07624567e+00  5.40532589e-01  6.23091936e-01 ...  1.96396291e+00
    -2.93776631e-01 -1.77275503e+00]
   [-1.11161768e+00 -1.30034888e+00 -5.94964772e-02 ... -4.67372388e-01
    -2.96242267e-01  1.66705757e-01]
   [-3.03121656e-01 -6.83008134e-01 -1.06202853e+00 ...  7.68089950e-01
     3.68466258e-01 -7.76617408e-01]]

  [[-6.60709918e-01  1.27311432e+00  4.08624291e-01 ... -2.43563724e+00
     1.07902564e-01  2.48973823e+00]
   [-9.64745879e-02 -6.42600298e-01 -4.57611024e-01 ... -5.14966428e-01
    -6.49867356e-01 -1.72997499e+00]
   [ 1.09319493e-01 -1.59033477e-01 -1.04767728e+00 ...  3.30217332e-01
    -1.05403811e-02 -9.60865617e-01]
   ...
   [ 2.84838259e-01  2.23635644e-01  6.10094629e-02 ...  1.77559042e+00
     6.83505476e-01 -1.53132737e-01]
   [-6.90492839e-02 -1.98660278e+00  8.82363021e-02 ... -1.06234506e-01
    -4.58832175e-01 -5.72381258e-01]
   [-4.11456451e-02 -9.40154850e-01 -2.28354856e-01 ... -5.63349664e-01
    -8.59609663e-01 -1.20323110e+00]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-True-32-8-27-5-4] q.shape1: (4, 5, 27)
q.shape2: (20, 27)
q.shape3: (20, 27)
q.shape4: (4, 5, 27)
q_liner: [[[-0.45098242 -1.8597655  -0.18044868 ...  0.44736165 -0.7812911
   -1.3717854 ]
  [-1.5089675  -1.1255506   0.2868886  ... -0.59291077 -4.2512317
    1.4017425 ]
  [-0.5946903   1.0263848  -0.581638   ... -2.404116    1.5132208
   -2.4856858 ]
  [-0.31688586  0.5528781  -0.47048947 ... -3.4016237   0.32389942
    0.792212  ]
  [ 0.5705429  -1.4638315  -1.4060916  ...  0.13239647 -0.5641086
   -0.13941243]]

 [[-0.48622677  0.58664197 -0.8507686  ... -1.5951675   0.925034
   -0.5789255 ]
  [ 0.01250784  0.25906408 -1.4820709  ...  0.27701774  0.5088146
   -1.5133849 ]
  [ 1.8713679  -1.6441332  -0.23689705 ...  1.4759529   0.59806687
    1.3676002 ]
  [-1.7826599  -0.49967122 -0.13877729 ... -2.3092782  -0.94425666
   -0.67025876]
  [-1.9854672  -0.1258095  -1.3325741  ... -1.2256528   0.3417048
   -1.306887  ]]

 [[ 0.08923486  0.40770042 -1.179379   ... -2.331579    1.0649294
   -1.4443758 ]
  [-0.9717777  -1.0941966   0.10684844 ... -1.3449765   1.5412539
    1.2202598 ]
  [-1.9089527  -0.49968353 -0.7305629  ... -0.31890056  0.05979536
   -0.012014  ]
  [ 0.8310763  -0.54699767 -2.0045776  ...  1.1674603  -0.8113642
    2.5285468 ]
  [-0.6054805   0.17777057 -0.3048614  ... -3.8101263   0.3146161
    0.12864286]]

 [[-1.0738884   0.71441424  1.0330291  ...  2.1741905  -0.05606912
   -2.2165117 ]
  [ 2.8600929   2.6552117   1.1548573  ...  0.5743336  -0.509936
   -1.0215002 ]
  [-0.7602025  -2.2237754  -0.00880858 ... -1.8565426   0.769028
    1.1017362 ]
  [ 0.56063324  2.2217884   1.0828177  ...  1.7795794  -0.57600886
    1.1000314 ]
  [-0.13495904 -2.4847577  -0.8736484  ... -0.4826979   0.6778818
    1.9465017 ]]]
q.shape5: (4, 5, 256)
q.shape6: (4, 8, 5, 32)
attn_res: [[[[-2.80319524e+00 -4.44879346e-02  2.17424989e-01 ... -4.92406696e-01
    -7.14090049e-01 -1.29643941e+00]
   [-1.38720080e-01 -4.84938383e-01 -2.31890351e-01 ...  9.90081847e-01
    -1.49395692e+00 -1.34055483e+00]
   [-3.27846080e-01 -1.12097430e+00  9.44364071e-03 ...  5.44462621e-01
    -4.21593308e-01 -1.26262593e+00]
   [-3.22776109e-01 -6.83280945e-01 -6.80930018e-01 ... -4.47308719e-02
    -7.18713403e-02 -2.18238324e-01]
   [ 6.53426409e-01 -1.67093396e+00  6.73505664e-02 ... -5.32993376e-01
     5.73118508e-01 -2.86715448e-01]]

  [[ 6.39512539e-01  1.15021920e+00  3.25770664e+00 ... -3.44755650e-01
    -7.09135354e-01  2.68249720e-01]
   [-1.36833036e+00  1.10835671e+00  1.46197408e-01 ...  1.36248067e-01
     1.25481951e+00 -9.64864016e-01]
   [-2.05885023e-02  1.26983464e+00  1.80415392e+00 ... -2.28157923e-01
     1.47897765e-01  2.14451514e-02]
   [ 8.83977637e-02  9.95336056e-01  7.34887242e-01 ...  1.67515725e-01
    -3.31289768e-01  1.12156712e-01]
   [-2.17446494e+00  2.18828678e-01 -2.36754990e+00 ... -2.19945759e-01
    -4.03808087e-01 -9.30400312e-01]]

  [[ 8.09758663e-01 -9.71923023e-03  1.28495598e+00 ... -1.52837962e-01
     9.21359539e-01 -6.43020034e-01]
   [ 1.05608785e+00  2.79985934e-01  1.22594011e+00 ...  2.59045124e-01
     6.95364952e-01 -4.36347604e-01]
   [ 6.58181667e-01  1.09377384e-01  1.24770343e-01 ...  1.60662580e+00
     1.05504274e-01 -6.52299345e-01]
   [ 1.32870227e-02 -2.57822692e-01  1.66465974e+00 ...  9.89608884e-01
     8.06797087e-01 -7.06659436e-01]
   [ 3.88046026e-01  2.92600483e-01  3.86031151e-01 ...  1.26619840e+00
     1.69493631e-01 -5.40767193e-01]]

  ...

  [[ 1.28433600e-01  2.25222397e+00  5.97746253e-01 ...  6.70284390e-01
     2.84509754e+00 -3.24684650e-01]
   [-3.19677532e-01  1.96099699e+00  1.48907512e-01 ...  3.50157320e-02
     1.68419468e+00 -7.19701886e-01]
   [-6.11553133e-01  1.21179044e+00  1.14073420e+00 ...  2.23522139e+00
     3.53085011e-01 -2.84450221e+00]
   [-5.84392786e-01  1.25595558e+00  1.10554099e+00 ...  2.14175558e+00
     4.50863242e-01 -2.72458267e+00]
   [-1.31311369e+00 -3.58441949e-01  1.10824716e+00 ... -1.40534306e+00
    -2.32291722e+00 -4.88947928e-02]]

  [[-4.69944119e-01  6.70536995e-01  3.11837107e-01 ... -2.41985726e+00
    -5.08751094e-01 -9.48328316e-01]
   [-4.56336737e-01 -2.22268790e-01  3.27934027e-01 ...  1.09106243e+00
     4.07372504e-01  5.98126650e-01]
   [-5.81900001e-01  6.10064864e-01  3.92829329e-01 ... -2.14065146e+00
    -4.95583981e-01 -7.98365712e-01]
   [-5.07956684e-01 -5.75426459e-01  3.11629176e-01 ...  3.22047591e-01
     1.56774867e+00  5.71561098e-01]
   [ 4.43685055e-01  1.95801958e-01  3.36557090e-01 ...  3.51673007e-01
     1.07864046e+00  7.42618382e-01]]

  [[ 1.13297176e+00  2.13383898e-01  1.35840237e+00 ...  1.38145638e+00
    -1.77384984e+00 -4.56836522e-01]
   [-9.03018713e-01 -1.17695332e+00 -3.26366127e-01 ... -1.56978261e+00
    -9.08884406e-02  3.31863761e-04]
   [ 4.71781433e-01 -4.22495067e-01  1.22188389e+00 ...  4.84764278e-01
    -1.16849840e+00 -3.82768422e-01]
   [-1.50871861e+00 -1.41081405e+00 -8.97162497e-01 ... -2.78980517e+00
     3.13014269e-01  7.07667589e-01]
   [-1.51875153e-01 -9.10536647e-01  8.98156166e-01 ... -3.90620172e-01
    -6.59721553e-01 -2.62063622e-01]]]


 [[[ 1.78416383e+00  2.12847400e+00  8.80897462e-01 ...  5.60044765e-01
    -4.92928088e-01 -7.78833628e-01]
   [-8.28029156e-01  5.75103700e-01 -1.79080629e+00 ... -1.91938972e+00
     2.00046778e+00  1.43776822e+00]
   [-6.42088711e-01 -4.79160547e-01 -5.23513198e-01 ... -1.48341084e+00
     1.60904157e+00  1.00207019e+00]
   [-1.50377119e+00  6.92839622e-01  2.79739022e-01 ... -2.36733294e+00
     1.90836561e+00 -4.33146983e-01]
   [-6.41471267e-01  1.22276855e+00 -3.73080522e-01 ... -1.61741722e+00
     1.81115055e+00  9.81786847e-03]]

  [[-7.39863336e-01 -2.79601336e+00  1.19394875e+00 ...  1.61532140e+00
    -1.33034480e+00 -7.05599606e-01]
   [-3.47097576e-01 -2.05591917e+00  9.55611765e-01 ...  1.70682776e+00
    -1.28007817e+00 -4.36766684e-01]
   [-6.95993602e-02  1.71467364e+00 -2.31308527e-02 ...  1.43407750e+00
    -4.37878847e-01  1.15157747e+00]
   [-5.18224001e-01  1.38743734e+00  1.15126148e-01 ...  1.28118241e+00
    -3.67816776e-01  1.08049786e+00]
   [-5.28654695e-01  1.49967635e+00 -1.44985661e-01 ...  1.10563707e+00
    -4.28476721e-01  1.09400499e+00]]

  [[-2.24010324e+00 -1.61406434e+00  1.31747353e+00 ... -3.82814550e+00
     7.48241305e-01 -1.20210159e+00]
   [-1.72360027e+00 -1.00190699e+00  1.25571418e+00 ... -2.08741403e+00
     5.34401894e-01 -7.48971283e-01]
   [-1.22111666e+00  1.06140804e+00 -9.76471901e-01 ...  2.74213791e+00
     1.55224097e+00 -1.80152667e+00]
   [-2.10940552e+00 -1.42980123e+00  1.13016903e+00 ... -3.53390384e+00
     8.19032669e-01 -1.23637056e+00]
   [-5.55289865e-01  7.36188412e-01 -1.09066534e+00 ... -2.29375750e-01
     1.67534554e+00 -1.63957262e+00]]

  ...

  [[ 5.18869340e-01 -3.53117764e-01  1.29362226e+00 ... -1.06612420e+00
    -2.05602670e+00  6.73957318e-02]
   [ 7.02163160e-01 -3.69021177e-01 -5.68851754e-02 ...  7.04999387e-01
    -1.69983900e+00  9.62643504e-01]
   [ 6.69689775e-01 -3.69806290e-01  1.77653596e-01 ...  4.12957966e-01
    -1.75352561e+00  7.97611713e-01]
   [ 7.16823757e-01 -2.59574085e-01  2.66839951e-01 ...  6.88099861e-01
    -1.16539359e+00 -1.00512244e-01]
   [ 1.74972701e+00  1.02007866e+00 -5.36142588e-01 ... -2.68191457e-01
    -1.19312465e+00 -1.10187018e+00]]

  [[ 2.62004197e-01  5.85391760e-01 -5.93074858e-01 ... -3.27271283e-01
     7.11398184e-01 -3.06471407e-01]
   [-1.34802341e+00 -1.87201738e-01 -9.46986556e-01 ... -1.45116544e+00
     1.34190011e+00 -4.86879647e-01]
   [-2.38827825e+00 -6.45802081e-01 -1.16075134e+00 ... -2.15017724e+00
     1.71881866e+00 -5.82780421e-01]
   [-1.42540073e+00  1.18572807e+00 -8.58679891e-01 ... -5.92930436e-01
    -4.32025135e-01  3.89573038e-01]
   [-1.20292854e+00  3.48198861e-01 -1.74205816e+00 ... -1.10957623e+00
    -8.67623329e-01  1.73768699e-01]]

  [[ 1.93283319e+00 -1.62004387e+00  1.23325944e+00 ...  7.79917419e-01
     5.41524589e-01 -1.51799464e+00]
   [-1.53996289e+00  2.76292682e+00  8.89561117e-01 ...  5.54684877e-01
     1.65696591e-02  2.07576418e+00]
   [ 1.08014739e+00 -1.37752879e+00  1.36015511e+00 ... -4.01346445e-01
    -3.97832990e-02 -8.72898519e-01]
   [-5.96014380e-01  2.87217408e-01  1.10326791e+00 ...  2.06792736e+00
     5.20461261e-01  5.71951330e-01]
   [ 1.53559953e-01 -7.34196007e-01  1.03098571e+00 ...  1.24604261e+00
     6.45786822e-01 -1.56373143e-01]]]


 [[[-3.30765367e-01 -1.26376975e+00  9.23854768e-01 ... -7.74505317e-01
    -8.49337876e-01 -1.19330311e+00]
   [-3.15007359e-01 -1.27742302e+00  8.76121163e-01 ... -7.61466622e-01
    -7.97870398e-01 -1.14459479e+00]
   [ 7.04774380e-01 -1.80310214e+00 -1.69993353e+00 ... -3.49746421e-02
     2.10907245e+00  1.59931087e+00]
   [ 3.51787627e-01 -7.15747237e-01  6.98598921e-01 ... -6.09020233e-01
    -1.13841839e-01 -5.20093501e-01]
   [ 4.03230011e-01 -1.44863486e+00  6.05166674e-01 ... -4.70452726e-01
     1.44024298e-01 -2.44865417e-01]]

  [[-4.85244900e-01  2.67290235e-01 -7.41559863e-02 ... -6.10105634e-01
    -4.07254308e-01  2.06193566e+00]
   [-1.44850731e-01  3.07594985e-01 -2.91992307e-01 ... -6.36664391e-01
    -3.90018076e-01  1.80905771e+00]
   [ 1.57185733e-01 -5.77312768e-01 -4.11863267e-01 ... -1.59419799e+00
    -4.37789142e-01  1.68254912e+00]
   [ 2.39803720e+00  6.11372471e-01 -1.91796732e+00 ... -8.28655660e-01
    -2.57115096e-01 -9.00358707e-02]
   [ 5.78466296e-01  2.83318162e+00  1.51391399e+00 ...  9.15881634e-01
     1.89619613e+00 -2.07890582e+00]]

  [[-7.70459950e-01 -1.43444204e+00 -9.73627567e-01 ...  1.09368896e+00
     8.95273745e-01 -4.97718185e-01]
   [-1.58521876e-01 -2.05444157e-01 -4.25364494e-01 ...  1.62135020e-01
     4.21321392e-02  5.66759706e-01]
   [-1.69951248e+00 -1.87351540e-01 -1.38141000e+00 ...  8.87515247e-01
    -2.38691539e-01  1.38627812e-02]
   [ 1.94211543e-01 -1.91349328e-01  6.30254567e-01 ...  1.84212196e+00
     1.73275560e-01 -8.25852633e-01]
   [ 5.96211553e-01  3.86731416e-01  1.40645719e+00 ...  1.52969158e+00
    -1.29963422e+00  2.39882588e+00]]

  ...

  [[-1.35487449e+00 -2.01735711e+00  1.51025438e+00 ...  3.62886250e-01
     1.20628619e+00  4.52259541e-01]
   [-8.39600682e-01 -7.76210189e-01  7.54370213e-01 ...  8.66532087e-01
     1.75105810e+00  2.43747860e-01]
   [-1.15406883e+00 -1.94632053e+00  1.50986338e+00 ...  5.48121989e-01
     1.14496911e+00  1.35722727e-01]
   [-1.38867950e+00 -7.39982128e-01  1.09632969e+00 ...  3.15247560e+00
    -1.32990921e+00 -1.60145998e-01]
   [-7.18746841e-01 -1.01146007e+00  9.61373270e-01 ...  9.70084667e-01
     1.34036195e+00 -6.56575412e-02]]

  [[ 1.05277991e+00  7.67185465e-02  6.30479336e-01 ... -4.98718202e-01
     9.27938879e-01 -2.14455485e+00]
   [-6.74727678e-01 -1.71707332e-01  6.75957739e-01 ... -6.12218678e-01
    -6.16182089e-01 -1.78729284e+00]
   [ 2.45350623e+00  2.24753571e+00  1.18443644e+00 ...  7.48514175e-01
    -8.27382207e-01 -2.49278164e+00]
   [ 2.42019153e+00  2.22079635e+00  1.17956424e+00 ...  7.34074891e-01
    -8.27089608e-01 -2.48422217e+00]
   [-2.01281309e-02 -2.24964213e+00 -2.41621196e-01 ... -7.50214159e-01
     1.15825593e+00 -1.19672751e+00]]

  [[ 1.86621344e+00 -9.82518792e-01  1.03057158e+00 ...  1.19127288e-01
    -1.74547875e+00 -1.56513011e+00]
   [-2.64868999e+00  1.52624115e-01 -7.58836508e-01 ... -5.10054350e-01
    -1.18890774e+00  9.60266232e-01]
   [-4.43611264e-01 -1.42837358e+00  8.02371442e-01 ... -1.46115971e+00
     8.66713226e-01 -1.62331450e+00]
   [ 8.79608333e-01 -1.03267884e+00  1.66023523e-01 ... -6.14058256e-01
    -1.70011222e+00 -1.12016904e+00]
   [-1.83857000e+00 -5.37121832e-01 -1.53068632e-01 ... -1.01773357e+00
    -2.09945753e-01 -1.26641542e-01]]]


 [[[-1.22885215e+00  3.59101701e+00  1.64254415e+00 ...  2.44549847e+00
    -1.92062986e+00 -1.14543438e+00]
   [-1.04101503e+00  3.39447832e+00 -1.46780324e+00 ...  1.96746445e+00
    -1.67358339e-01  2.11059117e+00]
   [-7.97532380e-01  2.98368931e+00 -1.14643827e-01 ...  1.89754379e+00
    -8.16165090e-01  4.67021227e-01]
   [ 6.70893133e-01  4.48014140e-01  7.88738489e-01 ...  2.07536399e-01
    -7.61160374e-01  3.82295549e-02]
   [ 3.64239186e-01 -2.38895416e-02  2.57039368e-01 ...  6.66535258e-01
    -3.63745302e-01 -4.10947442e-01]]

  [[-1.55587018e+00 -1.25099584e-01 -1.35277283e+00 ... -1.96697247e+00
    -8.69243920e-01  7.39177883e-01]
   [ 1.47149980e+00 -1.10085654e+00 -1.11441636e+00 ... -1.68497801e+00
    -3.11832571e+00  4.46860194e-01]
   [-1.38868606e+00 -9.81453359e-02 -1.28794622e+00 ... -1.86473477e+00
    -7.79211462e-01  6.93104744e-01]
   [ 8.82241428e-02 -7.04102695e-01 -1.17327857e+00 ... -1.55330408e+00
    -1.99664533e+00  2.98708558e-01]
   [-9.35102165e-01 -3.20369542e-01 -1.20892096e+00 ... -7.98875272e-01
    -5.75031161e-01  1.29331261e-01]]

  [[-3.44743758e-01 -1.21160187e-01  4.71292019e-01 ...  1.80866015e+00
     3.61542034e+00  1.35351920e+00]
   [-2.83008665e-01  6.44393623e-01  4.35708970e-01 ... -1.31574392e-01
     2.03128362e+00  1.27244115e+00]
   [-2.54709929e-01  6.60123467e-01  4.57210153e-01 ... -1.50678322e-01
     1.91282010e+00  1.23130167e+00]
   [-2.64060825e-01 -1.97156519e-03  5.68273365e-01 ...  1.60946846e+00
     3.06805682e+00  1.18995261e+00]
   [-7.38390628e-03  7.59679854e-01  1.10409570e+00 ...  2.68496662e-01
     7.26548582e-02  3.32303584e-01]]

  ...

  [[-3.09568381e+00  1.58821201e+00 -4.42662627e-01 ... -2.64995599e+00
     5.72895305e-03 -2.02834463e+00]
   [-1.20852697e+00  1.00290632e+00 -1.95810333e-01 ... -2.35596037e+00
     1.04770279e+00 -1.70814514e+00]
   [-8.98474455e-01 -1.81169435e-01  1.85779452e+00 ... -2.05426741e+00
    -4.79059219e-01  1.07750547e+00]
   [-4.03507948e-01  4.45097774e-01  6.50372028e-01 ...  1.03391755e+00
     1.46240306e+00 -1.83115900e-01]
   [-6.90640092e-01 -5.77002764e-03  1.28608632e+00 ... -7.88958609e-01
     3.67644310e-01  4.86574799e-01]]

  [[ 2.24173403e+00  3.67864817e-01  2.63187587e-01 ...  1.74812007e+00
    -9.44547772e-01  2.91319895e+00]
   [ 2.14511180e+00  4.19998944e-01  2.59818345e-01 ...  1.71990144e+00
    -9.11038816e-01  2.83388257e+00]
   [ 2.09205532e+00 -1.07189786e+00  2.55509108e-01 ...  5.09509444e-01
     3.52840722e-01 -1.50819707e+00]
   [ 2.15958595e+00  3.15484583e-01 -7.43911266e-02 ...  1.41033483e+00
    -9.07428443e-01  2.36819839e+00]
   [ 5.82875848e-01  4.31003600e-01 -1.05339491e+00 ...  2.97629923e-01
    -7.61801302e-01  1.39633799e+00]]

  [[-3.18923831e-01 -7.27193892e-01 -1.54356372e+00 ...  7.26870418e-01
     1.19138587e+00  1.16101265e+00]
   [-2.22394514e+00  5.99487245e-01 -5.77832222e-01 ...  2.16899946e-01
     1.38435078e+00  1.86982083e+00]
   [-6.98676348e-01 -2.82908320e-01 -1.21963215e+00 ... -5.48922241e-01
     3.21567237e-01  7.10158885e-01]
   [-3.83636355e-01 -5.39569497e-01 -1.31857729e+00 ... -1.21924114e+00
    -3.52137536e-01  2.47810706e-01]
   [-1.90700263e-01 -6.49843812e-01 -1.31630707e+00 ... -1.32001901e+00
    -3.52316290e-01  2.72502825e-02]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-True-32-8-27-5-8] q.shape1: (8, 5, 27)
q.shape2: (40, 27)
q.shape3: (40, 27)
q.shape4: (8, 5, 27)
q_liner: [[[ 0.15200195  0.42109513  0.18947552 ... -1.7429332  -0.884225
   -0.31648648]
  [-0.7228274   0.49029985  0.58301187 ...  2.1885214  -0.0600438
    2.0428016 ]
  [-0.5260736   0.6122724   1.230041   ... -2.247764    0.22396035
   -1.7408255 ]
  [ 0.3971978   0.6543124   0.09537844 ...  1.0527573   2.5283172
    1.3539605 ]
  [-2.2944772  -1.2713732  -0.40413117 ... -2.6895072   1.2463971
    1.2484484 ]]

 [[-1.1593062  -0.88011456 -1.8108406  ... -1.7323458   1.1656864
   -0.8288701 ]
  [ 0.9558412  -0.23498295  2.5545676  ... -3.0560331  -2.0548534
   -2.2333834 ]
  [-1.7470472  -2.397768   -2.3310997  ...  0.24311645 -0.14915928
    0.7152957 ]
  [ 0.8987072   1.1873528  -0.1076384  ...  2.544962    0.67048955
    0.5840135 ]
  [ 2.0645623   0.3715976   0.32978135 ...  1.3476607   0.29302907
   -0.27270532]]

 [[-0.00490406 -0.09373393  1.1604989  ... -0.68984926  1.4405506
    0.73424846]
  [-0.04013184 -0.74264437  0.7171273  ...  0.84781003 -0.8189953
    1.0422674 ]
  [ 1.3068575   1.0912939  -0.5706339  ...  0.6620283   0.5126465
    1.2609537 ]
  [-1.4994876   1.0570574  -2.6855764  ...  1.9866219   1.5518488
   -0.75737226]
  [ 1.1151257  -2.2495382   0.6445344  ... -1.7265897  -0.9692527
    1.5563262 ]]

 ...

 [[-1.2600608   0.42844266 -1.0461015  ...  0.44042793  0.8438229
    0.35004798]
  [-0.80994964  0.90170777 -1.5636967  ...  1.9153154   0.15813263
    0.75824195]
  [-0.41504437  0.5501679  -0.46502814 ...  1.3531638   0.20270535
   -1.1872677 ]
  [-2.140977   -1.8058906  -2.5433607  ... -1.3188152  -0.21092741
    3.014104  ]
  [ 0.30165464 -1.7570784  -0.5276766  ... -0.95511556  0.6305223
    2.6884043 ]]

 [[ 0.54159     2.0929532   1.2214144  ...  1.3534613  -2.23457
   -3.0139523 ]
  [-0.41575354  1.8297943   0.4623497  ... -0.0106837   0.28909513
   -1.1019404 ]
  [ 1.7901554  -2.319938    0.07372504 ...  1.7785084  -2.0408728
   -0.50145024]
  [-3.2801118   0.87907857  1.1032302  ...  1.169682    2.623778
   -2.4771414 ]
  [ 2.188267    2.8574073   1.3916485  ... -0.65159106  0.6747604
   -2.50303   ]]

 [[-0.28694752  0.1963344   1.8981187  ...  1.5710845  -1.9368709
    0.45920575]
  [ 1.1749982   0.24199866 -1.4054803  ...  0.47076377  0.1422315
    2.097656  ]
  [ 1.5478255   2.0425947   0.88846236 ... -1.2721353  -1.8794543
   -1.3773707 ]
  [-0.5135738   1.8262048   0.93603    ... -1.289328    1.1409359
   -3.309046  ]
  [-0.5917451   1.1871253   0.05737558 ...  2.3166168   0.72268176
    1.4457974 ]]]
q.shape5: (8, 5, 256)
q.shape6: (8, 8, 5, 32)
attn_res: [[[[-2.56978244e-01  2.42297196e+00 -6.34604275e-01 ... -1.98050916e+00
    -1.27987063e+00 -1.35229886e+00]
   [-5.69313765e-01  1.58913982e+00 -4.18032408e-02 ... -1.03192246e+00
    -3.72941822e-01 -1.95102096e-02]
   [-2.82356530e-01  2.34160423e+00 -6.00440264e-01 ... -1.95056880e+00
    -1.21521223e+00 -1.36832607e+00]
   [-8.82674813e-01  6.47974253e-01  6.06346130e-01 ... -4.50101867e-02
     5.57124734e-01  1.27918196e+00]
   [-1.37542951e+00 -7.53719330e-01  1.54225731e+00 ... -7.70005882e-01
    -2.34606671e+00 -2.07543463e-01]]

  [[-3.39703679e+00  6.50438368e-01 -8.07872713e-01 ...  8.49320650e-01
     4.89596575e-01 -1.73697221e+00]
   [ 6.42460287e-01 -7.21580923e-01  1.08607423e+00 ...  2.37193048e-01
    -1.54782414e+00  2.02061868e+00]
   [-3.24755073e+00  5.53794503e-01 -8.38467419e-01 ...  8.08727801e-01
     4.11459804e-01 -1.50862467e+00]
   [-6.76288784e-01 -2.47522175e-01 -4.75582242e-01 ...  3.68518710e-01
    -4.46726561e-01  1.04018223e+00]
   [-7.95715451e-01 -1.63129854e+00  2.02739072e+00 ...  1.80224866e-01
     7.02831268e-01 -9.24400389e-01]]

  [[ 1.78496814e+00 -2.16982675e+00  4.57702726e-01 ... -2.28703833e+00
     2.22641945e+00  6.80158734e-02]
   [ 1.64571404e+00  3.86126220e-01 -8.37649822e-01 ...  6.96563601e-01
    -1.21402204e+00  4.46721125e+00]
   [ 1.78256738e+00 -2.15939045e+00  4.52475548e-01 ... -2.27519751e+00
     2.21238732e+00  8.53437111e-02]
   [ 7.69540071e-01  1.20811331e+00 -6.96254432e-01 ...  1.18760729e+00
    -8.16897452e-02  7.25535393e-01]
   [ 1.66984689e+00 -1.03722322e+00 -7.64083192e-02 ... -1.00316834e+00
     8.62542868e-01  1.63332307e+00]]

  ...

  [[-5.62886715e-01  5.97115397e-01 -2.70146918e+00 ...  5.65000884e-02
    -2.03188372e+00  7.25510299e-01]
   [-3.71759832e-02  6.02029800e-01 -2.11667180e+00 ... -3.20816524e-02
    -1.73646343e+00  8.97429585e-01]
   [ 2.03622907e-01  7.01676846e-01 -2.56132185e-02 ... -3.50324750e-01
    -1.00812340e+00  1.47415626e+00]
   [-5.52293539e-01  7.91832507e-01  1.86239034e-02 ... -2.79328734e-01
    -1.15130901e+00  1.31666863e+00]
   [ 8.01565051e-01  9.98804629e-01  2.37001687e-01 ...  1.11361787e-01
    -8.06863070e-01  5.79792023e-01]]

  [[ 2.82789350e-01  5.53259015e-01 -1.62999117e+00 ... -1.87181130e-01
    -3.58288670e+00  1.29338598e+00]
   [-5.27653813e-01 -7.25743294e-01 -1.52061164e-01 ...  2.31065825e-02
    -2.73151064e+00  1.80194890e+00]
   [ 2.01521301e+00 -5.46444237e-01  9.11497995e-02 ... -7.74550676e-01
    -4.26716834e-01  1.58811808e+00]
   [-6.83979511e-01 -1.38691211e+00  6.54935539e-01 ...  1.05373013e+00
     5.76327443e-01 -1.81464851e-03]
   [ 8.14970732e-01 -3.77229393e-01 -5.29657483e-01 ... -3.67213726e-01
    -1.24196422e+00  1.22869372e+00]]

  [[ 1.83115840e+00 -3.66189909e+00 -4.56891179e-01 ...  3.22955012e+00
     4.74897981e-01 -3.31948924e+00]
   [ 5.56023955e-01 -2.69885015e+00  3.25058252e-01 ...  1.48468161e+00
     4.98144567e-01 -1.90101910e+00]
   [ 1.08083999e+00 -2.33744788e+00 -1.14427018e+00 ...  2.48100042e+00
    -4.27682996e-02 -2.41088462e+00]
   [ 1.19484925e+00 -1.60896850e+00 -4.87381160e-01 ...  2.00558019e+00
    -8.88102874e-02 -1.47241116e+00]
   [ 1.27142835e+00 -1.92271280e+00 -1.40598786e+00 ...  2.60565639e+00
    -2.39166304e-01 -2.17472005e+00]]]


 [[[ 4.24187064e-01 -8.04261267e-01  1.17144084e+00 ...  1.14419721e-01
    -1.30125928e+00 -1.51003349e+00]
   [ 1.20768532e-01  5.45705140e-01  7.15154588e-01 ...  1.01706076e+00
     5.80856442e-01  1.34334278e+00]
   [ 7.85499364e-02  6.92742288e-01  5.67384839e-01 ...  1.15852225e+00
     8.01981866e-01  1.62118959e+00]
   [ 1.73425511e-01 -2.53317922e-01  9.31063414e-01 ...  2.32290924e-02
    -8.88723969e-01 -9.01097059e-01]
   [-4.95236218e-02  2.45127529e-01  4.92662668e-01 ...  1.01480186e-01
     5.28664589e-01  3.20379198e-01]]

  [[ 2.15448499e-01 -1.74560130e+00  9.87766743e-01 ... -4.07929599e-01
     1.91420996e+00 -1.44195914e+00]
   [ 3.18728507e-01 -1.72002387e+00  8.50680172e-01 ... -7.14345872e-01
     1.92897081e+00 -8.08651805e-01]
   [-1.78319216e-02 -8.71710658e-01 -1.98827386e-02 ... -1.66765261e+00
     1.84509552e+00  7.73680210e-03]
   [ 1.45961851e-01 -9.83477771e-01 -6.46095812e-01 ...  8.26207697e-02
     1.81109643e+00 -3.14908385e-01]
   [ 1.71631664e-01 -9.17153835e-01 -8.71153533e-01 ...  2.06307054e-01
     1.79664314e+00 -1.06346630e-01]]

  [[-6.55044839e-02 -1.45136416e+00  1.02622986e+00 ... -9.73279953e-01
    -1.04390562e+00 -4.62779738e-02]
   [-8.15087914e-01 -2.77673185e-01  2.99122715e+00 ... -1.37440264e+00
    -5.29417157e-01  1.22440100e+00]
   [-8.88406634e-02 -1.40871322e+00  1.09830320e+00 ... -9.85548556e-01
    -1.02534366e+00  2.93090590e-04]
   [-3.08086514e-01 -9.96024728e-01  1.40232694e+00 ... -1.12502944e+00
    -6.15329504e-01  2.93542176e-01]
   [-1.02690518e+00  1.03961992e+00  1.30480170e-01 ... -1.16411531e+00
    -9.90285993e-01  1.26116478e+00]]

  ...

  [[-6.67787492e-01 -7.48469293e-01  1.75346148e+00 ... -1.59070981e+00
    -7.21942127e-01  3.60106856e-01]
   [-5.41643202e-01 -6.97641015e-01  1.69935024e+00 ... -1.73765945e+00
    -5.34308076e-01  2.96188653e-01]
   [-7.20738769e-01 -6.85732782e-01  1.36199582e+00 ... -1.75737977e+00
    -1.44002646e-01  6.39540911e-01]
   [ 5.49170710e-02 -3.54317933e-01  1.17707300e+00 ... -2.50371790e+00
     7.39561021e-01  1.13265738e-01]
   [-4.52753544e-01  1.21304750e-01  5.20596743e-01 ... -1.22551227e+00
     8.29265773e-01  5.64739525e-01]]

  [[ 8.17479268e-02  2.04386401e+00 -1.42903364e+00 ... -1.35942912e+00
     2.94508845e-01  1.55493474e+00]
   [-9.65518832e-01  1.81430900e+00 -3.87145340e-01 ...  3.21312070e-01
     6.09965205e-01 -4.06747937e-01]
   [-6.74268723e-01  1.11177778e+00 -2.65769780e-01 ...  5.25034189e-01
     8.33180666e-01 -7.26755857e-02]
   [-2.15502549e-02 -1.89341635e-01 -4.88718376e-02 ...  7.86029816e-01
     1.24795604e+00  6.80651307e-01]
   [-5.71583331e-01  1.19585347e+00 -3.23907137e-02 ...  5.52797258e-01
     8.13548326e-01 -2.16337770e-01]]

  [[-1.99589872e+00  2.66326857e+00  8.72236967e-01 ...  2.06453558e-02
    -1.53577626e+00  6.32512495e-02]
   [-2.41088080e+00  1.94077063e+00  1.57901120e+00 ... -2.09240818e+00
    -4.10253167e-01  2.56434536e+00]
   [-1.97838461e+00  2.64496136e+00  8.67962718e-01 ...  7.53649557e-03
    -1.52162874e+00  5.90771362e-02]
   [-1.12771070e+00  1.42933190e+00  8.09941411e-01 ... -1.26925099e+00
    -4.53853667e-01  5.17464519e-01]
   [-2.06636816e-01  8.97844791e-01  2.14792371e-01 ... -6.76467359e-01
    -4.05733973e-01 -8.92250419e-01]]]


 [[[-6.66273952e-01  4.61785406e-01 -6.14513457e-01 ... -1.37143135e+00
     9.52131808e-01 -1.34169173e+00]
   [-4.03143972e-01  3.55458081e-01 -4.41120505e-01 ... -1.36103213e+00
     8.50123227e-01 -1.03298080e+00]
   [ 1.07786143e+00  2.44722068e-01  1.23197103e+00 ... -7.98614085e-01
     3.51195127e-01  7.04872012e-01]
   [-6.78871691e-01  5.43601871e-01 -5.12849391e-01 ... -1.29226303e+00
     9.68530715e-01 -1.35647511e+00]
   [ 5.62926829e-01 -1.70756012e-01  3.47928107e-01 ... -3.90981227e-01
    -1.40755683e-01  1.46338463e+00]]

  [[-6.94682658e-01 -3.52912486e-01 -3.84189010e-01 ...  1.99356124e-01
    -4.81281817e-01  1.85464919e+00]
   [ 1.43326759e-01 -1.25256360e-01  2.20411822e-01 ... -1.11000687e-01
    -2.63003945e-01  1.27206039e+00]
   [ 8.77347946e-01 -5.94646037e-01  4.69589233e-03 ... -5.54023832e-02
     1.39257061e+00  1.05374408e+00]
   [ 5.95855176e-01  3.15763593e-01 -8.34880173e-02 ...  5.84285021e-01
     1.35551202e+00  6.98574841e-01]
   [ 1.02108312e+00  1.47516370e-01  5.11201799e-01 ...  4.90530729e-02
     4.65023726e-01  1.02833375e-01]]

  [[ 1.25649559e+00  1.29391122e+00 -2.79297090e+00 ...  1.44442177e+00
     1.01406360e+00 -3.80325079e-01]
   [ 1.36681592e+00  1.32052374e+00 -2.40725708e+00 ...  1.44097412e+00
     8.13360929e-01 -1.85186252e-01]
   [ 1.08427358e+00 -4.94374871e-01 -1.92268860e+00 ... -2.02791631e-01
     1.23341048e+00 -5.35030365e-01]
   [ 1.84450126e+00  1.19181085e+00 -3.61198097e-01 ...  1.23372734e+00
    -1.06430098e-01  7.44557917e-01]
   [-3.43781680e-01 -1.70977318e+00  3.35506797e-02 ...  5.93083143e-01
     5.48238814e-01  9.30738375e-02]]

  ...

  [[ 7.36637592e-01 -1.04915118e+00  7.98356831e-01 ...  1.89770293e+00
    -7.57482231e-01 -3.41061831e-01]
   [ 4.46583688e-01 -1.39696097e+00 -2.06490636e-01 ...  1.20105338e+00
    -4.80651617e-01 -1.00526798e+00]
   [-2.42045820e-02 -1.89089048e+00 -1.75126076e+00 ...  9.88952667e-02
    -4.09308672e-02 -1.99271357e+00]
   [-6.49973512e-01 -1.53972960e+00 -8.61876905e-01 ...  4.06859398e-01
    -2.37354189e-01 -7.04228282e-01]
   [-3.41073215e-01 -7.86957800e-01 -9.48418677e-01 ... -2.02146336e-01
    -2.30861511e-02 -9.12665009e-01]]

  [[ 1.35227926e-02 -2.07307696e+00  1.30978429e+00 ...  1.09331772e-01
    -3.69059515e+00  1.03458047e+00]
   [-1.80522478e+00  4.71573651e-01 -1.76421201e+00 ...  5.50222576e-01
    -1.20739365e+00  1.55124068e+00]
   [-1.55486673e-01 -2.32470214e-01  2.20053494e-01 ...  8.81275907e-02
    -2.05658460e+00  1.22190499e+00]
   [-5.71880341e-01  8.56631875e-01 -1.15484416e+00 ... -1.51747167e-01
    -8.65738273e-01  1.02290595e+00]
   [-1.57274556e+00  6.52692139e-01 -1.47006285e+00 ...  5.34399569e-01
    -1.07262039e+00  1.45283842e+00]]

  [[-8.98597538e-01  1.36141288e+00 -9.64361608e-01 ... -8.33650112e-01
     1.03497648e+00  1.91794440e-01]
   [-2.10425186e+00  1.92637849e+00  2.59698153e+00 ... -2.56887841e+00
    -1.21086568e-01  7.56922483e-01]
   [-2.26824427e+00  1.99169803e+00  3.07671618e+00 ... -2.80730438e+00
    -2.66377389e-01  8.28264773e-01]
   [-1.05246341e+00  1.21413696e+00 -5.99411666e-01 ... -1.09080780e+00
     1.11478519e+00  1.56446949e-01]
   [-2.13495636e+00  1.77886546e+00  2.77246571e+00 ... -2.38135958e+00
    -9.91312414e-02  7.14307189e-01]]]


 ...


 [[[ 5.12231648e-01  2.65683341e+00 -5.28806031e-01 ... -1.00575161e+00
     2.45839715e+00  1.24075902e+00]
   [ 2.44238451e-01  1.45790040e+00 -6.68403327e-01 ... -8.02414536e-01
     6.09421074e-01  1.47841167e+00]
   [ 5.23321211e-01  2.55669403e+00 -5.46488106e-01 ... -9.74699914e-01
     2.35547280e+00  1.22361553e+00]
   [ 1.65032542e+00  1.42235458e-01 -1.11479068e+00 ...  1.04943529e-01
     1.17208374e+00 -1.99630231e-01]
   [ 6.15390420e-01 -1.11208856e-01 -8.94065499e-01 ... -2.39751324e-01
    -6.08770728e-01  8.65371704e-01]]

  [[-2.82856655e+00 -7.50701278e-02 -2.67526531e+00 ... -6.20151639e-01
    -1.42378545e+00  1.04771841e+00]
   [-1.65642893e+00 -2.72704035e-01 -1.57168841e+00 ...  4.75616485e-01
    -1.44416714e+00  5.41228473e-01]
   [-2.54466200e+00 -1.38043046e-01 -2.39426041e+00 ... -3.47914606e-01
    -1.35745955e+00  8.23694229e-01]
   [-1.42357016e+00 -4.53841746e-01 -1.27011490e+00 ...  7.05690324e-01
    -6.54189229e-01 -5.87186038e-01]
   [-2.52016306e+00 -4.24600869e-01 -2.15934134e+00 ... -3.21520716e-01
     2.71529108e-01 -1.31956363e+00]]

  [[-9.31375265e-01  8.73723686e-01  1.46984863e+00 ... -3.73638177e+00
    -5.05779028e-01 -4.60493624e-01]
   [-2.30514288e-01 -1.19337153e+00  1.82728422e+00 ...  4.50006723e-01
     1.74710226e+00  2.16123438e+00]
   [-3.94947380e-02 -4.35772300e-01  1.56109166e+00 ...  2.21783713e-01
     8.74527812e-01  1.61396682e+00]
   [-1.86127692e-01 -8.64506602e-01  1.29789507e+00 ...  8.64399672e-02
     6.65763736e-01  1.31964004e+00]
   [-6.01636469e-01  8.72595161e-02  1.16699994e+00 ... -2.11265135e+00
    -1.64315969e-01 -4.60204668e-02]]

  ...

  [[ 1.72073162e+00  2.15879130e+00 -1.09917581e-01 ... -7.97739625e-01
    -1.63647890e+00  4.42075223e-01]
   [ 1.37895548e+00  2.02536249e+00 -1.66804224e-01 ... -7.92966008e-01
    -1.70231473e+00  4.61616486e-01]
   [ 1.60733652e+00  2.08371568e+00 -6.58251792e-02 ... -8.05445969e-01
    -1.53594899e+00  4.57112223e-01]
   [-1.10802567e+00  1.04020739e+00 -5.82878053e-01 ... -7.52022624e-01
    -2.16633606e+00  6.02570653e-01]
   [-1.53350770e+00  2.92651147e-01 -8.07485223e-01 ... -4.79313672e-01
    -1.70692408e+00  5.31664431e-01]]

  [[-8.78985524e-02  3.48210424e-01  5.40509641e-01 ... -2.68903047e-01
    -2.31514961e-01  6.20793104e-01]
   [-1.09498382e-01  3.65086734e-01  5.46922922e-01 ... -2.67645866e-01
    -3.46019119e-01  6.45765841e-01]
   [ 7.68257529e-02 -2.06543231e+00  9.26934779e-01 ...  9.61180508e-01
    -1.06945217e+00  1.17981493e+00]
   [ 2.50602663e-01 -1.53877068e+00  6.49288654e-01 ...  5.91456532e-01
    -6.86812580e-01  9.55713511e-01]
   [ 1.15491605e+00  1.08092451e+00 -5.89832664e-01 ... -1.12281823e+00
    -2.88653165e-01  2.17605442e-01]]

  [[ 4.38498408e-01 -3.00517678e+00 -6.87294483e-01 ... -2.01898813e+00
    -9.53092039e-01 -8.47300172e-01]
   [-2.42675379e-01 -2.00424767e+00  1.33690536e-02 ... -3.19305360e-01
    -8.35498333e-01  1.91834271e-01]
   [-3.16872627e-01 -1.39736187e+00 -2.02464074e-01 ...  5.74926555e-01
    -7.20665574e-01  5.38156748e-01]
   [ 4.72142220e-01 -2.42987251e+00 -1.13695431e+00 ... -1.17400503e+00
    -6.63838446e-01 -9.34348345e-01]
   [ 4.37384039e-01 -1.91210341e+00 -1.35850167e+00 ... -6.82220757e-02
    -6.54098749e-01 -6.57951832e-01]]]


 [[[ 1.69672623e-01 -2.31720448e+00 -7.93696225e-01 ...  1.26635635e+00
    -5.03826916e-01 -1.42568254e+00]
   [ 8.15054297e-01 -1.87734926e+00 -4.74097073e-01 ...  1.28979772e-01
    -3.95822883e-01 -4.35646176e-02]
   [ 4.87856239e-01 -1.74324226e+00 -7.17331827e-01 ...  7.02809513e-01
     1.26487494e-01 -2.65370667e-01]
   [-1.05019903e+00  2.55128860e+00  5.80314159e-01 ...  3.45429242e-01
     2.79489160e+00 -1.14719324e-01]
   [ 1.50569642e+00 -7.94944048e-01 -8.54807347e-03 ... -3.03171962e-01
     2.22646379e+00 -9.72814679e-01]]

  [[ 1.65069580e-01  1.38705218e+00 -1.46295160e-01 ...  4.66477215e-01
    -2.15122056e+00  1.49720359e+00]
   [ 1.98555648e+00 -1.40498161e+00  7.33058870e-01 ... -4.19928968e-01
    -6.51496172e-01 -3.17221493e-01]
   [ 2.17228985e+00 -1.70569897e+00  8.17957819e-01 ... -5.19385695e-01
    -5.02106965e-01 -5.11894643e-01]
   [ 2.07864928e+00 -1.57375431e+00  7.87511230e-01 ... -4.69874889e-01
    -5.58198750e-01 -4.22114223e-01]
   [-2.37981844e+00 -2.79026985e+00  1.67625165e+00 ...  3.32251340e-01
     1.07713020e+00  2.79359221e-01]]

  [[-2.59726453e+00 -2.58485556e-01 -1.56555399e-01 ... -4.75263715e-01
    -6.29661739e-01  8.69563818e-01]
   [-1.12702644e+00  2.21406603e+00  3.99260581e-01 ...  2.40152812e+00
    -4.01685804e-01  1.68510866e+00]
   [ 5.94160855e-02  2.00791097e+00 -3.14500988e-01 ...  1.26320708e+00
    -6.11948669e-01  1.79106700e+00]
   [-4.18361545e-01  8.30091834e-01 -2.52058864e-01 ... -1.38858318e+00
    -2.00976521e-01  7.22843945e-01]
   [ 1.56379476e-01  1.77501583e+00 -4.95033294e-01 ...  7.74773717e-01
    -5.71065128e-01  1.66983509e+00]]

  ...

  [[-6.50331736e-01 -7.75322676e-01  4.56743866e-01 ... -1.08240318e+00
    -1.53862035e+00  1.94021118e+00]
   [-6.48938119e-01 -7.69892335e-01  4.58413959e-01 ... -1.07365227e+00
    -1.51818967e+00  1.92054462e+00]
   [-3.07005405e-01 -5.17944455e-01  3.67347598e-01 ... -8.09772253e-01
    -1.12238801e+00  1.41921794e+00]
   [-3.42085302e-01 -5.20778537e-01  3.84080648e-01 ... -9.60439861e-01
    -1.31018806e+00  1.64101744e+00]
   [-1.88916221e-01  4.44561601e-01  7.37804711e-01 ...  5.80599368e-01
     2.31314921e+00 -1.82982993e+00]]

  [[ 1.42568064e+00 -3.11741918e-01 -1.17190421e+00 ... -7.38123953e-01
    -1.70774972e+00  2.43887997e+00]
   [-5.70038080e-01 -8.68768021e-02  3.56637836e-02 ...  6.72290802e-01
     4.30469006e-01 -4.27428961e-01]
   [-6.28739417e-01 -8.67452681e-01  5.04984915e-01 ...  6.73294008e-01
    -4.99443620e-01 -1.00218356e-01]
   [ 1.84164956e-01 -2.95484185e-01 -4.39192265e-01 ...  2.54202068e-01
    -5.42224407e-01  7.07970977e-01]
   [ 8.21320415e-01 -2.81146467e-01  2.38485366e-01 ...  6.77863240e-01
    -1.17492354e+00  1.51104128e+00]]

  [[-5.45827746e-01  1.75641835e+00 -5.46063483e-01 ...  4.79147464e-01
    -8.34876060e-01 -1.89206851e+00]
   [-4.60938305e-01  1.67489100e+00 -2.33770013e-02 ... -6.79758310e-01
    -9.14643347e-01  4.12532091e-01]
   [-5.88242054e-01  5.61904669e-01  1.12813115e+00 ... -1.70422447e+00
     6.40193164e-01  1.74468803e+00]
   [-7.19984412e-01 -5.95665991e-01  1.85500169e+00 ... -1.86343980e+00
     2.32992125e+00  1.50359011e+00]
   [-5.93997240e-01  5.07736325e-01  8.98755372e-01 ... -5.41500509e-01
     9.47924495e-01 -9.02354717e-04]]]


 [[[ 1.01886499e+00  7.07246482e-01 -1.26817119e+00 ...  7.20233202e-01
     1.18867445e+00  6.67371511e-01]
   [-8.19206119e-01  1.50146008e-01 -1.27692908e-01 ... -1.41927481e+00
     4.66120392e-01 -1.01142526e+00]
   [ 4.72669840e-01  5.14695048e-01 -9.14863229e-01 ...  8.50189105e-02
     9.12013352e-01  5.38987964e-02]
   [ 1.01236069e+00  6.97094798e-01 -1.26003397e+00 ...  7.13353157e-01
     1.16642404e+00  6.26711667e-01]
   [ 4.87387240e-01  7.05754817e-01 -1.48120320e+00 ...  9.94350314e-01
    -4.12753433e-01  4.41542715e-01]]

  [[-7.92184234e-01  1.35121393e+00  1.46130168e+00 ... -8.33490551e-01
     2.65534306e+00 -1.70190227e+00]
   [-7.86147952e-01  1.16950047e+00  1.12007689e+00 ... -8.03813934e-01
     2.42030382e+00 -1.24762034e+00]
   [-7.88917899e-01  1.19885015e+00  1.16348898e+00 ... -8.08832884e-01
     2.45282054e+00 -1.31642544e+00]
   [-1.61623967e+00  2.29582787e+00 -1.96513307e+00 ... -1.09129059e+00
     1.45271218e+00 -2.03446126e+00]
   [ 2.23373055e-01 -2.89779454e-01 -5.46640933e-01 ... -8.58616173e-01
    -1.02189630e-01  1.78972125e-01]]

  [[ 2.71228981e+00 -3.01190972e-01  7.29119420e-01 ...  1.07058144e+00
    -1.95445597e-01 -1.23041070e+00]
   [ 1.56437492e+00 -5.89776114e-02  1.07354224e+00 ...  1.62227616e-01
    -7.65786290e-01 -1.34240985e+00]
   [ 1.71143675e+00  2.92736501e-01  1.35132480e+00 ...  6.41611636e-01
     1.46455139e-01 -7.12903976e-01]
   [ 6.59321785e-01  7.44007975e-02  9.48170960e-01 ... -1.10262826e-01
    -9.40885663e-01 -1.14260292e+00]
   [-5.83314419e-01  1.44906902e+00  2.37507653e+00 ... -2.64465541e-01
     7.69216537e-01  3.38556200e-01]]

  ...

  [[ 4.83010918e-01 -1.01937389e+00 -1.05301929e+00 ... -9.99013066e-01
     1.36652434e+00 -2.75660872e+00]
   [ 3.71008515e-01 -8.59475255e-01 -4.94175136e-01 ... -3.47474515e-01
     1.09721684e+00 -2.03869677e+00]
   [ 4.80521694e-02 -3.18988383e-01  9.15928006e-01 ...  1.26322913e+00
     5.10026336e-01 -1.96659952e-01]
   [-6.41534850e-02 -2.16484189e-01  5.01301050e-01 ...  5.01294911e-01
     1.48916864e+00 -7.30761170e-01]
   [ 9.83673632e-01  1.14893031e+00  5.91727078e-01 ...  2.05047560e+00
     1.37970769e+00 -7.76439905e-01]]

  [[-1.27995551e+00 -1.16412377e+00 -7.80307710e-01 ...  2.46035886e+00
    -1.27029550e+00  1.47953868e+00]
   [-1.27247882e+00 -1.16242075e+00 -7.77234674e-01 ...  2.45365477e+00
    -1.25854409e+00  1.47620559e+00]
   [-8.80864382e-01 -8.24089408e-01 -7.19001770e-01 ...  2.20989966e+00
    -6.59801960e-01  1.11479878e+00]
   [-4.38569188e-01  1.02015108e-01  2.71143675e-01 ...  7.49839485e-01
     1.28237069e+00 -1.28990448e+00]
   [ 8.22290421e-01  2.18061551e-01 -2.84042001e-01 ...  2.35507876e-01
     1.68761647e+00 -1.25965524e+00]]

  [[-8.31601799e-01  1.53527781e-01  1.17939860e-01 ... -5.40696234e-02
     1.26932406e+00  1.20196812e-01]
   [ 1.18725502e+00 -8.48548263e-02 -1.41688928e-01 ...  1.31661490e-01
    -9.92572904e-01 -2.30625439e+00]
   [ 1.14933681e+00 -1.32101703e+00 -7.99543738e-01 ...  5.82918465e-01
    -3.91084015e-01 -2.11976075e+00]
   [-7.15477288e-01 -5.20370621e-03  3.13556157e-02 ...  2.46614218e-04
     1.19653630e+00  1.23501671e-02]
   [-1.08015388e-01  1.45491317e-01  6.24188662e-01 ... -8.18454564e-01
    -2.65983343e-01  6.21557117e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-True-32-8-27-11-4] q.shape1: (4, 11, 27)
q.shape2: (44, 27)
q.shape3: (44, 27)
q.shape4: (4, 11, 27)
q_liner: [[[-0.08246318  1.297637   -4.3869157  ...  1.6648993   1.0225514
   -0.23413606]
  [-2.1036825   0.34269288 -1.3593392  ...  0.28710133 -2.3495028
   -0.5770221 ]
  [ 0.55015564  1.3115653  -2.7073863  ... -1.2594198   0.450877
   -0.5750791 ]
  ...
  [ 1.9723426   1.9014058  -0.07350472 ... -0.62339854 -1.8269873
   -3.1420405 ]
  [ 0.5897575   0.5651129  -1.4288164  ...  1.6924045  -1.9481409
    1.4147217 ]
  [ 1.4633553  -0.39679056 -0.7927203  ...  0.4363156  -1.650817
    0.20362736]]

 [[-0.9566642   0.6318296  -0.99751896 ... -1.8659797  -0.01259731
    1.0842644 ]
  [-0.15104908  1.3874646   0.19238688 ... -2.0061364  -0.9589741
    0.54090524]
  [-0.31797707 -0.84257644  3.2394025  ...  0.8453818  -0.5109138
   -0.27457815]
  ...
  [ 0.33640504  1.8460547   2.517686   ...  1.085388    2.9914563
    2.6077745 ]
  [ 1.546665    0.5879998   0.41907552 ...  0.75106627  1.0203562
   -0.15183803]
  [-1.0632492   2.5393524   0.9687923  ... -1.3010052  -0.02241022
    1.0278877 ]]

 [[ 0.24715352  1.9982486  -1.0008467  ... -0.99167144  2.288722
   -0.38216916]
  [-1.7900983   1.6657426   0.72222143 ...  1.0981413  -0.52470183
   -1.220509  ]
  [-1.0200733  -0.02188973  0.9696115  ... -3.8275013   1.2366807
   -2.000785  ]
  ...
  [-1.0458595  -1.4305166  -1.8524687  ...  1.3384255  -2.3837926
   -1.3595229 ]
  [ 0.65088063 -0.07472718  0.7910718  ...  1.1668599   0.17494643
   -2.2131062 ]
  [-0.5484388  -0.3512259  -0.9518742  ... -0.37090048 -2.5363982
   -0.35450423]]

 [[-1.6597594  -2.0460486   1.7956158  ...  0.7144732  -2.8808208
   -2.3229933 ]
  [-0.67780596 -1.0200878   2.5991154  ... -0.39864108 -0.15486184
   -1.768438  ]
  [-0.9458305   1.8510628  -0.13740489 ... -1.8609341   1.1644534
    0.04018895]
  ...
  [ 0.38199356 -1.6202837  -1.9532994  ...  2.8872821  -0.4262538
   -0.07649663]
  [-1.2970152  -0.8319859  -1.2084574  ... -0.85649323  1.5001354
    1.9378235 ]
  [ 0.15252627  1.7864983  -2.6395547  ...  0.10763691  0.13296238
   -1.6784537 ]]]
q.shape5: (4, 11, 256)
q.shape6: (4, 8, 11, 32)
attn_res: [[[[-7.8279769e-01 -7.0509040e-01  1.1639467e+00 ...  1.4346666e+00
    -7.2795558e-01  4.0352285e-01]
   [-2.6509759e-01  5.3869545e-01  6.2195349e-01 ...  2.1716375e+00
    -2.6636298e+00  8.7987208e-01]
   [-2.7988240e-01  2.0581889e+00  1.1095345e+00 ...  2.4274516e+00
    -1.5195024e+00  1.6211601e+00]
   ...
   [ 4.4449124e-01 -3.5191447e-01  1.5992050e+00 ...  7.7700949e-01
    -1.1576139e+00 -4.0668553e-01]
   [-5.9056348e-01 -7.1728146e-01  1.0215667e+00 ...  1.0162539e+00
    -3.5279977e-01 -1.0123840e-01]
   [-6.4480054e-01 -5.4783970e-01  4.7324234e-01 ...  1.4918238e-01
    -2.8488547e-01 -5.8908594e-01]]

  [[-3.8469052e-01  5.0986749e-01  1.7059699e+00 ... -4.4636390e-01
     1.4760205e+00 -2.1104209e+00]
   [-2.0056069e-01  3.7634525e-01  1.2671596e+00 ... -6.2287700e-01
     1.0851474e+00 -1.7659298e+00]
   [ 2.2160053e+00 -8.2330391e-02 -1.4444356e+00 ... -1.4141990e+00
     1.0332428e+00 -1.4785302e+00]
   ...
   [-4.3202111e-01 -1.0740076e+00 -7.2556263e-01 ...  6.3864791e-01
    -3.2504812e-01  8.4080152e-02]
   [-4.7117040e-01 -9.1154420e-01 -4.8818269e-01 ...  6.3745493e-01
    -1.7087694e-01 -1.4303142e-01]
   [ 1.0938314e+00 -4.4590294e-01 -2.5886157e-01 ... -1.4026154e+00
    -1.6041747e-01  5.1888186e-01]]

  [[-6.6847509e-01  5.8819115e-01  4.0924990e-01 ...  1.4457198e+00
     1.4905620e+00  7.7613354e-01]
   [-8.1630552e-01  4.6018618e-01  3.3149612e-01 ...  1.4840350e+00
     1.7567704e+00  6.1467397e-01]
   [-5.7528555e-01 -2.6989706e+00 -9.8983520e-01 ...  1.1035367e+00
     2.0380909e+00 -6.8396665e-02]
   ...
   [-7.4670577e-01 -8.8008362e-01 -4.9623072e-01 ... -7.0141727e-01
     5.2066773e-01  7.6272225e-01]
   [-5.0536209e-01  5.7095593e-01 -1.5073059e-01 ...  5.1828772e-01
     6.4452857e-01  1.1876612e+00]
   [-3.4608316e-02  1.1083595e+00  4.0576822e-01 ...  1.1763496e+00
     3.3256733e-01  1.8268332e+00]]

  ...

  [[-1.3365139e+00 -1.3242815e+00  1.8828678e-01 ...  6.3189185e-01
    -6.3682961e-01 -2.8215542e+00]
   [-4.9300134e-01  1.0375623e+00 -1.5934501e+00 ... -1.0497986e+00
     3.9720207e-01 -5.5339819e-01]
   [-1.3332763e+00 -1.3163449e+00  1.8215118e-01 ...  6.2596363e-01
    -6.3313979e-01 -2.8135149e+00]
   ...
   [-1.8717691e-01  1.4525623e+00 -7.5977433e-01 ... -5.3843379e-01
     1.7834219e-01  1.2353193e+00]
   [-1.3639934e-01  2.0270326e+00 -5.6634659e-01 ... -4.4838119e-02
    -3.3057520e-01  1.9004223e+00]
   [-4.5799404e-01  1.2444786e+00 -2.3909968e-01 ... -3.8072996e-02
     3.8105246e-02  1.1791921e+00]]

  [[ 9.5752783e-02  1.0541996e+00 -4.1417587e-01 ...  9.1474485e-01
     1.1961446e+00  1.4698997e+00]
   [ 5.5043501e-01 -1.1075741e+00 -2.8086030e-01 ...  6.6041088e-01
    -1.0127577e+00  1.5126914e+00]
   [ 8.7609243e-01 -2.6068213e+00 -4.0503436e-01 ... -7.4653693e-02
    -1.6191890e+00 -8.3858728e-01]
   ...
   [-8.8915265e-01  1.4069018e-01  2.1869737e-01 ...  1.1820507e+00
     2.5693223e-01  6.9677901e-01]
   [-9.3114346e-01  1.4570567e-01 -4.7137621e-01 ...  1.5657127e+00
    -4.4004846e-02  2.1672747e+00]
   [-6.6193938e-02  5.8088261e-01 -5.5309981e-01 ... -5.8787402e-02
     4.0011129e-01  7.3493391e-01]]

  [[-5.4310501e-01 -1.9710052e-01 -9.7780518e-02 ...  2.1266186e+00
    -1.3628869e-01 -8.6513966e-01]
   [ 1.4677399e-01  1.8708569e-01 -4.2907111e-02 ...  1.8434227e+00
    -1.9556051e-01 -8.3491784e-01]
   [ 4.0539226e-01 -6.0423076e-01  8.0021888e-02 ...  1.8397444e+00
     7.0079517e-01 -2.0580356e+00]
   ...
   [ 4.7338307e-01  3.8258559e-01  2.4955061e-01 ...  5.5066341e-01
    -1.9846991e-02  1.1872637e-01]
   [-4.9561712e-01 -2.7228969e-01 -5.5614007e-01 ...  1.4597849e+00
     5.5466616e-01 -6.5874040e-01]
   [ 4.8850703e-01  5.8133936e-01 -2.6015082e-01 ...  1.2352877e+00
    -1.6298541e-01 -2.9084769e-01]]]


 [[[ 1.0277274e+00  1.3501179e+00 -1.7557404e+00 ...  1.4125605e+00
    -2.4516501e+00  2.1438267e+00]
   [ 1.3186480e+00  2.3107255e+00  6.1740184e-01 ... -3.8068363e-01
     1.2094141e+00  5.4158783e-01]
   [ 7.5349486e-01  1.1827129e+00 -1.5762832e+00 ...  1.1740490e+00
    -1.8264747e+00  1.6841091e+00]
   ...
   [ 2.5720376e-01  6.3153416e-01  6.5222108e-01 ...  4.2159355e-01
    -7.2601646e-01 -3.0784521e-01]
   [ 6.2985098e-01  1.1478155e+00 -1.0137304e+00 ...  1.2482047e+00
    -1.1789321e+00  1.0013914e+00]
   [ 5.8371437e-01  6.5427428e-01 -1.6578460e-01 ...  2.5640926e-01
     3.5888138e-01  3.5298955e-01]]

  [[ 2.4685057e-01 -2.2203481e+00 -9.0371448e-01 ...  6.9052482e-01
    -2.2482858e+00  1.6216891e+00]
   [ 4.0190986e-01  2.1025580e-01  1.8241937e+00 ... -3.0497000e-01
     1.5855798e+00  1.0036515e-01]
   [-1.3202611e+00 -2.0545976e-01 -1.8694085e+00 ...  2.3782146e+00
    -5.9179622e-01 -3.4564871e-01]
   ...
   [-6.2916946e-01  1.6553737e-01 -1.4122905e+00 ...  1.2387089e+00
    -8.5414666e-01  1.6111737e-01]
   [-1.1763873e-01 -7.0883107e-01 -6.4900780e-01 ... -1.5367888e-01
    -1.3353026e+00  2.0056767e+00]
   [ 4.2477208e-01  3.6949524e-01 -6.5087646e-01 ... -3.9157099e-01
    -3.4666896e-02  1.0099298e-01]]

  [[ 6.1834979e-01 -7.2176504e-01  7.8877878e-01 ...  2.4661965e+00
     1.3447888e+00 -3.3125770e+00]
   [-1.4486078e+00 -1.4690984e+00  4.0071854e-01 ... -1.1568773e+00
     1.5619948e+00  1.3888749e+00]
   [-1.2657610e-01 -9.0293670e-01  6.1472869e-01 ...  9.4826478e-01
     1.0880630e+00 -1.1374592e+00]
   ...
   [ 1.8328814e-01 -1.7242278e+00 -2.8483602e-01 ...  7.5935084e-01
    -6.2490940e-01 -2.8287423e-01]
   [-1.1435757e+00 -1.3401228e+00  4.3885639e-01 ... -6.5964246e-01
     1.4527816e+00  7.0849001e-01]
   [ 4.6827525e-01 -7.7529681e-01  2.0596462e-01 ...  8.4278077e-02
     3.1800935e-01 -1.3316134e+00]]

  ...

  [[ 1.7960651e+00 -2.3009541e+00 -8.3575383e-02 ... -1.6242814e+00
     1.1237364e+00 -2.2718768e+00]
   [ 1.7150283e+00 -2.2867920e+00  3.6271647e-02 ... -1.6062832e+00
     1.1300540e+00 -2.1588600e+00]
   [ 1.2672985e+00  1.9906985e+00 -6.2704754e-01 ... -9.8593122e-01
     1.8062642e+00  9.3466491e-02]
   ...
   [ 1.7365174e+00  8.8614398e-01 -1.0036873e+00 ...  1.6737933e-01
    -5.8275080e-01  1.9327734e-02]
   [-2.8004760e-01  7.2966480e-01  8.4544921e-01 ... -3.7514299e-01
     7.4131215e-01  1.9928764e+00]
   [ 1.0498545e+00  4.6507061e-01 -2.4864280e-01 ... -4.4428372e-01
    -5.7645161e-03  1.7377438e-02]]

  [[ 3.0880329e-01 -1.0779364e+00 -8.0125350e-01 ... -1.1933378e+00
    -2.4019871e+00  5.4661584e-01]
   [ 1.3317529e+00  4.8127347e-01  8.4964144e-01 ...  1.9077224e+00
    -5.4533690e-01  4.0476581e-01]
   [ 3.8170934e-01 -6.7882085e-01 -2.9188997e-01 ... -5.2490580e-01
    -1.9616147e+00  3.6584279e-01]
   ...
   [ 6.4179981e-01  3.0621785e-01  8.1464785e-01 ...  1.6707162e+00
    -4.1645727e-01  6.4864868e-01]
   [ 1.5287644e-01 -7.4754262e-01 -2.9261383e-01 ... -4.9012247e-01
    -1.4733126e+00  7.4329861e-02]
   [ 7.4963450e-01 -6.7345566e-01  1.2829746e-01 ... -7.2009993e-01
    -6.4582711e-01 -4.5273250e-01]]

  [[ 5.1302344e-01 -4.1249964e-01 -1.2395515e+00 ... -7.1222253e-02
     1.4003739e+00 -1.1826851e+00]
   [ 1.4116815e+00 -9.8910689e-02  1.2055942e+00 ...  3.7855381e-01
     1.8641654e+00 -4.0219963e-01]
   [ 1.3196415e+00 -1.1957872e-01  1.2899899e+00 ...  5.0037247e-01
     1.7692761e+00 -4.3774039e-01]
   ...
   [ 1.1125244e+00  4.6603575e-02  1.0422139e+00 ...  3.7142098e-01
     1.1623578e+00  3.8862824e-02]
   [ 6.6580212e-01 -3.2102600e-01 -4.4893882e-01 ... -4.7856274e-01
     1.3628872e-01 -4.5853090e-01]
   [-7.9279169e-02 -1.0036728e+00 -4.5050550e-01 ...  1.7554599e-01
     2.1301320e-01  9.1510177e-01]]]


 [[[ 6.7925692e-01 -4.1179633e-01  1.4184490e-01 ...  7.2772568e-01
     2.2168966e-01 -2.4334526e-01]
   [ 6.9876301e-01  1.0467386e+00 -1.8313544e+00 ...  6.2771720e-01
     6.0662138e-01  1.5293994e+00]
   [ 1.1573346e+00  5.4118359e-01 -4.9125046e-02 ... -5.8391166e-01
     5.2649802e-01  4.5921558e-01]
   ...
   [ 4.1412577e-01 -6.5627956e-01 -4.4671643e-01 ...  4.0274683e-01
     2.6884645e-01 -2.9136380e-02]
   [ 1.2785211e-01  3.0875623e-01 -8.4426230e-01 ...  7.6596648e-01
     4.7152901e-01  9.9062032e-01]
   [-8.8426545e-02  4.5162669e-01  5.5699146e-01 ...  1.9794118e-01
     5.2220047e-01  1.9289207e-01]]

  [[-9.8530293e-01 -1.9066544e+00  6.4393723e-01 ... -1.5093933e-03
    -1.4284737e+00 -1.4241964e+00]
   [-1.4019568e+00 -1.3018508e+00  3.8928217e-01 ...  6.1792499e-01
    -1.7372630e+00 -5.9209907e-01]
   [-1.8403337e+00 -6.4190364e-01  1.0362249e-01 ...  1.2628934e+00
    -2.0540705e+00  3.0308586e-01]
   ...
   [-2.8773218e-01  5.6132251e-01  9.9037662e-02 ...  4.6853471e-01
     8.8541692e-01 -1.0089549e+00]
   [-3.9441666e-01 -3.2997307e-01  5.1496071e-01 ...  2.8099233e-01
    -6.8189934e-02 -8.4284776e-01]
   [-1.9657685e-01 -7.1830499e-01  1.8655986e-01 ... -3.2505435e-01
    -7.7882439e-01  5.7977337e-01]]

  [[-1.1799642e+00 -3.4627664e-01  2.5838131e-01 ... -1.1421815e+00
     1.5421271e+00  3.6442703e-01]
   [-1.0703713e+00 -2.6285243e-01  4.3088770e-01 ... -1.0619637e+00
     1.3469459e+00  3.3622259e-01]
   [ 1.1185669e-01 -2.5024977e-01 -4.0597439e-01 ...  2.4102530e+00
    -1.1027972e+00 -4.3642771e-01]
   ...
   [-1.8512101e-01 -5.4995418e-02  7.4203089e-02 ... -1.0170962e-01
     6.4733326e-01 -7.8753722e-01]
   [-1.8556163e+00  1.1433532e+00  1.0073122e+00 ... -1.2180052e+00
     7.1194649e-01  1.1059356e+00]
   [-9.5912886e-01 -1.6364330e-01  1.8180966e-01 ... -6.8262124e-01
     9.3364149e-01  3.8846686e-01]]

  ...

  [[-2.5492647e-01  1.2936120e+00  6.0036981e-01 ... -1.8142904e+00
     4.5076963e-02 -6.6852295e-01]
   [ 3.3494048e+00  1.1756032e+00 -1.1480922e+00 ... -4.2384696e-01
     1.9819332e+00 -2.1145763e+00]
   [-3.3476910e-01  7.0064133e-01 -1.9462317e-01 ... -1.2318472e+00
     8.1666231e-01 -7.1495479e-01]
   ...
   [ 3.5045487e-01  5.5496645e-01 -8.4296513e-01 ...  1.1606443e+00
    -3.5541570e-01  1.0651007e+00]
   [ 1.9032432e+00 -2.9218769e-01 -4.0850177e-01 ... -3.1743327e-01
     5.8883446e-01 -1.0839411e+00]
   [ 2.0909964e-01  9.7163659e-01  2.3030111e-01 ... -8.5801578e-01
     1.6221337e-01 -1.3892941e-01]]

  [[ 2.0241485e+00 -2.1456991e-01 -1.0125104e+00 ...  3.7896487e-01
    -1.9329822e+00  2.5769830e+00]
   [ 5.7534951e-01 -9.0612549e-01 -1.3146353e+00 ... -2.5109451e+00
     4.5799580e-01 -3.7733251e-01]
   [ 1.2963111e+00 -3.1626260e-01 -1.0866363e+00 ... -2.9882008e-01
    -1.2129229e+00  1.4596646e+00]
   ...
   [ 4.7217670e-01 -8.8933015e-01 -1.1220967e+00 ... -2.2863882e+00
     3.2209957e-01 -4.3510833e-01]
   [ 6.9349784e-01 -9.4655025e-01 -2.3933657e-01 ... -4.7395837e-01
     2.3600911e-01 -1.6410667e+00]
   [-7.3858523e-01 -2.0606838e-01 -4.0755981e-01 ...  2.3945850e-01
    -3.1594500e-01 -1.0514282e+00]]

  [[-1.4949552e+00 -1.1390605e+00 -6.0267800e-01 ... -1.4885153e+00
    -5.3625073e-02 -1.7687765e+00]
   [-1.7087141e+00 -3.3348992e-01 -9.9131596e-01 ... -9.1906422e-01
    -1.2042087e-01 -1.5030341e+00]
   [-7.2421980e-01 -1.2156744e+00  2.3633099e-01 ... -1.2900846e+00
     4.4662660e-01 -6.7716509e-02]
   ...
   [-4.2736369e-01 -1.2841954e+00  6.0723770e-01 ... -8.5345012e-01
     8.8746238e-01 -5.4223478e-01]
   [-3.7558869e-01  2.6636433e-02 -1.0932862e-01 ...  2.2869822e-01
     2.5479922e-01 -6.0852718e-01]
   [-6.4282668e-01 -7.0061767e-01  5.2211851e-01 ... -5.5705154e-01
     6.3658857e-01 -3.5311496e-01]]]


 [[[-7.5209975e-01  2.1209881e+00 -2.6868954e+00 ... -1.0019795e+00
     5.2348989e-01  1.1272938e+00]
   [-6.8843257e-01  1.6997131e+00 -2.4453800e+00 ... -1.0243508e+00
     4.8504275e-01  1.1089215e+00]
   [-3.5168189e-01 -6.9079918e-01 -1.0916747e+00 ... -1.1059959e+00
     2.6334694e-01  8.4494615e-01]
   ...
   [-3.6363777e-02  6.4363056e-01 -1.6950660e+00 ...  3.9979404e-01
    -6.8854731e-01  1.6042644e-01]
   [ 1.2626114e+00  8.8374138e-01  6.2851644e-01 ... -1.3197976e-01
    -7.3568249e-01  9.3156022e-01]
   [ 6.7196172e-01  5.8715922e-01  2.8302959e-01 ... -1.1482449e+00
    -4.4075054e-01  1.4036740e+00]]

  [[-4.7869170e-01 -1.5002432e+00  1.4885621e+00 ...  2.0596137e+00
    -5.2312511e-01  5.7906801e-01]
   [ 3.3175528e-02 -1.3777525e+00  1.3785744e-01 ...  1.6913359e+00
     8.0389190e-01  1.5816900e-01]
   [ 6.6651440e-01 -1.0307927e+00 -1.6375245e+00 ...  1.1585717e+00
     2.4890499e+00 -3.2470763e-01]
   ...
   [ 2.2154215e-01  6.6026270e-01  7.5241697e-01 ...  2.2327413e-01
     4.0475838e-02 -4.1740239e-01]
   [-3.5165951e-01  5.6200451e-01  1.7516084e+00 ...  3.5922667e-01
    -7.2166938e-01 -5.6954581e-01]
   [ 1.0138004e+00 -8.3629549e-01 -1.7910250e+00 ...  8.8869947e-01
     2.0803022e+00  7.4635468e-02]]

  [[ 8.8754547e-01 -3.1865396e+00 -9.0363872e-01 ...  1.5783633e+00
     1.3029556e+00  1.4047669e+00]
   [ 1.9869810e+00 -2.1143100e+00 -1.3464200e+00 ...  7.4289697e-01
     6.1764956e-01  1.8557161e-01]
   [ 1.1740639e+00 -7.3422205e-01 -1.1247799e+00 ...  9.1723174e-01
    -8.5486203e-01 -9.7613525e-01]
   ...
   [-3.5781121e-01 -9.3786025e-01  4.6444565e-01 ...  5.1726139e-01
     6.9452989e-01 -1.2947631e-01]
   [ 1.1928308e+00 -8.4389561e-01 -1.1174923e+00 ...  8.7759292e-01
    -8.2308698e-01 -8.7779236e-01]
   [ 7.1517557e-01 -1.2419648e+00 -2.6166603e-01 ...  3.3051521e-01
     1.3902637e-01 -5.0930846e-01]]

  ...

  [[ 9.7617751e-01 -2.8288875e+00  1.9514309e+00 ...  1.0851215e+00
     8.7902534e-01 -1.7192745e+00]
   [-3.1310079e-01 -1.3315784e+00 -1.8247865e+00 ...  1.7092220e+00
    -1.7566333e+00  7.9658282e-01]
   [ 9.0036464e-01 -2.7408416e+00  1.7296085e+00 ...  1.1217344e+00
     7.2412705e-01 -1.5713758e+00]
   ...
   [ 9.7399816e-02 -1.8175266e+00  1.2570972e+00 ...  7.2666174e-01
     5.4983464e-03 -3.6393413e-01]
   [ 1.9531259e-01 -5.1949859e-01  3.6425385e-01 ...  2.7293826e-02
    -4.3448734e-01 -6.8998635e-01]
   [-7.4680644e-01 -4.4698933e-01  5.7605577e-01 ...  2.2436747e-01
     4.0074849e-01  9.5386392e-01]]

  [[-2.6264459e-01  2.1041803e+00 -6.0919029e-01 ...  2.7682686e-01
    -5.4263699e-01  1.2564818e+00]
   [-3.2291076e-01  1.2921286e+00 -7.9976392e-01 ...  1.1637453e-01
    -6.5665990e-01  7.3386848e-01]
   [-1.7682683e-02  2.1441150e-01 -9.4315387e-02 ... -1.6113269e-01
    -8.8029069e-01  6.0049176e-01]
   ...
   [-2.2137600e-01 -1.1763308e+00 -5.0853896e-01 ...  5.4883975e-01
    -6.6770595e-01  2.4318981e-01]
   [-4.9375715e-03  2.1388747e-01 -3.0156881e-01 ...  7.6696086e-01
     1.2343835e-01  1.1337931e+00]
   [-2.2999294e-01 -2.6781666e-01 -5.1930672e-01 ...  1.3164333e+00
     4.0693846e-02  4.6285281e-01]]

  [[ 2.5991395e-01  1.2787844e+00 -3.7464371e-01 ...  2.5189333e+00
     8.8867778e-01 -1.8050916e+00]
   [ 2.2375228e+00 -1.9751929e+00 -1.2960247e+00 ... -2.3756123e-01
    -2.3418649e-01  6.1671638e-01]
   [ 9.4137686e-01 -2.5132820e-01 -5.3511238e-01 ...  1.4645548e+00
     3.6300331e-01 -8.1677890e-01]
   ...
   [ 1.6153093e-01  8.9693588e-01  4.5664892e-01 ...  5.4115993e-01
     8.2131565e-02 -3.0714148e-01]
   [ 1.7810991e+00  1.3244727e-01  1.2947569e+00 ...  2.8184220e-01
     5.0155115e-01  1.4124254e+00]
   [-1.5608913e-01 -9.2611849e-01 -7.7208745e-01 ...  4.4713038e-01
     3.8975552e-01 -1.8032573e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-True-32-8-27-11-8] q.shape1: (8, 11, 27)
q.shape2: (88, 27)
q.shape3: (88, 27)
q.shape4: (8, 11, 27)
q_liner: [[[ 0.7224422  -0.4349445   3.4143314  ...  0.3524749   1.7550441
    1.3171579 ]
  [ 2.726345    1.2628067  -1.7939713  ... -0.06979546  0.00453782
    3.1302361 ]
  [-1.1040715  -0.15600364  1.9368501  ... -0.5825903  -0.65041417
   -2.2147686 ]
  ...
  [ 2.29157     0.908618    1.0856221  ... -1.3256541   0.30595994
   -0.84049827]
  [-0.40498114 -0.5691511   2.6631112  ...  0.8738295   0.4198153
    1.1513562 ]
  [-0.4481117  -0.92076814  3.5576978  ...  2.7185454   3.3272922
   -0.97112256]]

 [[-1.1616747  -1.7085901  -0.06308014 ... -0.84628963  0.9343368
   -0.6217179 ]
  [ 0.4018707   0.30482602  0.46497503 ...  0.11524689  0.10966628
   -0.6314564 ]
  [ 2.1810687  -1.1074287   1.3467315  ...  0.39241254  0.3339569
    0.5910638 ]
  ...
  [ 3.547802    0.51425123 -2.1266663  ... -1.1019756  -0.78907746
    2.1269357 ]
  [-1.6231765  -2.7684586   0.24566987 ... -0.25909057 -0.6573771
   -1.6647071 ]
  [ 2.5132887   0.55106294  0.7015406  ...  1.2227943   0.7392053
    1.8680627 ]]

 [[ 0.27821246 -1.1018684   1.7200263  ... -1.7082299  -0.4673362
   -2.2366893 ]
  [ 2.7587233   1.7226602   0.80260444 ...  1.1995286  -0.92798245
    0.2717521 ]
  [ 0.64558136  0.08447142  0.4400963  ...  1.3089368   1.2809186
   -1.5577403 ]
  ...
  [-1.0232698  -1.5747494   1.018051   ...  0.00518736 -0.4626458
    0.8344153 ]
  [ 1.1266454   0.38148978  2.193111   ... -1.535103    0.7982023
   -0.95043397]
  [-0.9965041  -1.8504593   1.8635492  ...  1.692321    1.8115427
   -0.7349715 ]]

 ...

 [[ 2.074959    2.2624094   0.34631863 ... -3.2463975   1.0677857
    1.5288497 ]
  [ 0.26497793  1.3373191   3.0214698  ...  0.41106525 -0.168928
    0.03355249]
  [ 0.5420742   1.2251356  -3.8265731  ... -0.34920886 -0.03093657
    0.798989  ]
  ...
  [-3.2419846  -1.4931114   0.72515845 ...  1.7054092  -0.04060049
   -2.0626805 ]
  [ 0.9767814   0.28908023 -1.5257838  ... -3.0712612  -0.89618737
   -0.34019688]
  [ 0.62380505  1.7282047  -0.0089727  ...  3.7021785  -0.5753088
    1.6830212 ]]

 [[ 2.0232098   0.64801407  0.06984086 ...  0.7552189   0.41255075
    0.56615067]
  [ 0.18463086  0.6487753  -2.7815037  ...  0.88175464 -0.71326035
   -0.08390006]
  [-1.9218032   0.28904673 -1.1362168  ... -2.5849714  -0.15884835
   -1.8206904 ]
  ...
  [-1.7156733  -0.79765487 -1.7961345  ... -0.48244846  1.5824316
    0.23448431]
  [-0.93504095 -0.5579304  -1.3916398  ... -1.322384   -0.33638978
   -0.6543722 ]
  [-3.1369116  -1.0516435   3.082999   ...  0.6630197   1.6387494
   -2.8189464 ]]

 [[ 0.5203575   2.510916   -2.5926096  ... -0.47947776 -2.6331599
    1.5112784 ]
  [ 0.2482923   0.10941231 -1.2460439  ...  1.8010229  -0.24936317
   -0.89507395]
  [-0.4074848   0.3564243   1.156305   ... -0.9337906  -0.32710424
    0.46405238]
  ...
  [ 0.8763598   0.15448405  0.44426623 ... -1.1368421   0.7098689
   -0.3491226 ]
  [-2.248125    0.22241627 -1.8704771  ... -1.2285389   0.29145718
   -0.22001871]
  [-1.0332358   0.15769057 -1.6133977  ...  0.13136601  1.1417925
   -0.2518325 ]]]
q.shape5: (8, 11, 256)
q.shape6: (8, 8, 11, 32)
attn_res: [[[[ 2.29930592e+00  1.64481744e-01  1.01702285e+00 ... -9.95433927e-02
     2.68009752e-01  1.06779754e+00]
   [ 4.91902053e-01 -2.61321163e+00  1.89640975e+00 ...  3.17844331e-01
     2.79524875e+00  4.26422864e-01]
   [ 7.14560330e-01  8.39176357e-01  1.31249976e+00 ... -1.69021797e+00
     2.27317154e-01  1.39981222e+00]
   ...
   [ 1.67043710e+00  2.84278363e-01  5.87283492e-01 ... -2.33790413e-01
    -1.22020319e-01  7.05130696e-01]
   [ 1.85510528e+00  6.88494682e-01 -3.98589939e-01 ... -3.98177564e-01
    -1.20962620e+00 -9.07486558e-01]
   [ 1.05437362e+00 -2.61561543e-01  1.35842443e-01 ...  1.24704324e-01
    -1.13332309e-01  5.12320518e-01]]

  [[-1.12356985e+00 -9.83506382e-01 -1.12679029e+00 ... -1.76943791e+00
    -6.85944736e-01 -2.68765926e+00]
   [-1.47824109e+00  4.78286386e-01 -2.25603127e+00 ... -3.08165282e-01
    -1.40956104e+00  4.94964242e-01]
   [-3.20842117e-01 -1.88976192e+00  1.82584131e+00 ...  2.88553476e-01
    -8.19338918e-01 -6.91012084e-01]
   ...
   [-3.99710089e-01  6.57906532e-01 -1.08710742e+00 ...  5.38541436e-01
     2.55247414e-01 -9.93492752e-02]
   [-1.60077512e-01 -5.02073646e-01  2.97412187e-01 ...  2.73832262e-01
     6.26981437e-01  1.04502821e+00]
   [-9.12903547e-01 -5.15863299e-01  2.18485624e-01 ...  8.71827960e-01
     2.18937352e-01  1.18633258e+00]]

  [[-1.63404834e+00  3.15329015e-01 -2.88394272e-01 ... -3.26663814e-02
     2.97724366e+00 -2.09884381e+00]
   [-1.47793388e+00  1.97742850e-01 -2.26640061e-01 ... -6.04159832e-02
     1.82008481e+00 -1.40075290e+00]
   [-1.10961521e+00 -6.94733858e-03 -2.71672368e-01 ...  3.97057980e-02
     1.26154870e-01 -4.11196113e-01]
   ...
   [-3.42645496e-01 -1.50033176e+00 -1.71799198e-01 ...  9.86899316e-01
    -9.94651675e-01  9.53116864e-02]
   [ 5.46635389e-02  4.40741152e-01 -8.54663432e-01 ... -4.54585254e-01
     8.48151267e-01 -2.22758889e+00]
   [-6.49106920e-01  6.73619151e-01 -5.90066254e-01 ...  1.95189327e-01
     5.03111839e-01 -7.89755210e-03]]

  ...

  [[-3.60828668e-01 -3.50639254e-01  1.72324526e+00 ... -2.69805241e+00
    -2.46656013e+00  6.11302018e-01]
   [-1.22971013e-01  9.29452717e-01  1.74056049e-02 ...  9.29680467e-01
     3.25684249e-01 -2.15683389e+00]
   [-3.56320858e-01 -3.36868316e-01  1.68258429e+00 ... -2.67667389e+00
    -2.43112803e+00  6.01194203e-01]
   ...
   [-1.36202633e-01  2.49740347e-01  3.31518382e-01 ... -1.21585619e+00
    -1.00346017e+00 -4.68953758e-01]
   [ 1.90684885e-01  5.93421698e-01 -7.35005975e-01 ... -5.48743010e-02
     2.06984431e-01 -1.71389794e+00]
   [-1.35383606e-01 -3.08974952e-01 -1.91549093e-01 ...  4.15296525e-01
     7.18355238e-01 -1.56317389e+00]]

  [[ 1.29735219e+00 -1.50211990e+00 -1.12833714e+00 ... -1.43933451e+00
    -9.96930361e-01  1.51755142e+00]
   [ 1.43456912e+00 -4.53953445e-01 -9.61430073e-01 ... -1.20983124e+00
    -5.97446680e-01  1.10965812e+00]
   [ 7.27005720e-01  6.78218246e-01 -1.27437496e+00 ... -6.54683292e-01
     2.86540389e-01  1.51518822e+00]
   ...
   [ 1.51994944e+00  9.10846740e-02 -9.75857973e-01 ... -4.32719916e-01
     1.91399485e-01  1.44975232e-02]
   [ 1.45326161e+00 -6.27583623e-01  1.40255737e+00 ...  9.28951204e-01
    -1.10752702e+00 -8.48638713e-01]
   [ 1.34272611e+00 -5.13755739e-01  9.21667337e-01 ...  5.77723384e-01
    -8.79723549e-01 -8.99160624e-01]]

  [[-1.50207233e+00  8.29241633e-01  1.07725894e+00 ... -6.26680076e-01
     2.26478791e+00  1.79772913e+00]
   [-1.12366879e+00  7.69516826e-01  8.67097676e-01 ... -7.08199739e-01
     2.32277060e+00  1.63535190e+00]
   [ 7.00242877e-01 -1.06534445e+00 -7.49881387e-01 ...  3.18908751e-01
     1.62710667e+00  7.22615778e-01]
   ...
   [ 1.24474669e+00 -1.06499469e+00 -1.24393463e+00 ...  7.63493627e-02
     1.63258386e+00  4.11473632e-01]
   [-1.11574113e-01 -1.22435188e+00 -2.76929379e-01 ... -7.10260775e-03
     1.56510866e+00  1.55074906e+00]
   [ 3.87127437e-02 -5.42808831e-01 -2.84451246e-01 ...  9.71410871e-01
     4.33796287e-01  7.04505801e-01]]]


 [[[-1.23551917e+00 -1.38201523e+00  1.21296906e+00 ...  2.24386549e+00
     3.86394382e-01 -8.50818306e-02]
   [-1.63295603e+00 -5.32034278e-01  6.53087974e-01 ...  1.57469070e+00
     1.64301947e-01 -2.94290066e-01]
   [-1.47358036e+00 -6.83639884e-01  9.86930609e-01 ...  1.36834288e+00
     4.68302667e-01 -2.44234949e-01]
   ...
   [-3.11853826e-01 -6.30388618e-01  1.00649798e+00 ...  5.57893634e-01
     5.30143939e-02 -4.07563150e-01]
   [-1.47745454e+00  2.89847344e-01  7.79004335e-01 ... -9.90755856e-02
     4.64349806e-01 -5.73481441e-01]
   [-9.06590700e-01 -5.65422118e-01  1.32119787e+00 ...  7.92021751e-02
     9.38407838e-01 -3.16813141e-02]]

  [[-2.05873799e+00 -1.66703284e+00  2.36390162e+00 ... -4.67089117e-01
     1.22965634e+00 -1.25620589e-01]
   [-1.67401004e+00 -1.41971469e+00  1.89681435e+00 ... -4.99572694e-01
     9.90873873e-01 -1.55994684e-01]
   [-1.03641796e+00 -9.52349901e-01  1.17609775e+00 ... -5.09003103e-01
     6.11808598e-01 -1.80421501e-01]
   ...
   [-1.64168417e+00 -1.29767776e+00  1.71408606e+00 ... -4.10249084e-01
     9.05799270e-01 -2.17490450e-01]
   [ 5.61679244e-01  1.34273827e+00  4.62346584e-01 ...  4.71610397e-01
     4.84938800e-01 -1.99564602e-02]
   [-4.83651236e-02  4.36621845e-01  5.47261178e-01 ...  4.69822586e-01
     1.13277301e-01  6.39434159e-03]]

  [[-8.90546620e-01 -2.05230641e+00 -4.19193238e-01 ...  8.14763367e-01
     1.18504703e+00 -2.36157870e+00]
   [ 2.07793331e+00 -1.96626687e+00 -9.82275605e-01 ...  1.15117311e+00
    -1.73160493e+00 -4.45691466e-01]
   [ 2.38938063e-01 -8.42937589e-01 -2.03851193e-01 ...  7.10915744e-01
     2.37828106e-01 -1.38963640e+00]
   ...
   [ 1.40589142e+00  8.65791380e-01  2.26798747e-02 ...  2.26553008e-01
     4.78913635e-01  5.99204823e-02]
   [ 5.58611512e-01 -2.78413892e-02 -7.12576807e-02 ...  1.91652924e-01
     4.07429427e-01 -3.84785026e-01]
   [ 1.13654244e+00 -1.26374853e+00 -5.94699442e-01 ...  1.06376266e+00
    -1.00665057e+00 -4.42790866e-01]]

  ...

  [[-1.74510825e+00  8.61098528e-01 -6.50493622e-01 ... -3.28302789e+00
    -1.08785796e+00  5.20625770e-01]
   [-1.72781074e+00  8.57256293e-01 -6.46260440e-01 ... -3.26838303e+00
    -1.08010292e+00  5.08153617e-01]
   [ 1.01990879e+00  2.47041404e-01  2.62442492e-02 ... -9.41994071e-01
     1.51652589e-01 -1.47283781e+00]
   ...
   [-1.96648538e-02  3.34964037e-01 -8.12128663e-01 ...  1.19863021e+00
     6.67339802e-01 -1.33301985e+00]
   [-2.66520351e-01  1.40880668e+00 -1.68568149e-01 ...  8.41176987e-01
    -3.11271757e-01 -3.39300603e-01]
   [-5.50515115e-01  5.11174560e-01 -2.15692818e-01 ... -7.74040818e-01
    -1.43968865e-01 -2.71022797e-01]]

  [[-1.16930938e+00  1.37919998e+00  1.77833676e+00 ...  5.66664994e-01
    -4.76901494e-02 -5.42733788e-01]
   [-1.51538992e+00  1.00692093e+00  1.47241950e+00 ...  3.19259107e-01
     3.40949714e-01 -3.32550406e-02]
   [-4.44285035e-01  1.78862751e-01  9.01913524e-01 ... -6.25910044e-01
     2.98513293e-01 -1.07214475e+00]
   ...
   [ 3.05181950e-01  1.11336362e+00  6.74190164e-01 ... -4.22054082e-01
     6.46130741e-01 -1.61087024e+00]
   [-2.96581686e-01  3.73865634e-01  7.53485203e-01 ...  3.42425764e-01
     3.73649389e-01 -2.54307449e-01]
   [-4.37480152e-01  8.09769273e-01  1.02907848e+00 ... -4.97010678e-01
     6.60119891e-01 -1.02402699e+00]]

  [[-3.02879691e-01  1.71402335e+00  4.92524534e-01 ...  1.68938851e+00
     1.64163840e+00  3.41118574e-02]
   [-9.18987334e-01  1.24247372e-01  1.08746099e+00 ...  8.17933977e-01
    -5.70389986e-01 -9.67637122e-01]
   [ 1.94573998e+00  6.92887425e-01  1.55967975e+00 ...  7.74396420e-01
    -6.47922233e-02  1.56291389e+00]
   ...
   [ 2.24395603e-01  3.65169317e-01  5.15642405e-01 ...  3.13894808e-01
     1.00055814e+00  7.89382339e-01]
   [ 1.11651272e-01 -9.30709615e-02  7.36164808e-01 ...  1.93504125e-01
     7.52256811e-01  1.00363672e+00]
   [ 7.27238953e-01  7.83828735e-01  6.76016062e-02 ... -6.69153988e-01
     1.38852024e+00  6.04394913e-01]]]


 [[[-2.03731871e+00 -1.19672990e+00 -1.56765890e+00 ...  1.01664054e+00
     4.20120299e-01  1.14538632e-01]
   [-1.80782998e+00 -9.12708521e-01 -1.51787090e+00 ...  1.08807647e+00
     2.91041583e-01 -1.99834853e-02]
   [-6.91125631e-01 -4.84159648e-01 -1.21955276e+00 ...  1.26558650e+00
     1.79635331e-01 -1.12333059e-01]
   ...
   [ 8.50529015e-01 -7.56493807e-01  1.75867692e-01 ...  1.44125462e+00
     7.08182991e-01  3.88709068e-01]
   [-8.45142007e-01 -1.43058097e+00  2.12202787e+00 ...  3.30119878e-01
     1.20682120e+00  6.51192844e-01]
   [-4.29668754e-01 -6.79789722e-01  1.17221427e+00 ...  1.40322417e-01
     2.90795088e-01  6.14536643e-01]]

  [[-1.24512565e+00  9.05421317e-01 -4.97368753e-01 ...  1.54153311e+00
    -9.74362731e-01  3.18297923e-01]
   [-1.16392446e+00  9.22408342e-01 -1.97270334e-01 ...  1.48080182e+00
    -8.00370514e-01  6.75090969e-01]
   [-5.84514260e-01  8.07108998e-01  1.55089617e+00 ...  9.99391735e-01
     1.66239738e-01  2.52892923e+00]
   ...
   [ 6.97689474e-01  2.96246815e+00  7.83647478e-01 ... -1.33827860e-02
     2.20221615e+00  5.23324668e-01]
   [-2.86970228e-01  1.37469125e+00  9.20122683e-01 ...  1.35893255e-01
     7.44928241e-01  7.08365858e-01]
   [-3.33450049e-01  6.59322143e-01  9.79734659e-01 ... -4.53989476e-01
     3.19668353e-01  1.51570886e-01]]

  [[ 8.43233392e-02 -2.90420842e+00  1.53992921e-01 ... -1.08981705e+00
    -1.81922507e+00 -1.00536287e+00]
   [-2.51882493e-01 -1.93921423e+00 -4.44075167e-02 ... -9.76576746e-01
    -8.90176415e-01 -7.61282682e-01]
   [-3.36509675e-01  3.50051075e-01  8.42559218e-01 ... -2.33707219e-01
     1.97884738e+00 -2.93176681e-01]
   ...
   [-1.24541318e+00  6.14743590e-01 -2.40926981e-01 ... -1.47003829e-02
     4.56930339e-01 -5.68261266e-01]
   [ 5.15691638e-01  1.29693770e+00  1.29326284e-02 ... -8.76997054e-01
    -2.43649215e-01 -5.18689513e-01]
   [-1.46691573e+00  2.76466906e-01  7.83053458e-01 ... -4.68465865e-01
     3.53129357e-01  9.56063747e-01]]

  ...

  [[-1.02148223e+00 -1.90400648e+00  1.51862442e+00 ...  1.53731823e-01
     1.97434974e+00  2.32368684e+00]
   [-9.95903671e-01 -1.37928796e+00  7.02485025e-01 ... -2.77225733e-01
     4.82631028e-01  8.53853703e-01]
   [-8.95832062e-01 -1.71480143e+00  1.25288296e+00 ...  9.13495198e-02
     1.72198343e+00  2.02223492e+00]
   ...
   [ 1.07970543e-01 -3.01111341e-01  1.01309285e-01 ... -2.01747760e-01
     4.86485273e-01  2.61973858e-01]
   [-2.44670644e-01  5.96363962e-01 -3.84426773e-01 ... -3.05484354e-01
    -7.79494196e-02  2.95157105e-01]
   [ 1.72556221e-01 -7.90011659e-02 -1.58772618e-01 ... -7.25641310e-01
     9.49458554e-02 -4.51774120e-01]]

  [[ 1.55342683e-01  1.89956093e+00  4.21297789e+00 ...  3.70919019e-01
    -9.25309896e-01 -2.32174373e+00]
   [-7.74865866e-01  3.73879254e-01  2.45730591e+00 ...  1.38833672e-02
     2.06273049e-01 -1.30612636e+00]
   [ 4.49955136e-01  1.23348117e+00  2.58463931e+00 ...  6.07989967e-01
     1.57448560e-01 -1.23563194e+00]
   ...
   [-3.08287703e-02  1.13984197e-01  1.11608875e+00 ... -7.34612644e-01
    -9.23603624e-02 -6.35224462e-01]
   [ 1.31502044e+00  8.35342184e-02  1.06710505e+00 ...  2.41355732e-01
     8.16660404e-01 -5.06259501e-01]
   [ 1.34372270e+00 -5.14276505e-01  1.41382933e+00 ... -4.91896838e-01
    -2.55720377e-01 -9.13248241e-01]]

  [[ 5.73971331e-01  3.18099403e+00 -2.04927564e+00 ... -8.78634691e-01
     5.07037222e-01 -1.16363674e-01]
   [ 3.63775492e-01  2.62554526e+00 -1.39180875e+00 ... -9.18032706e-01
     4.06157643e-01 -1.08253039e-01]
   [-3.09406340e-01  5.38695455e-01  1.38102531e+00 ... -8.85276496e-01
     1.49018943e-01  2.11356252e-01]
   ...
   [-5.28546751e-01  1.54193604e+00  5.17755687e-01 ... -3.75745118e-01
     2.56870925e-01  1.78218752e-01]
   [-1.92495906e+00  2.90219456e-01 -3.01160663e-01 ... -1.65504324e+00
     1.02426484e-01  7.01026440e-01]
   [-1.08978462e+00  1.04029369e+00 -7.97640502e-01 ... -1.41758609e+00
     1.64621606e-01  3.69242907e-01]]]


 ...


 [[[-5.23577094e-01  3.09747368e-01 -2.24636197e+00 ... -2.64340580e-01
     9.33719695e-01 -8.64511728e-01]
   [ 1.14286923e+00 -2.26517558e-01  1.47475576e+00 ... -6.41097367e-01
    -7.79094040e-01 -2.32091412e-01]
   [-3.79387140e-01  2.47085720e-01 -1.96345019e+00 ... -2.94697791e-01
     8.14806223e-01 -7.55289197e-01]
   ...
   [ 1.66655135e+00  6.20024264e-01 -7.97769606e-01 ... -2.54002261e+00
    -1.68665898e+00 -4.46416646e-01]
   [ 1.15498388e+00 -2.24504754e-01 -4.28489894e-01 ... -4.50542241e-01
    -2.99183249e-01  2.21335158e-01]
   [ 3.23576808e-01  6.95001483e-02 -1.09837306e+00 ... -5.93767822e-01
    -3.21236461e-01 -5.73535450e-02]]

  [[-9.77786183e-02  4.45360780e-01 -8.19456577e-01 ...  1.61316633e-01
    -1.40525058e-01 -1.76251853e+00]
   [-2.41912544e-01  1.69864565e-01 -1.90046400e-01 ...  1.75514817e-03
    -5.05536318e-01 -1.73822367e+00]
   [-3.77267003e-02 -5.61514497e-01  3.90807301e-01 ...  5.11251241e-02
    -1.76773655e+00 -1.31159389e+00]
   ...
   [-1.45864218e-01  4.02262270e-01  5.08843899e-01 ...  1.34030902e+00
     1.33261359e+00  1.40674138e+00]
   [ 4.25913304e-01 -1.67713895e-01 -4.22555357e-02 ... -1.49426579e-01
     5.51056936e-02 -1.81804109e+00]
   [ 1.55748911e-02 -1.05891697e-01  3.76196623e-01 ...  9.22345042e-01
     2.87457481e-02 -1.47092175e+00]]

  [[ 7.31119335e-01 -1.74818134e+00  2.28420353e+00 ... -5.03938878e-04
    -5.01344442e-01  1.84551764e+00]
   [ 3.71722579e-01 -2.33448446e-02 -2.33302474e-01 ...  1.02219748e+00
     2.66256928e+00 -2.67500734e+00]
   [ 7.52491951e-01 -8.04628074e-01  1.08491755e+00 ...  8.28198910e-01
     2.32349098e-01  3.19710761e-01]
   ...
   [ 2.36830950e-01 -4.47919309e-01 -1.18082851e-01 ...  4.92184848e-01
     4.49604809e-01 -7.32081234e-01]
   [-1.41169667e+00 -4.28557873e-01 -1.05316019e+00 ... -8.36964250e-01
     1.05959713e+00 -1.69584048e+00]
   [-7.95671105e-01  2.72055827e-02  5.88857055e-01 ... -2.24537775e-01
     4.74835038e-01  3.15239727e-01]]

  ...

  [[-3.00324130e+00  2.27493453e+00 -2.53267407e-01 ...  5.91655612e-01
     6.55345142e-01 -1.88414395e+00]
   [-1.76998639e+00 -6.84234679e-01 -4.57431495e-01 ... -2.89341509e-02
     6.29295528e-01  7.53205538e-01]
   [-3.88447762e-01  1.89115620e+00 -7.18472421e-01 ...  1.10171735e+00
     2.37284184e-01 -1.72132063e+00]
   ...
   [-2.78336614e-01 -7.34336376e-02  4.04408276e-01 ... -6.93466365e-01
    -9.97655511e-01  9.83115613e-01]
   [-4.94676411e-01 -3.67753685e-01  1.08315718e+00 ... -1.10427773e+00
    -1.44578457e+00  1.81373405e+00]
   [-3.28795135e-01 -6.32193625e-01  5.71555495e-01 ... -9.05484080e-01
    -1.80358648e-01  1.28702939e+00]]

  [[ 8.77268732e-01 -4.10598934e-01  7.67015278e-01 ...  8.00498545e-01
    -5.44355154e-01 -2.67568916e-01]
   [ 6.81768119e-01  1.59644079e+00  2.35124663e-01 ... -2.06102228e+00
    -1.57994613e-01  9.61350322e-01]
   [ 3.82003903e-01  3.39776307e-01 -1.07261741e+00 ... -7.16167450e-01
     3.69500399e-01  9.92328584e-01]
   ...
   [-9.72434044e-01 -7.14947879e-01 -4.46261823e-01 ...  4.41125602e-01
    -5.23745894e-01  5.12334704e-01]
   [ 1.52161449e-01 -5.80757797e-01 -4.38756585e-01 ... -1.06609225e-01
     6.05237260e-02 -1.22285688e+00]
   [ 1.18751153e-01 -1.08804822e+00  1.21069416e-01 ... -1.99705467e-01
    -4.81202304e-01 -7.03940213e-01]]

  [[-2.31879997e+00  3.23942035e-01  9.37920809e-01 ... -5.63451171e-01
    -4.64981407e-01  1.48543751e+00]
   [-2.09423900e-02  1.01500034e+00 -2.43932247e-01 ... -7.48187900e-01
     1.15023613e+00  1.12210047e+00]
   [-1.01159787e+00  7.05622494e-01  2.65302628e-01 ... -6.71307623e-01
     4.49873567e-01  1.28155482e+00]
   ...
   [-7.92707145e-01  5.05951703e-01  8.66278112e-02 ... -2.11775556e-01
     2.66125649e-01 -3.62946898e-01]
   [-1.62499702e+00  3.33974600e-01  4.74820793e-01 ... -4.40173388e-01
    -1.08137533e-01  7.47754276e-01]
   [ 5.84260821e-02  3.51829052e-01  9.17509422e-02 ...  4.98433948e-01
     3.81223947e-01  3.94881815e-01]]]


 [[[-5.02216578e-01 -2.33657598e+00 -7.69787133e-01 ...  1.59963918e+00
    -1.52967960e-01  2.36315107e+00]
   [-5.14567256e-01 -2.28237486e+00 -6.97986722e-01 ...  1.51181698e+00
    -1.38898849e-01  2.37501001e+00]
   [-1.10156906e+00 -1.65055919e+00  2.25888872e+00 ...  9.25543010e-01
     8.73935640e-01  1.98507440e+00]
   ...
   [ 6.92387819e-01 -8.38977575e-01  1.60156500e+00 ...  6.20569170e-01
    -4.72387671e-02  8.86278987e-01]
   [ 4.19787943e-01 -2.02289581e+00  8.69318068e-01 ...  1.70581305e+00
     3.01637936e+00  1.05180204e+00]
   [ 1.40804100e+00 -2.32210398e+00  7.60907888e-01 ...  1.47407889e+00
     1.97639084e+00  9.83586073e-01]]

  [[ 1.04314864e+00 -1.56638062e+00  1.10289752e+00 ... -2.18960309e+00
     7.50824153e-01 -1.28821909e+00]
   [ 9.51477349e-01 -7.84026980e-01  2.70042777e+00 ... -4.66197133e-01
     1.24079156e+00 -1.48869768e-01]
   [ 9.07663405e-01 -1.31746566e+00  1.29348361e+00 ... -2.15703154e+00
     7.77407110e-01 -1.18211067e+00]
   ...
   [ 4.57119823e-01 -4.33496386e-01  1.21140778e+00 ... -2.00707054e+00
     4.36301112e-01 -1.45000756e+00]
   [-5.32869637e-01 -4.46309298e-01 -1.85763657e-01 ...  1.33806229e-01
     5.31509697e-01 -8.92537117e-01]
   [ 1.88930258e-01 -2.38757372e-01  5.91547728e-01 ... -1.13304865e+00
     9.56508279e-01 -7.99867511e-01]]

  [[-1.71718574e+00 -6.18346691e-01 -2.36137092e-01 ...  9.47143376e-01
     6.82267070e-01 -1.45662522e+00]
   [-1.83149087e+00  1.67528534e+00 -6.10133052e-01 ...  1.62860334e-01
     1.10560429e+00 -3.32612604e-01]
   [-1.58737612e+00  5.22891819e-01 -7.66673505e-01 ...  4.04881656e-01
     8.72087002e-01 -3.17398596e+00]
   ...
   [-1.56652594e+00 -4.84370887e-01 -1.14526725e+00 ...  3.24671715e-01
     7.41721988e-01 -2.38602805e+00]
   [-9.64861095e-01  4.99786735e-02  4.74504471e-01 ...  3.78816128e-01
     4.07267064e-01 -1.51054025e+00]
   [-8.18779767e-01  9.82970834e-01 -3.34682643e-01 ...  8.74236286e-01
     6.39159828e-02 -1.48706663e+00]]

  ...

  [[ 8.40526298e-02 -3.05065423e-01 -2.40211725e+00 ...  2.51445079e+00
     6.22644126e-01  4.88214254e-01]
   [ 1.15869813e-01 -3.97488594e-01 -2.30415416e+00 ...  2.42161703e+00
     5.95580935e-01  5.33915520e-01]
   [ 8.19317400e-02 -1.19066322e+00 -9.22089100e-01 ...  7.37421989e-01
    -1.40535504e-01  7.16316104e-01]
   ...
   [ 3.37998658e-01 -6.38207048e-02 -5.90681553e-01 ... -2.07061425e-01
    -5.94067454e-01  7.99896479e-01]
   [ 2.25297183e-01  2.33066440e-01 -1.04505908e+00 ...  4.33695078e-01
    -5.97039521e-01  2.84478992e-01]
   [-1.17132640e+00  8.24551046e-01 -8.22138429e-01 ... -9.19350266e-01
    -6.45599604e-01  1.05909839e-01]]

  [[ 1.54328597e+00  1.04389977e+00  1.68628466e+00 ...  7.05978632e-01
    -8.90491366e-01 -1.18545473e+00]
   [ 1.09322250e+00  8.24211597e-01  1.36300778e+00 ...  7.52861381e-01
    -7.03641057e-01 -6.76098824e-01]
   [-6.60677254e-01 -4.47036654e-01  3.63803536e-01 ... -1.51663136e+00
    -8.49872708e-01  1.26021528e+00]
   ...
   [-7.67961621e-01  5.17816126e-01  4.12962526e-01 ...  2.55298138e-01
    -1.22623786e-01 -2.38133073e-02]
   [-6.53602779e-01  7.28860438e-01  8.90548706e-01 ...  1.62543818e-01
    -3.36647391e-01 -5.53217173e-01]
   [-2.44571596e-01 -4.30736005e-01  9.35387611e-01 ... -2.97742653e+00
    -1.58123815e+00  4.65305805e-01]]

  [[ 4.55715179e-01  1.19146752e+00 -2.30643082e+00 ...  6.46457732e-01
    -4.68116790e-01  1.53607339e-01]
   [-7.74578676e-02 -4.55456614e-01  3.08382750e-01 ...  1.26317635e-01
     2.46407509e-01  8.85237157e-01]
   [-1.08658463e-01 -3.96715045e-01  4.47291791e-01 ...  1.32892042e-01
     2.59060204e-01  7.21964478e-01]
   ...
   [ 4.35228705e-01  1.05414987e+00  1.94830447e-01 ...  3.94946992e-01
    -1.24072820e-01 -4.02740508e-01]
   [ 2.84697860e-01  1.19587183e+00 -1.38542449e+00 ...  2.94206440e-01
    -4.41390991e-01  5.77223897e-01]
   [ 3.17377806e-01  7.78875947e-01  5.50578713e-01 ...  7.22341418e-01
    -1.98021621e-01 -3.64834726e-01]]]


 [[[-7.65058279e-01 -1.28571784e+00 -2.52530705e-02 ...  9.61547941e-02
     2.43091965e+00  1.85263646e+00]
   [-7.62691677e-01 -1.29602849e+00  1.96099617e-02 ...  1.60103887e-01
     2.36835146e+00  1.74982452e+00]
   [-7.62938380e-01 -1.40238011e+00 -3.49719226e-01 ... -1.46325901e-01
     2.01772332e+00  1.67375803e+00]
   ...
   [-4.08040732e-01 -1.35418177e-01 -4.21337366e-01 ... -1.19810081e+00
    -1.95115089e+00 -2.83383548e-01]
   [-5.33847988e-01 -8.90270233e-01  1.70799255e-01 ... -1.67972744e-01
     3.73974264e-01  7.49898195e-01]
   [-3.26613575e-01  8.42672110e-01  9.09774542e-01 ...  6.21514879e-02
     2.87985235e-01  6.81026280e-01]]

  [[ 1.93592772e-01  9.59824264e-01  3.40321332e-01 ... -4.49948370e-01
     1.83061779e-01 -1.93495548e+00]
   [ 1.67419091e-01  9.57827389e-01  3.61894876e-01 ... -4.09914047e-01
     1.62785485e-01 -1.85928094e+00]
   [ 2.56705344e-01  4.15964246e-01  1.46771419e+00 ...  2.92594504e+00
     1.34135079e+00 -6.35596752e-01]
   ...
   [-1.09345078e+00  7.64212310e-01  1.45986915e+00 ...  1.75721848e+00
    -7.79285789e-01  2.15665865e+00]
   [ 7.04360288e-03 -2.50349224e-01  2.39688665e-01 ...  8.43830884e-01
     6.54134452e-01  8.32153916e-01]
   [-2.66377062e-01 -5.23450971e-01  6.65453196e-01 ... -8.09507251e-01
    -1.77260697e-01 -3.67632806e-01]]

  [[-1.66600466e+00  1.88242126e+00  2.58194208e-01 ... -4.67830509e-01
     1.85051218e-01  2.26301193e-01]
   [-1.54710555e+00  1.68335795e+00  5.27302474e-02 ... -4.94050860e-01
     1.37241378e-01  2.96990573e-02]
   [-1.63814044e+00  1.83126211e+00  2.15119675e-01 ... -4.75400299e-01
     1.70433447e-01  1.84607625e-01]
   ...
   [-2.28787169e-01 -2.07675886e+00  2.24456694e-02 ... -1.39412344e+00
    -1.59171355e+00 -2.35364109e-01]
   [-1.35560489e+00  5.77401757e-01 -2.90520638e-01 ...  1.72232080e+00
    -2.25373602e+00 -4.72125828e-01]
   [-4.99464393e-01 -8.07882071e-01 -6.85226440e-01 ... -2.36907959e-01
    -1.13581598e+00 -2.38638759e-01]]

  ...

  [[-3.43075544e-01  4.16523457e-01  1.04071283e+00 ...  3.43887091e-01
    -2.70073867e+00  1.23653293e+00]
   [-2.95889616e-01  4.40832347e-01  7.76438236e-01 ...  4.62658346e-01
    -2.25116205e+00  9.63957906e-01]
   [ 4.19854373e-02  6.03992701e-01 -1.15947378e+00 ...  1.33067644e+00
     1.06628358e+00 -1.01727295e+00]
   ...
   [-4.54503655e-01 -3.75251472e-03 -2.42053002e-01 ... -4.45018202e-01
    -3.56792718e-01  1.65305614e+00]
   [ 4.31661934e-01 -4.40567344e-01  8.90839756e-01 ... -3.61372530e-01
    -7.34757602e-01  7.56591856e-01]
   [-6.29006326e-02  2.26471633e-01  5.21057844e-01 ...  2.31786400e-01
    -1.07727706e+00  1.16490018e+00]]

  [[-1.34708977e+00 -2.93532348e+00  2.07337784e-03 ... -1.07136993e-02
    -1.15677512e+00 -2.85353605e-02]
   [-1.83600330e+00 -1.28390384e+00  5.04585981e-01 ...  4.57631975e-01
    -4.78776425e-01 -1.24641821e-01]
   [-1.88095260e+00 -1.07083368e+00  5.65232992e-01 ...  5.19085884e-01
    -3.96689981e-01 -1.49304703e-01]
   ...
   [ 1.08296728e+00  5.47329009e-01  6.17370605e-01 ...  2.01669121e+00
    -2.88477689e-01 -1.80704927e+00]
   [-1.15234196e+00 -1.32611370e+00 -8.01333189e-02 ... -4.54871774e-01
    -2.87268013e-01  1.66955754e-01]
   [-3.03121656e-01 -6.83008134e-01 -1.06202853e+00 ...  7.68089950e-01
     3.68466258e-01 -7.76617408e-01]]

  [[-8.43631744e-01  1.70818186e+00  6.39258564e-01 ... -3.17088175e+00
     1.74215749e-01  3.40708590e+00]
   [ 4.95791733e-01 -3.30271900e-01 -2.15916872e+00 ... -2.12281060e+00
    -5.33408582e-01 -9.30221677e-01]
   [ 4.11442190e-01  8.31273139e-01 -2.88995314e+00 ...  1.20510149e+00
     3.83064479e-01 -5.46640873e-01]
   ...
   [ 2.74629831e-01  2.24563658e-01  6.93054050e-02 ...  1.79149508e+00
     6.91932261e-01 -1.58029407e-01]
   [-1.04013085e-01 -2.08568215e+00  1.21975407e-01 ... -1.10306211e-01
    -4.96909410e-01 -6.07418776e-01]
   [-4.11456451e-02 -9.40154850e-01 -2.28354856e-01 ... -5.63349664e-01
    -8.59609663e-01 -1.20323110e+00]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-False-32-8-27-5-4] q.shape1: (4, 5, 27)
q.shape2: (20, 27)
q.shape3: (20, 27)
q.shape4: (4, 5, 27)
q_liner: [[[-0.45098242 -1.8597655  -0.18044868 ...  0.44736165 -0.7812911
   -1.3717854 ]
  [-1.5089675  -1.1255506   0.2868886  ... -0.59291077 -4.2512317
    1.4017425 ]
  [-0.5946903   1.0263848  -0.581638   ... -2.404116    1.5132208
   -2.4856858 ]
  [-0.31688586  0.5528781  -0.47048947 ... -3.4016237   0.32389942
    0.792212  ]
  [ 0.5705429  -1.4638315  -1.4060916  ...  0.13239647 -0.5641086
   -0.13941243]]

 [[-0.48622677  0.58664197 -0.8507686  ... -1.5951675   0.925034
   -0.5789255 ]
  [ 0.01250784  0.25906408 -1.4820709  ...  0.27701774  0.5088146
   -1.5133849 ]
  [ 1.8713679  -1.6441332  -0.23689705 ...  1.4759529   0.59806687
    1.3676002 ]
  [-1.7826599  -0.49967122 -0.13877729 ... -2.3092782  -0.94425666
   -0.67025876]
  [-1.9854672  -0.1258095  -1.3325741  ... -1.2256528   0.3417048
   -1.306887  ]]

 [[ 0.08923486  0.40770042 -1.179379   ... -2.331579    1.0649294
   -1.4443758 ]
  [-0.9717777  -1.0941966   0.10684844 ... -1.3449765   1.5412539
    1.2202598 ]
  [-1.9089527  -0.49968353 -0.7305629  ... -0.31890056  0.05979536
   -0.012014  ]
  [ 0.8310763  -0.54699767 -2.0045776  ...  1.1674603  -0.8113642
    2.5285468 ]
  [-0.6054805   0.17777057 -0.3048614  ... -3.8101263   0.3146161
    0.12864286]]

 [[-1.0738884   0.71441424  1.0330291  ...  2.1741905  -0.05606912
   -2.2165117 ]
  [ 2.8600929   2.6552117   1.1548573  ...  0.5743336  -0.509936
   -1.0215002 ]
  [-0.7602025  -2.2237754  -0.00880858 ... -1.8565426   0.769028
    1.1017362 ]
  [ 0.56063324  2.2217884   1.0828177  ...  1.7795794  -0.57600886
    1.1000314 ]
  [-0.13495904 -2.4847577  -0.8736484  ... -0.4826979   0.6778818
    1.9465017 ]]]
q.shape5: (4, 5, 256)
q.shape6: (4, 8, 5, 32)
attn_res: [[[[-1.8165474  -0.34955198  0.2079937  ... -0.42757973 -0.26867023
    -0.93475693]
   [ 1.4930425  -2.0854533   1.7868445  ... -2.725434    0.11511506
    -0.12302628]
   [-0.27526066 -1.233642    0.01429317 ...  0.48763072 -0.46220648
    -1.3002135 ]
   [ 0.37774357 -1.1686964   0.2601993  ... -1.1766689  -0.15675294
    -0.15661557]
   [ 0.72602934 -1.8565936   0.07483396 ... -0.5922149   0.63679844
    -0.31857276]]

  [[-1.5518537   0.0694391  -3.1525266  ...  0.569828   -0.9822093
    -0.67328805]
   [-1.4049532   0.73789394 -1.9653988  ...  0.09246025 -0.03517137
    -0.45618403]
   [-0.3239324   1.2044983   1.1949637  ... -0.16807021  0.00571826
    -0.11057796]
   [-0.28973103  0.96564734  0.20933664 ...  0.13064565 -0.39433584
    -0.04220863]
   [-2.2377942   0.12676142 -2.5937846  ... -0.26685762 -0.6142252
    -0.9111365 ]]

  [[ 0.66813105  0.10613003 -0.01407206 ...  1.994468    0.02597257
    -0.74883103]
   [ 0.02953915 -0.38170484 -0.9398417  ...  2.7309487  -0.24444053
    -1.1819438 ]
   [-0.9251646   0.8239346  -0.21311048 ...  2.032754   -0.4330653
    -0.45269436]
   [-1.4972848   1.12509    -0.55232435 ...  1.9299675  -0.74983716
    -0.20799269]
   [ 0.06055903  0.32955986 -0.15916377 ...  1.4768366  -0.23335342
    -0.30656075]]

  ...

  [[-1.6764549   0.8335365  -0.65307146 ... -2.0387402  -1.9644034
    -1.3480741 ]
   [-0.45884603  0.8052085   0.7013218  ...  0.15491042  0.5221436
    -0.4086475 ]
   [-0.75721806  1.190844    1.2795433  ...  2.1369936   0.10216983
    -2.9118917 ]
   [-0.69012034  1.0077641   1.1074452  ...  1.9640265   0.14010252
    -2.5991495 ]
   [-1.4590151  -0.39826876  1.2313857  ... -1.5614924  -2.5810194
    -0.05432747]]

  [[-0.548433    0.3801065   0.603457   ... -1.2845359   0.24419963
    -0.10634151]
   [-3.2917855   0.48887604  2.3143353  ... -0.93108225 -1.3882588
     0.43059292]
   [ 1.0636346   0.8828341   0.44591796 ...  0.9605551   0.21460782
     1.0169467 ]
   [ 0.5841731   0.05655852  0.42847776 ...  1.6219368   1.3457029
     1.3922528 ]
   [ 0.49298346  0.21755774  0.37395236 ...  0.39074785  1.1984894
     0.8251316 ]]

  [[-0.37402818 -0.17908573 -0.14413255 ... -2.1316254  -0.9948177
     2.0280895 ]
   [-0.7092611  -1.2756169   1.3069298  ... -1.3375051  -0.7224027
     0.29928046]
   [-0.01510194 -0.7116107   1.5207124  ... -0.13702354 -1.3387222
    -0.18538024]
   [-1.7327425  -1.5886188  -0.73192585 ... -3.0916429   0.19927414
     0.78028154]
   [-0.16875006 -1.0117073   0.99795145 ... -0.43402237 -0.733024
    -0.29118183]]]


 [[[ 1.1347599   2.1036801  -2.0272     ... -0.19127607  1.7430563
     1.3357136 ]
   [-1.5483638   0.7201501   0.4920958  ... -2.3318336   1.8128997
    -0.6608317 ]
   [-0.6202162  -0.15625261 -0.63282835 ... -1.5936494   1.8157122
     0.98248065]
   [-0.65464664  1.2979941  -0.5393002  ... -1.7496531   1.9972506
     0.15571669]
   [-0.71171033  1.3712308  -0.4248931  ... -1.7918223   2.005683
     0.00913706]]

  [[-0.5323745   1.6268587   0.09424442 ...  1.435848   -0.40431252
     1.2417068 ]
   [-0.68644625  0.61779565 -0.53646463 ...  0.9375519  -0.952968
     0.81230766]
   [ 0.24599797  0.18046942 -0.09520097 ...  0.7716137  -0.4925456
     0.34831586]
   [-0.562195    1.3417135  -0.05915953 ...  1.2966926  -0.55514437
     1.0874381 ]
   [ 0.06486714 -0.11703829 -0.18025324 ...  0.1352759  -0.2987581
    -0.01885183]]

  [[-0.06064446  1.4263287  -1.0712099  ... -0.21823144  1.7306342
    -1.0030811 ]
   [-1.7554911  -0.8885797   1.0699407  ... -2.127888    0.7570484
    -0.9631144 ]
   [-0.45297563  1.5881834  -1.1721743  ...  1.3813174   1.7668663
    -1.2861322 ]
   [-2.3422961  -1.6651026   1.3570962  ... -3.9470162   0.7960014
    -1.2708142 ]
   [-0.6169888   0.81798714 -1.2118504  ... -0.25486198  1.8614951
    -1.8217473 ]]

  ...

  [[ 1.9862981   1.1664224  -0.62497485 ... -0.3042896  -1.3402573
    -1.2612207 ]
   [ 0.7477417  -0.6537043   0.08071849 ...  2.2982063  -0.74336404
    -0.506204  ]
   [ 0.7814973  -0.35783592  0.08479831 ...  0.5776338  -1.8409152
     0.8333319 ]
   [ 0.09278507 -0.03359905  0.03453953 ...  0.08906709 -0.15084752
    -0.01301022]
   [ 1.944141    1.1334208  -0.595714   ... -0.2979905  -1.325694
    -1.2243003 ]]

  [[-1.5371078   0.5470137  -2.576969   ... -1.2532806  -2.3458865
     0.5834649 ]
   [-1.519867    0.042383   -0.96848047 ... -1.450014    1.2924943
    -0.40490055]
   [-1.5631583   0.39371896 -2.2830637  ... -0.871206   -1.3595961
     0.7056838 ]
   [-1.3642792   1.2637519  -1.1614658  ... -0.03505534 -0.51507485
     0.8863558 ]
   [-1.3359134   0.38539377 -1.9327549  ... -1.2364383  -0.9630861
     0.1891734 ]]

  [[-0.20120935 -0.8065231   1.598071   ... -1.652105   -0.72402287
     0.16424721]
   [-1.8666546   2.6134768   0.81364363 ...  0.433884    0.22010958
     2.271439  ]
   [ 0.56655335 -1.3724489   1.266009   ... -0.4967835   0.2118786
    -0.49991328]
   [-0.6848875   0.3444156   1.1646794  ...  2.3321555   0.61685497
     0.65192807]
   [ 0.17062214 -0.81577337  1.1455398  ...  1.3844917   0.717541
    -0.1737479 ]]]


 [[[ 0.24114648 -0.9929613   0.53257704 ... -0.6652973  -0.06652091
    -0.4392555 ]
   [ 0.56653565 -0.45364732  0.7690483  ... -0.67062646 -0.01052937
    -0.4706685 ]
   [ 0.9482762  -2.1883576  -0.2141133  ... -0.16564055  1.408571
     1.3684002 ]
   [ 0.10374793 -0.81616247  0.751538   ... -0.76435065 -0.36908248
    -0.29477906]
   [ 0.44803333 -1.6095945   0.6724075  ... -0.52272534  0.16002697
    -0.27207273]]

  [[-0.23564976  0.4269815   0.02916853 ...  0.20129351  0.09612408
     0.3721387 ]
   [ 0.08839501 -0.15206528 -0.137473   ... -0.50051415 -0.11932456
     0.49086505]
   [ 0.5933267   1.0583632   0.58471984 ... -0.19186568  0.9232782
    -0.9642809 ]
   [ 2.6622245   0.67872626 -2.1292663  ... -0.9199471  -0.285441
    -0.09995496]
   [ 0.631719    3.171801    1.6911106  ...  1.0547134   2.112488
    -2.323415  ]]

  [[-1.0583392  -0.09078415 -0.6988915  ...  1.1153873  -0.3081215
     0.22678052]
   [-0.11893996 -0.15374583 -0.31828135 ...  0.12200142  0.03149994
     0.42359135]
   [-1.3923849  -0.09256417 -0.8887348  ...  1.2081944  -0.51300114
     0.53338665]
   [ 0.36802322 -0.08586605  0.98845375 ...  2.0877252  -0.15875119
    -0.1853286 ]
   [ 0.6624573   0.4297016   1.5627303  ...  1.6996574  -1.444038
     2.6653624 ]]

  ...

  [[-1.1990268  -1.2826025   1.1440616  ...  1.1817594   0.79058266
     0.2637038 ]
   [-0.79504097 -0.06885208  0.528824   ...  1.9131312  -0.16993544
     0.40300763]
   [-1.2660017  -2.1185024   1.6501886  ...  0.6141724   1.258937
     0.16113816]
   [-0.17228585 -0.52089304  0.46088317 ...  0.3543369   0.30698785
    -0.24019493]
   [-0.79860765 -1.1238445   1.0681926  ...  1.0778719   1.4892913
    -0.07295281]]

  [[-0.27931368 -1.0720246   0.34033644 ... -0.60065395 -0.04816866
    -1.6729865 ]
   [ 0.4399844  -0.44148248  0.5984835  ... -0.30238423 -0.35848266
    -1.5033015 ]
   [ 1.5480384   0.35282052  0.62272465 ...  0.12471032  0.03858465
    -2.129862  ]
   [ 2.6596537   2.4123597   1.2907314  ...  0.79796475 -0.8903305
    -2.7421076 ]
   [ 0.07169172  0.068328    0.06265852 ...  0.0155312  -0.06728822
    -0.11520293]]

  [[ 1.4781716  -0.62397516  0.55167794 ... -0.09574606 -1.7477269
    -1.4529104 ]
   [-2.5700758   0.31361237 -0.9719715  ... -0.6198999  -1.3025577
     0.8344032 ]
   [-0.45585385 -1.5048908   0.79660404 ... -1.551383    0.8453579
    -1.6910143 ]
   [ 0.8067889  -0.57668877  0.53561646 ... -0.02704812 -1.0010389
    -0.842519  ]
   [-2.0428557  -0.59680206 -0.17007628 ... -1.130815   -0.23327303
    -0.14071277]]]


 [[[ 0.93923736 -0.14835459  0.7436347  ... -0.10662711 -0.56971025
    -0.30778062]
   [ 0.51726955  0.07536122  0.22476059 ...  0.5251053  -0.33563188
    -0.5996598 ]
   [ 0.6608254   0.5992254   0.59209037 ...  0.23997498 -0.71052766
     0.4558764 ]
   [ 0.59484804  0.1295158   0.7155033  ...  0.13272089 -0.63731766
     0.14869821]
   [ 0.40471023 -0.0265438   0.2855993  ...  0.74059486 -0.4041615
    -0.4566083 ]]

  [[-1.1296905  -0.2603191  -1.3625789  ... -1.5006719  -0.8492818
     0.45898026]
   [ 0.99916494 -1.0769488  -1.2181199  ... -1.4283824  -2.7527027
     0.1406265 ]
   [-1.5352918  -0.11274341 -1.4327556  ... -1.9432772  -0.79091007
     0.7377856 ]
   [ 0.05784931 -0.7542782  -1.3190237  ... -1.579845   -2.066981
     0.35002685]
   [-0.08996323 -0.27952266 -0.38190043 ... -0.16164687 -0.43035555
    -0.3610469 ]]

  [[-0.2834166   0.42266297  0.25130725 ...  0.18407178  1.8885164
     1.0064447 ]
   [ 0.28983322  0.6545152   0.96040857 ...  0.41241089  0.16199096
     0.38817197]
   [-0.5837106   0.96415323  0.6455137  ... -0.79596347  0.9489082
     0.89335227]
   [-0.22849436 -0.20527981 -0.3476032  ...  0.96113265  2.9970336
     1.130818  ]
   [-0.00820431  0.84408873  1.2267731  ...  0.2983296   0.08072763
     0.36922622]]

  ...

  [[-0.44173408 -0.38511887  0.8230266  ... -1.7528572   0.44472575
    -0.014633  ]
   [-0.56573004  0.4557316  -0.0155184  ... -0.82554126  0.5375734
    -0.69876856]
   [-0.9946362  -0.21737863  2.014802   ... -2.2492619  -0.5165436
     1.1601659 ]
   [-0.49734983  0.40892366  0.6831461  ...  1.0616468   1.5936861
    -0.23798606]
   [-0.76737785 -0.00641115  1.4289848  ... -0.8766207   0.40849367
     0.5406387 ]]

  [[ 0.51602954 -0.25339377 -0.6012469  ...  0.31535012 -0.36305967
     0.7754345 ]
   [ 1.7242668   0.84767216 -1.3688529  ...  0.6497306  -1.3586433
     2.3749256 ]
   [-0.15233468 -0.05083613  0.06592843 ...  0.26153636 -0.08382657
     0.663211  ]
   [ 2.3480315   0.328378   -0.07845721 ...  1.5473247  -0.99383986
     2.6163995 ]
   [ 0.64763993  0.47889283 -1.170439   ...  0.33069998 -0.84644586
     1.5514867 ]]

  [[-0.31380928 -1.5585606  -1.3990066  ... -1.4937835  -0.47312608
     0.14676483]
   [-0.488111   -0.8563858  -0.527608   ... -0.2889922   0.77647316
     0.3157988 ]
   [-0.3206111  -1.0858512  -0.6052179  ... -0.02598561  0.9868914
     0.33973575]
   [-0.14507952 -1.492305   -1.0864936  ... -1.1054943   0.2898278
    -0.08337238]
   [-0.21188919 -0.7220487  -1.4625635  ... -1.4666877  -0.39146256
     0.03027809]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-False-32-8-27-5-8] q.shape1: (8, 5, 27)
q.shape2: (40, 27)
q.shape3: (40, 27)
q.shape4: (8, 5, 27)
q_liner: [[[ 0.15200195  0.42109513  0.18947552 ... -1.7429332  -0.884225
   -0.31648648]
  [-0.7228274   0.49029985  0.58301187 ...  2.1885214  -0.0600438
    2.0428016 ]
  [-0.5260736   0.6122724   1.230041   ... -2.247764    0.22396035
   -1.7408255 ]
  [ 0.3971978   0.6543124   0.09537844 ...  1.0527573   2.5283172
    1.3539605 ]
  [-2.2944772  -1.2713732  -0.40413117 ... -2.6895072   1.2463971
    1.2484484 ]]

 [[-1.1593062  -0.88011456 -1.8108406  ... -1.7323458   1.1656864
   -0.8288701 ]
  [ 0.9558412  -0.23498295  2.5545676  ... -3.0560331  -2.0548534
   -2.2333834 ]
  [-1.7470472  -2.397768   -2.3310997  ...  0.24311645 -0.14915928
    0.7152957 ]
  [ 0.8987072   1.1873528  -0.1076384  ...  2.544962    0.67048955
    0.5840135 ]
  [ 2.0645623   0.3715976   0.32978135 ...  1.3476607   0.29302907
   -0.27270532]]

 [[-0.00490406 -0.09373393  1.1604989  ... -0.68984926  1.4405506
    0.73424846]
  [-0.04013184 -0.74264437  0.7171273  ...  0.84781003 -0.8189953
    1.0422674 ]
  [ 1.3068575   1.0912939  -0.5706339  ...  0.6620283   0.5126465
    1.2609537 ]
  [-1.4994876   1.0570574  -2.6855764  ...  1.9866219   1.5518488
   -0.75737226]
  [ 1.1151257  -2.2495382   0.6445344  ... -1.7265897  -0.9692527
    1.5563262 ]]

 ...

 [[-1.2600608   0.42844266 -1.0461015  ...  0.44042793  0.8438229
    0.35004798]
  [-0.80994964  0.90170777 -1.5636967  ...  1.9153154   0.15813263
    0.75824195]
  [-0.41504437  0.5501679  -0.46502814 ...  1.3531638   0.20270535
   -1.1872677 ]
  [-2.140977   -1.8058906  -2.5433607  ... -1.3188152  -0.21092741
    3.014104  ]
  [ 0.30165464 -1.7570784  -0.5276766  ... -0.95511556  0.6305223
    2.6884043 ]]

 [[ 0.54159     2.0929532   1.2214144  ...  1.3534613  -2.23457
   -3.0139523 ]
  [-0.41575354  1.8297943   0.4623497  ... -0.0106837   0.28909513
   -1.1019404 ]
  [ 1.7901554  -2.319938    0.07372504 ...  1.7785084  -2.0408728
   -0.50145024]
  [-3.2801118   0.87907857  1.1032302  ...  1.169682    2.623778
   -2.4771414 ]
  [ 2.188267    2.8574073   1.3916485  ... -0.65159106  0.6747604
   -2.50303   ]]

 [[-0.28694752  0.1963344   1.8981187  ...  1.5710845  -1.9368709
    0.45920575]
  [ 1.1749982   0.24199866 -1.4054803  ...  0.47076377  0.1422315
    2.097656  ]
  [ 1.5478255   2.0425947   0.88846236 ... -1.2721353  -1.8794543
   -1.3773707 ]
  [-0.5135738   1.8262048   0.93603    ... -1.289328    1.1409359
   -3.309046  ]
  [-0.5917451   1.1871253   0.05737558 ...  2.3166168   0.72268176
    1.4457974 ]]]
q.shape5: (8, 5, 256)
q.shape6: (8, 8, 5, 32)
attn_res: [[[[-1.22433233e+00 -3.06415528e-01  1.11285949e+00 ... -1.16010404e+00
    -1.63813531e+00 -1.13535309e+00]
   [-1.56841505e+00 -9.91562128e-01  1.75053847e+00 ... -8.79234910e-01
    -2.52705526e+00 -4.44799751e-01]
   [-3.15899581e-01  2.58675385e+00 -6.59491718e-01 ... -2.15856767e+00
    -1.35062480e+00 -1.51299655e+00]
   [-9.85436440e-01  7.59444296e-01  6.30120873e-01 ... -7.27043971e-02
     6.29566133e-01  1.41214275e+00]
   [-1.51927340e+00 -9.22151446e-01  1.73579943e+00 ... -7.86341190e-01
    -2.56200814e+00 -1.83339521e-01]]

  [[-6.64977968e-01  2.49735534e-01 -2.63983339e-01 ...  5.32918751e-01
     2.66901217e-03  3.88632119e-01]
   [ 8.17986786e-01 -3.97963226e-01  1.20238578e+00 ...  3.33996534e-01
    -1.21902120e+00  1.71402705e+00]
   [-2.24787474e+00  5.08434176e-01  1.06020570e-02 ...  7.73179293e-01
     7.81271458e-01 -1.59239554e+00]
   [-7.25985765e-02 -2.65711248e-02 -5.10530137e-02 ...  3.95599231e-02
    -4.79554199e-02  1.11661971e-01]
   [-4.83743519e-01 -1.88921642e+00  2.34787488e+00 ...  1.00146428e-01
     7.23218322e-01 -8.22386980e-01]]

  [[ 8.46918702e-01 -1.22766650e+00  6.75660521e-02 ... -1.51472664e+00
     1.40327823e+00  3.90669972e-01]
   [ 8.09217036e-01  3.25689167e-01 -7.86749780e-01 ...  3.19224209e-01
    -9.64740276e-01  3.60917997e+00]
   [ 1.94229388e+00 -2.27652478e+00  4.65173036e-01 ... -2.40537739e+00
     2.39249539e+00  7.61375427e-02]
   [ 8.55584621e-01  1.34158289e+00 -7.73635209e-01 ...  1.31824470e+00
    -9.14087370e-02  8.06547940e-01]
   [ 1.85538530e+00 -1.15247035e+00 -8.48981291e-02 ... -1.11463153e+00
     9.58380938e-01  1.81480324e+00]]

  ...

  [[ 2.04817683e-01  7.50301540e-01 -1.14418161e+00 ...  4.69755828e-02
    -6.64919555e-01  6.21364653e-01]
   [ 2.63254553e-01  1.44028473e+00  7.47441471e-01 ...  5.01877129e-01
    -8.11534226e-01 -1.35917425e-01]
   [ 4.27275658e-01  6.86981320e-01 -4.57869053e-01 ... -2.10747734e-01
    -4.37963039e-01  1.12365627e+00]
   [ 3.85043234e-01  2.13217020e-01 -1.56075168e+00 ... -4.23947006e-01
     2.72904575e-01  1.31822479e+00]
   [ 8.90627801e-01  1.10978305e+00  2.63335288e-01 ...  1.23735331e-01
    -8.96514416e-01  6.44213378e-01]]

  [[ 6.96782053e-01 -2.40329251e-01 -5.27078450e-01 ... -9.00210738e-02
    -1.07323229e+00  8.25895190e-01]
   [-3.60734373e-01 -6.64041519e-01 -9.51043665e-01 ...  1.05360933e-01
    -6.99248791e-01  4.99893785e-01]
   [ 1.95111060e+00 -6.41531765e-01  6.22695684e-03 ... -7.07278371e-01
    -2.98281491e-01  1.51322687e+00]
   [-8.20931792e-01 -8.81077647e-01 -1.09388804e+00 ...  7.02114642e-01
     1.45188117e+00 -9.97869551e-01]
   [ 9.05523121e-01 -4.19143766e-01 -5.88508368e-01 ... -4.08015281e-01
    -1.37996030e+00  1.36521542e+00]]

  [[ 2.01964092e+00 -3.09442908e-01 -3.61090243e-01 ...  1.97740984e+00
    -2.84776926e-01  6.27335727e-01]
   [ 8.11073184e-01 -2.55719161e+00  3.38432379e-02 ...  1.79955161e+00
     3.29726607e-01 -1.89306343e+00]
   [ 1.32572484e+00 -2.23774767e+00 -1.12912035e+00 ...  2.63612962e+00
    -9.03626159e-02 -2.18180943e+00]
   [ 1.71520209e+00 -1.03641617e+00 -4.09012914e-01 ...  2.11174679e+00
    -1.86381549e-01 -4.76334900e-01]
   [ 1.41269803e+00 -2.13634777e+00 -1.56220877e+00 ...  2.89517403e+00
    -2.65740365e-01 -2.41635561e+00]]]


 [[[-9.76835191e-03  2.62329489e-01 -7.42339268e-02 ...  7.95877099e-01
     6.36960149e-01  3.38781059e-01]
   [-7.04822719e-01  1.91042840e+00  4.30178106e-01 ... -2.29877681e-01
     9.24095988e-01  1.92261207e+00]
   [-2.47735828e-02  5.49713016e-01  5.11896253e-01 ...  6.19874597e-01
     1.18036830e+00  1.31552839e+00]
   [-2.98019778e-02 -2.49603242e-02 -6.18569087e-04 ... -1.35122985e-01
     1.40414402e-01 -4.86308224e-02]
   [-5.50262704e-02  2.72363871e-01  5.47402918e-01 ...  1.12755656e-01
     5.87405086e-01  3.55976880e-01]]

  [[-1.08057752e-01 -1.10543823e+00  3.69582176e-02 ... -6.77279949e-01
     1.98347247e+00 -1.10926354e+00]
   [-2.02036247e-01 -1.24846089e+00  4.41430986e-01 ... -6.29351377e-01
     9.47343707e-01  4.42637652e-01]
   [-8.18154775e-04 -2.74949700e-01 -2.62544211e-02 ... -4.80300456e-01
     5.78405023e-01  8.47301912e-04]
   [-1.60553902e-02 -2.54796863e-01  1.12619892e-01 ... -1.60623491e-01
     3.82936060e-01 -2.92044193e-01]
   [ 1.90701857e-01 -1.01905978e+00 -9.67948377e-01 ...  2.29230061e-01
     1.99627018e+00 -1.18162930e-01]]

  [[-4.47801977e-01 -1.28283948e-01  1.51181984e+00 ... -7.46951461e-01
    -2.10672826e-01  6.28705502e-01]
   [-8.62054408e-01 -3.17173153e-01  3.27746654e+00 ... -1.49276233e+00
    -5.89384735e-01  1.33820152e+00]
   [-2.12571591e-01 -1.28444016e+00  1.10491669e+00 ... -1.12119615e+00
    -1.11078107e+00  1.38718143e-01]
   [-1.75154924e+00  2.72272754e+00 -3.40619087e-01 ... -1.42418551e+00
    -1.03130460e+00  2.24272466e+00]
   [-1.13445330e+00  1.15297210e+00  1.47226900e-01 ... -1.28299510e+00
    -1.11397660e+00  1.40048289e+00]]

  ...

  [[-3.00010294e-02 -4.14048195e-01  1.28318715e+00 ... -2.15203285e+00
     5.39437950e-01  3.56179029e-01]
   [ 1.73635888e+00  6.50147080e-01  8.53060663e-01 ...  1.07369506e+00
     3.66151035e-01  8.48611519e-02]
   [-2.97267318e-01  5.14731705e-01  7.55734205e-01 ... -7.95362115e-01
     4.81575668e-01  6.16654456e-02]
   [ 7.74851218e-02 -3.83566141e-01  1.30327177e+00 ... -2.74617004e+00
     8.18376958e-01  1.25169978e-01]
   [-2.63329148e-01  4.03477579e-01 -5.10378890e-02 ... -7.90628135e-01
     1.18057787e+00  4.98212904e-01]]

  [[-7.46014714e-02  1.49184287e+00 -5.39414763e-01 ... -1.34765238e-01
     5.98796904e-01  6.17144465e-01]
   [-4.12485301e-01  1.69943619e+00  1.67878971e-01 ...  1.68234676e-01
     9.18565750e-01 -1.36124104e-01]
   [ 3.66198063e-01  1.60284638e+00  4.59683359e-01 ... -4.59749103e-02
     7.51252174e-01  2.15325356e-01]
   [-1.35304341e-02 -2.16778904e-01 -6.67349324e-02 ...  8.75580072e-01
     1.37141538e+00  7.64506876e-01]
   [-6.35092556e-01  1.32872605e+00 -3.59896943e-02 ...  6.14219189e-01
     9.03942704e-01 -2.40375280e-01]]

  [[-1.42696452e+00  5.39949834e-02  3.20220232e-01 ... -7.62107670e-01
     4.24610376e-02  7.80946732e-01]
   [ 9.11482632e-01  1.52087912e-01 -5.14522195e-01 ...  1.03347614e-01
    -3.81001115e-01 -2.15156960e+00]
   [-1.80033720e+00  1.95501924e+00  5.20296335e-01 ... -1.11787245e-02
    -1.50030363e+00  3.28408182e-01]
   [-1.73924482e+00  1.35313511e+00  1.09847367e+00 ... -1.43094134e+00
    -2.82405376e-01  1.74396527e+00]
   [-2.11106583e-01  9.72933054e-01  2.30577841e-01 ... -7.51821637e-01
    -4.36588198e-01 -9.91975367e-01]]]


 [[[-8.21048558e-01  5.48233032e-01 -6.95828319e-01 ... -1.35176682e+00
     1.00670779e+00 -1.31350946e+00]
   [-7.81261206e-01  5.30178726e-01 -5.92998147e-01 ... -1.11509800e+00
     8.73599112e-01 -1.12757277e+00]
   [ 7.12006092e-02  4.53170270e-01  4.89606977e-01 ... -7.16481209e-02
     2.49242440e-01  1.01977360e+00]
   [-7.98809588e-01  6.18185103e-01 -5.87977767e-01 ... -1.35834122e+00
     1.05280423e+00 -1.41852105e+00]
   [-6.78008080e-01  2.00772792e-01 -3.48231882e-01 ...  4.65626776e-01
    -1.41909644e-01  4.92866874e-01]]

  [[ 1.24380529e+00  6.86752498e-01  7.54218102e-01 ...  1.11682385e-01
     7.52305448e-01  3.13183844e-01]
   [ 8.08735937e-02  1.46237239e-01  9.89529416e-02 ...  6.60787448e-02
    -3.17020155e-02  2.76948601e-01]
   [ 7.21234202e-01  2.76156616e+00  6.58762991e-01 ...  1.49143040e+00
     6.16187215e-01 -6.37054503e-01]
   [ 9.16396618e-01 -1.57947481e-01  1.48863226e-01 ...  1.84136897e-01
     1.08741617e+00  6.04209244e-01]
   [ 1.03609276e+00  1.46908820e-01  4.90032554e-01 ...  9.43998992e-02
     5.08877158e-01  1.01282775e-01]]

  [[ 1.47796941e+00  4.83767718e-01  3.64322007e-01 ...  1.24100983e+00
    -1.23710811e-01  8.96858275e-01]
   [ 5.25687814e-01 -2.17811322e+00 -1.80597258e+00 ... -1.21875584e+00
     1.74699986e+00 -9.36483920e-01]
   [-4.08389747e-01 -2.02873063e+00 -3.75934601e-01 ...  4.38934326e-01
     8.42589498e-01 -1.31344303e-01]
   [ 7.51629829e-01 -3.67083192e-01 -1.99439213e-01 ...  1.02018082e+00
     2.40190029e-01  4.48900521e-01]
   [-3.90146434e-01 -1.90815806e+00  5.54318875e-02 ...  6.49593055e-01
     6.02563143e-01  1.05887368e-01]]

  ...

  [[-5.60686707e-01 -9.85786557e-01 -9.43172693e-01 ... -2.03397393e-01
    -1.12864241e-01 -8.84362638e-01]
   [-4.88414109e-01 -3.02275717e-01 -2.88546920e-01 ... -4.84939516e-02
    -1.41402647e-01 -2.01711953e-01]
   [-1.65635669e+00 -1.72040153e+00 -4.76163000e-01 ...  4.47236687e-01
    -4.29948896e-01  2.39123285e-01]
   [-5.03059268e-01 -4.66460705e-01 -6.35511100e-01 ... -3.46573651e-01
    -8.91064778e-02 -5.99942029e-01]
   [-3.78970236e-01 -8.74397695e-01 -1.05379868e+00 ... -2.24607050e-01
    -2.56512687e-02 -1.01407230e+00]]

  [[-1.23240101e+00 -1.24601150e+00  1.89166868e+00 ...  1.59331369e+00
    -3.23892522e+00  1.38978708e+00]
   [-6.93697751e-01  1.16415286e+00 -1.31817830e+00 ... -7.00696409e-02
    -8.10754240e-01  1.24114990e+00]
   [-7.61962295e-01 -8.88492048e-01  1.12732756e+00 ...  8.37293684e-01
    -2.66082430e+00  1.05194974e+00]
   [-1.27713251e+00 -1.06117439e+00  1.67215908e+00 ...  1.54971719e+00
    -3.05322266e+00  1.39103270e+00]
   [-1.59794295e+00  8.65601003e-01 -1.85225952e+00 ...  4.02066827e-01
    -8.28197002e-01  1.45621789e+00]]

  [[-1.47475064e+00  9.65763927e-01  1.22397316e+00 ... -1.04929543e+00
     6.40537083e-01  5.16174436e-01]
   [-9.82325435e-01  4.61888671e-01  1.27024794e+00 ... -5.72685957e-01
     2.49918655e-01  4.94490743e-01]
   [-2.18773961e-01 -5.66122755e-02 -1.87195882e-01 ...  4.29058969e-01
     4.77506518e-01 -1.71340466e-01]
   [-7.71077991e-01  8.89526725e-01 -4.39153731e-01 ... -7.99170673e-01
     8.16737592e-01  1.14619471e-01]
   [-2.37217331e+00  1.97651720e+00  3.08051729e+00 ... -2.64595509e+00
    -1.10145807e-01  7.93674648e-01]]]


 ...


 [[[ 1.85956228e+00 -4.58713055e-01 -1.06535661e+00 ...  3.94469827e-01
     1.05268466e+00 -5.01171172e-01]
   [ 3.91542166e-01  5.68970621e-01 -4.13029462e-01 ... -3.16842616e-01
     4.64253485e-01  6.59792781e-01]
   [ 5.30737042e-01  2.06105161e+00 -3.23544860e-01 ... -9.77906048e-01
     1.95766437e+00  7.33709037e-01]
   [ 1.64852130e+00 -3.22528630e-02 -9.89522815e-01 ...  1.63906008e-01
     1.16771579e+00 -2.49964982e-01]
   [ 6.77521348e-01 -1.55961424e-01 -9.86958265e-01 ... -2.54126787e-01
    -7.06388354e-01  9.46395040e-01]]

  [[-4.87025559e-01 -4.63997692e-01 -6.98856711e-01 ...  1.47158635e+00
    -1.24603057e+00 -3.93498018e-02]
   [-4.52328235e-01 -2.56442986e-02 -7.98627317e-01 ... -2.76590973e-01
     3.47487628e-01 -4.12472546e-01]
   [-1.14195287e+00 -4.85432744e-02 -2.26520944e+00 ... -5.66660106e-01
     4.11385089e-01  3.35863233e-03]
   [-1.34053540e+00 -3.64241391e-01 -1.13421047e+00 ...  3.75708640e-01
    -2.77477235e-01 -9.42525506e-01]
   [-2.80018139e+00 -4.71778721e-01 -2.39926791e+00 ... -3.57245266e-01
     3.01699013e-01 -1.46618176e+00]]

  [[-4.25068200e-01 -1.43345952e+00  1.47302556e+00 ... -5.63526303e-02
     1.45544636e+00  1.44878435e+00]
   [ 1.98334411e-01  1.02951430e-01  1.37955010e+00 ...  3.04619074e-01
     9.68057886e-02  1.29915392e+00]
   [-1.04379110e-01 -5.79704940e-01  1.65793049e+00 ...  1.25229537e-01
     9.13870096e-01  1.65413868e+00]
   [-2.11878404e-01 -9.70403254e-01  1.43555498e+00 ...  8.74101296e-02
     7.45791197e-01  1.45128322e+00]
   [-6.68484986e-01  9.69550610e-02  1.29666674e+00 ... -2.34739017e+00
    -1.82573289e-01 -5.11338525e-02]]

  ...

  [[ 1.10829628e+00  1.98848259e+00 -8.89505446e-02 ... -9.13720012e-01
    -1.59567869e+00  4.87143904e-01]
   [-2.89956152e-01  6.53148413e-01 -2.42907032e-01 ... -7.04816222e-01
    -6.13986611e-01  2.07274035e-01]
   [ 1.55498004e+00  2.03353429e+00 -9.95997787e-02 ... -7.91067481e-01
    -1.53405869e+00  4.63711500e-01]
   [-1.21470773e+00  1.15637279e+00 -6.23898029e-01 ... -8.48686635e-01
    -2.35334873e+00  6.30035341e-01]
   [-1.70389736e+00  3.25167894e-01 -8.97205949e-01 ... -5.32570779e-01
    -1.89658260e+00  5.90738297e-01]]

  [[-6.50370598e-01  9.23267126e-01  7.03212261e-01 ... -3.18513125e-01
    -3.65520334e+00  1.40060246e+00]
   [ 2.13188410e-01 -2.85328436e+00  1.07474101e+00 ...  1.30939579e+00
    -9.04365480e-01  1.32303941e+00]
   [ 1.00858688e-01 -1.96349931e+00  1.04569459e+00 ...  9.29884672e-01
    -9.28482711e-01  1.21635926e+00]
   [ 2.91909277e-01 -1.02075708e+00  8.74071836e-01 ...  4.05345023e-01
    -1.84512466e-01  9.14825201e-01]
   [ 1.28324020e+00  1.20102739e+00 -6.55369759e-01 ... -1.24757588e+00
    -3.20725739e-01  2.41783828e-01]]

  [[ 1.20268917e+00 -9.24481213e-01 -3.55133152e+00 ...  9.49430883e-01
    -4.13235724e-01 -5.38837552e-01]
   [-3.39503527e-01 -1.45633709e+00 -6.17250085e-01 ...  1.68791556e+00
     2.33527094e-01 -1.67606378e+00]
   [-1.53840974e-01 -1.93517625e+00 -1.93603963e-01 ...  1.16711164e+00
    -1.34066308e+00  5.57705760e-01]
   [ 5.01301944e-01 -2.69711924e+00 -1.20299697e+00 ... -1.12195802e+00
    -8.18890691e-01 -9.50158596e-01]
   [ 2.79625237e-01 -4.70949233e-01 -1.18477666e+00 ...  5.70670605e-01
    -3.40700001e-02 -4.24959600e-01]]]


 [[[ 1.70081568e+00 -7.99403429e-01 -1.08830377e-01 ... -4.01027352e-01
     2.55287933e+00 -5.23045421e-01]
   [ 1.65317178e+00 -7.02303529e-01 -3.71507853e-02 ... -3.92184317e-01
     2.61564207e+00 -7.09911942e-01]
   [-8.40816915e-01  2.22997522e+00  5.05851090e-01 ...  2.71883190e-01
     2.59488797e+00 -8.73775110e-02]
   [-3.45913887e-01  8.40341806e-01  1.91143513e-01 ...  1.13777272e-01
     9.20579672e-01 -3.77861857e-02]
   [ 1.54935753e+00 -9.17499006e-01  8.63834769e-02 ... -3.01427692e-01
     2.13378048e+00 -1.45208740e+00]]

  [[ 3.47871542e-01  1.62674451e+00 -1.65491295e+00 ...  1.59072489e-01
     3.16316307e-01 -4.41888571e-02]
   [-1.99265070e-02  3.32385719e-01 -3.77844453e-01 ...  3.44968773e-02
     2.00263277e-01 -6.12022839e-02]
   [ 1.74358058e+00 -7.22942293e-01 -5.03674150e-02 ... -3.59365702e-01
    -5.96261322e-02 -5.24629295e-01]
   [ 1.98131907e+00 -1.50006521e+00  7.50636995e-01 ... -4.47873592e-01
    -5.32061696e-01 -4.02349234e-01]
   [-2.64424276e+00 -3.10030007e+00  1.86250198e+00 ...  3.69168162e-01
     1.19681120e+00  3.10399115e-01]]

  [[-7.03447223e-01  4.85316753e-01 -1.63466954e+00 ... -1.34615600e-01
     1.31756294e+00  1.15195684e-01]
   [-2.09393829e-01  5.57688415e-01 -3.66378948e-02 ... -8.23894560e-01
    -1.40672438e-02  3.21553051e-01]
   [-1.38808802e-01  1.67791200e+00 -6.70578957e-01 ...  4.41515148e-01
    -1.13974124e-01  1.37287438e+00]
   [-4.12259065e-03  9.66778219e-01 -2.63300180e-01 ... -1.44665456e+00
    -9.96831954e-02  6.44637287e-01]
   [ 1.73755005e-01  1.97224009e+00 -5.50037026e-01 ...  8.60859752e-01
    -6.34516895e-01  1.85537243e+00]]

  ...

  [[-2.87171692e-01  3.58641416e-01  8.05102289e-01 ...  5.18913269e-01
     2.30535316e+00 -1.75275528e+00]
   [-7.05322921e-01 -8.44889939e-01  5.04604757e-01 ... -1.18654108e+00
    -1.67923319e+00  2.12147665e+00]
   [-3.37462127e-01 -4.81761694e-01  4.25935000e-01 ... -7.78534532e-01
    -1.29680800e+00  1.50878036e+00]
   [-3.71844620e-01 -5.66082895e-01  4.17493254e-01 ... -1.04399204e+00
    -1.42416644e+00  1.78377569e+00]
   [-1.64514840e-01  5.03774464e-01  7.76873231e-01 ...  6.31641388e-01
     2.59842229e+00 -2.05125737e+00]]

  [[ 8.41234803e-01 -5.29671311e-01 -6.68534517e-01 ... -2.62896121e-01
    -1.44148421e+00  1.77871025e+00]
   [ 5.35716534e-01 -1.82208717e-01  1.05512202e+00 ...  1.74679589e+00
    -8.40537727e-01  1.03212094e+00]
   [ 5.05348802e-01 -1.90940350e-01  5.61517596e-01 ...  1.34597850e+00
    -7.98954725e-01  9.81463611e-01]
   [ 3.68238717e-01 -2.47420996e-01  1.72997862e-01 ...  6.95202529e-01
    -6.88667297e-01  9.17913973e-01]
   [ 9.12578225e-01 -3.12384963e-01  2.64983773e-01 ...  7.53181398e-01
    -1.30547071e+00  1.67893481e+00]]

  [[-7.18634188e-01 -2.95071423e-01  1.50517273e+00 ... -1.22196615e+00
     2.10434723e+00  5.58663964e-01]
   [-8.21144760e-01 -6.26902938e-01  2.06715226e+00 ... -1.99200904e+00
     2.58499241e+00  1.51175368e+00]
   [-6.19363487e-01  4.08368021e-01  1.18472409e+00 ... -1.53637135e+00
     1.02045989e+00  1.43875146e+00]
   [-8.10820222e-01 -3.23678195e-01  1.76125050e+00 ... -1.28120804e+00
     2.29911137e+00  5.17795026e-01]
   [-6.03848398e-01  6.05419159e-01  8.55436087e-01 ... -4.58809555e-01
     8.83878291e-01 -1.13144815e-01]]]


 [[[-1.28793514e+00  1.44450021e+00 -1.49882889e+00 ... -5.44707775e-01
    -1.27030969e+00 -9.12519813e-01]
   [-8.29266071e-01  1.04920423e+00 -1.25986743e+00 ... -4.09812450e-01
    -8.42477918e-01 -9.22773123e-01]
   [ 5.50602794e-01  6.15548491e-01 -1.19171226e+00 ...  4.01969284e-01
     6.06835306e-01  2.23868191e-01]
   [ 1.12438917e+00  7.74244368e-01 -1.39919782e+00 ...  7.91830182e-01
     1.29625928e+00  6.95869207e-01]
   [ 3.72325242e-01  6.66710436e-01 -1.43515968e+00 ...  9.85215187e-01
    -6.56033456e-01  3.79763991e-01]]

  [[-3.55812795e-02 -5.11912480e-02 -1.54235601e+00 ... -1.17897534e+00
     6.60782456e-02  1.63696933e+00]
   [ 2.96879932e-02  7.56841660e-01  3.29126477e-01 ... -1.29994333e+00
     1.17564058e+00 -7.63660669e-01]
   [ 1.47983444e+00  2.65125066e-01 -1.50207746e+00 ... -2.28019929e+00
    -1.08971989e+00  7.40599215e-01]
   [-6.32324040e-01  8.36035728e-01 -6.02161527e-01 ... -7.59856343e-01
     5.85448742e-01 -2.38133240e+00]
   [-2.22056806e-02  1.28594786e-01 -1.04774117e+00 ... -8.93809140e-01
     1.17241323e-01  9.54924464e-01]]

  [[-5.54600179e-01  6.83995664e-01  1.03655159e+00 ... -4.35710251e-02
     3.56907248e-02  4.82188687e-02]
   [ 2.65345395e-01  5.74783981e-02  4.58212793e-01 ...  1.44488081e-01
    -7.58129299e-01 -9.71913397e-01]
   [ 1.60173976e+00  2.99847305e-01  1.29859400e+00 ...  6.69636428e-01
     8.50926414e-02 -7.59188592e-01]
   [ 5.85059941e-01  6.58835620e-02  9.12581384e-01 ... -1.36658266e-01
    -1.03139710e+00 -1.26137125e+00]
   [-5.30040443e-01  1.62354815e+00  2.73301005e+00 ... -2.72288859e-01
     8.95288587e-01  4.34903145e-01]]

  ...

  [[ 1.06409454e+00  1.18671691e+00  6.03164315e-01 ...  2.16041660e+00
     1.53331828e+00 -9.26802456e-01]
   [ 9.49745253e-02  2.41320863e-01  4.00803566e-01 ...  6.72961950e-01
     4.45305288e-01 -6.31753951e-02]
   [ 4.80049521e-01  3.44387621e-01  6.39439940e-01 ...  1.45397758e+00
     7.87242055e-01 -4.30901706e-01]
   [-2.23055296e-02 -7.52694234e-02  1.74297437e-01 ...  1.74295306e-01
     5.17769217e-01 -2.54078448e-01]
   [ 1.09297132e+00  1.27662969e+00  6.57468498e-01 ...  2.27831101e+00
     1.53293014e+00 -8.62664104e-01]]

  [[ 8.70462775e-01 -5.41207671e-01 -1.78972676e-01 ... -1.09654009e-01
     1.56012523e+00 -1.00522375e+00]
   [-1.34982967e+00 -1.21679842e+00 -8.28654230e-01 ...  2.63957930e+00
    -1.26946044e+00  1.49878716e+00]
   [-9.71812069e-01 -8.00606787e-01 -6.39142215e-01 ...  2.20230412e+00
    -5.16644180e-01  8.00519109e-01]
   [ 6.11213632e-02 -1.54062450e-01 -4.18083370e-01 ...  6.22993886e-01
     2.74977803e-01 -4.30331469e-01]
   [ 8.54663730e-01  3.35934132e-01 -6.75936937e-02 ...  4.86053467e-01
     2.03074646e+00 -4.65035856e-01]]

  [[ 1.13653588e+00 -7.03825802e-02  2.89711744e-01 ... -3.52471113e-01
    -1.37787533e+00 -1.27432024e+00]
   [ 1.30120230e+00 -3.80137920e-01  3.47703189e-01 ...  1.07996613e-01
    -1.18446326e+00 -1.48495865e+00]
   [ 7.89030671e-01 -1.31247568e+00  1.40692919e-01 ...  8.18085194e-01
    -5.75227290e-02 -3.72978479e-01]
   [-7.86808848e-01 -1.24216760e-02  4.10277210e-02 ...  1.18299592e-02
     1.32719016e+00  1.23595754e-02]
   [-2.24897727e-01  1.69237927e-01  7.06076503e-01 ... -9.20990407e-01
    -2.07336277e-01  8.93001080e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-False-32-8-27-11-4] q.shape1: (4, 11, 27)
q.shape2: (44, 27)
q.shape3: (44, 27)
q.shape4: (4, 11, 27)
q_liner: [[[-0.08246318  1.297637   -4.3869157  ...  1.6648993   1.0225514
   -0.23413606]
  [-2.1036825   0.34269288 -1.3593392  ...  0.28710133 -2.3495028
   -0.5770221 ]
  [ 0.55015564  1.3115653  -2.7073863  ... -1.2594198   0.450877
   -0.5750791 ]
  ...
  [ 1.9723426   1.9014058  -0.07350472 ... -0.62339854 -1.8269873
   -3.1420405 ]
  [ 0.5897575   0.5651129  -1.4288164  ...  1.6924045  -1.9481409
    1.4147217 ]
  [ 1.4633553  -0.39679056 -0.7927203  ...  0.4363156  -1.650817
    0.20362736]]

 [[-0.9566642   0.6318296  -0.99751896 ... -1.8659797  -0.01259731
    1.0842644 ]
  [-0.15104908  1.3874646   0.19238688 ... -2.0061364  -0.9589741
    0.54090524]
  [-0.31797707 -0.84257644  3.2394025  ...  0.8453818  -0.5109138
   -0.27457815]
  ...
  [ 0.33640504  1.8460547   2.517686   ...  1.085388    2.9914563
    2.6077745 ]
  [ 1.546665    0.5879998   0.41907552 ...  0.75106627  1.0203562
   -0.15183803]
  [-1.0632492   2.5393524   0.9687923  ... -1.3010052  -0.02241022
    1.0278877 ]]

 [[ 0.24715352  1.9982486  -1.0008467  ... -0.99167144  2.288722
   -0.38216916]
  [-1.7900983   1.6657426   0.72222143 ...  1.0981413  -0.52470183
   -1.220509  ]
  [-1.0200733  -0.02188973  0.9696115  ... -3.8275013   1.2366807
   -2.000785  ]
  ...
  [-1.0458595  -1.4305166  -1.8524687  ...  1.3384255  -2.3837926
   -1.3595229 ]
  [ 0.65088063 -0.07472718  0.7910718  ...  1.1668599   0.17494643
   -2.2131062 ]
  [-0.5484388  -0.3512259  -0.9518742  ... -0.37090048 -2.5363982
   -0.35450423]]

 [[-1.6597594  -2.0460486   1.7956158  ...  0.7144732  -2.8808208
   -2.3229933 ]
  [-0.67780596 -1.0200878   2.5991154  ... -0.39864108 -0.15486184
   -1.768438  ]
  [-0.9458305   1.8510628  -0.13740489 ... -1.8609341   1.1644534
    0.04018895]
  ...
  [ 0.38199356 -1.6202837  -1.9532994  ...  2.8872821  -0.4262538
   -0.07649663]
  [-1.2970152  -0.8319859  -1.2084574  ... -0.85649323  1.5001354
    1.9378235 ]
  [ 0.15252627  1.7864983  -2.6395547  ...  0.10763691  0.13296238
   -1.6784537 ]]]
q.shape5: (4, 11, 256)
q.shape6: (4, 8, 11, 32)
attn_res: [[[[-5.47236562e-01 -4.79893953e-01  6.26384139e-01 ...  7.49843419e-01
    -3.17945570e-01  2.85166502e-01]
   [-6.59596860e-01 -1.17995419e-01 -2.86563821e-02 ...  3.36281925e-01
    -4.97703046e-01  7.52104223e-01]
   [ 1.56677127e-01  5.24536073e-02  1.00172305e+00 ...  4.27966937e-02
     1.47631153e-01  1.00958936e-01]
   ...
   [-3.53001729e-02 -6.62634671e-02  2.93594390e-01 ...  1.31657183e-01
    -3.06700647e-01 -7.72358701e-02]
   [-5.29462360e-02 -1.66521937e-01  9.70615372e-02 ... -1.42433420e-01
     1.74791902e-01 -4.48174089e-01]
   [-6.01000428e-01 -2.99580514e-01  5.22308290e-01 ...  5.43383658e-01
    -7.28339136e-01  1.33979678e-01]]

  [[-1.86862454e-01  1.05888337e-01  7.35663116e-01 ...  5.13984203e-01
    -2.98209935e-01  1.03263557e-01]
   [-3.34254295e-01  2.45600939e-02  6.24696970e-01 ...  5.83428502e-01
    -7.07553864e-01  7.16278255e-01]
   [ 2.35238290e+00 -8.26660246e-02 -1.54567945e+00 ... -1.50280797e+00
     1.11141479e+00 -1.58879709e+00]
   ...
   [ 5.02128676e-02 -1.47237331e-02  2.13916358e-02 ... -6.92000091e-02
    -9.57406908e-02  7.40377381e-02]
   [-4.67798293e-01 -4.70691741e-01 -1.32949308e-01 ...  9.36838448e-01
    -5.90618134e-01  5.54854631e-01]
   [-7.47082606e-02 -5.62124923e-02 -6.20754808e-03 ...  2.16394633e-01
    -1.70110703e-01  1.79719210e-01]]

  [[-1.13365126e+00  3.83375794e-01  2.42719188e-01 ...  1.31032026e+00
     1.54708433e+00  8.46052349e-01]
   [-9.86032069e-01  3.17973703e-01  4.27077636e-02 ... -4.59470093e-01
    -6.21830344e-01  1.66980767e+00]
   [ 1.09585948e-01 -1.70382965e+00  2.18302742e-01 ... -5.20392239e-01
     9.70952630e-01 -7.73079395e-01]
   ...
   [-8.30866277e-01 -9.77394521e-01 -5.45823038e-01 ... -7.56012142e-01
     5.70403457e-01  8.57986033e-01]
   [-5.82329929e-01  1.64467543e-01 -3.62125337e-01 ... -9.48848575e-02
     5.07344961e-01  4.93083090e-01]
   [-8.63396227e-02  1.46367073e-01 -1.31465809e-03 ... -2.42660254e-01
    -1.02854915e-01  1.31896928e-01]]

  ...

  [[ 4.39087003e-01  9.17174339e-01 -7.78760612e-01 ... -2.19408721e-01
    -5.85174382e-01  4.33089525e-01]
   [ 1.57523319e-01  2.49810159e-01 -1.09234977e+00 ... -1.32275760e+00
     5.42123497e-01  6.27615988e-01]
   [ 4.82116818e-01  4.86921340e-01 -5.88740408e-03 ... -1.02269673e+00
    -7.81221449e-01 -5.51387250e-01]
   ...
   [ 2.37804890e-01  8.79047632e-01  7.00457618e-02 ... -1.05122685e+00
     1.66922092e-01  6.80144191e-01]
   [-1.46823674e-01  2.25078917e+00 -6.28001571e-01 ... -5.50478585e-02
    -3.68667543e-01  2.10896993e+00]
   [-4.32446867e-01  1.40580785e+00 -2.86126912e-01 ...  7.25828186e-02
     9.12398323e-02  1.24166596e+00]]

  [[-2.35744715e-01  1.56851187e-02  2.90883064e-01 ...  9.43470240e-01
    -7.74210989e-01  1.70282209e+00]
   [-3.08159769e-01  7.62255490e-02  2.64820009e-01 ...  4.34053272e-01
     4.08421829e-03  1.47383243e-01]
   [ 9.57911834e-02 -2.26509500e+00  1.43627092e-01 ...  1.88380584e-01
    -2.51700133e-01 -1.01498020e+00]
   ...
   [ 1.80871278e-01 -9.22926813e-02  9.54206884e-01 ...  3.33865136e-01
    -1.02377641e+00  7.43829191e-01]
   [ 1.30069852e-01 -1.75523594e-01  2.63015956e-01 ...  8.19275603e-02
    -2.16067091e-01  2.43481606e-01]
   [-7.28076696e-02  4.87585276e-01 -5.72089195e-01 ... -2.37841442e-01
     2.52051026e-01  5.79727471e-01]]

  [[ 2.40206182e-01  1.74920201e-01  3.63527715e-01 ...  2.75512218e-01
    -3.67828816e-01  2.66888052e-01]
   [-2.57069916e-01 -2.05376297e-01  7.03640521e-01 ...  2.41913229e-01
    -6.84482604e-02 -7.00290024e-01]
   [ 3.63001227e-01 -4.55397844e-01 -4.20434698e-02 ...  6.95642948e-01
     7.49061167e-01 -1.05164874e+00]
   ...
   [ 1.62747905e-01 -4.18091044e-02  1.04893744e+00 ...  2.23706871e-01
    -2.12542832e-01 -2.03562915e-01]
   [-8.50941062e-01 -3.65348995e-01 -7.42024004e-01 ...  1.31775105e+00
     7.28356004e-01 -9.18033540e-01]
   [ 8.16326678e-01  4.31556106e-01  7.85756484e-02 ...  1.01679862e+00
    -2.46589705e-01 -4.32144642e-01]]]


 [[[-8.98087859e-01 -1.28274751e+00  1.59536815e+00 ...  7.97032952e-01
     6.71077728e-01 -1.21339515e-01]
   [ 7.63804734e-01  1.67966592e+00 -6.93351179e-02 ...  6.80711746e-01
     6.20132089e-02  9.52847824e-02]
   [ 2.21886948e-01  3.32959712e-01 -2.79887319e-01 ...  8.01226854e-01
    -4.18295294e-01  7.18593538e-01]
   ...
   [ 4.08054084e-01  7.11669505e-01  7.42007911e-01 ...  4.74992216e-01
    -9.30303574e-01 -1.93331063e-01]
   [ 8.99838984e-01  1.17821527e+00 -1.20988786e+00 ...  1.04027987e+00
    -4.54762697e-01  1.29386032e+00]
   [ 6.48571551e-01  7.26971388e-01 -1.84205085e-01 ...  2.84899175e-01
     3.98757130e-01  3.92210662e-01]]

  [[ 1.62440643e-01 -9.57414061e-02  3.28588337e-02 ...  4.79140282e-01
    -4.89648938e-01  9.17405605e-01]
   [-5.02238750e-01 -5.45006059e-03 -2.39169478e-01 ...  1.09653723e+00
     1.76273718e-01  3.94068062e-02]
   [-2.25146085e-01  2.33943760e-01 -5.84575713e-01 ...  7.41249323e-01
    -2.84941457e-02  1.28855957e-02]
   ...
   [-6.68357253e-01  4.78805900e-01 -9.93302286e-01 ...  8.11536789e-01
    -3.26861948e-01 -4.64740098e-01]
   [-1.37010336e-01 -7.75631309e-01 -6.92176342e-01 ... -1.83915615e-01
    -1.45218956e+00  2.17339039e+00]
   [ 4.64969933e-01  3.84338170e-01 -7.32180059e-01 ... -4.42506909e-01
    -9.11601186e-02  1.25895739e-01]]

  [[ 5.73662639e-01 -6.38366342e-01 -9.65905339e-02 ... -7.98727751e-01
    -1.04734004e-02 -2.10765749e-03]
   [-1.52349138e+00 -1.66128325e+00  1.86037704e-01 ... -1.02636564e+00
     1.39992845e+00  1.23888505e+00]
   [ 1.36596441e+00 -1.88214910e+00  7.22793758e-01 ...  1.16989732e+00
    -5.57366669e-01 -1.39299965e+00]
   ...
   [ 3.47623050e-01 -1.58267844e+00  3.70362997e-02 ...  7.97378778e-01
    -4.35284287e-01 -6.45256877e-01]
   [-1.25013340e+00 -1.48402464e+00  4.80846882e-01 ... -7.35270023e-01
     1.59703434e+00  7.87763059e-01]
   [ 5.99983394e-01 -7.43352890e-01  2.29482248e-01 ...  6.00429177e-01
     4.31242049e-01 -1.10796618e+00]]

  ...

  [[-4.83920246e-01 -1.46727586e+00  3.03260994e+00 ... -9.22874153e-01
     1.14008975e+00  1.24594605e+00]
   [-3.25198799e-01  1.50611266e-01  2.94248402e-01 ... -1.65990353e-01
     2.17166305e-01  6.98917091e-01]
   [ 1.01008821e+00  2.16370440e+00 -1.21144247e+00 ... -5.61296105e-01
     8.43455553e-01  2.13119078e+00]
   ...
   [ 1.97684848e+00  9.04707551e-01 -1.12185884e+00 ...  1.27375871e-01
    -5.76852918e-01 -2.74378359e-02]
   [-4.12220418e-01  7.63924420e-01  9.92053986e-01 ... -4.20086086e-01
     8.24721634e-01  2.14216781e+00]
   [ 1.16517520e+00  4.74753469e-01 -2.95643866e-01 ... -4.57003206e-01
    -4.41241674e-02  4.36589960e-03]]

  [[-3.36935252e-01  4.67504352e-01  9.19425726e-01 ... -8.78006816e-02
    -5.69205344e-01 -1.12809443e+00]
   [ 8.38032126e-01 -4.56335485e-01 -4.93207902e-01 ... -1.58316612e+00
     2.30297014e-01 -4.85190719e-01]
   [ 3.43618125e-01 -8.08218718e-01 -2.99268842e-01 ... -1.56272030e+00
    -8.84344727e-02 -8.38672280e-01]
   ...
   [ 8.24856400e-01  2.70609260e-01  6.32490039e-01 ...  1.50904489e+00
    -4.07643795e-01  4.87899661e-01]
   [ 2.69664794e-01 -7.15962827e-01 -3.29230070e-01 ... -6.51182353e-01
    -1.38365269e+00 -5.23886532e-02]
   [ 8.34656477e-01 -7.48503566e-01  1.40968546e-01 ... -7.99472868e-01
    -7.16705441e-01 -5.01383901e-01]]

  [[-3.62969935e-04  1.99393928e-03 -7.38232493e-01 ... -1.97916590e-02
     2.80617893e-01 -1.40765405e+00]
   [ 9.88916039e-01 -1.62251741e-02  5.03912210e-01 ... -4.99730557e-02
     1.08718848e+00 -4.27625954e-01]
   [ 4.13185120e-01  1.84794381e-01  4.23468530e-01 ...  5.33387721e-01
     5.84695578e-01 -8.89721215e-02]
   ...
   [ 5.09807110e-01 -5.11205971e-01  1.45052969e-01 ...  5.23981035e-01
     1.08483994e+00  5.41165918e-02]
   [ 6.27303004e-01 -2.77222395e-01 -6.07599616e-01 ... -5.09705007e-01
     1.49475083e-01 -6.57512367e-01]
   [-1.12769090e-01 -1.10648596e+00 -4.90555733e-01 ...  1.92301169e-01
     1.90695181e-01  1.04301643e+00]]]


 [[[-1.31867647e-01  9.53308642e-01  6.53856695e-01 ...  6.85903907e-01
    -8.37609768e-02  1.66034400e+00]
   [ 3.80222112e-01  7.04934359e-01 -2.31963158e-01 ... -1.16591096e-01
     6.58425212e-01  4.18487340e-02]
   [ 1.02675450e+00  5.66390812e-01  7.22663939e-01 ... -1.75373614e+00
     7.80452371e-01  4.98947084e-01]
   ...
   [ 3.27618062e-01 -6.57787919e-01 -4.10258174e-01 ...  3.31973225e-01
     2.87048370e-01 -6.07835576e-02]
   [ 3.32320511e-01  3.96606684e-01 -6.78217411e-01 ...  4.90013659e-01
     4.25589383e-01  1.01047361e+00]
   [-9.83105749e-02  5.00949085e-01  6.19869530e-01 ...  2.18970671e-01
     5.79792917e-01  2.14979589e-01]]

  [[-1.19777572e+00 -1.72031319e+00  5.83552837e-01 ...  3.85776281e-01
    -1.60946500e+00 -1.07351434e+00]
   [ 2.34686360e-02 -5.72991371e-02  2.50156820e-02 ... -7.35890985e-01
    -8.94338265e-02  3.83419573e-01]
   [-1.41949379e+00 -5.98662674e-01  3.67848217e-01 ...  9.18083847e-01
    -1.66615891e+00  5.66309571e-01]
   ...
   [-2.99480110e-01  4.54560935e-01  2.51441956e-01 ...  6.83375418e-01
     7.58863926e-01 -7.93009639e-01]
   [-5.33582330e-01  1.32522255e-01  1.38273990e+00 ... -3.39184403e-01
     5.63023351e-02  3.57395887e-01]
   [-2.33814761e-01 -7.73487747e-01  2.00813890e-01 ... -3.68400484e-01
    -8.47646117e-01  6.31949306e-01]]

  [[-2.82561255e+00  1.42381442e+00  1.50794351e+00 ... -1.18189359e+00
     1.16470921e+00  2.04235077e+00]
   [-6.10940576e-01 -4.57305759e-02  6.10086992e-02 ... -4.47711498e-01
     1.24468112e+00 -7.64140069e-01]
   [ 3.56368929e-01 -7.40246028e-02 -7.50441730e-01 ...  1.53628564e+00
    -7.61605144e-01 -4.16853637e-01]
   ...
   [-3.40045273e-01  1.35681331e-02  1.65750831e-01 ... -1.64923519e-01
     7.15584099e-01 -6.74225867e-01]
   [-6.24324441e-01  7.80046642e-01  2.77125388e-01 ... -1.46945417e+00
    -1.23743415e-01  1.02605319e+00]
   [-1.11168802e+00 -1.90360382e-01  2.41744101e-01 ... -7.93073058e-01
     1.07947278e+00  4.27807271e-01]]

  ...

  [[ 7.87175059e-01 -4.09369767e-01 -6.37152314e-01 ... -3.67425531e-01
     8.67446840e-01 -4.55804527e-01]
   [-5.71605004e-03  4.53185365e-02 -3.17823887e-01 ...  7.12454841e-02
     4.14142132e-01 -1.34132251e-01]
   [ 1.23843074e-01  1.45875645e+00  4.95294809e-01 ...  2.06744647e+00
     4.13152188e-01  8.90121460e-01]
   ...
   [-6.04999214e-02  1.34414148e+00 -4.12423372e-01 ...  1.87720680e+00
    -1.37759581e-01  1.30121350e+00]
   [ 1.18688130e+00  4.68385696e-01 -5.21162093e-01 ... -3.08844805e-01
     6.19204044e-01 -7.99054384e-01]
   [ 2.11473107e-01  1.08077693e+00  2.45222002e-01 ... -9.36102629e-01
     1.82582021e-01 -1.48607299e-01]]

  [[-3.73827279e-01 -3.70000005e-01 -8.36803794e-01 ... -2.30709016e-01
    -3.14492226e-01 -5.68245769e-01]
   [-2.03506872e-01  2.29132533e-01  5.20407915e-01 ... -1.50221422e-01
    -5.91884494e-01 -1.13071012e+00]
   [-3.95310462e-01 -1.65351987e-01 -5.67289114e-01 ... -1.05407429e+00
    -1.04542293e-01  1.64791539e-01]
   ...
   [ 1.15420245e-01 -8.86201680e-01 -3.15901458e-01 ... -1.36301506e+00
     5.49318671e-01 -4.97347325e-01]
   [ 7.79246926e-01 -1.03712702e+00 -2.66690522e-01 ... -4.91523236e-01
     2.68224776e-01 -1.82313216e+00]
   [-7.79594243e-01  7.24497363e-02 -6.75855279e-01 ...  1.58572525e-01
    -4.63986218e-01 -7.13471949e-01]]

  [[-6.84902072e-02  1.17284395e-01  9.45720077e-03 ...  1.16983928e-01
     2.29468510e-01 -2.02006340e-01]
   [-1.77271754e-01 -1.25168532e-01  3.06215249e-02 ...  1.73776150e-01
     1.93024516e-01 -4.17427152e-01]
   [ 1.13141048e+00  6.46047965e-02  6.12304509e-01 ...  6.82713807e-01
     4.14560944e-01  4.89982456e-01]
   ...
   [-7.60859847e-01 -6.77287042e-01  8.38192165e-01 ... -1.16839123e+00
     6.54332280e-01  8.83063078e-01]
   [-4.25647467e-01  6.24696687e-02 -7.40228295e-02 ...  1.47317827e-01
     2.25549757e-01 -4.28361118e-01]
   [-7.14251757e-01 -7.78464139e-01  5.80131650e-01 ... -6.18946135e-01
     7.07320750e-01 -3.92350078e-01]]]


 [[[ 5.70559502e-03  9.56466794e-01 -3.56151700e-01 ... -1.06465256e+00
     6.84228361e-01  3.47140431e-01]
   [ 8.57388914e-01  1.42940462e+00 -3.69078189e-01 ...  1.13511288e+00
    -1.56476474e+00  1.36357024e-01]
   [ 1.81996310e+00  7.06210732e-01  2.45785093e+00 ... -2.40274239e+00
    -1.02610230e-01  2.31381798e+00]
   ...
   [ 1.52180642e-02  5.47002733e-01 -1.74908972e+00 ... -1.32391214e-01
    -5.10451436e-01  1.11969039e-01]
   [ 1.35345447e+00  9.45069730e-01  6.73125267e-01 ... -1.41850531e-01
    -7.86145389e-01  9.98736203e-01]
   [ 7.52379715e-01  6.36168301e-01  3.35038841e-01 ... -1.26816010e+00
    -4.93728846e-01  1.55101109e+00]]

  [[ 9.72999483e-02  5.53266630e-02 -3.87374461e-02 ...  6.45228982e-01
     4.23890322e-01  3.68311167e-01]
   [ 8.40800777e-02  1.23026776e+00 -5.60181141e-01 ...  1.70937493e-01
     6.18017793e-01  8.62891138e-01]
   [ 7.12559342e-01 -6.20694816e-01 -8.99094880e-01 ...  5.45076132e-01
     1.11907506e+00  6.22640491e-01]
   ...
   [-8.56086388e-02 -6.98166192e-02  1.11343956e+00 ...  5.00373542e-01
     1.21833742e+00 -1.78220659e-01]
   [-3.64272565e-01  5.03598213e-01  1.84842646e+00 ...  4.24378961e-01
    -4.96588647e-01 -5.63682437e-01]
   [ 1.12644482e+00 -9.29217339e-01 -1.99002790e+00 ...  9.87443745e-01
     2.31144667e+00  8.29283297e-02]]

  [[-1.50685990e+00 -1.67208517e+00  2.27113795e+00 ...  1.41583467e+00
     8.55534256e-01  6.15527272e-01]
   [-8.80007982e-01 -1.44837415e+00  1.01270103e+00 ...  8.10308099e-01
     8.59812558e-01  2.65511245e-01]
   [-1.65780112e-02 -4.75166857e-01  9.24852788e-02 ... -6.67809173e-02
     3.43235850e-01 -1.34895861e-01]
   ...
   [-4.42181051e-01 -3.47821534e-01  1.47149295e-01 ...  2.86523491e-01
     5.08705497e-01  2.62003601e-01]
   [ 1.32479250e+00 -9.38562393e-01 -1.24117362e+00 ...  9.76965308e-01
    -9.13248539e-01 -9.77042735e-01]
   [ 1.10857463e+00 -1.07006872e+00 -3.02116036e-01 ...  4.23525602e-01
    -1.62581205e-01 -5.32076776e-01]]

  ...

  [[ 1.91695631e-01 -2.96176404e-01  2.58973300e-01 ... -6.74029812e-02
    -2.20467329e-01 -1.99662000e-01]
   [-3.40985000e-01 -1.35867405e+00 -1.70899391e+00 ...  1.64367139e+00
    -1.70082140e+00  8.78079951e-01]
   [ 9.35034394e-01 -2.96071720e+00  1.88783622e+00 ...  1.19549143e+00
     7.52544999e-01 -1.63154399e+00]
   ...
   [-1.75196782e-01 -1.84232533e+00  1.32671309e+00 ...  9.20204520e-01
     1.41514361e+00 -5.20415545e-01]
   [ 2.15378106e-01 -5.76373637e-01  4.04446751e-01 ...  3.05869430e-02
    -4.82417375e-01 -7.65913129e-01]
   [-8.28911006e-01 -4.92976815e-01  6.45134389e-01 ...  2.44562075e-01
     4.50153530e-01  1.05762982e+00]]

  [[-3.05087388e-01 -9.57886428e-02 -9.20094788e-01 ...  1.77456126e-01
    -4.82527018e-01  1.42573610e-01]
   [ 9.06276166e-01  1.37122214e+00 -5.66584587e-01 ... -2.48356968e-01
     5.22298038e-01  1.07604790e+00]
   [ 1.19811714e+00  6.71005607e-01 -8.65672827e-01 ...  2.09824145e-01
     3.47637862e-01  1.59054935e+00]
   ...
   [-6.89008296e-01 -4.28672463e-01 -8.28581989e-01 ...  1.22641587e+00
     2.17412561e-02  2.65776813e-01]
   [-5.39996810e-02  2.59761155e-01 -3.36953074e-01 ...  8.34278107e-01
     1.59479260e-01  1.19191992e+00]
   [-2.55547732e-01 -2.97574133e-01 -5.77007532e-01 ...  1.46270359e+00
     4.52154204e-02  5.14280975e-01]]

  [[ 1.90110791e+00 -1.25975406e+00 -4.24362391e-01 ... -1.96657658e-01
    -7.64629915e-02  8.15313280e-01]
   [-4.09044027e-01 -7.06083119e-01 -3.02731752e+00 ...  1.28400004e+00
     4.46721315e-01 -4.41026360e-01]
   [ 2.25087094e+00 -5.12103498e-01  1.07027447e+00 ...  3.13525975e-01
     6.17722631e-01  2.85349154e+00]
   ...
   [ 7.67546892e-01 -1.65940389e-01  1.20503259e+00 ...  1.40998080e-01
     4.89641279e-02  2.34444082e-01]
   [ 1.96823764e+00  1.37012050e-01  1.21077085e+00 ...  1.07611939e-01
     5.19524932e-01  1.78351903e+00]
   [-1.73432410e-01 -1.02902067e+00 -8.57874811e-01 ...  4.96811569e-01
     4.33061719e-01 -2.00361937e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-False-32-8-27-11-8] q.shape1: (8, 11, 27)
q.shape2: (88, 27)
q.shape3: (88, 27)
q.shape4: (8, 11, 27)
q_liner: [[[ 0.7224422  -0.4349445   3.4143314  ...  0.3524749   1.7550441
    1.3171579 ]
  [ 2.726345    1.2628067  -1.7939713  ... -0.06979546  0.00453782
    3.1302361 ]
  [-1.1040715  -0.15600364  1.9368501  ... -0.5825903  -0.65041417
   -2.2147686 ]
  ...
  [ 2.29157     0.908618    1.0856221  ... -1.3256541   0.30595994
   -0.84049827]
  [-0.40498114 -0.5691511   2.6631112  ...  0.8738295   0.4198153
    1.1513562 ]
  [-0.4481117  -0.92076814  3.5576978  ...  2.7185454   3.3272922
   -0.97112256]]

 [[-1.1616747  -1.7085901  -0.06308014 ... -0.84628963  0.9343368
   -0.6217179 ]
  [ 0.4018707   0.30482602  0.46497503 ...  0.11524689  0.10966628
   -0.6314564 ]
  [ 2.1810687  -1.1074287   1.3467315  ...  0.39241254  0.3339569
    0.5910638 ]
  ...
  [ 3.547802    0.51425123 -2.1266663  ... -1.1019756  -0.78907746
    2.1269357 ]
  [-1.6231765  -2.7684586   0.24566987 ... -0.25909057 -0.6573771
   -1.6647071 ]
  [ 2.5132887   0.55106294  0.7015406  ...  1.2227943   0.7392053
    1.8680627 ]]

 [[ 0.27821246 -1.1018684   1.7200263  ... -1.7082299  -0.4673362
   -2.2366893 ]
  [ 2.7587233   1.7226602   0.80260444 ...  1.1995286  -0.92798245
    0.2717521 ]
  [ 0.64558136  0.08447142  0.4400963  ...  1.3089368   1.2809186
   -1.5577403 ]
  ...
  [-1.0232698  -1.5747494   1.018051   ...  0.00518736 -0.4626458
    0.8344153 ]
  [ 1.1266454   0.38148978  2.193111   ... -1.535103    0.7982023
   -0.95043397]
  [-0.9965041  -1.8504593   1.8635492  ...  1.692321    1.8115427
   -0.7349715 ]]

 ...

 [[ 2.074959    2.2624094   0.34631863 ... -3.2463975   1.0677857
    1.5288497 ]
  [ 0.26497793  1.3373191   3.0214698  ...  0.41106525 -0.168928
    0.03355249]
  [ 0.5420742   1.2251356  -3.8265731  ... -0.34920886 -0.03093657
    0.798989  ]
  ...
  [-3.2419846  -1.4931114   0.72515845 ...  1.7054092  -0.04060049
   -2.0626805 ]
  [ 0.9767814   0.28908023 -1.5257838  ... -3.0712612  -0.89618737
   -0.34019688]
  [ 0.62380505  1.7282047  -0.0089727  ...  3.7021785  -0.5753088
    1.6830212 ]]

 [[ 2.0232098   0.64801407  0.06984086 ...  0.7552189   0.41255075
    0.56615067]
  [ 0.18463086  0.6487753  -2.7815037  ...  0.88175464 -0.71326035
   -0.08390006]
  [-1.9218032   0.28904673 -1.1362168  ... -2.5849714  -0.15884835
   -1.8206904 ]
  ...
  [-1.7156733  -0.79765487 -1.7961345  ... -0.48244846  1.5824316
    0.23448431]
  [-0.93504095 -0.5579304  -1.3916398  ... -1.322384   -0.33638978
   -0.6543722 ]
  [-3.1369116  -1.0516435   3.082999   ...  0.6630197   1.6387494
   -2.8189464 ]]

 [[ 0.5203575   2.510916   -2.5926096  ... -0.47947776 -2.6331599
    1.5112784 ]
  [ 0.2482923   0.10941231 -1.2460439  ...  1.8010229  -0.24936317
   -0.89507395]
  [-0.4074848   0.3564243   1.156305   ... -0.9337906  -0.32710424
    0.46405238]
  ...
  [ 0.8763598   0.15448405  0.44426623 ... -1.1368421   0.7098689
   -0.3491226 ]
  [-2.248125    0.22241627 -1.8704771  ... -1.2285389   0.29145718
   -0.22001871]
  [-1.0332358   0.15769057 -1.6133977  ...  0.13136601  1.1417925
   -0.2518325 ]]]
q.shape5: (8, 11, 256)
q.shape6: (8, 8, 11, 32)
attn_res: [[[[ 1.32303107e+00  1.85968608e-01 -1.08508587e+00 ...  2.22405100e+00
     7.79668540e-02  2.01804996e+00]
   [ 1.54855549e+00  1.70498800e+00 -6.58982933e-01 ... -7.09770620e-01
    -1.14412296e+00 -2.20730519e+00]
   [ 2.26489973e+00  9.85280633e-01 -6.79646969e-01 ... -5.68250954e-01
    -1.36451900e+00 -1.27132785e+00]
   ...
   [ 4.90406036e-01 -1.33343786e-02  6.89004138e-02 ...  6.43879175e-05
     4.11925130e-02  1.19329564e-01]
   [ 6.32343143e-02 -8.88042450e-02  1.50656432e-01 ... -5.70915937e-02
     4.51664813e-02  9.37323198e-02]
   [ 1.17152631e+00 -2.90623903e-01  1.50936007e-01 ...  1.38560355e-01
    -1.25924826e-01  5.69245040e-01]]

  [[-4.62468833e-01 -6.08880818e-01  1.53020024e-01 ...  6.17594719e-01
     4.66670185e-01  9.95308459e-01]
   [-8.81989062e-01  4.43131924e-01 -1.11338151e+00 ... -7.24680722e-02
    -4.45305973e-01  4.81044352e-02]
   [ 1.66897342e-01 -1.99924484e-02  4.63340491e-01 ...  3.22865009e-01
     9.13091481e-01 -1.65576696e+00]
   ...
   [ 5.79560772e-02  1.00676946e-01  5.71783006e-01 ...  1.13380246e-01
     1.50787389e+00 -2.07973552e+00]
   [-1.93574607e-01 -6.05136335e-01  4.06637430e-01 ...  3.09143335e-01
     6.77487373e-01  1.17979228e+00]
   [-1.00365806e+00 -4.57776725e-01  1.21661454e-01 ...  9.50923204e-01
     2.83565789e-01  1.36386895e+00]]

  [[-4.75502193e-01  8.86480629e-01 -8.43556643e-01 ...  8.54564905e-01
     5.85590720e-01 -1.76237607e+00]
   [-9.58506227e-01  7.52082288e-01 -5.00318348e-01 ...  1.39723933e+00
     3.39196384e-01 -1.45396531e+00]
   [-9.74781632e-01 -3.64511341e-01 -1.00890845e-02 ... -1.71686858e-01
    -1.10694021e-01 -1.74815208e-03]
   ...
   [-3.55618924e-01 -1.53855836e+00 -9.10613686e-02 ...  9.39438045e-01
    -8.76209438e-01  1.30394459e-01]
   [ 5.94221056e-02  4.79108632e-01 -9.29063737e-01 ... -4.94157881e-01
     9.21984673e-01 -2.42150545e+00]
   [-7.21229970e-01  7.48465776e-01 -6.55629158e-01 ...  2.16877013e-01
     5.59013069e-01 -8.77506845e-03]]

  ...

  [[-3.45347881e-01 -2.90303230e-01 -2.43714914e-01 ...  6.91129446e-01
     8.12446117e-01 -1.42997062e+00]
   [-1.02451849e+00  6.28892243e-01 -4.68929932e-02 ...  4.13124263e-03
    -3.54630560e-01  3.55470121e-01]
   [-4.07293469e-01 -1.22685695e+00  1.00342667e+00 ... -1.87549546e-01
    -7.29915798e-01 -6.13737702e-01]
   ...
   [-1.49780184e-01  2.09786296e-01  3.50444794e-01 ... -1.20256150e+00
    -1.01484191e+00 -5.29698789e-01]
   [ 2.10457310e-01  6.37697101e-01 -7.94094980e-01 ... -5.71121573e-02
     2.25213617e-01 -1.85330236e+00]
   [-1.56140119e-01 -2.12650627e-01 -6.35781065e-02 ...  3.12016934e-01
     7.71780550e-01 -1.69795740e+00]]

  [[ 1.35932207e+00 -6.79358393e-02  1.04293358e+00 ...  7.93566883e-01
    -7.87167609e-01 -1.74463943e-01]
   [ 1.51020694e+00 -1.35801494e-01 -9.39139307e-01 ... -3.27381223e-01
    -1.65913478e-01 -5.99586815e-02]
   [ 1.57173967e+00  2.41082460e-01 -1.05973315e+00 ... -3.86693776e-01
     2.34818786e-01 -5.90538699e-03]
   ...
   [ 1.68702292e+00 -1.35877520e-01 -5.09029865e-01 ... -2.95902908e-01
    -7.19078928e-02 -2.12848872e-01]
   [ 2.93582320e-01  2.31842190e-01  4.64747220e-01 ...  1.98142633e-01
    -1.71801195e-01  2.65972055e-02]
   [ 1.48073447e+00 -5.85172713e-01  1.02387798e+00 ...  6.38008177e-01
    -9.79755163e-01 -1.00138700e+00]]

  [[ 4.59588394e-02 -1.82579935e+00 -5.29224277e-01 ...  3.84725094e-01
     1.52986538e+00  1.64561284e+00]
   [ 4.62070435e-01 -9.02606726e-01 -6.59615278e-01 ...  8.94290328e-01
     6.13016486e-01  6.57865167e-01]
   [-7.04725146e-01 -6.11024983e-02 -4.21672642e-01 ...  3.03369552e-01
     6.07058644e-01  2.59703845e-01]
   ...
   [ 9.85697627e-01 -8.40068817e-01 -1.34553003e+00 ...  1.36015922e-01
     1.47577786e+00  2.67278761e-01]
   [-1.24002859e-01 -1.35161531e+00 -3.00833017e-01 ... -4.96065523e-03
     1.73258960e+00  1.72280848e+00]
   [-6.74949348e-01  4.50063527e-01  4.44862127e-01 ...  5.35951078e-01
     1.05374694e-01  7.23146439e-01]]]


 [[[ 3.04059297e-01  6.36527240e-01 -1.47335127e-01 ... -1.64772797e+00
     1.38766539e+00  3.00414234e-01]
   [-1.08648881e-01 -4.93292421e-01  5.58705747e-01 ...  1.07199036e-01
     2.51276314e-01 -6.89734459e-01]
   [-4.11073416e-01 -7.27829337e-01  4.24592733e-01 ...  4.74491656e-01
     3.71783584e-01 -6.42568827e-01]
   ...
   [-6.46759808e-01 -8.72481167e-01  6.61520600e-01 ...  1.15441263e+00
     2.96903551e-01 -6.45733923e-02]
   [-1.53754628e+00  2.50795722e-01  7.69520879e-01 ... -6.26937002e-02
     5.45903087e-01 -6.26733363e-01]
   [-8.18776727e-01 -3.19230705e-01  1.05404425e+00 ...  9.95668769e-02
     8.30182552e-01 -3.59932303e-01]]

  [[ 4.40795094e-01  1.28988671e+00  7.58541942e-01 ...  3.65957171e-01
     5.69417253e-02  2.52301276e-01]
   [-1.08037055e+00  4.13904577e-01 -1.64391935e+00 ... -1.54495016e-02
    -1.39699388e+00  4.09388304e-01]
   [-8.90330911e-01  5.46628237e-01  2.27509901e-01 ...  1.74999607e+00
     3.91845286e-01  2.82267749e-01]
   ...
   [-3.49271446e-01  1.62965104e-01 -1.07931823e-01 ...  5.92529178e-01
    -3.15000117e-03  2.89216340e-02]
   [ 1.97358221e-01  1.23628497e+00  4.68190968e-01 ...  9.07309413e-01
     4.92090613e-01  8.36678222e-02]
   [ 7.06823394e-02  4.60673809e-01  6.02925420e-01 ...  3.24921995e-01
     1.04718611e-01 -1.58913881e-02]]

  [[-5.57510734e-01 -5.09987891e-01  6.30468190e-01 ...  7.69963503e-01
     4.42240000e-01 -4.51951683e-01]
   [ 9.74367619e-01 -3.63871783e-01  1.63257882e-01 ...  3.90116483e-01
    -1.14126354e-01  9.46107507e-01]
   [ 8.74933541e-01 -2.29577079e-01  6.09138787e-01 ...  8.84460807e-01
     2.43378617e-02 -2.81008303e-01]
   ...
   [ 8.91624808e-01  4.08101797e-01 -4.37615141e-02 ... -1.60821930e-01
     1.67269006e-01  7.54083514e-01]
   [ 6.02795660e-01 -2.83727385e-02 -2.82450356e-02 ...  1.57923639e-01
     5.05919456e-01 -4.15483624e-01]
   [ 1.51768339e+00 -6.86108112e-01 -5.19433916e-01 ...  8.20886314e-01
    -1.61538243e+00  4.96454746e-01]]

  ...

  [[-1.57902575e+00  1.60392618e+00  4.98112470e-01 ... -3.06251025e+00
    -1.26948917e+00  1.17690742e+00]
   [-7.96128392e-01  6.86939299e-01 -7.49222040e-01 ... -7.10793793e-01
    -1.04385599e-01 -5.61846673e-01]
   [ 1.04798496e+00  2.49246627e-01  5.36281690e-02 ... -9.86391902e-01
     1.79934710e-01 -1.54566848e+00]
   ...
   [-9.74592101e-03  3.01074475e-01 -8.88849974e-01 ...  1.25127518e+00
     7.66667426e-01 -1.48682380e+00]
   [-8.39365199e-02  3.30495924e-01  2.08055228e-02 ... -4.31468099e-01
     9.75701809e-02 -4.90752488e-01]
   [-8.79599810e-01  5.56961596e-01 -2.73982048e-01 ... -8.26965213e-01
    -2.33744815e-01 -5.18603250e-03]]

  [[ 2.18177885e-01  3.75919998e-01 -1.73046052e-01 ...  3.12273473e-01
    -8.70147943e-01  4.43976849e-01]
   [ 1.49292004e+00 -4.42330390e-01 -5.02446830e-01 ... -5.19972861e-01
    -1.29072702e+00  1.83554709e-01]
   [-4.08912450e-01  4.46646847e-02  5.34598649e-01 ...  5.91553211e-01
     3.92279148e-01  3.50876898e-01]
   ...
   [ 4.40375626e-01 -3.40813577e-01  4.54079330e-01 ...  7.10333705e-01
     1.88737914e-01 -1.69086719e+00]
   [-3.33246142e-01  3.97727996e-01  8.45651627e-01 ...  3.75661701e-01
     4.40471530e-01 -2.92434156e-01]
   [-5.97713649e-01  7.07387149e-01  1.10987842e+00 ... -1.62755564e-01
     5.37062585e-01 -7.13493764e-01]]

  [[-6.25758708e-01  3.62787932e-01  4.90565240e-01 ... -2.00903863e-01
     1.03189516e+00  9.96129274e-01]
   [-5.56733012e-01  2.48509169e-01  1.31714070e+00 ...  6.55948937e-01
     5.42507827e-01  2.26573914e-01]
   [ 4.17039633e-01 -1.89683422e-01  1.58584988e+00 ... -3.41448665e-01
     7.44571924e-01  1.75883150e+00]
   ...
   [-6.01710975e-02  2.75276840e-01  7.05172479e-01 ... -1.32267982e-01
     8.54523242e-01  9.51952994e-01]
   [-4.58167970e-01  1.13799304e-01  6.38064981e-01 ... -1.06530622e-01
     3.37709397e-01  8.21551919e-01]
   [ 8.64298463e-01  9.02236819e-01 -3.70637118e-03 ... -7.55506337e-01
     1.51475930e+00  6.20114684e-01]]]


 [[[-8.79022419e-01 -1.41467452e+00  2.23258591e+00 ...  1.94698498e-01
     1.04598963e+00  6.99545503e-01]
   [-9.86165702e-01 -9.57527161e-01  1.32847703e+00 ... -1.31870836e-01
     2.25467658e+00  9.00838614e-01]
   [-6.74185753e-01 -7.33415365e-01 -6.17454171e-01 ...  8.45995903e-01
     5.77552244e-02  2.97775626e-01]
   ...
   [ 1.93728693e-03  4.90175933e-02 -2.34132051e-01 ... -3.29151034e-01
    -4.74755287e-01  8.12553346e-01]
   [-4.00807224e-02 -5.16615510e-02 -6.99891746e-02 ... -1.35391518e-01
    -2.40930453e-01  5.86221397e-01]
   [-4.77582842e-01 -7.56255865e-01  1.30282152e+00 ...  1.55566037e-01
     3.23009670e-01  6.84235692e-01]]

  [[-6.24801636e-01  9.66501296e-01  4.37519372e-01 ...  3.32718074e-01
     2.17932194e-01  7.02677906e-01]
   [-1.68360919e-01  9.06943753e-02  4.91727501e-01 ...  1.11228026e-01
    -2.22268224e-01  4.97780889e-01]
   [-5.88133931e-01  9.00355697e-01  1.44987869e+00 ...  9.09610271e-01
     2.35656708e-01  2.48194122e+00]
   ...
   [ 7.77949631e-01  3.28872204e+00  8.70770156e-01 ... -1.43624982e-02
     2.44648337e+00  5.80120504e-01]
   [-2.82438934e-01  1.42575848e+00  9.03268337e-01 ...  6.92423642e-01
     6.28143668e-01  1.52442932e+00]
   [-3.89264882e-01  7.67606795e-01  1.08027017e+00 ... -4.93159145e-01
     3.67084235e-01  2.04485178e-01]]

  [[-1.10404265e+00  1.46109998e+00 -3.15255940e-01 ... -2.82739133e-01
    -1.17372370e+00 -5.19764960e-01]
   [ 9.30377282e-03 -8.13819766e-01  4.69204485e-01 ... -5.37284195e-01
     1.92178845e-01 -6.03315175e-01]
   [-2.33284637e-01  1.09060454e+00  3.24554056e-01 ... -6.16126895e-01
     7.32649505e-01 -4.36240107e-01]
   ...
   [-1.24095702e+00  9.87018347e-01  5.07372737e-01 ... -3.30073312e-02
     4.08887029e-01 -1.93648800e-01]
   [ 3.25830489e-01  1.47535229e+00 -1.84479058e-02 ... -8.89459908e-01
    -4.46084470e-01 -5.53783298e-01]
   [-1.62954068e+00  2.98392117e-01  8.68432105e-01 ... -5.17879248e-01
     3.76725525e-01  1.06745446e+00]]

  ...

  [[ 4.08598959e-01  2.80427039e-01 -1.00325668e+00 ... -5.82214773e-01
    -1.95393950e-01  9.83802527e-02]
   [ 9.82815698e-02 -3.35006088e-01  6.76175058e-01 ... -9.77704823e-01
     4.94132370e-01 -4.61372852e-01]
   [-5.80664992e-01 -1.28677261e+00  9.77274656e-01 ...  1.97210126e-02
     1.38800931e+00  1.90443265e+00]
   ...
   [ 1.07414328e-01 -3.02135378e-01  1.16910316e-01 ... -1.78027675e-01
     5.39759338e-01  3.01955998e-01]
   [-1.15596578e-01  6.12482548e-01 -4.13266599e-01 ... -2.97797412e-01
    -4.64773998e-02  5.47683954e-01]
   [ 1.91729128e-01 -8.77790675e-02 -1.76413968e-01 ... -8.06268096e-01
     1.05495401e-01 -5.01971185e-01]]

  [[ 4.81504530e-01 -1.01415420e+00  4.48905021e-01 ... -6.51863635e-01
    -7.66830564e-01 -2.47298062e-01]
   [-4.82239544e-01 -1.07553160e+00  8.46548438e-01 ...  3.02726245e+00
     2.02926062e-02 -5.90119362e-01]
   [ 3.86009336e-01 -4.94855106e-01  1.06712270e+00 ...  1.83847040e-01
    -8.20840180e-01 -6.60138130e-01]
   ...
   [-1.99906945e-01 -2.62415886e-01  7.36988485e-01 ...  5.51186562e-01
     3.57344300e-02 -6.09054208e-01]
   [ 1.39235950e+00 -4.57720309e-02  1.08508074e+00 ...  2.61742145e-01
     7.53814816e-01 -6.40840113e-01]
   [ 1.20680678e+00 -7.25321412e-01  1.15869832e+00 ... -5.21722674e-01
    -2.63733178e-01 -1.01185131e+00]]

  [[-6.54650867e-01  1.00637460e+00  2.48776650e+00 ...  4.20675457e-01
     3.69114757e-01  1.05843115e+00]
   [ 8.87853801e-01 -2.77592325e+00 -1.22236061e+00 ...  2.14797020e-01
    -1.25969434e+00  1.80662632e+00]
   [ 6.17638290e-01 -7.71168351e-01 -2.71403372e-01 ...  2.96678454e-01
    -2.69155502e-02  1.16800451e+00]
   ...
   [-1.05702889e+00  9.26556587e-01  1.81083828e-02 ... -9.11841094e-01
     7.37722516e-02  4.74169403e-01]
   [-1.94785118e+00  9.49999094e-02 -4.34801340e-01 ... -1.68020892e+00
     1.42634958e-02  8.53957891e-01]
   [-1.21087205e+00  1.15588200e+00 -8.86267185e-01 ... -1.57509577e+00
     1.82912901e-01  4.10269886e-01]]]


 ...


 [[[ 1.15977049e+00 -4.09412861e-01  1.48405695e+00 ... -7.53775775e-01
    -1.01703799e+00  3.61025423e-01]
   [ 1.38718560e-01  2.12515667e-01 -9.63664889e-01 ... -3.29809457e-01
    -5.29660165e-01  2.82165229e-01]
   [-3.31119895e-01  1.47756949e-01 -6.51155889e-01 ... -8.84200633e-01
    -6.27739370e-01 -5.03793001e-01]
   ...
   [ 1.57433772e+00  6.88546956e-01 -8.08739126e-01 ... -2.51295996e+00
    -1.67946923e+00 -4.94304359e-01]
   [ 1.31234288e+00 -2.41307497e-01 -4.50911701e-01 ... -4.51289952e-01
    -2.52611339e-01  2.98069090e-01]
   [ 3.62168491e-01  1.25108421e-01 -5.76131582e-01 ... -5.00924706e-01
    -6.72146380e-01 -1.65072098e-01]]

  [[-2.02576965e-01 -2.64605641e-01  8.25169265e-01 ... -3.05398822e-01
    -3.06313276e-01 -1.08032823e+00]
   [-2.46477410e-01 -1.05542541e-02  1.89204931e-01 ... -4.76297498e-01
     6.02928817e-01 -7.89357364e-01]
   [-5.43843508e-02 -3.89494151e-02 -1.26538277e-01 ...  2.27159187e-01
     1.09570339e-01 -7.02760577e-01]
   ...
   [-1.84446931e-01  4.41441059e-01  5.06262422e-01 ...  1.41457915e+00
     1.47690189e+00  1.53099954e+00]
   [ 2.27047503e-02  5.60028017e-01  2.33857676e-01 ... -9.71095324e-01
     1.43273234e+00  2.26207376e-01]
   [ 2.41002068e-02  1.32405937e-01  2.67979145e-01 ...  1.27929568e+00
    -5.08562684e-01 -3.42044383e-01]]

  [[-3.25559437e-01 -2.82284170e-01  5.37566423e-01 ...  5.76528728e-01
     4.25012529e-01 -6.10143393e-02]
   [-1.52042675e+00  4.65396881e-01 -1.28776819e-01 ... -7.27964938e-01
     1.41712618e+00 -1.23530194e-01]
   [ 6.44123137e-01 -4.70986694e-01  1.29595205e-01 ...  2.06843600e-01
    -2.28968725e-01 -2.25278795e-01]
   ...
   [ 3.01245123e-01 -4.89055842e-01  8.36428776e-02 ...  3.57806176e-01
     4.05290812e-01 -6.69107556e-01]
   [-1.59116614e+00 -4.68234330e-01 -1.14620495e+00 ... -9.26573157e-01
     1.18211830e+00 -1.84426224e+00]
   [-8.89138103e-01  4.08153236e-02  6.50491774e-01 ... -2.50984788e-01
     5.41734099e-01  3.45794737e-01]]

  ...

  [[-3.55868101e-01 -6.42735898e-01  1.12180281e+00 ... -9.78620112e-01
    -1.28976715e+00  2.28035665e+00]
   [-1.91468930e+00 -2.50185043e-01 -4.67447072e-01 ...  1.23944432e-01
     2.87503421e-01  3.46171618e-01]
   [ 2.62528360e-01  1.12964308e+00 -4.13273633e-01 ...  7.68823326e-01
     3.97392839e-01 -3.10515016e-01]
   ...
   [ 6.03831327e-03  4.14950121e-03  8.27060454e-03 ... -1.62840672e-02
    -6.77257404e-03  1.85637502e-03]
   [-5.35861731e-01 -3.98371816e-01  1.17333758e+00 ... -1.19621658e+00
    -1.56615639e+00  1.96474040e+00]
   [ 2.00721651e-01 -2.12198228e-01  8.22655261e-01 ... -9.46224511e-01
    -4.34228718e-01  9.39361989e-01]]

  [[ 1.80850577e+00 -1.48149228e+00  3.66361402e-02 ... -3.26701999e-01
    -1.65997779e+00 -7.58520544e-01]
   [ 3.70507658e-01  6.09902292e-02 -7.06816554e-01 ... -4.96855170e-01
    -4.07051891e-02  6.53157055e-01]
   [ 2.44350410e+00  3.50738205e-02  4.52526867e-01 ... -1.11012399e+00
    -8.80962908e-01 -2.21076155e+00]
   ...
   [-1.01127958e+00 -8.40107560e-01 -4.52555656e-01 ...  5.25513232e-01
    -6.17511094e-01  4.94064152e-01]
   [ 1.92862570e-01 -6.44161999e-01 -3.92603129e-01 ... -1.09109618e-01
    -2.01839656e-02 -1.34724855e+00]
   [ 2.19546750e-01 -1.11321759e+00  2.51626015e-01 ... -2.15958178e-01
    -4.34738398e-01 -9.51468647e-01]]

  [[-4.77255940e-01 -2.96873152e-01 -4.76313084e-01 ...  5.83657995e-02
    -3.86613488e-01  7.45691478e-01]
   [-9.48200673e-02 -5.61402321e-01  2.58104235e-01 ... -2.09459037e-01
     5.22024572e-01  1.51162863e+00]
   [-9.82040465e-01 -1.83990002e-01  1.01871657e+00 ...  1.44926757e-01
     7.71354675e-01  1.46798205e+00]
   ...
   [-9.09148335e-01  4.91304457e-01  1.33214429e-01 ... -1.52300298e-01
     2.42598206e-01 -4.40416843e-01]
   [-1.77540994e+00  3.64887953e-01  5.18771112e-01 ... -4.80916768e-01
    -1.18146949e-01  8.16968083e-01]
   [ 6.49179816e-02  3.90921205e-01  1.01945497e-01 ...  5.53815424e-01
     4.23582196e-01  4.38757509e-01]]]


 [[[-1.54549813e+00  1.26078999e+00  3.40294659e-01 ... -1.01716888e+00
     4.83355999e-01  1.23326242e+00]
   [-1.32117033e-01 -2.21819353e+00  1.10607088e-01 ...  1.55947304e+00
     3.12268853e-01  2.23834300e+00]
   [ 2.05739713e+00 -5.84093034e-01  1.20432639e+00 ...  1.48603821e+00
    -7.65337348e-01 -7.21814811e-01]
   ...
   [ 1.03344762e+00 -1.17522895e+00  1.57944429e+00 ...  7.98684716e-01
     7.18353689e-03  9.89164948e-01]
   [ 5.18097997e-01 -2.27047086e+00  9.68055189e-01 ...  1.89052486e+00
     3.32221389e+00  1.16528141e+00]
   [ 1.58572602e+00 -2.54476047e+00  7.97629476e-01 ...  1.60725999e+00
     2.17554307e+00  1.06432796e+00]]

  [[-1.20746018e-02 -3.29022825e-01 -3.10007930e-01 ... -9.06812251e-01
     2.45611119e+00 -2.46953607e+00]
   [-4.89777535e-01 -3.61811191e-01  2.87460864e-01 ... -1.21013415e+00
     4.21874881e-01 -1.38790631e+00]
   [ 4.35454786e-01 -1.01825941e+00  5.11451364e-01 ... -1.60243750e+00
     3.16303223e-01 -7.64707565e-01]
   ...
   [ 4.05977428e-01 -3.50158274e-01  1.09851944e+00 ... -1.90380979e+00
     4.46837544e-01 -1.46673894e+00]
   [-5.90632200e-01 -4.86330330e-01 -2.16068938e-01 ...  1.71551555e-01
     5.97895622e-01 -9.85500634e-01]
   [-1.56680122e-01 -1.43146038e-01  1.01901734e+00 ... -1.27776182e+00
     6.55081809e-01 -6.93887293e-01]]

  [[-9.91693854e-01  8.25869262e-01  1.59935579e-02 ... -3.67825627e-02
     1.11219561e+00 -1.23609900e+00]
   [-8.04476142e-01  1.61779672e-01 -1.25835466e+00 ...  7.86570311e-02
     1.93743062e+00 -2.67697382e+00]
   [-6.37218714e-01  5.60451150e-01 -3.15911680e-01 ... -1.71001062e-01
     1.32591391e+00 -2.17534947e+00]
   ...
   [-1.62193060e+00 -4.38739479e-01 -9.11090314e-01 ...  2.17579156e-01
     8.02368641e-01 -2.31073594e+00]
   [-9.78792012e-01 -2.87287980e-01  7.10526288e-01 ...  8.48222673e-02
     5.03496081e-03 -9.10685539e-01]
   [-9.06024992e-01  1.06564665e+00 -3.67266983e-01 ...  9.62841153e-01
     1.28338207e-02 -1.61181641e+00]]

  ...

  [[-1.01978026e-01  7.36040771e-02  2.93091089e-01 ... -5.96999109e-01
    -8.20884168e-01  1.08209886e-01]
   [ 2.46468723e-01 -8.72801319e-02 -2.09658670e+00 ...  2.03521681e+00
     2.14516163e-01  6.70883775e-01]
   [-1.34537470e+00  1.25487339e+00 -1.12135267e+00 ... -3.19983453e-01
    -1.69297171e+00 -1.19589877e+00]
   ...
   [ 3.67408305e-01 -3.35258320e-02 -5.79468131e-01 ... -2.92085767e-01
    -7.37331808e-01  9.14923668e-01]
   [-1.57527253e-01 -4.61008310e-01 -9.06491101e-01 ...  5.37792981e-01
    -3.02565575e-01  2.13546351e-01]
   [-1.30411637e+00  9.17844713e-01 -9.17613089e-01 ... -1.01106417e+00
    -7.12455273e-01  1.05230466e-01]]

  [[-5.62288284e-01  5.42849451e-02  8.10115695e-01 ...  3.65317613e-01
    -8.38061035e-01 -1.19248509e+00]
   [ 5.28948784e-01  7.70974815e-01  7.46214986e-01 ... -1.72665811e+00
    -1.17414796e+00 -4.39747959e-01]
   [-1.10247803e+00 -7.19228759e-02  1.01330078e+00 ...  5.25126934e-01
    -1.10646403e+00  2.62538075e-01]
   ...
   [-7.03217983e-01  4.99204546e-01  8.35959613e-01 ...  2.94983149e-01
    -5.23310542e-01 -8.91649783e-01]
   [-2.25288719e-01  1.28203821e+00  9.35316026e-01 ...  7.00408340e-01
    -4.59897518e-03 -5.60342669e-01]
   [-2.71746248e-01 -4.78595614e-01  1.03931963e+00 ... -3.30825210e+00
    -1.75693142e+00  5.17006457e-01]]

  [[ 2.47535244e-01 -6.78856790e-01  5.95084429e-01 ...  6.04810789e-02
    -1.19059004e-01  1.27928376e+00]
   [ 6.96788609e-01 -1.61281049e+00  8.79633605e-01 ...  2.55791575e-01
    -8.22249174e-01  1.71692145e+00]
   [ 3.87603730e-01  2.11612391e+00 -7.41588175e-01 ... -6.82667941e-02
    -3.25612903e-01  5.19744515e-01]
   ...
   [ 4.07707512e-01  1.38768959e+00  6.15562201e-01 ...  9.40575063e-01
    -3.89918417e-01 -3.21556866e-01]
   [ 2.97075152e-01  1.30927050e+00 -1.54760635e+00 ...  3.08196306e-01
    -4.89582509e-01  6.68217599e-01]
   [ 5.42326212e-01  7.73510456e-01  3.81412923e-01 ...  6.84002876e-01
    -2.10783362e-01 -3.17981660e-01]]]


 [[[-1.51528347e+00 -1.47544849e+00  1.21930134e+00 ...  2.10377619e-01
     1.44775105e+00  1.46550155e+00]
   [-5.86764753e-01 -2.81878471e-01 -3.46677721e-01 ... -1.10298145e+00
    -1.78157520e+00 -2.00618103e-01]
   [-4.63834435e-01 -1.79562795e+00  6.52304232e-01 ... -2.26502299e-01
    -1.05772424e+00  4.90460008e-01]
   ...
   [-1.66229650e-01 -1.81947380e-01  3.46270472e-01 ... -2.15626180e-01
    -2.81594574e-01  2.89202988e-01]
   [-5.26000917e-01 -8.00060213e-01  1.19247951e-01 ... -3.54541123e-01
     2.60668457e-01  8.60242248e-01]
   [-3.62903953e-01  9.36302483e-01  1.01086056e+00 ...  6.90571964e-02
     3.19983542e-01  7.56695807e-01]]

  [[ 3.23335111e-01 -2.21100286e-01 -8.38937342e-01 ...  8.97746086e-01
     2.58016050e-01  4.04276550e-02]
   [-1.48306444e-01  1.92633599e-01  4.32318211e-01 ...  5.36582828e-01
     4.43488061e-01  2.23662890e-02]
   [ 2.11016685e-01  4.36678380e-01  9.13977325e-01 ...  2.29777908e+00
     9.84577537e-01  1.92808449e-01]
   ...
   [-1.04426754e+00  4.61784452e-01  1.15522945e+00 ...  1.20859206e+00
    -1.17587578e+00  1.81379724e+00]
   [ 4.05890167e-01 -7.16979861e-01  2.27823138e-01 ... -3.39175165e-02
     2.26076484e-01 -4.39359426e-01]
   [-3.63835096e-01 -9.42648292e-01  5.91055095e-01 ... -6.66119516e-01
    -2.03453824e-01  4.74575758e-01]]

  [[-8.29727352e-01 -5.52249908e-01  1.26785375e-02 ... -5.76329410e-01
    -1.37552768e-01 -1.81847587e-01]
   [ 6.58771098e-01 -5.70816696e-01 -2.04583973e-01 ...  1.79388964e+00
     4.32536721e-01 -1.50163639e+00]
   [-2.28278771e-01  1.42520154e+00  6.33420587e-01 ... -1.00156844e+00
     4.09036577e-01  1.75501645e-01]
   ...
   [-1.82006985e-01 -2.09998322e+00 -5.00310957e-02 ... -1.33447599e+00
    -1.64330816e+00 -1.85830265e-01]
   [-1.49546492e+00  6.37488008e-01 -3.17720354e-01 ...  1.92057014e+00
    -2.49394035e+00 -5.24155676e-01]
   [-8.37749481e-01 -9.04044926e-01 -4.68748987e-01 ... -3.24692160e-01
    -5.05455017e-01 -4.16478395e-01]]

  ...

  [[ 4.10545915e-01  2.57493526e-01  6.18768483e-03 ...  5.51923811e-01
    -3.57357204e-01  4.38439578e-01]
   [-3.11531454e-01 -1.19476795e+00  1.11211026e+00 ... -2.21140295e-01
     1.46610081e+00  1.21338379e+00]
   [ 6.52300060e-01  7.87011534e-02 -8.02716315e-01 ...  6.78363264e-01
     7.24432886e-01 -3.93950850e-01]
   ...
   [-3.88967484e-01  1.68006614e-01 -2.52337784e-01 ... -2.40337044e-01
    -1.93123609e-01  1.41796350e+00]
   [ 3.54855537e-01 -6.55580044e-01  8.54944348e-01 ... -5.34323812e-01
    -4.68589187e-01  1.29073143e+00]
   [-6.98896050e-02  2.51635104e-01  5.78953087e-01 ...  2.57540405e-01
    -1.19697464e+00  1.29433334e+00]]

  [[-1.60664010e+00  1.59030306e+00  1.44113827e+00 ...  5.03144622e-01
     3.78276467e-01 -1.61648959e-01]
   [ 4.02190328e-01  7.30962038e-01 -6.43795669e-01 ...  1.20302129e+00
     4.24712896e-01 -3.07951093e-01]
   [-1.57721305e+00  1.12526424e-01 -4.81703192e-01 ...  5.21702349e-01
    -9.12978590e-01 -1.86672699e+00]
   ...
   [ 1.19582856e+00  6.00591779e-01  6.92324400e-01 ...  2.18218112e+00
    -3.26418519e-01 -1.96972799e+00]
   [-1.23513079e+00 -1.44483221e+00 -6.61071688e-02 ... -5.19302666e-01
    -3.29158068e-01  1.85228631e-01]
   [ 3.33542302e-02 -9.96513247e-01 -1.30889583e+00 ...  6.85186148e-01
     3.63192767e-01 -7.24361062e-01]]

  [[-7.50788391e-01  1.42729437e+00  5.22316635e-01 ... -2.64449668e+00
     1.36785284e-01  2.80022526e+00]
   [-1.07193977e-01 -7.14000344e-01 -5.08456767e-01 ... -5.72184861e-01
    -7.22074747e-01 -1.92219448e+00]
   [ 1.21466085e-01 -1.76703870e-01 -1.16408575e+00 ...  3.66908282e-01
    -1.17115229e-02 -1.06762838e+00]
   ...
   [ 4.60827529e-01  2.53207497e-02  6.46683276e-01 ...  1.69284666e+00
     5.51289678e-01  2.36072391e-01]
   [-8.83454978e-02 -2.19856524e+00  1.03184231e-01 ... -1.61240697e-01
    -5.16649961e-01 -6.11337483e-01]
   [ 1.90829396e-01 -7.04484403e-01 -1.93689466e-01 ...  2.50799686e-01
    -4.41140652e-01 -2.41706327e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-True-32-8-27-5-4] q.shape1: (4, 5, 27)
q.shape2: (20, 27)
q.shape3: (20, 27)
q.shape4: (4, 5, 27)
q_liner: [[[-0.45098242 -1.8597655  -0.18044868 ...  0.44736165 -0.7812911
   -1.3717854 ]
  [-1.5089675  -1.1255506   0.2868886  ... -0.59291077 -4.2512317
    1.4017425 ]
  [-0.5946903   1.0263848  -0.581638   ... -2.404116    1.5132208
   -2.4856858 ]
  [-0.31688586  0.5528781  -0.47048947 ... -3.4016237   0.32389942
    0.792212  ]
  [ 0.5705429  -1.4638315  -1.4060916  ...  0.13239647 -0.5641086
   -0.13941243]]

 [[-0.48622677  0.58664197 -0.8507686  ... -1.5951675   0.925034
   -0.5789255 ]
  [ 0.01250784  0.25906408 -1.4820709  ...  0.27701774  0.5088146
   -1.5133849 ]
  [ 1.8713679  -1.6441332  -0.23689705 ...  1.4759529   0.59806687
    1.3676002 ]
  [-1.7826599  -0.49967122 -0.13877729 ... -2.3092782  -0.94425666
   -0.67025876]
  [-1.9854672  -0.1258095  -1.3325741  ... -1.2256528   0.3417048
   -1.306887  ]]

 [[ 0.08923486  0.40770042 -1.179379   ... -2.331579    1.0649294
   -1.4443758 ]
  [-0.9717777  -1.0941966   0.10684844 ... -1.3449765   1.5412539
    1.2202598 ]
  [-1.9089527  -0.49968353 -0.7305629  ... -0.31890056  0.05979536
   -0.012014  ]
  [ 0.8310763  -0.54699767 -2.0045776  ...  1.1674603  -0.8113642
    2.5285468 ]
  [-0.6054805   0.17777057 -0.3048614  ... -3.8101263   0.3146161
    0.12864286]]

 [[-1.0738884   0.71441424  1.0330291  ...  2.1741905  -0.05606912
   -2.2165117 ]
  [ 2.8600929   2.6552117   1.1548573  ...  0.5743336  -0.509936
   -1.0215002 ]
  [-0.7602025  -2.2237754  -0.00880858 ... -1.8565426   0.769028
    1.1017362 ]
  [ 0.56063324  2.2217884   1.0828177  ...  1.7795794  -0.57600886
    1.1000314 ]
  [-0.13495904 -2.4847577  -0.8736484  ... -0.4826979   0.6778818
    1.9465017 ]]]
q.shape5: (4, 5, 256)
q.shape6: (4, 8, 5, 32)
attn_res: [[[[-3.11466146e+00 -4.94310409e-02  2.41583332e-01 ... -5.47118604e-01
    -7.93433428e-01 -1.44048834e+00]
   [-1.54133439e-01 -5.38820386e-01 -2.57655978e-01 ...  1.10009098e+00
    -1.65995216e+00 -1.48950541e+00]
   [-3.64273429e-01 -1.24552703e+00  1.04929358e-02 ...  6.04958475e-01
    -4.68437016e-01 -1.40291762e+00]
   [-3.58640134e-01 -7.59201050e-01 -7.56588936e-01 ... -4.97009680e-02
    -7.98570812e-02 -2.42486984e-01]
   [ 7.26029336e-01 -1.85659361e+00  7.48339593e-02 ... -5.92214882e-01
     6.36798441e-01 -3.18572760e-01]]

  [[ 7.10569501e-01  1.27802145e+00  3.61967421e+00 ... -3.83061856e-01
    -7.87928224e-01  2.98055261e-01]
   [-1.52036715e+00  1.23150754e+00  1.62441552e-01 ...  1.51386768e-01
     1.39424396e+00 -1.07207119e+00]
   [-2.28761137e-02  1.41092753e+00  2.00461555e+00 ... -2.53508806e-01
     1.64330900e-01  2.38279514e-02]
   [ 9.82197672e-02  1.10592890e+00  8.16541493e-01 ...  1.86128557e-01
    -3.68099749e-01  1.24618568e-01]
   [-2.23779416e+00  1.26761422e-01 -2.59378457e+00 ... -2.66857624e-01
    -6.14225209e-01 -9.11136508e-01]]

  [[ 8.99731874e-01 -1.07991453e-02  1.42772889e+00 ... -1.69819966e-01
     1.02373290e+00 -7.14466751e-01]
   [ 1.17343092e+00  3.11095476e-01  1.36215556e+00 ...  2.87827909e-01
     7.72627831e-01 -4.84830737e-01]
   [ 7.31312931e-01  1.21530458e-01  1.38633668e-01 ...  1.78513980e+00
     1.17226943e-01 -7.24777102e-01]
   [ 2.10355833e-01  1.22138962e-01  4.42859679e-02 ...  3.60352397e-01
    -3.46193761e-02 -3.41845006e-02]
   [ 6.05590343e-02  3.29559863e-01 -1.59163773e-01 ...  1.47683656e+00
    -2.33353421e-01 -3.06560755e-01]]

  ...

  [[ 1.42704010e-01  2.50247121e+00  6.64162517e-01 ...  7.44760454e-01
     3.16121960e+00 -3.60760748e-01]
   [ 1.03162535e-01  1.80906820e+00  4.80131537e-01 ...  5.38396776e-01
     2.28528571e+00 -2.60798514e-01]
   [-6.79503500e-01  1.34643376e+00  1.26748252e+00 ...  2.48357916e+00
     3.92316699e-01 -3.16055822e+00]
   [-6.57318711e-01  1.25533545e+00  1.19117737e+00 ...  2.33801246e+00
     3.23889941e-01 -3.00710702e+00]
   [-1.45901513e+00 -3.98268759e-01  1.23138571e+00 ... -1.56149244e+00
    -2.58101940e+00 -5.43274730e-02]]

  [[-5.22160172e-01  7.45041132e-01  3.46485704e-01 ... -2.68873048e+00
    -5.65279007e-01 -1.05369818e+00]
   [-5.07040858e-01 -2.46965349e-01  3.64371121e-01 ...  1.21229160e+00
     4.52636182e-01  6.64585233e-01]
   [-5.00843644e-01  6.52726054e-01  3.34121644e-01 ... -2.33510303e+00
    -4.78317827e-01 -9.03026521e-01]
   [-5.64396322e-01 -6.39362752e-01  3.46254647e-01 ...  3.57830554e-01
     1.74194288e+00  6.35067880e-01]
   [ 4.92983460e-01  2.17557743e-01  3.73952359e-01 ...  3.90747845e-01
     1.19848943e+00  8.25131595e-01]]

  [[ 1.25885761e+00  2.37093225e-01  1.50933599e+00 ...  1.53495157e+00
    -1.97094440e+00 -5.07596135e-01]
   [-1.00335419e+00 -1.30772603e+00 -3.62629056e-01 ... -1.74420285e+00
    -1.00987196e-01  3.68744135e-04]
   [ 5.24201632e-01 -4.69438970e-01  1.35764885e+00 ...  5.38626909e-01
    -1.29833162e+00 -4.25298244e-01]
   [-1.67635417e+00 -1.56757116e+00 -9.96847212e-01 ... -3.09978390e+00
     3.47793698e-01  7.86297381e-01]
   [-1.68750063e-01 -1.01170731e+00  9.97951448e-01 ... -4.34022367e-01
    -7.33024001e-01 -2.91181833e-01]]]


 [[[ 1.98240435e+00  2.36497116e+00  9.78775024e-01 ...  6.22272015e-01
    -5.47697902e-01 -8.65370750e-01]
   [-9.20032442e-01  6.39004111e-01 -1.98978472e+00 ... -2.13265514e+00
     2.22274208e+00  1.59752035e+00]
   [-7.13431895e-01 -5.32400668e-01 -5.81681311e-01 ... -1.64823437e+00
     1.78782392e+00  1.11341131e+00]
   [-1.67085683e+00  7.69821763e-01  3.10821116e-01 ... -2.63037014e+00
     2.12040615e+00 -4.81274426e-01]
   [-7.11710334e-01  1.37123084e+00 -4.24893111e-01 ... -1.79182231e+00
     2.00568295e+00  9.13706422e-03]]

  [[-8.22070420e-01 -3.10668159e+00  1.32660973e+00 ...  1.79480159e+00
    -1.47816098e+00 -7.83999622e-01]
   [-3.85663927e-01 -2.28435469e+00  1.06179082e+00 ...  1.89647532e+00
    -1.42230904e+00 -4.85296309e-01]
   [ 4.64669496e-01  4.23306823e-01 -4.16204743e-02 ...  6.85007393e-01
    -3.39180470e-01  2.53784627e-01]
   [-5.75804472e-01  1.54159713e+00  1.27917960e-01 ...  1.42353606e+00
    -4.08685297e-01  1.20055330e+00]
   [ 6.48671389e-02 -1.17038295e-01 -1.80253237e-01 ...  1.35275900e-01
    -2.98758090e-01 -1.88518316e-02]]

  [[-2.48900366e+00 -1.79340494e+00  1.46385956e+00 ... -4.25349522e+00
     8.31379294e-01 -1.33566844e+00]
   [-1.91511142e+00 -1.11322999e+00  1.39523792e+00 ... -2.31934881e+00
     5.93779922e-01 -8.32190275e-01]
   [-1.35679638e+00  1.17934239e+00 -1.08496904e+00 ...  3.04682016e+00
     1.72471225e+00 -2.00169635e+00]
   [-2.34681892e+00 -1.66831768e+00  1.35971653e+00 ... -3.95463753e+00
     7.97538340e-01 -1.27326810e+00]
   [-6.16988778e-01  8.17987144e-01 -1.21185040e+00 ... -2.54861981e-01
     1.86149514e+00 -1.82174730e+00]]

  ...

  [[ 5.76521516e-01 -3.92353088e-01  1.43735814e+00 ... -1.18458247e+00
    -2.28447413e+00  7.48841465e-02]
   [ 7.80181289e-01 -4.10023540e-01 -6.32057562e-02 ...  7.83332705e-01
    -1.88871014e+00  1.06960392e+00]
   [ 7.44099796e-01 -4.10895854e-01  1.97392896e-01 ...  4.58842158e-01
    -1.94836175e+00  8.86235297e-01]
   [ 7.96470881e-01 -2.88415670e-01  2.96488851e-01 ...  7.64555454e-01
    -1.29488158e+00 -1.11680269e-01]
   [ 1.94414103e+00  1.13342083e+00 -5.95713973e-01 ... -2.97990501e-01
    -1.32569396e+00 -1.22430027e+00]]

  [[ 2.91115791e-01  6.50435328e-01 -6.58972085e-01 ... -3.63634765e-01
     7.90442467e-01 -3.40523809e-01]
   [-1.49780381e+00 -2.08001882e-01 -1.05220723e+00 ... -1.61240602e+00
     1.49100006e+00 -5.40977359e-01]
   [-2.62271500e+00 -7.56966531e-01 -1.28651452e+00 ... -2.38749290e+00
     1.91530311e+00 -6.60333991e-01]
   [-1.58377874e+00  1.31747568e+00 -9.54088807e-01 ... -6.58811569e-01
    -4.80027974e-01  4.32858944e-01]
   [-1.33591342e+00  3.85393769e-01 -1.93275487e+00 ... -1.23643827e+00
    -9.63086128e-01  1.89173400e-01]]

  [[ 2.14759254e+00 -1.80004883e+00  1.37028837e+00 ...  8.66574943e-01
     6.01693988e-01 -1.68666077e+00]
   [-1.71106982e+00  3.06991863e+00  9.88401234e-01 ...  6.16316557e-01
     1.84107311e-02  2.30640459e+00]
   [ 1.20016384e+00 -1.53058743e+00  1.51128340e+00 ... -4.45940554e-01
    -4.42037284e-02 -9.69887257e-01]
   [-6.57856941e-01  3.50679815e-01  1.17873454e+00 ...  2.36186552e+00
     6.05038166e-01  6.33920968e-01]
   [ 1.70622140e-01 -8.15773368e-01  1.14553976e+00 ...  1.38449168e+00
     7.17540979e-01 -1.73747897e-01]]]


 [[[-3.67517084e-01 -1.40418863e+00  1.02650535e+00 ... -8.60561490e-01
    -9.43708777e-01 -1.32589245e+00]
   [-3.50008190e-01 -1.41935909e+00  9.73468006e-01 ... -8.46074045e-01
    -8.86522770e-01 -1.27177203e+00]
   [ 7.83082724e-01 -2.00344682e+00 -1.88881493e+00 ... -3.88607159e-02
     2.34341359e+00  1.77701211e+00]
   [ 3.90875071e-01 -7.95274675e-01  7.76221037e-01 ... -6.76689148e-01
    -1.26490891e-01 -5.77881634e-01]
   [ 4.48033333e-01 -1.60959446e+00  6.72407508e-01 ... -5.22725344e-01
     1.60026968e-01 -2.72072732e-01]]

  [[-5.39161026e-01  2.96989173e-01 -8.23955461e-02 ... -6.77895188e-01
    -4.52504814e-01  2.29103971e+00]
   [-1.60945266e-01  3.41772228e-01 -3.24435890e-01 ... -7.07404852e-01
    -4.33353424e-01  2.01006436e+00]
   [ 5.02131045e-01 -8.21846485e-01 -4.07579750e-01 ... -1.35958540e+00
    -2.11586237e-01  4.77948070e-01]
   [ 2.66448617e+00  6.79302812e-01 -2.13107491e+00 ... -9.20728564e-01
    -2.85683483e-01 -1.00039862e-01]
   [ 6.31718993e-01  3.17180109e+00  1.69111061e+00 ...  1.05471337e+00
     2.11248803e+00 -2.32341504e+00]]

  [[-8.56066644e-01 -1.59382463e+00 -1.08180845e+00 ...  1.21520996e+00
     9.94748652e-01 -5.53020239e-01]
   [-1.76135436e-01 -2.28271276e-01 -4.72627223e-01 ...  1.80150032e-01
     4.68134880e-02  6.29733086e-01]
   [-1.88834727e+00 -2.08168387e-01 -1.53490007e+00 ...  9.86128151e-01
    -2.65212834e-01  1.54030891e-02]
   [ 2.15790629e-01 -2.12610364e-01  7.00282872e-01 ...  2.04680228e+00
     1.92528412e-01 -9.17614102e-01]
   [ 6.62457287e-01  4.29701596e-01  1.56273031e+00 ...  1.69965744e+00
    -1.44403803e+00  2.66536236e+00]]

  ...

  [[-1.50541615e+00 -2.24150801e+00  1.67806053e+00 ...  4.03206974e-01
     1.34031808e+00  5.02510607e-01]
   [-9.32889700e-01 -8.62455845e-01  8.38189185e-01 ...  9.62813437e-01
     1.94562030e+00  2.70830959e-01]
   [-1.28229856e+00 -2.16257834e+00  1.67762601e+00 ...  6.09024405e-01
     1.27218783e+00  1.50803059e-01]
   [-1.68889821e-01 -5.31104028e-01  4.64334905e-01 ...  3.46396685e-01
     3.03183556e-01 -2.53575593e-01]
   [-7.98607647e-01 -1.12384450e+00  1.06819260e+00 ...  1.07787192e+00
     1.48929131e+00 -7.29528069e-02]]

  [[ 1.16975546e+00  8.52428302e-02  7.00532615e-01 ... -5.54131389e-01
     1.03104329e+00 -2.38283873e+00]
   [ 4.80588436e-01  3.50216106e-02  2.87810475e-01 ... -2.27662206e-01
     4.23599184e-01 -9.78977919e-01]
   [ 2.71763325e+00  2.49664378e+00  1.31095922e+00 ...  8.35702002e-01
    -9.26792443e-01 -2.75247335e+00]
   [ 2.69006920e+00  2.46882892e+00  1.30883682e+00 ...  8.16583693e-01
    -9.15813386e-01 -2.75827241e+00]
   [ 7.16917217e-02  6.83280006e-02  6.26585186e-02 ...  1.55312018e-02
    -6.72882199e-02 -1.15202926e-01]]

  [[ 2.07357049e+00 -1.09168756e+00  1.14507961e+00 ...  1.32363662e-01
    -1.93942094e+00 -1.73903358e+00]
   [-2.94298863e+00  1.69582337e-01 -8.43151629e-01 ... -5.66726983e-01
    -1.32100856e+00  1.06696236e+00]
   [-4.92901444e-01 -1.58708179e+00  8.91523838e-01 ... -1.62351084e+00
     9.63014662e-01 -1.80368280e+00]
   [ 9.54022586e-01 -6.81930602e-01  6.33362889e-01 ... -3.19842026e-02
    -1.18372190e+00 -9.96273160e-01]
   [-2.04285574e+00 -5.96802056e-01 -1.70076281e-01 ... -1.13081503e+00
    -2.33273029e-01 -1.40712768e-01]]]


 [[[-1.36539137e+00  3.99001908e+00  1.82504916e+00 ...  2.71722054e+00
    -2.13403320e+00 -1.27270496e+00]
   [ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [-8.86147141e-01  3.31521034e+00 -1.27382085e-01 ...  2.10838199e+00
    -9.06850219e-01  5.18912554e-01]
   [ 6.41727448e-01  2.78321505e-01  8.15137386e-01 ...  4.87079024e-02
    -7.19946027e-01  2.27760687e-01]
   [ 4.04710233e-01 -2.65437961e-02  2.85599291e-01 ...  7.40594864e-01
    -4.04161513e-01 -4.56608295e-01]]

  [[-1.72874475e+00 -1.38999552e-01 -1.50308096e+00 ... -2.18552518e+00
    -9.65826631e-01  8.21308792e-01]
   [ 1.63499987e+00 -1.22317410e+00 -1.23824048e+00 ... -1.87219787e+00
    -3.46480656e+00  4.96511340e-01]
   [-1.54298460e+00 -1.09050393e-01 -1.43105125e+00 ... -2.07192755e+00
    -8.65790546e-01  7.70116448e-01]
   [ 9.80269015e-02 -7.82336295e-01 -1.30364275e+00 ... -1.72589338e+00
    -2.21849513e+00  3.31898391e-01]
   [-8.99632275e-02 -2.79522657e-01 -3.81900430e-01 ... -1.61646873e-01
    -4.30355549e-01 -3.61046910e-01]]

  [[-3.83048654e-01 -1.34622440e-01  5.23657799e-01 ...  2.00962257e+00
     4.01713371e+00  1.50391030e+00]
   [-3.14454079e-01  7.15992987e-01  4.84121084e-01 ... -1.46193862e-01
     2.25698185e+00  1.41382360e+00]
   [-1.43309623e-01  7.82568574e-01  3.17028403e-01 ... -9.00348306e-01
     6.60269737e-01  8.19622993e-01]
   [-2.93400913e-01 -2.19061971e-03  6.31414831e-01 ...  1.78829849e+00
     3.40895224e+00  1.32216954e+00]
   [-8.20430741e-03  8.44088733e-01  1.22677314e+00 ...  2.98329592e-01
     8.07276294e-02  3.69226217e-01]]

  ...

  [[-3.43964887e+00  1.76468015e+00 -4.91847396e-01 ... -2.94439578e+00
     6.36550365e-03 -2.25371647e+00]
   [-1.34280777e+00  1.11434042e+00 -2.17567042e-01 ... -2.61773396e+00
     1.16411424e+00 -1.89793909e+00]
   [-9.98304844e-01 -2.01299369e-01  2.06421614e+00 ... -2.28251958e+00
    -5.32288015e-01  1.19722843e+00]
   [-4.48342085e-01  4.94553089e-01  7.22635567e-01 ...  1.14879727e+00
     1.62489223e+00 -2.03462154e-01]
   [-7.67377853e-01 -6.41115010e-03  1.42898476e+00 ... -8.76620710e-01
     4.08493668e-01  5.40638685e-01]]

  [[ 2.49081564e+00  4.08738703e-01  2.92430669e-01 ...  1.94235575e+00
    -1.04949760e+00  3.23688793e+00]
   [ 2.38345766e+00  4.66665506e-01  2.88687050e-01 ...  1.91100168e+00
    -1.01226544e+00  3.14875865e+00]
   [ 2.71513194e-01  1.22993886e-01  4.10767756e-02 ...  2.66099095e-01
    -1.22710764e-01  4.06194121e-01]
   [ 2.39906955e+00  3.42722625e-01 -8.36197138e-02 ...  1.56130803e+00
    -1.00723588e+00  2.62545633e+00]
   [ 6.47639930e-01  4.78892833e-01 -1.17043900e+00 ...  3.30699980e-01
    -8.46445858e-01  1.55148673e+00]]

  [[-3.54359835e-01 -8.07993233e-01 -1.71507084e+00 ...  8.07633817e-01
     1.32376218e+00  1.29001415e+00]
   [-2.47105050e+00  6.66096926e-01 -6.42035842e-01 ...  2.40999952e-01
     1.53816772e+00  2.07757878e+00]
   [-6.61912501e-01 -4.33638841e-02 -5.70384145e-01 ...  2.54325151e-01
     6.82826400e-01  8.00044119e-01]
   [-3.89981180e-01 -5.16794562e-01 -1.28948677e+00 ... -1.43740261e+00
    -5.26798487e-01  1.43265992e-01]
   [-2.11889192e-01 -7.22048700e-01 -1.46256351e+00 ... -1.46668768e+00
    -3.91462564e-01  3.02780867e-02]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-True-32-8-27-5-8] q.shape1: (8, 5, 27)
q.shape2: (40, 27)
q.shape3: (40, 27)
q.shape4: (8, 5, 27)
q_liner: [[[ 0.15200195  0.42109513  0.18947552 ... -1.7429332  -0.884225
   -0.31648648]
  [-0.7228274   0.49029985  0.58301187 ...  2.1885214  -0.0600438
    2.0428016 ]
  [-0.5260736   0.6122724   1.230041   ... -2.247764    0.22396035
   -1.7408255 ]
  [ 0.3971978   0.6543124   0.09537844 ...  1.0527573   2.5283172
    1.3539605 ]
  [-2.2944772  -1.2713732  -0.40413117 ... -2.6895072   1.2463971
    1.2484484 ]]

 [[-1.1593062  -0.88011456 -1.8108406  ... -1.7323458   1.1656864
   -0.8288701 ]
  [ 0.9558412  -0.23498295  2.5545676  ... -3.0560331  -2.0548534
   -2.2333834 ]
  [-1.7470472  -2.397768   -2.3310997  ...  0.24311645 -0.14915928
    0.7152957 ]
  [ 0.8987072   1.1873528  -0.1076384  ...  2.544962    0.67048955
    0.5840135 ]
  [ 2.0645623   0.3715976   0.32978135 ...  1.3476607   0.29302907
   -0.27270532]]

 [[-0.00490406 -0.09373393  1.1604989  ... -0.68984926  1.4405506
    0.73424846]
  [-0.04013184 -0.74264437  0.7171273  ...  0.84781003 -0.8189953
    1.0422674 ]
  [ 1.3068575   1.0912939  -0.5706339  ...  0.6620283   0.5126465
    1.2609537 ]
  [-1.4994876   1.0570574  -2.6855764  ...  1.9866219   1.5518488
   -0.75737226]
  [ 1.1151257  -2.2495382   0.6445344  ... -1.7265897  -0.9692527
    1.5563262 ]]

 ...

 [[-1.2600608   0.42844266 -1.0461015  ...  0.44042793  0.8438229
    0.35004798]
  [-0.80994964  0.90170777 -1.5636967  ...  1.9153154   0.15813263
    0.75824195]
  [-0.41504437  0.5501679  -0.46502814 ...  1.3531638   0.20270535
   -1.1872677 ]
  [-2.140977   -1.8058906  -2.5433607  ... -1.3188152  -0.21092741
    3.014104  ]
  [ 0.30165464 -1.7570784  -0.5276766  ... -0.95511556  0.6305223
    2.6884043 ]]

 [[ 0.54159     2.0929532   1.2214144  ...  1.3534613  -2.23457
   -3.0139523 ]
  [-0.41575354  1.8297943   0.4623497  ... -0.0106837   0.28909513
   -1.1019404 ]
  [ 1.7901554  -2.319938    0.07372504 ...  1.7785084  -2.0408728
   -0.50145024]
  [-3.2801118   0.87907857  1.1032302  ...  1.169682    2.623778
   -2.4771414 ]
  [ 2.188267    2.8574073   1.3916485  ... -0.65159106  0.6747604
   -2.50303   ]]

 [[-0.28694752  0.1963344   1.8981187  ...  1.5710845  -1.9368709
    0.45920575]
  [ 1.1749982   0.24199866 -1.4054803  ...  0.47076377  0.1422315
    2.097656  ]
  [ 1.5478255   2.0425947   0.88846236 ... -1.2721353  -1.8794543
   -1.3773707 ]
  [-0.5135738   1.8262048   0.93603    ... -1.289328    1.1409359
   -3.309046  ]
  [-0.5917451   1.1871253   0.05737558 ...  2.3166168   0.72268176
    1.4457974 ]]]
q.shape5: (8, 5, 256)
q.shape6: (8, 8, 5, 32)
attn_res: [[[[-2.85531402e-01  2.69219112e+00 -7.05115914e-01 ... -2.20056581e+00
    -1.42207849e+00 -1.50255430e+00]
   [-6.32570863e-01  1.76571095e+00 -4.64480221e-02 ... -1.14658070e+00
    -4.14379895e-01 -2.16780901e-02]
   [-3.13729465e-01  2.60178256e+00 -6.67155921e-01 ... -2.16729879e+00
    -1.35023594e+00 -1.52036238e+00]
   [-9.84656453e-01  7.61677384e-01  6.28505826e-01 ... -7.17819408e-02
     6.34186149e-01  1.41396189e+00]
   [-1.51927340e+00 -9.22151446e-01  1.73579943e+00 ... -7.86341190e-01
    -2.56200814e+00 -1.83339521e-01]]

  [[-3.77448559e+00  7.22709358e-01 -8.97636414e-01 ...  9.43689644e-01
     5.43996215e-01 -1.92996919e+00]
   [ 7.13844717e-01 -8.01756620e-01  1.20674932e+00 ...  2.63547838e-01
    -1.71980464e+00  2.24513197e+00]
   [-3.60838938e+00  6.15327179e-01 -9.31630433e-01 ...  8.98586392e-01
     4.57177609e-01 -1.67624986e+00]
   [-7.51432002e-01 -2.75024652e-01 -5.28424740e-01 ...  4.09465253e-01
    -4.96362865e-01  1.15575814e+00]
   [-4.83743519e-01 -1.88921642e+00  2.34787488e+00 ...  1.00146428e-01
     7.23218322e-01 -8.22386980e-01]]

  [[ 1.98329806e+00 -2.41091871e+00  5.08558631e-01 ... -2.54115391e+00
     2.47379947e+00  7.55731985e-02]
   [ 1.82857132e+00  4.29029137e-01 -9.30722117e-01 ...  7.73959637e-01
    -1.34891343e+00  4.96356821e+00]
   [ 1.98063052e+00 -2.39932299e+00  5.02750635e-01 ... -2.52799749e+00
     2.45820856e+00  9.48263556e-02]
   [ 8.55044603e-01  1.34234822e+00 -7.73616135e-01 ...  1.31956375e+00
    -9.07663852e-02  8.06150794e-01]
   [ 1.85538530e+00 -1.15247035e+00 -8.48981291e-02 ... -1.11463153e+00
     9.58380938e-01  1.81480324e+00]]

  ...

  [[-6.25429690e-01  6.63461566e-01 -3.00163245e+00 ...  6.27778769e-02
    -2.25764871e+00  8.06122601e-01]
   [-4.13066149e-02  6.68922007e-01 -2.35185766e+00 ... -3.56462859e-02
    -1.92940390e+00  9.97143984e-01]
   [ 2.26247668e-01  7.79640913e-01 -2.84591913e-02 ... -3.89249742e-01
    -1.12013721e+00  1.63795137e+00]
   [-6.13659441e-01  8.79813910e-01  2.06932500e-02 ... -3.10365289e-01
    -1.27923238e+00  1.46296525e+00]
   [ 8.90627801e-01  1.10978305e+00  2.63335288e-01 ...  1.23735331e-01
    -8.96514416e-01  6.44213378e-01]]

  [[ 3.14210415e-01  6.14732265e-01 -1.81110144e+00 ... -2.07979038e-01
    -3.98098540e+00  1.43709564e+00]
   [-5.86282015e-01 -8.06381404e-01 -1.68956876e-01 ...  2.56739780e-02
    -3.03501177e+00  2.00216556e+00]
   [ 2.23912549e+00 -6.07160270e-01  1.01277567e-01 ... -8.60611916e-01
    -4.74129796e-01  1.76457572e+00]
   [-7.76195168e-01 -1.57274294e+00  8.21185768e-01 ...  1.18154609e+00
     8.45841587e-01 -7.61916637e-02]
   [ 9.05523121e-01 -4.19143766e-01 -5.88508368e-01 ... -4.08015281e-01
    -1.37996030e+00  1.36521542e+00]]

  [[ 2.03462052e+00 -4.06877708e+00 -5.07656872e-01 ...  3.58838916e+00
     5.27664423e-01 -3.68832159e+00]
   [ 6.17804348e-01 -2.99872231e+00  3.61175895e-01 ...  1.64964616e+00
     5.53493977e-01 -2.11224365e+00]
   [ 1.20093334e+00 -2.59716463e+00 -1.27141130e+00 ...  2.75666738e+00
    -4.75203395e-02 -2.67876077e+00]
   [ 1.32761049e+00 -1.78774285e+00 -5.41534603e-01 ...  2.22842240e+00
    -9.86781120e-02 -1.63601243e+00]
   [ 1.41269803e+00 -2.13634777e+00 -1.56220877e+00 ...  2.89517403e+00
    -2.65740365e-01 -2.41635561e+00]]]


 [[[ 4.71318990e-01 -8.93623650e-01  1.30160105e+00 ...  1.27133027e-01
    -1.44584370e+00 -1.67781508e+00]
   [ 1.34187266e-01  6.06339037e-01  7.94616222e-01 ...  1.13006759e+00
     6.45396054e-01  1.49260318e+00]
   [ 8.72776955e-02  7.69713700e-01  6.30427599e-01 ...  1.28724694e+00
     8.91090989e-01  1.80132174e+00]
   [ 8.51773075e-04  8.32152460e-03  7.24736461e-03 ...  1.28572769e-02
     9.58934706e-03  1.97125748e-02]
   [-5.50262704e-02  2.72363871e-01  5.47402918e-01 ...  1.12755656e-01
     5.87405086e-01  3.55976880e-01]]

  [[ 2.39387229e-01 -1.93955708e+00  1.09751868e+00 ... -4.53255147e-01
     2.12689996e+00 -1.60217690e+00]
   [ 3.54142815e-01 -1.91113770e+00  9.45200264e-01 ... -7.93717682e-01
     2.14330101e+00 -8.98501992e-01]
   [-1.98132396e-02 -9.68567431e-01 -2.20918953e-02 ... -1.85294735e+00
     2.05010605e+00  8.59645009e-03]
   [-1.58161968e-02 -2.54743397e-01  1.12559944e-01 ... -1.60492420e-01
     3.83261234e-01 -2.92659283e-01]
   [ 1.90701857e-01 -1.01905978e+00 -9.67948377e-01 ...  2.29230061e-01
     1.99627018e+00 -1.18162930e-01]]

  [[-7.27827623e-02 -1.61262691e+00  1.14025545e+00 ... -1.08142221e+00
    -1.15989518e+00 -5.14199734e-02]
   [-9.05602336e-01 -3.07395697e-01  3.32278705e+00 ... -1.52635646e+00
    -5.87428570e-01  1.36048162e+00]
   [-1.02690667e-01 -1.56264782e+00  1.21692562e+00 ... -1.09552515e+00
    -1.13716042e+00 -4.01832163e-04]
   [-3.42318386e-01 -1.10669422e+00  1.55814123e+00 ... -1.25003290e+00
    -6.83699489e-01  3.26158017e-01]
   [-1.13445330e+00  1.15297210e+00  1.47226900e-01 ... -1.28299510e+00
    -1.11397660e+00  1.40048289e+00]]

  ...

  [[-7.41986156e-01 -8.31632614e-01  1.94829059e+00 ... -1.76745546e+00
    -8.02157938e-01  4.00118738e-01]
   [-6.01825833e-01 -7.75156677e-01  1.88816702e+00 ... -1.93073273e+00
    -5.93675673e-01  3.29098523e-01]
   [-8.05798292e-01 -7.52087712e-01  1.47922182e+00 ... -1.88832927e+00
    -1.74110532e-01  7.12586164e-01]
   [ 6.10189699e-02 -3.93686622e-01  1.30785882e+00 ... -2.78190875e+00
     8.21734488e-01  1.25850827e-01]
   [-2.63329148e-01  4.03477579e-01 -5.10378890e-02 ... -7.90628135e-01
     1.18057787e+00  4.98212904e-01]]

  [[ 9.08310339e-02  2.27096009e+00 -1.58781528e+00 ... -1.51047683e+00
     3.27232063e-01  1.72770536e+00]
   [-1.07279861e+00  2.01589870e+00 -4.30161476e-01 ...  3.57013375e-01
     6.77739084e-01 -4.51942146e-01]
   [-7.49187529e-01  1.23530877e+00 -2.95299798e-01 ...  5.83371401e-01
     9.25756335e-01 -8.07507038e-02]
   [-2.39447411e-02 -2.10379660e-01 -5.43020442e-02 ...  8.73366475e-01
     1.38661802e+00  7.56279290e-01]
   [-6.35092556e-01  1.32872605e+00 -3.59896943e-02 ...  6.14219189e-01
     9.03942704e-01 -2.40375280e-01]]

  [[-2.21766543e+00  2.95918751e+00  9.69152212e-01 ...  2.29392853e-02
    -1.70641816e+00  7.02791661e-02]
   [-1.93797622e-03  2.58597848e-03  8.46923969e-04 ...  2.00462109e-05
    -1.49120681e-03  6.14156525e-05]
   [-2.19820523e+00  2.93884635e+00  9.64403152e-01 ...  8.37388542e-03
    -1.69069862e+00  6.56412691e-02]
   [-1.73947144e+00  1.41059756e+00  1.11855984e+00 ... -1.47189593e+00
    -3.34458768e-01  1.81945240e+00]
   [-2.11106583e-01  9.72933054e-01  2.30577841e-01 ... -7.51821637e-01
    -4.36588198e-01 -9.91975367e-01]]]


 [[[-7.40304410e-01  5.13094902e-01 -6.82792783e-01 ... -1.52381265e+00
     1.05792427e+00 -1.49076867e+00]
   [-6.62660122e-01  4.59280729e-01 -6.11180425e-01 ... -1.36399281e+00
     9.46967542e-01 -1.33441448e+00]
   [ 1.19762385e+00  2.71913379e-01  1.36885667e+00 ... -8.87349129e-01
     3.90216798e-01  7.83191264e-01]
   [-7.54301846e-01  6.04002059e-01 -5.69832742e-01 ... -1.43584788e+00
     1.07614529e+00 -1.50719476e+00]
   [-6.78008080e-01  2.00772792e-01 -3.48231882e-01 ...  4.65626776e-01
    -1.41909644e-01  4.92866874e-01]]

  [[-7.71869659e-01 -3.92125010e-01 -4.26876694e-01 ...  2.21506819e-01
    -5.34757614e-01  2.06072140e+00]
   [ 1.59251899e-01 -1.39173746e-01  2.44902015e-01 ... -1.23334080e-01
    -2.92226613e-01  1.41340041e+00]
   [ 2.20877245e-01 -7.90901721e-01 -5.91926694e-01 ...  2.43997201e-01
     1.48744130e+00  1.07144320e+00]
   [ 6.62061274e-01  3.50848496e-01 -9.27644521e-02 ...  6.49205625e-01
     1.50612450e+00  7.76194215e-01]
   [ 1.03609276e+00  1.46908820e-01  4.90032554e-01 ...  9.43998992e-02
     5.08877158e-01  1.01282775e-01]]

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [ 1.22983062e+00  1.26645219e+00 -2.73369932e+00 ...  1.41376865e+00
     9.92543459e-01 -3.72253925e-01]
   [ 1.20474851e+00 -5.49305558e-01 -2.13632059e+00 ... -2.25324035e-01
     1.37045610e+00 -5.94478130e-01]
   [ 2.04944587e+00  1.32423437e+00 -4.01331186e-01 ...  1.37080812e+00
    -1.18255645e-01  8.27286720e-01]
   [-3.90146434e-01 -1.90815806e+00  5.54318875e-02 ...  6.49593055e-01
     6.02563143e-01  1.05887368e-01]]

  ...

  [[ 8.18486273e-01 -1.16572356e+00  8.87063205e-01 ...  2.10855889e+00
    -8.41646969e-01 -3.78957599e-01]
   [ 4.96204138e-01 -1.55217886e+00 -2.29434073e-01 ...  1.33450377e+00
    -5.34057319e-01 -1.11696446e+00]
   [-1.11310452e-01 -1.98075986e+00 -2.03733468e+00 ... -1.07587472e-01
     4.13264669e-02 -2.17504144e+00]
   [-7.22192764e-01 -1.71081066e+00 -9.57641065e-01 ...  4.52065945e-01
    -2.63726890e-01 -7.82475829e-01]
   [-3.78970236e-01 -8.74397695e-01 -1.05379868e+00 ... -2.24607050e-01
    -2.56512687e-02 -1.01407230e+00]]

  [[ 1.50253261e-02 -2.30341887e+00  1.45531595e+00 ...  1.21479750e-01
    -4.10066128e+00  1.14953387e+00]
   [-2.00580549e+00  5.23970783e-01 -1.96023560e+00 ...  6.11358404e-01
    -1.34154844e+00  1.72360075e+00]
   [-5.61798751e-01 -9.83918905e-01  1.59332812e-01 ...  2.33217359e-01
    -2.39701247e+00  1.05433893e+00]
   [-6.35422647e-01  9.51813161e-01 -1.28316021e+00 ... -1.68607950e-01
    -9.61931527e-01  1.13656223e+00]
   [-1.59794295e+00  8.65601003e-01 -1.85225952e+00 ...  4.02066827e-01
    -8.28197002e-01  1.45621789e+00]]

  [[-9.98441756e-01  1.51268101e+00 -1.07151294e+00 ... -9.26277936e-01
     1.14997387e+00  2.13104948e-01]
   [-2.33805752e+00  2.14042068e+00  2.88553524e+00 ... -2.85430908e+00
    -1.34540632e-01  8.41024935e-01]
   [-2.70607397e-02  1.87333953e-02  2.15611793e-03 ... -3.23955715e-02
     2.53775958e-02  1.94294739e-03]
   [-1.16940379e+00  1.34904110e+00 -6.66013002e-01 ... -1.21200871e+00
     1.23865020e+00  1.73829958e-01]
   [-2.37217331e+00  1.97651720e+00  3.08051729e+00 ... -2.64595509e+00
    -1.10145807e-01  7.93674648e-01]]]


 ...


 [[[ 5.69146276e-01  2.95203733e+00 -5.87562263e-01 ... -1.11750185e+00
     2.73155260e+00  1.37862122e+00]
   [ 2.71376073e-01  1.61988938e+00 -7.42670417e-01 ... -8.91571641e-01
     6.77134573e-01  1.64267969e+00]
   [ 5.81468046e-01  2.84077120e+00 -6.07209027e-01 ... -1.08300006e+00
     2.61719203e+00  1.35957277e+00]
   [ 1.83369482e+00  1.58039436e-01 -1.23865628e+00 ...  1.16603926e-01
     1.30231524e+00 -2.21811384e-01]
   [ 6.77521348e-01 -1.55961424e-01 -9.86958265e-01 ... -2.54126787e-01
    -7.06388354e-01  9.46395040e-01]]

  [[-3.14285183e+00 -8.34112540e-02 -2.97251725e+00 ... -6.89057410e-01
    -1.58198392e+00  1.16413164e+00]
   [-1.84047663e+00 -3.03004473e-01 -1.74632049e+00 ...  5.28462768e-01
    -1.60463023e+00  6.01364970e-01]
   [-2.82740211e+00 -1.53381169e-01 -2.66028953e+00 ... -3.86571825e-01
    -1.50828838e+00  9.15215731e-01]
   [-1.58174467e+00 -5.04268527e-01 -1.41123891e+00 ...  7.84100473e-01
    -7.26876974e-01 -6.52428925e-01]
   [-2.80018139e+00 -4.71778721e-01 -2.39926791e+00 ... -3.57245266e-01
     3.01699013e-01 -1.46618176e+00]]

  [[-1.03486145e+00  9.70804155e-01  1.63316524e+00 ... -4.15153551e+00
    -5.61976731e-01 -5.11659622e-01]
   [-2.56126970e-01 -1.32596838e+00  2.03031564e+00 ...  5.00007391e-01
     1.94122469e+00  2.40137148e+00]
   [-4.38830703e-02 -4.84191477e-01  1.73454642e+00 ...  2.46426344e-01
     9.71697509e-01  1.79329658e+00]
   [-2.06808552e-01 -9.60563064e-01  1.44210577e+00 ...  9.60443914e-02
     7.39737630e-01  1.46626687e+00]
   [-6.68484986e-01  9.69550610e-02  1.29666674e+00 ... -2.34739017e+00
    -1.82573289e-01 -5.11338525e-02]]

  ...

  [[ 1.91192412e+00  2.39865708e+00 -1.22130655e-01 ... -8.86377394e-01
    -1.81831002e+00  4.91194725e-01]
   [ 1.53217280e+00  2.25040269e+00 -1.85338020e-01 ... -8.81073415e-01
    -1.89146066e+00  5.12907207e-01]
   [ 1.78592956e+00  2.31523943e+00 -7.31390864e-02 ... -8.94940019e-01
    -1.70660996e+00  5.07902503e-01]
   [-1.21847439e+00  1.16582942e+00 -6.40308857e-01 ... -8.37075114e-01
    -2.40712023e+00  6.66279316e-01]
   [-1.70389736e+00  3.25167894e-01 -8.97205949e-01 ... -5.32570779e-01
    -1.89658260e+00  5.90738297e-01]]

  [[-9.76650640e-02  3.86900485e-01  6.00566268e-01 ... -2.98781186e-01
    -2.57238865e-01  6.89770162e-01]
   [-1.21664867e-01  4.05651957e-01  6.07692122e-01 ... -2.97384322e-01
    -3.84465694e-01  7.17517614e-01]
   [ 8.53619501e-02 -2.29492474e+00  1.02992749e+00 ...  1.06797838e+00
    -1.18828022e+00  1.31090546e+00]
   [ 2.78447390e-01 -1.70974529e+00  7.21431851e-01 ...  6.57173991e-01
    -7.63125241e-01  1.06190395e+00]
   [ 1.28324020e+00  1.20102739e+00 -6.55369759e-01 ... -1.24757588e+00
    -3.20725739e-01  2.41783828e-01]]

  [[ 4.87220466e-01 -3.33908558e+00 -7.63660550e-01 ... -2.24332023e+00
    -1.05899119e+00 -9.41444695e-01]
   [-2.69639313e-01 -2.22694182e+00  1.48545206e-02 ... -3.54783714e-01
    -9.28331494e-01  2.13149250e-01]
   [-3.52080643e-01 -1.55262434e+00 -2.24960119e-01 ...  6.38807237e-01
    -8.00739527e-01  5.97952008e-01]
   [ 5.24602413e-01 -2.69985819e+00 -1.26328266e+00 ... -1.30445004e+00
    -7.37598300e-01 -1.03816485e+00]
   [ 2.79625237e-01 -4.70949233e-01 -1.18477666e+00 ...  5.70670605e-01
    -3.40700001e-02 -4.24959600e-01]]]


 [[[ 1.88525140e-01 -2.57467175e+00 -8.81884754e-01 ...  1.40706265e+00
    -5.59807718e-01 -1.58409178e+00]
   [ 9.05615866e-01 -2.08594370e+00 -5.26774585e-01 ...  1.43310875e-01
    -4.39803243e-01 -4.84051704e-02]
   [ 2.07502618e-01  5.74444570e-02 -1.60917655e-01 ... -5.94622679e-02
     5.70736468e-01  6.22955322e-01]
   [-1.16688776e+00  2.83476520e+00  6.44793510e-01 ...  3.83810282e-01
     3.10543537e+00 -1.27465919e-01]
   [ 1.54935753e+00 -9.17499006e-01  8.63834769e-02 ... -3.01427692e-01
     2.13378048e+00 -1.45208740e+00]]

  [[ 1.83410659e-01  1.54116917e+00 -1.62550181e-01 ...  5.18308043e-01
    -2.39024520e+00  1.66355968e+00]
   [ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [ 2.41365552e+00 -1.89522123e+00  9.08842087e-01 ... -5.77095211e-01
    -5.57896674e-01 -5.68771780e-01]
   [ 2.30960989e+00 -1.74861574e+00  8.75012457e-01 ... -5.22083163e-01
    -6.20220780e-01 -4.69015777e-01]
   [-2.64424276e+00 -3.10030007e+00  1.86250198e+00 ...  3.69168162e-01
     1.19681120e+00  3.10399115e-01]]

  [[-2.88584971e+00 -2.87206173e-01 -1.73950449e-01 ... -5.28070807e-01
    -6.99624181e-01  9.66182053e-01]
   [-1.25225163e+00  2.46007323e+00  4.43622857e-01 ...  2.66836429e+00
    -4.46317554e-01  1.87234294e+00]
   [ 6.60178810e-02  2.23101234e+00 -3.49445552e-01 ...  1.40356350e+00
    -6.79942966e-01  1.99007463e+00]
   [ 1.19299442e-03  9.68705535e-01 -2.51973957e-01 ... -1.45759153e+00
    -1.10324152e-01  6.47130072e-01]
   [ 1.73755005e-01  1.97224009e+00 -5.50037026e-01 ...  8.60859752e-01
    -6.34516895e-01  1.85537243e+00]]

  ...

  [[-7.22590864e-01 -8.61469686e-01  5.07493198e-01 ... -1.20267022e+00
    -1.70957828e+00  2.15579033e+00]
   [-7.21042335e-01 -8.55435967e-01  5.09348869e-01 ... -1.19294691e+00
    -1.68687737e+00  2.13393855e+00]
   [-3.17400813e-01 -5.97647250e-01  3.56065154e-01 ... -9.46327090e-01
    -1.42023599e+00  1.71366179e+00]
   [-3.80094856e-01 -5.78642786e-01  4.26756293e-01 ... -1.06715536e+00
    -1.45576465e+00  1.82335269e+00]
   [-1.64514840e-01  5.03774464e-01  7.76873231e-01 ...  6.31641388e-01
     2.59842229e+00 -2.05125737e+00]]

  [[ 1.58408964e+00 -3.46379936e-01 -1.30211580e+00 ... -8.20137739e-01
    -1.89749980e+00  2.70986676e+00]
   [-6.33375645e-01 -9.65297818e-02  3.96264493e-02 ...  7.46989846e-01
     4.78298932e-01 -4.74921048e-01]
   [ 2.18549848e-01 -1.25277862e-01 -3.38238239e-01 ...  2.50193477e-02
    -3.54236007e-01  5.74521661e-01]
   [ 2.02283204e-01 -2.90927261e-01 -3.87887180e-01 ...  1.35095626e-01
    -5.44052780e-01  7.59471714e-01]
   [ 9.12578225e-01 -3.12384963e-01  2.64983773e-01 ...  7.53181398e-01
    -1.30547071e+00  1.67893481e+00]]

  [[-6.06475294e-01  1.95157599e+00 -6.06737256e-01 ...  5.32386124e-01
    -9.27640140e-01 -2.10229850e+00]
   [-5.12153685e-01  1.86099005e+00 -2.59744525e-02 ... -7.55287051e-01
    -1.01627040e+00  4.58369136e-01]
   [-6.53602362e-01  6.24338627e-01  1.25347912e+00 ... -1.89358282e+00
     7.11325705e-01  1.93854213e+00]
   [-7.97744215e-01 -6.69054449e-01  2.06335258e+00 ... -2.07245374e+00
     2.59222531e+00  1.67841542e+00]
   [-6.03848398e-01  6.05419159e-01  8.55436087e-01 ... -4.58809555e-01
     8.83878291e-01 -1.13144815e-01]]]


 [[[ 1.13207221e+00  7.85829484e-01 -1.40907919e+00 ...  8.00259173e-01
     1.32074940e+00  7.41523921e-01]
   [-9.10228968e-01  1.66828901e-01 -1.41881019e-01 ... -1.57697213e+00
     5.17911553e-01 -1.12380576e+00]
   [ 5.25188684e-01  5.71883440e-01 -1.01651478e+00 ...  9.44654495e-02
     1.01334822e+00  5.98875657e-02]
   [ 1.12453496e+00  7.74189293e-01 -1.39918721e+00 ...  7.91920185e-01
     1.29639125e+00  6.95969164e-01]
   [ 3.72325242e-01  6.66710436e-01 -1.43515968e+00 ...  9.85215187e-01
    -6.56033456e-01  3.79763991e-01]]

  [[-8.80204737e-01  1.50134885e+00  1.62366867e+00 ... -9.26100671e-01
     2.95038128e+00 -1.89100266e+00]
   [-8.73497725e-01  1.29944515e+00  1.24452972e+00 ... -8.93126607e-01
     2.68922663e+00 -1.38624477e+00]
   [-8.76575470e-01  1.33205569e+00  1.29276562e+00 ... -8.98703218e-01
     2.72535634e+00 -1.46269488e+00]
   [-1.76500106e+00  2.55896688e+00 -2.12360692e+00 ... -1.18836558e+00
     1.58677626e+00 -2.35035753e+00]
   [-2.22056806e-02  1.28594786e-01 -1.04774117e+00 ... -8.93809140e-01
     1.17241323e-01  9.54924464e-01]]

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [ 1.73819447e+00 -6.55306876e-02  1.19282484e+00 ...  1.80252925e-01
    -8.50873709e-01 -1.49156654e+00]
   [ 1.90159643e+00  3.25262785e-01  1.50147200e+00 ...  7.12901890e-01
     1.62727937e-01 -7.92115629e-01]
   [ 7.32579827e-01  8.26675445e-02  1.05352330e+00 ... -1.22514263e-01
    -1.04542851e+00 -1.26955903e+00]
   [-5.30040443e-01  1.62354815e+00  2.73301005e+00 ... -2.72288859e-01
     8.95288587e-01  4.34903145e-01]]

  ...

  [[ 5.36678851e-01 -1.13263774e+00 -1.17002153e+00 ... -1.11001456e+00
     1.51836050e+00 -3.06289864e+00]
   [-2.87591224e-03 -7.89056718e-02  3.55898768e-01 ...  4.72485662e-01
     4.47161905e-02  1.03856623e-01]
   [ 8.87443498e-02 -4.76220548e-01  9.95322347e-01 ...  1.40275276e+00
     4.30781305e-01 -2.09154218e-01]
   [-7.12816492e-02 -2.40538001e-01  5.57001233e-01 ...  5.56994379e-01
     1.65463173e+00 -8.11956882e-01]
   [ 1.09297132e+00  1.27662969e+00  6.57468498e-01 ...  2.27831101e+00
     1.53293014e+00 -8.62664104e-01]]

  [[-1.42217290e+00 -1.29347098e+00 -8.67008626e-01 ...  2.73373222e+00
    -1.41143954e+00  1.64393198e+00]
   [-1.41386545e+00 -1.29157853e+00 -8.63594115e-01 ...  2.72628331e+00
    -1.39838219e+00  1.64022839e+00]
   [-9.78738189e-01 -9.15654898e-01 -7.98890889e-01 ...  2.45544410e+00
    -7.33113408e-01  1.23866522e+00]
   [ 2.70375609e-02 -1.12842560e-01 -3.11187625e-01 ...  9.45869923e-01
     4.63421702e-01  2.31160253e-01]
   [ 8.54663730e-01  3.35934132e-01 -6.75936937e-02 ...  4.86053467e-01
     2.03074646e+00 -4.65035856e-01]]

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [ 1.31917238e+00 -9.42831486e-02 -1.57432154e-01 ...  1.46290556e-01
    -1.10285890e+00 -2.56250501e+00]
   [ 5.26231050e-01 -1.41352737e+00 -7.98658371e-01 ...  5.64672172e-01
     1.96866095e-01 -9.06495035e-01]
   [-7.94974804e-01 -5.78191411e-03  3.48395705e-02 ...  2.74018385e-04
     1.32948482e+00  1.37224123e-02]
   [-2.24897727e-01  1.69237927e-01  7.06076503e-01 ... -9.20990407e-01
    -2.07336277e-01  8.93001080e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-True-32-8-27-11-4] q.shape1: (4, 11, 27)
q.shape2: (44, 27)
q.shape3: (44, 27)
q.shape4: (4, 11, 27)
q_liner: [[[-0.08246318  1.297637   -4.3869157  ...  1.6648993   1.0225514
   -0.23413606]
  [-2.1036825   0.34269288 -1.3593392  ...  0.28710133 -2.3495028
   -0.5770221 ]
  [ 0.55015564  1.3115653  -2.7073863  ... -1.2594198   0.450877
   -0.5750791 ]
  ...
  [ 1.9723426   1.9014058  -0.07350472 ... -0.62339854 -1.8269873
   -3.1420405 ]
  [ 0.5897575   0.5651129  -1.4288164  ...  1.6924045  -1.9481409
    1.4147217 ]
  [ 1.4633553  -0.39679056 -0.7927203  ...  0.4363156  -1.650817
    0.20362736]]

 [[-0.9566642   0.6318296  -0.99751896 ... -1.8659797  -0.01259731
    1.0842644 ]
  [-0.15104908  1.3874646   0.19238688 ... -2.0061364  -0.9589741
    0.54090524]
  [-0.31797707 -0.84257644  3.2394025  ...  0.8453818  -0.5109138
   -0.27457815]
  ...
  [ 0.33640504  1.8460547   2.517686   ...  1.085388    2.9914563
    2.6077745 ]
  [ 1.546665    0.5879998   0.41907552 ...  0.75106627  1.0203562
   -0.15183803]
  [-1.0632492   2.5393524   0.9687923  ... -1.3010052  -0.02241022
    1.0278877 ]]

 [[ 0.24715352  1.9982486  -1.0008467  ... -0.99167144  2.288722
   -0.38216916]
  [-1.7900983   1.6657426   0.72222143 ...  1.0981413  -0.52470183
   -1.220509  ]
  [-1.0200733  -0.02188973  0.9696115  ... -3.8275013   1.2366807
   -2.000785  ]
  ...
  [-1.0458595  -1.4305166  -1.8524687  ...  1.3384255  -2.3837926
   -1.3595229 ]
  [ 0.65088063 -0.07472718  0.7910718  ...  1.1668599   0.17494643
   -2.2131062 ]
  [-0.5484388  -0.3512259  -0.9518742  ... -0.37090048 -2.5363982
   -0.35450423]]

 [[-1.6597594  -2.0460486   1.7956158  ...  0.7144732  -2.8808208
   -2.3229933 ]
  [-0.67780596 -1.0200878   2.5991154  ... -0.39864108 -0.15486184
   -1.768438  ]
  [-0.9458305   1.8510628  -0.13740489 ... -1.8609341   1.1644534
    0.04018895]
  ...
  [ 0.38199356 -1.6202837  -1.9532994  ...  2.8872821  -0.4262538
   -0.07649663]
  [-1.2970152  -0.8319859  -1.2084574  ... -0.85649323  1.5001354
    1.9378235 ]
  [ 0.15252627  1.7864983  -2.6395547  ...  0.10763691  0.13296238
   -1.6784537 ]]]
q.shape5: (4, 11, 256)
q.shape6: (4, 8, 11, 32)
attn_res: [[[[-8.69775236e-01 -7.83433795e-01  1.29327428e+00 ...  1.59407413e+00
    -8.08839560e-01  4.48358744e-01]
   [-2.94552863e-01  5.98550498e-01  6.91059470e-01 ...  2.41293073e+00
    -2.95958900e+00  9.77635741e-01]
   [-3.10980469e-01  2.28687644e+00  1.23281610e+00 ...  2.69716859e+00
    -1.68833601e+00  1.80128908e+00]
   ...
   [ 4.97418761e-01 -3.89604956e-01  1.77821541e+00 ...  8.63675654e-01
    -1.28697896e+00 -4.54684407e-01]
   [ 3.54258753e-02 -1.74026951e-01  1.06718957e-01 ... -1.38367444e-01
     2.51154274e-01 -4.69002515e-01]
   [-6.01000428e-01 -2.99580514e-01  5.22308290e-01 ...  5.43383658e-01
    -7.28339136e-01  1.33979678e-01]]

  [[-4.27433938e-01  5.66519439e-01  1.89552224e+00 ... -4.95959908e-01
     1.64002275e+00 -2.34491229e+00]
   [-2.22845241e-01  4.18161362e-01  1.40795517e+00 ... -6.92085564e-01
     1.20571923e+00 -1.96214426e+00]
   [ 2.46222806e+00 -9.14782062e-02 -1.60492849e+00 ... -1.57133234e+00
     1.14804769e+00 -1.64281142e+00]
   ...
   [ 8.54577124e-02 -4.65106666e-02 -2.84652989e-02 ... -1.68735325e-01
    -1.27706500e-02 -3.15983929e-02]
   [-4.85543668e-01 -1.01038063e+00 -6.04822159e-01 ...  7.30423152e-01
    -2.07749218e-01 -5.20001352e-02]
   [-7.47082606e-02 -5.62124923e-02 -6.20754808e-03 ...  2.16394633e-01
    -1.70110703e-01  1.79719210e-01]]

  [[-7.42750108e-01  6.53545737e-01  4.54722136e-01 ...  1.60635543e+00
     1.65618002e+00  8.62370610e-01]
   [-9.07006145e-01  5.11318028e-01  3.68329018e-01 ...  1.64892805e+00
     1.95196724e+00  6.82971060e-01]
   [-6.39206171e-01 -2.99885583e+00 -1.09981692e+00 ...  1.22615194e+00
     2.26454520e+00 -7.59962946e-02]
   ...
   [-8.29673111e-01 -9.77870822e-01 -5.51367521e-01 ... -7.79352605e-01
     5.78519821e-01  8.47469151e-01]
   [-5.82239807e-01  1.64715052e-01 -3.63189399e-01 ... -9.48846042e-02
     5.11686087e-01  4.98151928e-01]
   [-8.63396227e-02  1.46367073e-01 -1.31465809e-03 ... -2.42660254e-01
    -1.02854915e-01  1.31896928e-01]]

  ...

  [[-1.48501551e+00 -1.47142386e+00  2.09207550e-01 ...  7.02102065e-01
    -7.07588494e-01 -3.13506031e+00]
   [-3.49199563e-01  1.34960926e+00 -1.79847598e+00 ... -1.26032960e+00
     5.35956025e-01 -1.95659354e-01]
   [-1.48141789e+00 -1.46260548e+00  2.02390194e-01 ...  6.95515156e-01
    -7.03488648e-01 -3.12612772e+00]
   ...
   [-7.31870085e-02  1.65461171e+00 -8.80274117e-01 ... -3.95667911e-01
     2.84390122e-01  1.25169921e+00]
   [-1.51554808e-01  2.25225830e+00 -6.29273951e-01 ... -4.98201363e-02
    -3.67305756e-01  2.11158037e+00]
   [-4.32446867e-01  1.40580785e+00 -2.86126912e-01 ...  7.25828186e-02
     9.12398323e-02  1.24166596e+00]]

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [ 6.11594379e-01 -1.23063791e+00 -3.12067002e-01 ...  7.33789861e-01
    -1.12528634e+00  1.68076825e+00]
   [ 9.73436058e-01 -2.89646816e+00 -4.50038195e-01 ... -8.29485580e-02
    -1.79909897e+00 -9.31763649e-01]
   ...
   [-1.07172024e+00  7.31824338e-02  3.59488964e-01 ...  1.05141115e+00
     1.62585035e-01  3.00369084e-01]
   [-3.10641397e-02 -1.65988892e-01  1.75039750e-02 ...  9.64834839e-02
     1.31224111e-01  5.90578355e-02]
   [-7.28076696e-02  4.87585276e-01 -5.72089195e-01 ... -2.37841442e-01
     2.52051026e-01  5.79727471e-01]]

  [[-6.03450060e-01 -2.19000593e-01 -1.08645022e-01 ...  2.36290979e+00
    -1.51431888e-01 -9.61266339e-01]
   [ 1.63082242e-01  2.07873017e-01 -4.76745702e-02 ...  2.04824734e+00
    -2.17289448e-01 -9.27686453e-01]
   [ 4.50435847e-01 -6.71367466e-01  8.89132023e-02 ...  2.04416037e+00
     7.78661251e-01 -2.28670621e+00]
   ...
   [ 5.25981188e-01  4.25095081e-01  2.77278483e-01 ...  6.11848295e-01
    -2.20522285e-02  1.31918266e-01]
   [-5.31912386e-01 -1.74551800e-01 -7.24522412e-01 ...  1.74600518e+00
     7.54883826e-01 -1.09205937e+00]
   [ 8.16326678e-01  4.31556106e-01  7.85756484e-02 ...  1.01679862e+00
    -2.46589705e-01 -4.32144642e-01]]]


 [[[ 1.14191937e+00  1.50013113e+00 -1.95082271e+00 ...  1.56951165e+00
    -2.72405577e+00  2.38202977e+00]
   [ 1.46516454e+00  2.56747270e+00  6.86002076e-01 ... -4.22981828e-01
     1.34379351e+00  6.01764321e-01]
   [ 8.37216556e-01  1.31412554e+00 -1.75142586e+00 ...  1.30449903e+00
    -2.02941656e+00  1.87123239e+00]
   ...
   [ 3.84395957e-01  6.93757415e-01  7.92696774e-01 ...  4.84076440e-01
    -9.85104978e-01 -2.37143636e-01]
   [ 6.99834585e-01  1.27535045e+00 -1.12636733e+00 ...  1.38689411e+00
    -1.30992460e+00  1.11265719e+00]
   [ 6.48571551e-01  7.26971388e-01 -1.84205085e-01 ...  2.84899175e-01
     3.98757130e-01  3.92210662e-01]]

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [ 4.46008593e-01  2.38635927e-01  2.02892447e+00 ... -3.40416282e-01
     1.76683688e+00  1.07851535e-01]
   [-1.46695685e+00 -2.28288651e-01 -2.07712078e+00 ...  2.64246058e+00
    -6.57551467e-01 -3.84054124e-01]
   ...
   [-7.26787329e-01  2.36756325e-01 -1.55639720e+00 ...  1.42526793e+00
    -9.09003317e-01  1.22400612e-01]
   [-1.34795621e-01 -7.97600150e-01 -7.07151294e-01 ... -1.72133923e-01
    -1.48398268e+00  2.21883130e+00]
   [ 4.64969933e-01  3.84338170e-01 -7.32180059e-01 ... -4.42506909e-01
    -9.11601186e-02  1.25895739e-01]]

  [[ 6.87055349e-01 -8.01961184e-01  8.76420915e-01 ...  2.74021840e+00
     1.49420989e+00 -3.68064141e+00]
   [-1.60956419e+00 -1.63233161e+00  4.45242822e-01 ... -1.28541923e+00
     1.73554981e+00  1.54319441e+00]
   [-1.40640154e-01 -1.00326300e+00  6.83031857e-01 ...  1.05362749e+00
     1.20895910e+00 -1.26384354e+00]
   ...
   [ 3.59488040e-01 -1.57633424e+00  1.96668040e-02 ...  8.65184307e-01
    -4.91390616e-01 -6.59810007e-01]
   [-1.26646996e+00 -1.48338771e+00  4.84615326e-01 ... -7.31138051e-01
     1.60774708e+00  7.89164007e-01]
   [ 5.99983394e-01 -7.43352890e-01  2.29482248e-01 ...  6.00429177e-01
     4.31242049e-01 -1.10796618e+00]]

  ...

  [[ 1.99562800e+00 -2.55661583e+00 -9.28615406e-02 ... -1.80475724e+00
     1.24859607e+00 -2.52430773e+00]
   [ 1.93033111e+00 -2.47296357e+00 -8.98231193e-02 ... -1.74570560e+00
     1.20774209e+00 -2.44171238e+00]
   [ 1.45300496e+00  2.33511448e+00 -9.32816625e-01 ... -1.02462089e+00
     1.92009902e+00  2.58707926e-02]
   ...
   [ 1.90618670e+00  9.42978382e-01 -1.09939480e+00 ...  2.02100635e-01
    -6.79276824e-01  1.91878323e-02]
   [-4.35952932e-01  7.76728511e-01  1.00815976e+00 ... -4.04875934e-01
     8.26009750e-01  2.22688127e+00]
   [ 1.16517520e+00  4.74753469e-01 -2.95643866e-01 ... -4.57003206e-01
    -4.41241674e-02  4.36589960e-03]]

  [[ 3.43114793e-01 -1.19770718e+00 -8.90281677e-01 ... -1.32593095e+00
    -2.66887474e+00  6.07350945e-01]
   [ 1.47972548e+00  5.34748316e-01  9.44046140e-01 ...  2.11969161e+00
    -6.05929911e-01  4.49739814e-01]
   [ 4.24121499e-01 -7.54245400e-01 -3.24322164e-01 ... -5.83228648e-01
    -2.17957211e+00  4.06492054e-01]
   ...
   [ 7.13110805e-01  3.40242028e-01  9.05164361e-01 ...  1.85635149e+00
    -4.62730289e-01  7.20720708e-01]
   [ 1.05101533e-01 -8.00254703e-01 -2.67546564e-01 ... -5.98239779e-01
    -1.57142520e+00  8.18649381e-02]
   [ 8.34656477e-01 -7.48503566e-01  1.40968546e-01 ... -7.99472868e-01
    -7.16705441e-01 -5.01383901e-01]]

  [[ 5.70026040e-01 -4.58332956e-01 -1.37727952e+00 ... -7.91358426e-02
     1.55597115e+00 -1.31409466e+00]
   [ 1.56853509e+00 -1.09900773e-01  1.33954930e+00 ...  4.20615345e-01
     2.07129478e+00 -4.46888477e-01]
   [ 1.46626830e+00 -1.32865250e-01  1.43332207e+00 ...  5.55969417e-01
     1.96586227e+00 -4.86378193e-01]
   ...
   [ 1.06087911e+00  3.17745686e-01  1.03227305e+00 ...  6.31959140e-01
     1.23627341e+00 -1.56842902e-01]
   [ 7.39012361e-01 -3.56078297e-01 -4.96965617e-01 ... -5.31629801e-01
     1.49336085e-01 -5.07708669e-01]
   [-1.12769090e-01 -1.10648596e+00 -4.90555733e-01 ...  1.92301169e-01
     1.90695181e-01  1.04301643e+00]]]


 [[[ 7.54729927e-01 -4.57551509e-01  1.57605454e-01 ...  8.08584154e-01
     2.46321857e-01 -2.70383626e-01]
   [ 7.76403368e-01  1.16304290e+00 -2.03483820e+00 ...  6.97463572e-01
     6.74023807e-01  1.69933271e+00]
   [ 3.06501150e-01  2.69015819e-01 -5.47630668e-01 ...  2.90971339e-01
     2.17135757e-01  4.40725058e-01]
   ...
   [ 4.40518439e-01 -7.97963023e-01 -5.68154812e-01 ...  3.32092762e-01
     2.53998548e-01 -7.81501383e-02]
   [ 1.42057925e-01  3.43062490e-01 -9.38069165e-01 ...  8.51073861e-01
     5.23921132e-01  1.10068941e+00]
   [-9.83105749e-02  5.00949085e-01  6.19869530e-01 ...  2.18970671e-01
     5.79792917e-01  2.14979589e-01]]

  [[-1.09478104e+00 -2.11850500e+00  7.15485871e-01 ... -1.67710381e-03
    -1.58719313e+00 -1.58244050e+00]
   [-9.60709453e-01 -2.91209966e-01  4.23576124e-02 ...  6.87497914e-01
    -1.06474328e+00  2.05069333e-01]
   [-2.04308462e+00 -7.18767941e-01  1.27225533e-01 ...  1.41835153e+00
    -2.28514099e+00  3.34999323e-01]
   ...
   [-3.18768442e-01  6.24701440e-01  1.12735100e-01 ...  5.17457485e-01
     9.85108435e-01 -1.12218821e+00]
   [-4.38240707e-01 -3.66636842e-01  5.72178602e-01 ...  3.12213749e-01
    -7.57666826e-02 -9.36497569e-01]
   [-2.33814761e-01 -7.73487747e-01  2.00813890e-01 ... -3.68400484e-01
    -8.47646117e-01  6.31949306e-01]]

  [[-1.31107140e+00 -3.84751856e-01  2.87090361e-01 ... -1.26909065e+00
     1.71347463e+00  4.04918939e-01]
   [-1.18930149e+00 -2.92058259e-01  4.78764117e-01 ... -1.17995965e+00
     1.49660659e+00  3.73580664e-01]
   [ 1.24285206e-01 -2.78055280e-01 -4.51082647e-01 ...  2.67805886e+00
    -1.22533011e+00 -4.84919667e-01]
   ...
   [-2.05690026e-01 -6.11060411e-02  8.24480057e-02 ... -1.13010667e-01
     7.19259083e-01 -8.75041246e-01]
   [-1.98422205e+00  9.59484816e-01  1.09480119e+00 ... -5.59318781e-01
     7.39404798e-01  1.37200832e+00]
   [-1.11168802e+00 -1.90360382e-01  2.41744101e-01 ... -7.93073058e-01
     1.07947278e+00  4.27807271e-01]]

  ...

  [[-2.83251643e-01  1.43734670e+00  6.67077601e-01 ... -2.01587844e+00
     5.00855148e-02 -7.42803335e-01]
   [ 3.72156119e+00  1.30622578e+00 -1.27565789e+00 ... -4.70941126e-01
     2.20214820e+00 -2.34952950e+00]
   [-3.71965677e-01  7.78490424e-01 -2.16247976e-01 ... -1.36871898e+00
     9.07402635e-01 -7.94394255e-01]
   ...
   [ 2.48607814e-01  6.45227253e-01 -8.49509060e-01 ...  1.30888700e+00
    -4.33159471e-01  1.14458239e+00]
   [ 1.22094786e+00  4.25622255e-01 -5.39985657e-01 ... -3.69599462e-01
     6.20877743e-01 -8.42103481e-01]
   [ 2.11473107e-01  1.08077693e+00  2.45222002e-01 ... -9.36102629e-01
     1.82582021e-01 -1.48607299e-01]]

  [[ 2.24905396e+00 -2.38411024e-01 -1.12501168e+00 ...  4.21072096e-01
    -2.14775801e+00  2.86331463e+00]
   [ 6.39277279e-01 -1.00680614e+00 -1.46070588e+00 ... -2.78993917e+00
     5.08884192e-01 -4.19258356e-01]
   [ 1.44034576e+00 -3.51402909e-01 -1.20737362e+00 ... -3.32022339e-01
    -1.34769225e+00  1.62184942e+00]
   ...
   [ 5.34093440e-01 -1.00052595e+00 -1.24587119e+00 ... -2.54754257e+00
     3.74144733e-01 -4.63531375e-01]
   [ 7.78082192e-01 -1.04269540e+00 -2.51035720e-01 ... -5.03013372e-01
     2.56376415e-01 -1.83793485e+00]
   [-7.79594243e-01  7.24497363e-02 -6.75855279e-01 ...  1.58572525e-01
    -4.63986218e-01 -7.13471949e-01]]

  [[-1.66106141e+00 -1.26562285e+00 -6.69642270e-01 ... -1.65390587e+00
    -5.95834181e-02 -1.96530735e+00]
   [-1.89857149e+00 -3.70544314e-01 -1.10146236e+00 ... -1.02118242e+00
    -1.33800969e-01 -1.67003798e+00]
   [-8.04688692e-01 -1.35074925e+00  2.62590051e-01 ... -1.43342745e+00
     4.96251792e-01 -7.52405524e-02]
   ...
   [-4.78884488e-01 -1.21521282e+00  5.57571709e-01 ... -8.91647696e-01
     8.60865653e-01 -3.89657408e-01]
   [-3.85063201e-01  4.55264524e-02 -1.34719878e-01 ...  2.27931857e-01
     2.26654470e-01 -5.97750247e-01]
   [-7.14251757e-01 -7.78464139e-01  5.80131650e-01 ... -6.18946135e-01
     7.07320750e-01 -3.92350078e-01]]]


 [[[-8.35666418e-01  2.35665369e+00 -2.98543954e+00 ... -1.11331058e+00
     5.81655443e-01  1.25254881e+00]
   [-7.64925063e-01  1.88857007e+00 -2.71708894e+00 ... -1.13816750e+00
     5.38936436e-01  1.23213506e+00]
   [-3.90757620e-01 -7.67554700e-01 -1.21297204e+00 ... -1.22888434e+00
     2.92607695e-01  9.38828945e-01]
   ...
   [-3.87103856e-02  5.71767569e-01 -1.99930000e+00 ...  3.61807853e-01
    -8.63678455e-01  4.86693569e-02]
   [ 1.40289831e+00  9.79594648e-01  6.97715521e-01 ... -1.47032559e-01
    -8.14864516e-01  1.03522170e+00]
   [ 7.52379715e-01  6.36168301e-01  3.35038841e-01 ... -1.26816010e+00
    -4.93728846e-01  1.55101109e+00]]

  [[-5.31879663e-01 -1.66693699e+00  1.65395796e+00 ...  2.28845978e+00
    -5.81250131e-01  6.43408954e-01]
   [ 3.68616879e-02 -1.53083622e+00  1.53174937e-01 ...  1.87926221e+00
     8.93213212e-01  1.75743327e-01]
   [ 7.49882758e-01 -1.28710032e+00 -1.74022233e+00 ...  1.27576482e+00
     2.70384669e+00 -4.20345038e-01]
   ...
   [ 3.32449466e-01  7.85184622e-01  7.68238485e-01 ...  1.89220756e-01
     7.71058649e-02 -4.22257006e-01]
   [-3.90732706e-01  6.24449432e-01  1.94623172e+00 ...  3.99140775e-01
    -8.01854908e-01 -6.32828593e-01]
   [ 1.12644482e+00 -9.29217339e-01 -1.99002790e+00 ...  9.87443745e-01
     2.31144667e+00  8.29283297e-02]]

  [[ 9.86161649e-01 -3.54059982e+00 -1.00404310e+00 ...  1.75373709e+00
     1.44772851e+00  1.56085217e+00]
   [ 2.20775676e+00 -2.34923339e+00 -1.49602234e+00 ...  8.25441122e-01
     6.86277330e-01  2.06190705e-01]
   [ 1.00718945e-01 -1.96245573e-02 -5.64484335e-02 ... -1.10164033e-02
    -8.79572611e-03 -4.22091186e-02]
   ...
   [-3.97567958e-01 -1.04206729e+00  5.16050816e-01 ...  5.74734986e-01
     7.71699905e-01 -1.43862590e-01]
   [ 1.32536745e+00 -9.37661827e-01 -1.24165809e+00 ...  9.75103259e-01
    -9.14541066e-01 -9.75324929e-01]
   [ 1.10857463e+00 -1.07006872e+00 -3.02116036e-01 ...  4.23525602e-01
    -1.62581205e-01 -5.32076776e-01]]

  ...

  [[ 1.08464170e+00 -3.14320850e+00  2.16825676e+00 ...  1.20569062e+00
     9.76694882e-01 -1.91030514e+00]
   [-3.47889751e-01 -1.47953153e+00 -2.02754068e+00 ...  1.89913559e+00
    -1.95181477e+00  8.85092080e-01]
   [ 1.00040507e+00 -3.04537940e+00  1.92178702e+00 ...  1.24637151e+00
     8.04585576e-01 -1.74597323e+00]
   ...
   [ 1.08222023e-01 -2.01947403e+00  1.39677477e+00 ...  8.07401955e-01
     6.10924186e-03 -4.04371172e-01]
   [ 2.15658963e-01 -5.77125251e-01  4.04974163e-01 ...  3.06268334e-02
    -4.83046472e-01 -7.66912103e-01]
   [-8.28911006e-01 -4.92976815e-01  6.45134389e-01 ...  2.44562075e-01
     4.50153530e-01  1.05762982e+00]]

  [[-2.91827321e-01  2.33797836e+00 -6.76878154e-01 ...  3.07585418e-01
    -6.02930009e-01  1.39609087e+00]
   [-3.58789742e-01  1.43569851e+00 -8.88626575e-01 ...  1.29305035e-01
    -7.29622126e-01  8.15409422e-01]
   [ 3.78639512e-02 -2.22518131e-01  2.85997298e-02 ... -2.39653200e-01
    -8.59279335e-01  3.92080784e-01]
   ...
   [-3.91992688e-01 -9.40754473e-01 -8.51484179e-01 ...  7.24584401e-01
    -3.68330687e-01  3.86567384e-01]
   [-1.92152895e-02  2.24594235e-01 -3.19715977e-01 ...  8.56503844e-01
     1.53002515e-01  1.23726380e+00]
   [-2.55547732e-01 -2.97574133e-01 -5.77007532e-01 ...  1.46270359e+00
     4.52154204e-02  5.14280975e-01]]

  [[ 2.88793296e-01  1.42087162e+00 -4.16270822e-01 ...  2.79881501e+00
     9.87419784e-01 -2.00565743e+00]
   [ 2.48613644e+00 -2.19465876e+00 -1.44002736e+00 ... -2.63956904e-01
    -2.60207206e-01  6.85240448e-01]
   [ 1.04597437e+00 -2.79253662e-01 -5.94569325e-01 ...  1.62728298e+00
     4.03337002e-01 -9.07532096e-01]
   ...
   [ 8.75674069e-01 -9.45845842e-02  1.19649446e+00 ...  1.34862766e-01
    -1.32761300e-02  2.44801611e-01]
   [ 2.01437044e+00  1.40223429e-01  1.23914957e+00 ...  1.10134281e-01
     5.31701922e-01  1.82532227e+00]
   [-1.73432410e-01 -1.02902067e+00 -8.57874811e-01 ...  4.96811569e-01
     4.33061719e-01 -2.00361937e-01]]]]
FAILED
tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-True-32-8-27-11-8] q.shape1: (8, 11, 27)
q.shape2: (88, 27)
q.shape3: (88, 27)
q.shape4: (8, 11, 27)
q_liner: [[[ 0.7224422  -0.4349445   3.4143314  ...  0.3524749   1.7550441
    1.3171579 ]
  [ 2.726345    1.2628067  -1.7939713  ... -0.06979546  0.00453782
    3.1302361 ]
  [-1.1040715  -0.15600364  1.9368501  ... -0.5825903  -0.65041417
   -2.2147686 ]
  ...
  [ 2.29157     0.908618    1.0856221  ... -1.3256541   0.30595994
   -0.84049827]
  [-0.40498114 -0.5691511   2.6631112  ...  0.8738295   0.4198153
    1.1513562 ]
  [-0.4481117  -0.92076814  3.5576978  ...  2.7185454   3.3272922
   -0.97112256]]

 [[-1.1616747  -1.7085901  -0.06308014 ... -0.84628963  0.9343368
   -0.6217179 ]
  [ 0.4018707   0.30482602  0.46497503 ...  0.11524689  0.10966628
   -0.6314564 ]
  [ 2.1810687  -1.1074287   1.3467315  ...  0.39241254  0.3339569
    0.5910638 ]
  ...
  [ 3.547802    0.51425123 -2.1266663  ... -1.1019756  -0.78907746
    2.1269357 ]
  [-1.6231765  -2.7684586   0.24566987 ... -0.25909057 -0.6573771
   -1.6647071 ]
  [ 2.5132887   0.55106294  0.7015406  ...  1.2227943   0.7392053
    1.8680627 ]]

 [[ 0.27821246 -1.1018684   1.7200263  ... -1.7082299  -0.4673362
   -2.2366893 ]
  [ 2.7587233   1.7226602   0.80260444 ...  1.1995286  -0.92798245
    0.2717521 ]
  [ 0.64558136  0.08447142  0.4400963  ...  1.3089368   1.2809186
   -1.5577403 ]
  ...
  [-1.0232698  -1.5747494   1.018051   ...  0.00518736 -0.4626458
    0.8344153 ]
  [ 1.1266454   0.38148978  2.193111   ... -1.535103    0.7982023
   -0.95043397]
  [-0.9965041  -1.8504593   1.8635492  ...  1.692321    1.8115427
   -0.7349715 ]]

 ...

 [[ 2.074959    2.2624094   0.34631863 ... -3.2463975   1.0677857
    1.5288497 ]
  [ 0.26497793  1.3373191   3.0214698  ...  0.41106525 -0.168928
    0.03355249]
  [ 0.5420742   1.2251356  -3.8265731  ... -0.34920886 -0.03093657
    0.798989  ]
  ...
  [-3.2419846  -1.4931114   0.72515845 ...  1.7054092  -0.04060049
   -2.0626805 ]
  [ 0.9767814   0.28908023 -1.5257838  ... -3.0712612  -0.89618737
   -0.34019688]
  [ 0.62380505  1.7282047  -0.0089727  ...  3.7021785  -0.5753088
    1.6830212 ]]

 [[ 2.0232098   0.64801407  0.06984086 ...  0.7552189   0.41255075
    0.56615067]
  [ 0.18463086  0.6487753  -2.7815037  ...  0.88175464 -0.71326035
   -0.08390006]
  [-1.9218032   0.28904673 -1.1362168  ... -2.5849714  -0.15884835
   -1.8206904 ]
  ...
  [-1.7156733  -0.79765487 -1.7961345  ... -0.48244846  1.5824316
    0.23448431]
  [-0.93504095 -0.5579304  -1.3916398  ... -1.322384   -0.33638978
   -0.6543722 ]
  [-3.1369116  -1.0516435   3.082999   ...  0.6630197   1.6387494
   -2.8189464 ]]

 [[ 0.5203575   2.510916   -2.5926096  ... -0.47947776 -2.6331599
    1.5112784 ]
  [ 0.2482923   0.10941231 -1.2460439  ...  1.8010229  -0.24936317
   -0.89507395]
  [-0.4074848   0.3564243   1.156305   ... -0.9337906  -0.32710424
    0.46405238]
  ...
  [ 0.8763598   0.15448405  0.44426623 ... -1.1368421   0.7098689
   -0.3491226 ]
  [-2.248125    0.22241627 -1.8704771  ... -1.2285389   0.29145718
   -0.22001871]
  [-1.0332358   0.15769057 -1.6133977  ...  0.13136601  1.1417925
   -0.2518325 ]]]
q.shape5: (8, 11, 256)
q.shape6: (8, 8, 11, 32)
attn_res: [[[[ 2.55478454e+00  1.82757497e-01  1.13002539e+00 ... -1.10603772e-01
     2.97788620e-01  1.18644178e+00]
   [ 1.85808420e-01  1.32918777e-02  8.21862891e-02 ... -8.04416742e-03
     2.16580443e-02  8.62894207e-02]
   [ 7.87969410e-01  9.80823100e-01  1.42472959e+00 ... -1.88401425e+00
     2.01393276e-01  1.54891634e+00]
   ...
   [ 1.85604143e+00  3.15864861e-01  6.52537167e-01 ... -2.59767175e-01
    -1.35578096e-01  7.83478558e-01]
   [ 4.33876254e-02 -5.54634593e-02  1.88283071e-01 ... -8.30766559e-02
     1.67318154e-02  1.22188695e-01]
   [ 1.17152631e+00 -2.90623903e-01  1.50936007e-01 ...  1.38560355e-01
    -1.25924826e-01  5.69245040e-01]]

  [[-1.24841094e+00 -1.09278488e+00 -1.25198925e+00 ... -1.96604216e+00
    -7.62160838e-01 -2.98628831e+00]
   [-1.64249003e+00  5.31429350e-01 -2.50670123e+00 ... -3.42405885e-01
    -1.56617880e+00  5.49960256e-01]
   [-3.56491238e-01 -2.09973550e+00  2.02871251e+00 ...  3.20614994e-01
    -9.10376608e-01 -7.67791271e-01]
   ...
   [-5.08877397e-01 -3.19804102e-02 -3.73151094e-01 ... -3.12556565e-01
     1.46169916e-01 -5.65623045e-01]
   [-1.99946493e-01 -6.16905630e-01  3.99899721e-01 ...  3.10215771e-01
     6.57802999e-01  1.23893058e+00]
   [-1.00365806e+00 -4.57776725e-01  1.21661454e-01 ...  9.50923204e-01
     2.83565789e-01  1.36386895e+00]]

  [[-1.81560934e+00  3.50365579e-01 -3.20438087e-01 ... -3.62959802e-02
     3.30804873e+00 -2.33204889e+00]
   [-1.12885153e+00  2.17839122e-01 -1.99231759e-01 ... -2.25669555e-02
     2.05677271e+00 -1.44994676e+00]
   [-1.23290575e+00 -7.71926530e-03 -3.01858187e-01 ...  4.41175550e-02
     1.40172064e-01 -4.56884533e-01]
   ...
   [-3.80717158e-01 -1.66703534e+00 -1.90888107e-01 ...  1.09655499e+00
    -1.10516858e+00  1.05901882e-01]
   [ 6.07372820e-02  4.89712358e-01 -9.49626029e-01 ... -5.05094767e-01
     9.42390382e-01 -2.47509885e+00]
   [-7.21229970e-01  7.48465776e-01 -6.55629158e-01 ...  2.16877013e-01
     5.59013069e-01 -8.77506845e-03]]

  ...

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [-1.36634454e-01  1.03272521e+00  1.93395577e-02 ...  1.03297830e+00
     3.61871421e-01 -2.39648199e+00]
   [-3.95805866e-01 -3.75169992e-01  1.86956060e+00 ... -2.97500706e+00
    -2.70161152e+00  6.70012236e-01]
   ...
   [-1.51336282e-01  2.77489275e-01  3.68353695e-01 ... -1.35095119e+00
    -1.11495566e+00 -5.21059752e-01]
   [ 2.16812253e-01  6.56952858e-01 -8.18073392e-01 ... -5.88367283e-02
     2.32014135e-01 -1.90926433e+00]
   [-1.56140119e-01 -2.12650627e-01 -6.35781065e-02 ...  3.12016934e-01
     7.71780550e-01 -1.69795740e+00]]

  [[ 1.44150245e+00 -1.66902220e+00 -1.25370800e+00 ... -1.59926069e+00
    -1.10770047e+00  1.68616831e+00]
   [ 1.59396589e+00 -5.04392862e-01 -1.06825566e+00 ... -1.34425700e+00
    -6.63829684e-01  1.23295355e+00]
   [ 8.07784200e-01  7.53575861e-01 -1.41597211e+00 ... -7.27425992e-01
     3.18378180e-01  1.68354249e+00]
   ...
   [ 1.36864281e+00 -3.09147894e-01 -1.08992600e+00 ... -5.92648685e-01
     1.47261828e-01 -5.03015630e-02]
   [ 2.71738142e-01  2.37544611e-01  4.61962044e-01 ...  1.93361923e-01
    -1.65879503e-01  2.77428813e-02]
   [ 1.48073447e+00 -5.85172713e-01  1.02387798e+00 ...  6.38008177e-01
    -9.79755163e-01 -1.00138700e+00]]

  [[-1.66896939e+00  9.21379626e-01  1.19695449e+00 ... -6.96311235e-01
     2.51643109e+00  1.99747694e+00]
   [-1.24852085e+00  8.55018675e-01  9.63441849e-01 ... -7.86888599e-01
     2.58085608e+00  1.81705761e+00]
   [-2.68119931e-01  3.50912869e-01  2.75558084e-01 ... -4.37454283e-01
     1.25910974e+00  7.16006398e-01]
   ...
   [ 1.38305187e+00 -1.18332756e+00 -1.38214982e+00 ...  8.48326012e-02
     1.81398177e+00  4.57192928e-01]
   [-1.23971201e-01 -1.36039090e+00 -3.07699382e-01 ... -7.89177045e-03
     1.73900962e+00  1.72305441e+00]
   [-6.74949348e-01  4.50063527e-01  4.44862127e-01 ...  5.35951078e-01
     1.05374694e-01  7.23146439e-01]]]


 [[[-1.37279916e+00 -1.53557253e+00  1.34774351e+00 ...  2.49318409e+00
     4.29327101e-01 -9.45353732e-02]
   [-1.81439567e+00 -5.91149211e-01  7.25653350e-01 ...  1.74965632e+00
     1.82557732e-01 -3.26988965e-01]
   [-1.36472797e+00 -6.91840529e-01  7.27230668e-01 ...  1.58164477e+00
     2.03457624e-01 -2.11227298e-01]
   ...
   [-6.75640941e-01 -8.67508769e-01  7.06131101e-01 ...  1.16381454e+00
     2.75739312e-01 -5.44223450e-02]
   [-1.64161611e+00  3.22052687e-01  8.65560353e-01 ... -1.10083982e-01
     5.15944183e-01 -6.37201667e-01]
   [-8.18776727e-01 -3.19230705e-01  1.05404425e+00 ...  9.95668769e-02
     8.30182552e-01 -3.59932303e-01]]

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [-1.86001122e+00 -1.57746077e+00  2.10757136e+00 ... -5.55080771e-01
     1.10097110e+00 -1.73327416e-01]
   [-1.15157545e+00 -1.05816662e+00  1.30677521e+00 ... -5.65559030e-01
     6.79787397e-01 -2.00468361e-01]
   ...
   [ 5.35945259e-02  7.85661563e-02 -2.51475155e-01 ... -2.98200250e-02
    -1.15074016e-01 -1.27082840e-01]
   [ 6.51118875e-01  1.50806379e+00  5.45884550e-01 ...  5.60989380e-01
     5.65997124e-01 -1.84917562e-02]
   [ 7.06823394e-02  4.60673809e-01  6.02925420e-01 ...  3.24921995e-01
     1.04718611e-01 -1.58913881e-02]]

  [[-9.89496291e-01 -2.28034067e+00 -4.65770274e-01 ...  9.05292690e-01
     1.31671894e+00 -2.62397647e+00]
   [ 2.73619556e+00 -1.19982243e+00 -8.90243053e-01 ...  8.88069630e-01
    -2.49271917e+00  6.38128102e-01]
   [ 2.65486717e-01 -9.36597288e-01 -2.26501361e-01 ...  7.89906383e-01
     2.64253438e-01 -1.54404032e+00]
   ...
   [ 8.88795853e-01  4.19449806e-01 -1.31677404e-01 ... -1.44587427e-01
     1.60444900e-01  7.86565840e-01]
   [ 6.20679498e-01 -3.09349168e-02 -7.91752115e-02 ...  2.12947667e-01
     4.52699423e-01 -4.27538991e-01]
   [ 1.51768339e+00 -6.86108112e-01 -5.19433916e-01 ...  8.20886314e-01
    -1.61538243e+00  4.96454746e-01]]

  ...

  [[-1.93900931e+00  9.56776202e-01 -7.22770751e-01 ... -3.64780903e+00
    -1.20873117e+00  5.78473091e-01]
   [-1.91978967e+00  9.52506959e-01 -7.18067110e-01 ... -3.63153648e+00
    -1.20011437e+00  5.64615130e-01]
   [ 1.13323188e+00  2.74490476e-01  2.91602630e-02 ... -1.04666018e+00
     1.68502882e-01 -1.63648641e+00]
   ...
   [-9.65424627e-03  3.01193118e-01 -8.90445411e-01 ...  1.25340295e+00
     7.67022252e-01 -1.48774993e+00]
   [-8.38349983e-02  3.29421610e-01  2.05519293e-02 ... -4.30834830e-01
     9.83346924e-02 -4.91602421e-01]
   [-8.79599810e-01  5.56961596e-01 -2.73982048e-01 ... -8.26965213e-01
    -2.33744815e-01 -5.18603250e-03]]

  [[-1.29923272e+00  1.53244448e+00  1.97592986e+00 ...  6.29627824e-01
    -5.29890582e-02 -6.03037596e-01]
   [-1.68376660e+00  1.11880100e+00  1.63602161e+00 ...  3.54732394e-01
     3.78832996e-01 -3.69500518e-02]
   [-6.39278531e-01  9.33873057e-02  2.67779678e-01 ... -4.15775478e-02
     3.14840615e-01  2.70498484e-01]
   ...
   [ 4.73732054e-01  8.08765292e-01  1.01117045e-01 ... -2.74987817e-01
     5.65101087e-01 -1.03257787e+00]
   [-3.34460050e-01  4.02308077e-01  8.45288515e-01 ...  3.72240037e-01
     4.41988468e-01 -2.88152277e-01]
   [-5.97713649e-01  7.07387149e-01  1.10987842e+00 ... -1.62755564e-01
     5.37062585e-01 -7.13493764e-01]]

  [[-3.36533010e-01  1.90447044e+00  5.47249496e-01 ...  1.87709844e+00
     1.82404280e+00  3.79020646e-02]
   [-1.02109706e+00  1.38052642e-01  1.20829010e+00 ...  9.08815622e-01
    -6.33766830e-01 -1.07515240e+00]
   [ 2.16193318e+00  7.69874930e-01  1.73297763e+00 ...  8.60440493e-01
    -7.19913691e-02  1.73657107e+00]
   ...
   [-1.96993947e-02  2.75630087e-01  6.84226632e-01 ... -1.27147153e-01
     8.62534821e-01  9.46446538e-01]
   [ 1.35823846e-01 -1.24995194e-01  4.45521116e-01 ...  1.08402900e-01
     4.50459301e-01  7.95582473e-01]
   [ 8.64298463e-01  9.02236819e-01 -3.70637118e-03 ... -7.55506337e-01
     1.51475930e+00  6.20114684e-01]]]


 [[[-2.26368761e+00 -1.32969999e+00 -1.74184334e+00 ...  1.12960064e+00
     4.66800362e-01  1.27265155e-01]
   [-2.00869989e+00 -1.01412058e+00 -1.68652332e+00 ...  1.20897388e+00
     3.23379546e-01 -2.22038627e-02]
   [-7.67917395e-01 -5.37955165e-01 -1.35505855e+00 ...  1.40620744e+00
     1.99594796e-01 -1.24814495e-01]
   ...
   [-1.86822955e-02 -1.97873563e-01  2.40139425e-01 ...  3.75839829e-01
     3.05520833e-01  3.93878203e-03]
   [-6.42579645e-02 -2.13937268e-01  2.39238322e-01 ...  3.07306379e-01
     2.60626227e-01  5.58849797e-02]
   [-4.77582842e-01 -7.56255865e-01  1.30282152e+00 ...  1.55566037e-01
     3.23009670e-01  6.84235692e-01]]

  [[-1.38347304e+00  1.00602376e+00 -5.52631974e-01 ...  1.71281469e+00
    -1.08262527e+00  3.53664368e-01]
   [-1.29324949e+00  1.02489829e+00 -2.19189316e-01 ...  1.64533544e+00
    -8.89300585e-01  7.50101089e-01]
   [-6.49460316e-01  8.96787763e-01  1.72321784e+00 ...  1.11043537e+00
     1.84710845e-01  2.80992126e+00]
   ...
   [ 7.75210559e-01  3.29163122e+00  8.70719492e-01 ... -1.48697589e-02
     2.44690681e+00  5.81471920e-01]
   [-3.07237297e-01  1.42511964e+00  9.03173983e-01 ...  6.95866406e-01
     6.14094615e-01  1.54046524e+00]
   [-3.89264882e-01  7.67606795e-01  1.08027017e+00 ... -4.93159145e-01
     3.67084235e-01  2.04485178e-01]]

  [[ 9.36926007e-02 -3.22689843e+00  1.71103254e-01 ... -1.21090794e+00
    -2.02136135e+00 -1.11706996e+00]
   [-2.79869437e-01 -2.15468264e+00 -4.93416935e-02 ... -1.08508527e+00
    -9.89084840e-01 -8.45869660e-01]
   [-3.73899668e-01  3.88945580e-01  9.36176896e-01 ... -2.59674668e-01
     2.19871950e+00 -3.25751901e-01]
   ...
   [-1.39570498e+00  7.62282014e-01 -3.17624480e-01 ... -1.34943932e-01
     6.70537233e-01 -5.93995750e-01]
   [ 3.40779305e-01  1.47536612e+00 -3.60523313e-02 ... -9.02792394e-01
    -4.53548163e-01 -5.60013413e-01]
   [-1.62954068e+00  2.98392117e-01  8.68432105e-01 ... -5.17879248e-01
     3.76725525e-01  1.06745446e+00]]

  ...

  [[-1.13498032e+00 -2.11556292e+00  1.68736053e+00 ...  1.70813143e-01
     2.19372201e+00  2.58187437e+00]
   [-1.10655975e+00 -1.53254223e+00  7.80538976e-01 ... -3.08028579e-01
     5.36256671e-01  9.48726416e-01]
   [-9.95369077e-01 -1.90533495e+00  1.39209223e+00 ...  1.01499468e-01
     1.91331494e+00  2.24692750e+00]
   ...
   [ 1.19967245e-01 -3.34568143e-01  1.12565890e-01 ... -2.24164203e-01
     5.40539145e-01  2.91082054e-01]
   [-2.71856248e-01  6.62626624e-01 -4.27140892e-01 ... -3.39427054e-01
    -8.66104662e-02  3.27952355e-01]
   [ 1.91729128e-01 -8.77790675e-02 -1.76413968e-01 ... -8.06268096e-01
     1.05495401e-01 -5.01971185e-01]]

  [[ 1.72602996e-01  2.11062336e+00  4.68108654e+00 ...  4.12132263e-01
    -1.02812219e+00 -2.57971549e+00]
   [-8.60962033e-01  4.15421426e-01  2.73034000e+00 ...  1.54259801e-02
     2.29192257e-01 -1.45125151e+00]
   [ 4.99950171e-01  1.37053442e+00  2.87182164e+00 ...  6.75544441e-01
     1.74942791e-01 -1.37292433e+00]
   ...
   [-1.18098721e-01  9.27825272e-02  7.67347097e-01 ... -6.23830557e-01
     7.15233386e-03 -6.62179053e-01]
   [ 1.45703530e+00  1.39258996e-01  1.18960238e+00 ...  3.19821507e-01
     9.68956769e-01 -5.63906133e-01]
   [ 1.20680678e+00 -7.25321412e-01  1.15869832e+00 ... -5.21722674e-01
    -2.63733178e-01 -1.01185131e+00]]

  [[ 6.37745976e-01  3.53443789e+00 -2.27697301e+00 ... -9.76260841e-01
     5.63374698e-01 -1.29292980e-01]
   [ 4.04195011e-01  2.91727233e+00 -1.54645419e+00 ... -1.02003634e+00
     4.51286286e-01 -1.20281152e-01]
   [-3.43784809e-01  5.98550498e-01  1.53447258e+00 ... -9.83640492e-01
     1.65576607e-01  2.34840289e-01]
   ...
   [-5.87274194e-01  1.71326208e+00  5.75284123e-01 ... -4.17494595e-01
     2.85412163e-01  1.98020816e-01]
   [-2.11977816e+00  3.21846366e-01 -3.86474699e-01 ... -1.80514109e+00
     1.15860894e-01  7.81069815e-01]
   [-1.21087205e+00  1.15588200e+00 -8.86267185e-01 ... -1.57509577e+00
     1.82912901e-01  4.10269886e-01]]]


 ...


 [[[-5.81752360e-01  3.44163746e-01 -2.49595785e+00 ... -2.93711782e-01
     1.03746641e+00 -9.60568607e-01]
   [-1.49139598e-01  8.82307440e-02 -6.39870465e-01 ... -7.52967373e-02
     2.65967667e-01 -2.46253952e-01]
   [-5.17336488e-01  2.97487199e-01 -2.33543038e+00 ... -2.84436375e-01
     9.81735647e-01 -8.38425457e-01]
   ...
   [ 1.85172391e+00  6.88915908e-01 -8.86410713e-01 ... -2.82224727e+00
    -1.87406564e+00 -4.96018499e-01]
   [ 1.32482743e+00 -2.43603081e-01 -4.55201298e-01 ... -4.55583215e-01
    -2.55014420e-01  3.00904661e-01]
   [ 3.62168491e-01  1.25108421e-01 -5.76131582e-01 ... -5.00924706e-01
    -6.72146380e-01 -1.65072098e-01]]

  [[-1.08642913e-01  4.94845331e-01 -9.10507381e-01 ...  1.79240718e-01
    -1.56138957e-01 -1.95835400e+00]
   [-2.68791735e-01  1.88738421e-01 -2.11162627e-01 ...  1.95015967e-03
    -5.61707079e-01 -1.93135965e+00]
   [-4.12897855e-01 -3.35227489e-01  9.08069849e-01 ... -2.63538092e-01
    -9.68743801e-01 -1.20779014e+00]
   ...
   [-1.62071392e-01  4.46958125e-01  5.65382242e-01 ...  1.48923230e+00
     1.48068178e+00  1.56304622e+00]
   [ 4.44034487e-01 -2.04093426e-01 -2.64475524e-01 ... -9.03847992e-01
     4.64929461e-01 -1.76124597e+00]
   [ 2.41002068e-02  1.32405937e-01  2.67979145e-01 ...  1.27929568e+00
    -5.08562684e-01 -3.42044383e-01]]

  [[ 8.12354863e-01 -1.94242382e+00  2.53800416e+00 ... -5.59932087e-04
    -5.57049394e-01  2.05057526e+00]
   [ 4.13025111e-01 -2.59387195e-02 -2.59224892e-01 ...  1.13577497e+00
     2.95841050e+00 -2.97223043e+00]
   [ 7.99629569e-01 -9.85594332e-01  1.37959301e+00 ...  7.09049582e-01
    -3.19452137e-01  1.00953162e+00]
   ...
   [ 4.16173518e-01 -5.01366317e-01  6.83909953e-02 ...  3.94708037e-01
     3.79981697e-01 -7.26426840e-01]
   [-1.56855190e+00 -4.76175427e-01 -1.17017794e+00 ... -9.29960310e-01
     1.17733037e+00 -1.88426721e+00]
   [-8.89138103e-01  4.08153236e-02  6.50491774e-01 ... -2.50984788e-01
     5.41734099e-01  3.45794737e-01]]

  ...

  [[-3.33693504e+00  2.52770519e+00 -2.81408250e-01 ...  6.57395184e-01
     7.28161275e-01 -2.09349346e+00]
   [-1.96665168e+00 -7.60260820e-01 -5.08257270e-01 ... -3.21490541e-02
     6.99217260e-01  8.36895049e-01]
   [-3.55896831e-01  2.16685677e+00 -7.73211181e-01 ...  1.23213816e+00
     2.32373163e-01 -1.97820807e+00]
   ...
   [ 5.37171774e-02 -3.81488264e-01  4.79379058e-01 ... -2.97695249e-01
    -3.64379078e-01  5.50755978e-01]
   [-5.49640477e-01 -4.08615232e-01  1.20350790e+00 ... -1.22697520e+00
    -1.60642743e+00  2.01526022e+00]
   [ 2.00721651e-01 -2.12198228e-01  8.22655261e-01 ... -9.46224511e-01
    -4.34228718e-01  9.39361989e-01]]

  [[ 9.74743068e-01 -4.56221074e-01  8.52239251e-01 ...  8.89442861e-01
    -6.04839087e-01 -2.97298819e-01]
   [ 7.57520199e-01  1.77382314e+00  2.61249632e-01 ... -2.29002476e+00
    -1.75549582e-01  1.06816697e+00]
   [ 1.66542500e-01 -2.96084374e-01 -1.26760912e+00 ...  8.15469921e-02
     4.60680187e-01  6.96373999e-01]
   ...
   [-1.09702098e+00 -8.37583423e-01 -5.00708103e-01 ...  5.46397448e-01
    -5.78725576e-01  5.43211579e-01]
   [ 1.64058596e-01 -6.34329200e-01 -4.36089873e-01 ... -1.20245531e-01
     4.80881035e-02 -1.38670218e+00]
   [ 2.19546750e-01 -1.11321759e+00  2.51626015e-01 ... -2.15958178e-01
    -4.34738398e-01 -9.51468647e-01]]

  [[-2.57644463e+00  3.59935611e-01  1.04213428e+00 ... -6.26056910e-01
    -5.16646028e-01  1.65048623e+00]
   [-2.32694149e-02  1.12777805e+00 -2.71035790e-01 ... -8.31319869e-01
     1.27804017e+00  1.24677825e+00]
   [-1.12399745e+00  7.84024954e-01  2.94780731e-01 ... -7.45897472e-01
     4.99859452e-01  1.42394960e+00]
   ...
   [-8.80785704e-01  5.62168598e-01  9.62531269e-02 ... -2.35306203e-01
     2.95695186e-01 -4.03274298e-01]
   [-1.80555236e+00  3.71082872e-01  5.27578712e-01 ... -4.89081532e-01
    -1.20152846e-01  8.30838144e-01]
   [ 6.49179816e-02  3.90921205e-01  1.01945497e-01 ...  5.53815424e-01
     4.23582196e-01  4.38757509e-01]]]


 [[[-5.58018446e-01 -2.59619570e+00 -8.55319083e-01 ...  1.77737689e+00
    -1.69964403e-01  2.62572360e+00]
   [-5.71741343e-01 -2.53597188e+00 -7.75540829e-01 ...  1.67979658e+00
    -1.54332072e-01  2.63889980e+00]
   [-3.03634524e-01 -3.01727057e-01  4.37284261e-01 ... -2.98006594e-01
     8.49179849e-02  9.68526840e-01]
   ...
   [ 7.69319892e-01 -9.32197273e-01  1.77951694e+00 ...  6.89521313e-01
    -5.24875522e-02  9.84754443e-01]
   [ 4.66630131e-01 -2.24785042e+00  9.65893805e-01 ...  1.89549518e+00
     3.35151219e+00  1.16855168e+00]
   [ 1.58572602e+00 -2.54476047e+00  7.97629476e-01 ...  1.60725999e+00
     2.17554307e+00  1.06432796e+00]]

  [[ 1.15905404e+00 -1.74042296e+00  1.22544169e+00 ... -2.43289232e+00
     8.34249079e-01 -1.43135464e+00]
   [ 1.05719709e+00 -8.71141136e-01  3.00047541e+00 ... -5.17996848e-01
     1.37865734e+00 -1.65410861e-01]
   [ 1.00851488e+00 -1.46385074e+00  1.43720388e+00 ... -2.39670181e+00
     8.63785744e-01 -1.31345630e+00]
   ...
   [ 4.20442134e-01 -3.50320578e-01  1.25352991e+00 ... -2.04647875e+00
     4.21821892e-01 -1.50310147e+00]
   [-5.93016148e-01 -4.86405551e-01 -2.14733481e-01 ...  1.71686113e-01
     5.96841395e-01 -9.85887527e-01]
   [-1.56680122e-01 -1.43146038e-01  1.01901734e+00 ... -1.27776182e+00
     6.55081809e-01 -6.93887293e-01]]

  [[-1.90798426e+00 -6.87051892e-01 -2.62374550e-01 ...  1.05238163e+00
     7.58074582e-01 -1.61847258e+00]
   [ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [-1.04696083e+00  8.39102268e-01 -7.53290713e-01 ...  5.45103997e-02
     6.84192538e-01 -2.91862440e+00]
   ...
   [-1.74058437e+00 -5.38189888e-01 -1.27251923e+00 ...  3.60746324e-01
     8.24135542e-01 -2.65114212e+00]
   [-1.00933301e+00 -3.47437203e-01  6.24680042e-01 ...  1.56430051e-01
    -3.72718573e-02 -1.01788855e+00]
   [-9.06024992e-01  1.06564665e+00 -3.67266983e-01 ...  9.62841153e-01
     1.28338207e-02 -1.61181641e+00]]

  ...

  [[ 9.33918133e-02 -3.38961601e-01 -2.66901922e+00 ...  2.79383445e+00
     6.91826820e-01  5.42460322e-01]
   [ 1.28744245e-01 -4.41653997e-01 -2.56017137e+00 ...  2.69068551e+00
     6.61756516e-01  5.93239427e-01]
   [ 9.10352916e-02 -1.32295918e+00 -1.02454340e+00 ...  8.19357753e-01
    -1.56150609e-01  7.95906782e-01]
   ...
   [ 3.75554055e-01 -7.09119588e-02 -6.56312823e-01 ... -2.30068251e-01
    -6.60074949e-01  8.88773739e-01]
   [-1.83948860e-01 -3.98976892e-01 -9.74371254e-01 ...  5.48822701e-01
    -3.51455927e-01  2.69939333e-01]
   [-1.30411637e+00  9.17844713e-01 -9.17613089e-01 ... -1.01106417e+00
    -7.12455273e-01  1.05230466e-01]]

  [[ 1.71476221e+00  1.15988874e+00  1.87364972e+00 ...  7.84420729e-01
    -9.89434898e-01 -1.31717193e+00]
   [ 1.21469164e+00  9.15790737e-01  1.51445317e+00 ...  8.36512625e-01
    -7.81823456e-01 -7.51220822e-01]
   [-7.34085858e-01 -4.96707439e-01  4.04226154e-01 ... -1.68514621e+00
    -9.44303095e-01  1.40023935e+00]
   ...
   [-8.53290677e-01  5.75351238e-01  4.58847255e-01 ...  2.83664584e-01
    -1.36248678e-01 -2.64592469e-02]
   [-8.17043185e-01  7.56789923e-01  8.71214271e-01 ...  2.03953266e-01
    -2.88370371e-01 -5.53507924e-01]
   [-2.71746248e-01 -4.78595614e-01  1.03931963e+00 ... -3.30825210e+00
    -1.75693142e+00  5.17006457e-01]]

  [[ 5.06350219e-01  1.32385290e+00 -2.56270099e+00 ...  7.18286395e-01
    -5.20129800e-01  1.70674831e-01]
   [-8.60642865e-02 -5.06062865e-01  3.42647463e-01 ...  1.40352935e-01
     2.73786128e-01  9.83596802e-01]
   [-1.20731622e-01 -4.40794498e-01  4.96990889e-01 ...  1.47657827e-01
     2.87844688e-01  8.02182734e-01]
   ...
   [ 4.83587414e-01  1.17127764e+00  2.16478273e-01 ...  4.38829958e-01
    -1.37858689e-01 -4.47489440e-01]
   [ 2.97087908e-01  1.30885541e+00 -1.55114591e+00 ...  3.06451291e-01
    -4.89314049e-01  6.69429958e-01]
   [ 5.42326212e-01  7.73510456e-01  3.81412923e-01 ...  6.84002876e-01
    -2.10783362e-01 -3.17981660e-01]]]


 [[[-8.50064814e-01 -1.42857540e+00 -2.80589685e-02 ...  1.06838666e-01
     2.70102191e+00  2.05848503e+00]
   [-8.01909447e-01 -1.34764802e+00 -2.64694560e-02 ...  1.00786358e-01
     2.54801178e+00  1.94187391e+00]
   [-7.39975154e-01 -1.24520826e+00 -1.92725323e-02 ...  1.00393951e-01
     2.34488606e+00  1.78072667e+00]
   ...
   [-1.10716768e-01 -4.82840389e-01  1.02218144e-01 ... -2.92010725e-01
    -2.80653000e-01  2.73010522e-01]
   [-4.93608713e-01 -7.87164927e-01  8.42456967e-02 ... -3.55253637e-01
     2.32951134e-01  8.28024983e-01]
   [-3.62903953e-01  9.36302483e-01  1.01086056e+00 ...  6.90571964e-02
     3.19983542e-01  7.56695807e-01]]

  [[ 2.15103090e-01  1.06647146e+00  3.78134817e-01 ... -4.99942660e-01
     2.03401983e-01 -2.14995074e+00]
   [ 1.86021209e-01  1.06425261e+00  4.02105421e-01 ... -4.55460042e-01
     1.80872768e-01 -2.06586742e+00]
   [ 2.85228163e-01  4.62182522e-01  1.63079369e+00 ...  3.25105000e+00
     1.49038994e+00 -7.06218719e-01]
   ...
   [-1.22752917e+00  8.45273912e-01  1.60493636e+00 ...  1.85636389e+00
    -9.09008145e-01  2.42010427e+00]
   [ 4.98922557e-01 -5.89296699e-01  2.38539949e-01 ...  1.16451748e-01
     5.18669426e-01 -2.74631053e-01]
   [-3.63835096e-01 -9.42648292e-01  5.91055095e-01 ... -6.66119516e-01
    -2.03453824e-01  4.74575758e-01]]

  [[-1.85111642e+00  2.09157920e+00  2.86882460e-01 ... -5.19811690e-01
     2.05612481e-01  2.51445770e-01]
   [-1.71900618e+00  1.87039769e+00  5.85891604e-02 ... -5.48945427e-01
     1.52490407e-01  3.29989493e-02]
   [-1.82015598e+00  2.03473568e+00  2.39021882e-01 ... -5.28222561e-01
     1.89370483e-01  2.05119595e-01]
   ...
   [-2.54207969e-01 -2.30750942e+00  2.49396339e-02 ... -1.54902613e+00
    -1.76857042e+00 -2.61515677e-01]
   [-1.50543833e+00  6.42960489e-01 -3.16290617e-01 ...  1.91602492e+00
    -2.50301194e+00 -5.18292606e-01]
   [-8.37749481e-01 -9.04044926e-01 -4.68748987e-01 ... -3.24692160e-01
    -5.05455017e-01 -4.16478395e-01]]

  ...

  [[-3.81195068e-01  4.62803870e-01  1.15634763e+00 ...  3.82096797e-01
    -3.00082088e+00  1.37392557e+00]
   [-3.28766286e-01  4.89813745e-01  8.62709165e-01 ...  5.14064789e-01
    -2.50129104e+00  1.07106447e+00]
   [ 4.66504805e-02  6.71102941e-01 -1.28830409e+00 ...  1.47852933e+00
     1.18475938e+00 -1.13030338e+00]
   ...
   [-6.54701531e-01  1.72166809e-01 -1.96638420e-01 ... -4.09423500e-01
    -3.71878266e-01  1.77383590e+00]
   [ 3.65034461e-01 -9.31289017e-01  1.12766325e+00 ... -5.63041151e-01
    -5.46963871e-01  1.28839183e+00]
   [-6.98896050e-02  2.51635104e-01  5.78953087e-01 ...  2.57540405e-01
    -1.19697464e+00  1.29433334e+00]]

  [[ 0.00000000e+00  0.00000000e+00  0.00000000e+00 ...  0.00000000e+00
     0.00000000e+00  0.00000000e+00]
   [-2.04000378e+00 -1.42655969e+00  5.60651064e-01 ...  5.08479953e-01
    -5.31973839e-01 -1.38490915e-01]
   [-2.08994722e+00 -1.18981516e+00  6.28036678e-01 ...  5.76762080e-01
    -4.40766692e-01 -1.65894121e-01]
   ...
   [ 1.20329714e+00  6.08143330e-01  6.85967326e-01 ...  2.24076819e+00
    -3.20530772e-01 -2.00783253e+00]
   [-1.28037989e+00 -1.47345948e+00 -8.90369713e-02 ... -5.05413115e-01
    -3.19186598e-01  1.85506403e-01]
   [ 3.33542302e-02 -9.96513247e-01 -1.30889583e+00 ...  6.85186148e-01
     3.63192767e-01 -7.24361062e-01]]

  [[-9.37368631e-01  1.89797997e+00  7.10287333e-01 ... -3.52320218e+00
     1.93573058e-01  3.78565121e+00]
   [ 5.50879717e-01 -3.66968811e-01 -2.39907646e+00 ... -2.35867858e+00
    -5.92676282e-01 -1.03357971e+00]
   [ 4.57157969e-01  9.23636854e-01 -3.21105909e+00 ...  1.33900166e+00
     4.25627172e-01 -6.07378781e-01]
   ...
   [ 4.50781107e-01  2.43478119e-02  6.61099494e-01 ...  1.70800400e+00
     5.58783412e-01  2.34279454e-01]
   [-1.27451032e-01 -2.30846000e+00  1.40785784e-01 ... -1.66719615e-01
    -5.59109092e-01 -6.49723411e-01]
   [ 1.90829396e-01 -7.04484403e-01 -1.93689466e-01 ...  2.50799686e-01
    -4.41140652e-01 -2.41706327e-01]]]]
FAILED

=================================== FAILURES ===================================
_______________ test_attention_layer[cpu-0.0-False-32-8-27-5-4] ________________

batch_size = 4, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.0, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = False
current_input_id = '4-5-27-8-32-False-0.0-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-False-0.0-cpu().npy'>
input_dim  = 27
k          = array([[[-0.17591418, -0.81691647, -0.38043165, -1.4896185 ,
         -0.3424145 ,  0.5975326 , -0.55117905, -0.862665...  -0.12426752,  1.3688309 , -0.28665462,  1.8718244 ,
          1.2692264 ,  1.2295368 , -0.991682  ]]], dtype=float32)
label_result = array([[[ 2.684392  ,  0.9753974 ,  1.1736592 , -0.94691074,
         -1.639431  ,  1.5847182 , -0.47033298,  0.386539...   0.0308926 , -1.7722621 , -1.4601024 ,  1.809397  ,
          0.0587098 , -0.91223675, -0.41190767]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-False-0.0-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb1e7e10fd0>
num_head   = 8
q          = array([[[-8.04154854e-03,  6.31518424e-01,  2.25275445e+00,
         -7.59383500e-01, -6.42755508e-01, -1.04077518e+00...,  5.16363382e-01, -4.79716718e-01,
          7.03656971e-01,  1.89074099e-01, -1.07197821e+00]]],
      dtype=float32)
result     = array([[[ 1.1413963 ,  2.5955107 ,  0.4908291 , -0.61278707,
          0.54178596,  0.5745801 ,  0.59717864, -1.029976...  -0.6802785 ,  0.44650224,  0.89780754, -0.3478823 ,
          0.5838422 ,  0.69775784,  0.4009544 ]]], dtype=float32)
seq_len    = 5
v          = array([[[-1.32029665e+00,  3.13428760e-01,  3.91371369e-01,
         -1.15919903e-01, -1.81199983e-01,  1.58794081e+00...,  6.39540374e-01,  1.90380514e-01,
         -7.48570561e-02,  2.28314137e+00, -8.06154013e-01]]],
      dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb1770f4ca0>, array([[[ 1.1413963 ,  2.5955107 ,  0.4908291 , -0.612...  0.0308926 , -1.7722621 , -1.4601024 ,  1.809397  ,
          0.0587098 , -0.91223675, -0.41190767]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 540 / 540 (100%)
E           Max absolute difference: 7.6331496
E           Max relative difference: 246.42119
E            x: array([[[ 1.141396,  2.595511,  0.490829, -0.612787,  0.541786,
E                     0.57458 ,  0.597179, -1.029977, -1.846357, -0.106231,
E                     2.436829, -0.405172,  0.774709, -1.821504,  1.03205 ,...
E            y: array([[[ 2.684392,  0.975397,  1.173659, -0.946911, -1.639431,
E                     1.584718, -0.470333,  0.38654 ,  3.446278,  0.030415,
E                     2.34821 , -1.859018,  0.229898, -0.925394, -3.297908,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb1770f4ca0>, array([[[ 1.1413963 ,  2.5955107 ,  0.4908291 , -0.612...  0.0308926 , -1.7722621 , -1.4601024 ,  1.809397  ,
          0.0587098 , -0.91223675, -0.41190767]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cpu-0.0-False-32-8-27-5-8] ________________

batch_size = 8, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.0, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = False
current_input_id = '8-5-27-8-32-False-0.0-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-False-0.0-cpu().npy'>
input_dim  = 27
k          = array([[[-1.3202966 ,  0.31342876,  0.39137137, ..., -0.05047274,
         -0.37128997,  0.06527077],
        [-1.0428...
        [ 0.7475417 , -0.12896587, -0.21562193, ..., -0.4836035 ,
          0.526678  ,  0.26005384]]], dtype=float32)
label_result = array([[[-0.98619014,  0.01227057, -1.0986575 , ..., -0.6001241 ,
          1.1766448 ,  1.0502951 ],
        [-2.2617...
        [-0.84644544,  0.99343395,  0.86754274, ..., -0.10476331,
          0.19767864,  0.0904889 ]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-False-0.0-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb17711e3a0>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.6823758 , -0.6566193 ,  0.32996404, ...,  1.2692264 ,
          1.2295368 , -0.991682  ]]], dtype=float32)
result     = array([[[ 1.1133957 ,  1.3988233 , -2.4611478 , ...,  0.9047266 ,
          0.72520775, -0.66226894],
        [-0.7116...
        [-1.2725768 , -2.967183  , -0.64246064, ..., -0.7607485 ,
          4.298591  , -2.0962002 ]]], dtype=float32)
seq_len    = 5
v          = array([[[-0.05705854, -1.8222909 ,  0.37688625, ..., -0.30623534,
         -0.7493343 , -0.15542848],
        [ 2.5435...
        [-0.59417653, -0.05847015, -0.01491287, ...,  0.67793965,
          0.08334691,  0.17072625]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176aef3a0>, array([[[ 1.1133957 ,  1.3988233 , -2.4611478 , ...,  ...        [-0.84644544,  0.99343395,  0.86754274, ..., -0.10476331,
          0.19767864,  0.0904889 ]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1080 / 1080 (100%)
E           Max absolute difference: 5.7682467
E           Max relative difference: 1137.2069
E            x: array([[[ 1.113396,  1.398823, -2.461148, ...,  0.904727,  0.725208,
E                    -0.662269],
E                   [-0.711652,  1.558339, -0.303517, ...,  0.110257, -0.0561  ,...
E            y: array([[[-0.98619 ,  0.012271, -1.098657, ..., -0.600124,  1.176645,
E                     1.050295],
E                   [-2.261757,  0.475472,  0.094867, ..., -0.7179  ,  0.300461,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176aef3a0>, array([[[ 1.1133957 ,  1.3988233 , -2.4611478 , ...,  ...        [-0.84644544,  0.99343395,  0.86754274, ..., -0.10476331,
          0.19767864,  0.0904889 ]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cpu-0.0-False-32-8-27-11-4] _______________

batch_size = 4, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.0, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = False
current_input_id = '4-11-27-8-32-False-0.0-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-False-0.0-cpu().npy'>
input_dim  = 27
k          = array([[[ 3.31167579e-01, -1.21368361e+00, -1.94302607e+00, ...,
         -3.49218071e-01, -9.10320699e-01,  2.0637938...49814832e-01,  1.62794697e+00, ...,
          1.30049407e-01,  1.38784778e+00,  7.90922821e-01]]],
      dtype=float32)
label_result = array([[[ 0.958886  , -0.9810894 , -2.4749491 , ..., -1.4079584 ,
         -0.55122584, -0.8794164 ],
        [-0.0266...
        [ 1.7334445 , -1.7192147 , -2.112659  , ..., -0.14162265,
          0.63673735,  1.2376459 ]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-False-0.0-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb177124130>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 3.4161992 ,  0.04355975, -0.76129997, ...,  0.59368753,
          0.31795904,  0.14328356]]], dtype=float32)
result     = array([[[ 1.3423111 ,  2.1469648 , -0.24065743, ...,  1.8989532 ,
         -0.4764918 ,  0.82515144],
        [-2.1423...
        [-0.41440547,  0.7241264 , -0.8658513 , ..., -0.09846438,
          0.36229676,  0.06566399]]], dtype=float32)
seq_len    = 11
v          = array([[[ 0.46454597, -0.29647216, -0.00637594, ...,  0.8831419 ,
          1.8853118 , -0.61863774],
        [-0.3089...
        [-0.10503879, -1.4589338 , -0.06638545, ..., -0.8672699 ,
          0.8674379 ,  1.4639174 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176aefb80>, array([[[ 1.3423111 ,  2.1469648 , -0.24065743, ...,  ...        [ 1.7334445 , -1.7192147 , -2.112659  , ..., -0.14162265,
          0.63673735,  1.2376459 ]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1188 / 1188 (100%)
E           Max absolute difference: 6.6190166
E           Max relative difference: 357.51843
E            x: array([[[ 1.342311,  2.146965, -0.240657, ...,  1.898953, -0.476492,
E                     0.825151],
E                   [-2.142376,  0.252431,  1.007315, ...,  2.405457, -2.506706,...
E            y: array([[[ 0.958886, -0.981089, -2.474949, ..., -1.407958, -0.551226,
E                    -0.879416],
E                   [-0.026666, -2.63918 , -1.162378, ...,  0.319178, -0.150182,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176aefb80>, array([[[ 1.3423111 ,  2.1469648 , -0.24065743, ...,  ...        [ 1.7334445 , -1.7192147 , -2.112659  , ..., -0.14162265,
          0.63673735,  1.2376459 ]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cpu-0.0-False-32-8-27-11-8] _______________

batch_size = 8, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.0, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = False
current_input_id = '8-11-27-8-32-False-0.0-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-False-0.0-cpu().npy'>
input_dim  = 27
k          = array([[[ 4.64545965e-01, -2.96472162e-01, -6.37594005e-03, ...,
          8.83141875e-01,  1.88531184e+00, -6.1863774...70587523e-02, -1.71661545e-02, ...,
         -1.40956357e-01, -1.46573985e+00, -9.60531652e-01]]],
      dtype=float32)
label_result = array([[[ 2.2122066 , -0.62547314, -1.1846288 , ..., -0.45579988,
          3.4089773 ,  1.5059081 ],
        [-1.6189...
        [-1.5021623 , -1.263076  ,  0.522946  , ..., -0.6085389 ,
         -0.34653932, -0.6441026 ]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-False-0.0-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb176afe190>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.07931643,  0.34981483,  1.627947  , ...,  0.13004941,
          1.3878478 ,  0.7909228 ]]], dtype=float32)
result     = array([[[-4.71048474e-01,  7.36927211e-01,  4.25018638e-01, ...,
         -8.34151745e-01,  4.18677092e-01,  3.7866899...24058485e-01, -1.20106113e+00, ...,
          3.21060419e-01,  1.07927859e+00, -1.08807790e+00]]],
      dtype=float32)
seq_len    = 11
v          = array([[[-0.18071565, -0.93578744, -0.1328542 , ...,  0.21799618,
          0.3303766 , -0.71756196],
        [-1.2459...
        [ 0.25303677,  0.72302336,  0.13070038, ..., -0.46647197,
          1.0845269 ,  0.7676009 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176afc0d0>, array([[[-4.71048474e-01,  7.36927211e-01,  4.25018638...        [-1.5021623 , -1.263076  ,  0.522946  , ..., -0.6085389 ,
         -0.34653932, -0.6441026 ]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 2376 / 2376 (100%)
E           Max absolute difference: 7.861343
E           Max relative difference: 3631.5603
E            x: array([[[-4.710485e-01,  7.369272e-01,  4.250186e-01, ...,
E                    -8.341517e-01,  4.186771e-01,  3.786690e-01],
E                   [-5.213118e-01, -9.580985e-03,  1.808504e+00, ...,...
E            y: array([[[ 2.212207, -0.625473, -1.184629, ..., -0.4558  ,  3.408977,
E                     1.505908],
E                   [-1.618987, -0.403133, -0.318609, ..., -1.115377,  2.052999,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176afc0d0>, array([[[-4.71048474e-01,  7.36927211e-01,  4.25018638...        [-1.5021623 , -1.263076  ,  0.522946  , ..., -0.6085389 ,
         -0.34653932, -0.6441026 ]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
________________ test_attention_layer[cpu-0.0-True-32-8-27-5-4] ________________

batch_size = 4, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.0, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = True
current_input_id = '4-5-27-8-32-True-0.0-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-True-0.0-cpu().npy'>
input_dim  = 27
k          = array([[[-0.17591418, -0.81691647, -0.38043165, -1.4896185 ,
         -0.3424145 ,  0.5975326 , -0.55117905, -0.862665...  -0.12426752,  1.3688309 , -0.28665462,  1.8718244 ,
          1.2692264 ,  1.2295368 , -0.991682  ]]], dtype=float32)
label_result = array([[[ 1.15346432e+00, -1.19938540e+00, -2.15440130e+00,
         -3.92032194e+00,  6.66048586e-01,  2.13432884e+00..., -1.46010244e+00,  1.80939698e+00,
          5.87098040e-02, -9.12236750e-01, -4.11907673e-01]]],
      dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-True-0.0-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb176afe3d0>
num_head   = 8
q          = array([[[-8.04154854e-03,  6.31518424e-01,  2.25275445e+00,
         -7.59383500e-01, -6.42755508e-01, -1.04077518e+00...,  5.16363382e-01, -4.79716718e-01,
          7.03656971e-01,  1.89074099e-01, -1.07197821e+00]]],
      dtype=float32)
result     = array([[[ 0.85227764,  4.291686  ,  0.8970603 ,  0.6002846 ,
         -1.6225426 , -0.89698756, -2.1739423 , -0.412180...  -0.6802785 ,  0.44650224,  0.89780754, -0.3478823 ,
          0.5838422 ,  0.69775784,  0.4009544 ]]], dtype=float32)
seq_len    = 5
v          = array([[[-1.32029665e+00,  3.13428760e-01,  3.91371369e-01,
         -1.15919903e-01, -1.81199983e-01,  1.58794081e+00...,  6.39540374e-01,  1.90380514e-01,
         -7.48570561e-02,  2.28314137e+00, -8.06154013e-01]]],
      dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb1770f4ca0>, array([[[ 0.85227764,  4.291686  ,  0.8970603 ,  0.600... -1.46010244e+00,  1.80939698e+00,
          5.87098040e-02, -9.12236750e-01, -4.11907673e-01]]],
      dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 540 / 540 (100%)
E           Max absolute difference: 9.34763
E           Max relative difference: 992.19617
E            x: array([[[ 0.852278,  4.291686,  0.89706 ,  0.600285, -1.622543,
E                    -0.896988, -2.173942, -0.41218 ,  3.368036,  1.363919,
E                     0.554489, -1.930448, -0.081659, -1.879353,  0.313441,...
E            y: array([[[ 1.153464e+00, -1.199385e+00, -2.154401e+00, -3.920322e+00,
E                     6.660486e-01,  2.134329e+00,  1.545630e+00, -3.000924e-01,
E                     1.683147e+00,  1.500266e+00,  2.056209e+00, -2.836608e+00,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb1770f4ca0>, array([[[ 0.85227764,  4.291686  ,  0.8970603 ,  0.600... -1.46010244e+00,  1.80939698e+00,
          5.87098040e-02, -9.12236750e-01, -4.11907673e-01]]],
      dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
________________ test_attention_layer[cpu-0.0-True-32-8-27-5-8] ________________

batch_size = 8, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.0, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = True
current_input_id = '8-5-27-8-32-True-0.0-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-True-0.0-cpu().npy'>
input_dim  = 27
k          = array([[[-1.3202966 ,  0.31342876,  0.39137137, ..., -0.05047274,
         -0.37128997,  0.06527077],
        [-1.0428...
        [ 0.7475417 , -0.12896587, -0.21562193, ..., -0.4836035 ,
          0.526678  ,  0.26005384]]], dtype=float32)
label_result = array([[[-0.52561927,  0.01307313, -2.9664428 , ..., -3.252933  ,
          0.93879956, -0.32285666],
        [-0.8999...
        [-0.84644544,  0.99343395,  0.86754274, ..., -0.10476331,
          0.19767864,  0.0904889 ]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-True-0.0-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb176adf820>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.6823758 , -0.6566193 ,  0.32996404, ...,  1.2692264 ,
          1.2295368 , -0.991682  ]]], dtype=float32)
result     = array([[[-1.4737704 , -0.5738725 , -1.409698  , ..., -0.3833657 ,
          1.4484162 , -0.97327757],
        [-1.2953...
        [-1.2725768 , -2.967183  , -0.64246064, ..., -0.7607485 ,
          4.298591  , -2.0962002 ]]], dtype=float32)
seq_len    = 5
v          = array([[[-0.05705854, -1.8222909 ,  0.37688625, ..., -0.30623534,
         -0.7493343 , -0.15542848],
        [ 2.5435...
        [-0.59417653, -0.05847015, -0.01491287, ...,  0.67793965,
          0.08334691,  0.17072625]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176afc430>, array([[[-1.4737704 , -0.5738725 , -1.409698  , ..., -...        [-0.84644544,  0.99343395,  0.86754274, ..., -0.10476331,
          0.19767864,  0.0904889 ]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1080 / 1080 (100%)
E           Max absolute difference: 7.046466
E           Max relative difference: 33097.582
E            x: array([[[-1.47377 , -0.573873, -1.409698, ..., -0.383366,  1.448416,
E                    -0.973278],
E                   [-1.295334,  0.044158,  0.07078 , ..., -2.037281,  0.955328,...
E            y: array([[[-0.525619,  0.013073, -2.966443, ..., -3.252933,  0.9388  ,
E                    -0.322857],
E                   [-0.899977,  0.696251, -0.650439, ..., -3.034249,  1.538145,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176afc430>, array([[[-1.4737704 , -0.5738725 , -1.409698  , ..., -...        [-0.84644544,  0.99343395,  0.86754274, ..., -0.10476331,
          0.19767864,  0.0904889 ]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cpu-0.0-True-32-8-27-11-4] ________________

batch_size = 4, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.0, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = True
current_input_id = '4-11-27-8-32-True-0.0-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-True-0.0-cpu().npy'>
input_dim  = 27
k          = array([[[ 3.31167579e-01, -1.21368361e+00, -1.94302607e+00, ...,
         -3.49218071e-01, -9.10320699e-01,  2.0637938...49814832e-01,  1.62794697e+00, ...,
          1.30049407e-01,  1.38784778e+00,  7.90922821e-01]]],
      dtype=float32)
label_result = array([[[-3.23120546e+00,  2.48784423e+00, -7.00054109e-01, ...,
         -2.83167267e+00,  3.56361079e+00,  9.1523045...71921468e+00, -2.11265898e+00, ...,
         -1.41622648e-01,  6.36737347e-01,  1.23764586e+00]]],
      dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-True-0.0-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb17711f160>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 3.4161992 ,  0.04355975, -0.76129997, ...,  0.59368753,
          0.31795904,  0.14328356]]], dtype=float32)
result     = array([[[ 1.8854189 , -1.3444659 , -3.9229677 , ...,  2.683056  ,
         -2.56832   , -3.084055  ],
        [ 0.4277...
        [-0.41440547,  0.7241264 , -0.8658513 , ..., -0.09846438,
          0.36229676,  0.06566399]]], dtype=float32)
seq_len    = 11
v          = array([[[ 0.46454597, -0.29647216, -0.00637594, ...,  0.8831419 ,
          1.8853118 , -0.61863774],
        [-0.3089...
        [-0.10503879, -1.4589338 , -0.06638545, ..., -0.8672699 ,
          0.8674379 ,  1.4639174 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176afcca0>, array([[[ 1.8854189 , -1.3444659 , -3.9229677 , ...,  ...1921468e+00, -2.11265898e+00, ...,
         -1.41622648e-01,  6.36737347e-01,  1.23764586e+00]]],
      dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1188 / 1188 (100%)
E           Max absolute difference: 7.9500628
E           Max relative difference: 4514.377
E            x: array([[[ 1.885419, -1.344466, -3.922968, ...,  2.683056, -2.56832 ,
E                    -3.084055],
E                   [ 0.427769,  3.029819, -0.34498 , ...,  0.052667,  0.054343,...
E            y: array([[[-3.231205e+00,  2.487844e+00, -7.000541e-01, ...,
E                    -2.831673e+00,  3.563611e+00,  9.152305e-01],
E                   [-2.176373e+00,  3.947623e+00, -1.859022e+00, ...,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176afcca0>, array([[[ 1.8854189 , -1.3444659 , -3.9229677 , ...,  ...1921468e+00, -2.11265898e+00, ...,
         -1.41622648e-01,  6.36737347e-01,  1.23764586e+00]]],
      dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cpu-0.0-True-32-8-27-11-8] ________________

batch_size = 8, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.0, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = True
current_input_id = '8-11-27-8-32-True-0.0-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-True-0.0-cpu().npy'>
input_dim  = 27
k          = array([[[ 4.64545965e-01, -2.96472162e-01, -6.37594005e-03, ...,
          8.83141875e-01,  1.88531184e+00, -6.1863774...70587523e-02, -1.71661545e-02, ...,
         -1.40956357e-01, -1.46573985e+00, -9.60531652e-01]]],
      dtype=float32)
label_result = array([[[-7.6738834e-01,  1.2576637e+00,  4.0786333e+00, ...,
         -3.3998165e-01,  4.5593637e-01,  3.5968187e-01]...23e+00, -1.2630759e+00,  5.2294600e-01, ...,
         -6.0853893e-01, -3.4653932e-01, -6.4410257e-01]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-True-0.0-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb176a2b250>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.07931643,  0.34981483,  1.627947  , ...,  0.13004941,
          1.3878478 ,  0.7909228 ]]], dtype=float32)
result     = array([[[-1.7508776e+00, -2.5629845e+00,  2.7685773e+00, ...,
         -1.5953350e-01, -1.4444786e+00, -5.0518781e-01]...03e-04,  6.2405849e-01, -1.2010611e+00, ...,
          3.2106042e-01,  1.0792786e+00, -1.0880779e+00]]], dtype=float32)
seq_len    = 11
v          = array([[[-0.18071565, -0.93578744, -0.1328542 , ...,  0.21799618,
          0.3303766 , -0.71756196],
        [-1.2459...
        [ 0.25303677,  0.72302336,  0.13070038, ..., -0.46647197,
          1.0845269 ,  0.7676009 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176afcb80>, array([[[-1.7508776e+00, -2.5629845e+00,  2.7685773e+0...3e+00, -1.2630759e+00,  5.2294600e-01, ...,
         -6.0853893e-01, -3.4653932e-01, -6.4410257e-01]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 2376 / 2376 (100%)
E           Max absolute difference: 8.308762
E           Max relative difference: 5671.669
E            x: array([[[-1.750878e+00, -2.562984e+00,  2.768577e+00, ...,
E                    -1.595335e-01, -1.444479e+00, -5.051878e-01],
E                   [-1.713299e+00, -1.214198e+00,  2.572685e+00, ...,...
E            y: array([[[-7.673883e-01,  1.257664e+00,  4.078633e+00, ...,
E                    -3.399816e-01,  4.559364e-01,  3.596819e-01],
E                   [-1.668349e+00,  7.955310e-01,  3.222340e+00, ...,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176afcb80>, array([[[-1.7508776e+00, -2.5629845e+00,  2.7685773e+0...3e+00, -1.2630759e+00,  5.2294600e-01, ...,
         -6.0853893e-01, -3.4653932e-01, -6.4410257e-01]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cpu-0.1-False-32-8-27-5-4] ________________

batch_size = 4, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.1, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = False
current_input_id = '4-5-27-8-32-False-0.1-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-False-0.1-cpu().npy'>
input_dim  = 27
k          = array([[[-0.17591418, -0.81691647, -0.38043165, -1.4896185 ,
         -0.3424145 ,  0.5975326 , -0.55117905, -0.862665...  -0.12426752,  1.3688309 , -0.28665462,  1.8718244 ,
          1.2692264 ,  1.2295368 , -0.991682  ]]], dtype=float32)
label_result = array([[[ 2.9346378 ,  0.44954157,  2.71005   , -0.12178468,
         -2.279935  ,  1.3231928 , -0.14751923, -0.227303...  -0.0944917 , -0.91556394, -0.9561459 ,  0.99187815,
         -0.8582566 , -0.3194808 ,  0.49116212]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-False-0.1-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb1769b8760>
num_head   = 8
q          = array([[[-8.04154854e-03,  6.31518424e-01,  2.25275445e+00,
         -7.59383500e-01, -6.42755508e-01, -1.04077518e+00...,  5.16363382e-01, -4.79716718e-01,
          7.03656971e-01,  1.89074099e-01, -1.07197821e+00]]],
      dtype=float32)
result     = array([[[ 1.15931761e+00,  2.67736983e+00,  8.63862395e-01,
         -3.45565617e-01,  8.71939898e-01,  5.40359199e-01...,  1.47021949e+00,  1.00337811e-01,
          8.77430856e-01,  1.13272369e+00,  5.61406184e-03]]],
      dtype=float32)
seq_len    = 5
v          = array([[[-1.32029665e+00,  3.13428760e-01,  3.91371369e-01,
         -1.15919903e-01, -1.81199983e-01,  1.58794081e+00...,  6.39540374e-01,  1.90380514e-01,
         -7.48570561e-02,  2.28314137e+00, -8.06154013e-01]]],
      dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176aaf700>, array([[[ 1.15931761e+00,  2.67736983e+00,  8.63862395... -0.0944917 , -0.91556394, -0.9561459 ,  0.99187815,
         -0.8582566 , -0.3194808 ,  0.49116212]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 540 / 540 (100%)
E           Max absolute difference: 7.79678
E           Max relative difference: 501.52115
E            x: array([[[ 1.159318e+00,  2.677370e+00,  8.638624e-01, -3.455656e-01,
E                     8.719399e-01,  5.403592e-01,  7.094053e-01, -1.090203e+00,
E                    -1.853167e+00,  2.115200e-01,  2.196262e+00,  4.791695e-02,...
E            y: array([[[ 2.934638,  0.449542,  2.71005 , -0.121785, -2.279935,
E                     1.323193, -0.147519, -0.227303,  3.561441,  0.389996,
E                     2.331522, -2.525777, -0.628982, -0.837106, -3.046321,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176aaf700>, array([[[ 1.15931761e+00,  2.67736983e+00,  8.63862395... -0.0944917 , -0.91556394, -0.9561459 ,  0.99187815,
         -0.8582566 , -0.3194808 ,  0.49116212]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cpu-0.1-False-32-8-27-5-8] ________________

batch_size = 8, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.1, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = False
current_input_id = '8-5-27-8-32-False-0.1-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-False-0.1-cpu().npy'>
input_dim  = 27
k          = array([[[-1.3202966 ,  0.31342876,  0.39137137, ..., -0.05047274,
         -0.37128997,  0.06527077],
        [-1.0428...
        [ 0.7475417 , -0.12896587, -0.21562193, ..., -0.4836035 ,
          0.526678  ,  0.26005384]]], dtype=float32)
label_result = array([[[-1.3441794 , -0.29734766, -0.7343235 , ..., -0.6605535 ,
          1.3073803 ,  0.8877822 ],
        [-2.1590...
        [-0.76379997,  1.1710805 ,  0.91764796, ..., -0.2500516 ,
          0.54487824,  0.40733796]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-False-0.1-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb17712d9a0>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.6823758 , -0.6566193 ,  0.32996404, ...,  1.2692264 ,
          1.2295368 , -0.991682  ]]], dtype=float32)
result     = array([[[ 1.7573109 ,  0.7188603 , -2.0107496 , ...,  0.48746946,
          0.89025044, -0.54549587],
        [-0.7833...
        [-1.4106015 , -4.020299  , -0.6814308 , ..., -0.40422365,
          4.881533  , -2.1860442 ]]], dtype=float32)
seq_len    = 5
v          = array([[[-0.05705854, -1.8222909 ,  0.37688625, ..., -0.30623534,
         -0.7493343 , -0.15542848],
        [ 2.5435...
        [-0.59417653, -0.05847015, -0.01491287, ...,  0.67793965,
          0.08334691,  0.17072625]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176aaf790>, array([[[ 1.7573109 ,  0.7188603 , -2.0107496 , ...,  ...        [-0.76379997,  1.1710805 ,  0.91764796, ..., -0.2500516 ,
          0.54487824,  0.40733796]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1080 / 1080 (100%)
E           Max absolute difference: 6.3069525
E           Max relative difference: 2930.9473
E            x: array([[[ 1.757311,  0.71886 , -2.01075 , ...,  0.487469,  0.89025 ,
E                    -0.545496],
E                   [-0.783388,  1.599858, -0.323495, ...,  0.150906,  0.035989,...
E            y: array([[[-1.344179, -0.297348, -0.734324, ..., -0.660554,  1.30738 ,
E                     0.887782],
E                   [-2.159029,  0.659327,  0.377896, ..., -0.840012,  0.414792,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176aaf790>, array([[[ 1.7573109 ,  0.7188603 , -2.0107496 , ...,  ...        [-0.76379997,  1.1710805 ,  0.91764796, ..., -0.2500516 ,
          0.54487824,  0.40733796]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cpu-0.1-False-32-8-27-11-4] _______________

batch_size = 4, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.1, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = False
current_input_id = '4-11-27-8-32-False-0.1-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-False-0.1-cpu().npy'>
input_dim  = 27
k          = array([[[ 3.31167579e-01, -1.21368361e+00, -1.94302607e+00, ...,
         -3.49218071e-01, -9.10320699e-01,  2.0637938...49814832e-01,  1.62794697e+00, ...,
          1.30049407e-01,  1.38784778e+00,  7.90922821e-01]]],
      dtype=float32)
label_result = array([[[ 1.1349121e+00, -1.5840466e+00, -3.1853986e+00, ...,
         -1.8324615e+00, -1.0809383e+00, -8.0918926e-01]...75e+00, -1.9234445e+00, -2.2858939e+00, ...,
         -1.3492970e-01,  7.4084115e-01,  1.4316829e+00]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-False-0.1-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb1769f3280>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 3.4161992 ,  0.04355975, -0.76129997, ...,  0.59368753,
          0.31795904,  0.14328356]]], dtype=float32)
result     = array([[[ 2.1161158 ,  2.0653305 , -0.4616498 , ...,  1.5772606 ,
         -0.17069575,  0.99156183],
        [-1.4310...
        [-0.607339  ,  0.78120816, -0.8462765 , ...,  0.010862  ,
          0.32768828,  0.16622663]]], dtype=float32)
seq_len    = 11
v          = array([[[ 0.46454597, -0.29647216, -0.00637594, ...,  0.8831419 ,
          1.8853118 , -0.61863774],
        [-0.3089...
        [-0.10503879, -1.4589338 , -0.06638545, ..., -0.8672699 ,
          0.8674379 ,  1.4639174 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176aafdc0>, array([[[ 2.1161158 ,  2.0653305 , -0.4616498 , ...,  ...5e+00, -1.9234445e+00, -2.2858939e+00, ...,
         -1.3492970e-01,  7.4084115e-01,  1.4316829e+00]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1188 / 1188 (100%)
E           Max absolute difference: 6.4894385
E           Max relative difference: 2943.468
E            x: array([[[ 2.116116,  2.065331, -0.46165 , ...,  1.577261, -0.170696,
E                     0.991562],
E                   [-1.43103 , -0.546311,  0.427665, ...,  1.491289, -2.669832,...
E            y: array([[[ 1.134912e+00, -1.584047e+00, -3.185399e+00, ...,
E                    -1.832461e+00, -1.080938e+00, -8.091893e-01],
E                   [ 2.013414e+00, -2.546045e+00, -4.875801e-02, ...,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176aafdc0>, array([[[ 2.1161158 ,  2.0653305 , -0.4616498 , ...,  ...5e+00, -1.9234445e+00, -2.2858939e+00, ...,
         -1.3492970e-01,  7.4084115e-01,  1.4316829e+00]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cpu-0.1-False-32-8-27-11-8] _______________

batch_size = 8, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.1, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = False
current_input_id = '8-11-27-8-32-False-0.1-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-False-0.1-cpu().npy'>
input_dim  = 27
k          = array([[[ 4.64545965e-01, -2.96472162e-01, -6.37594005e-03, ...,
          8.83141875e-01,  1.88531184e+00, -6.1863774...70587523e-02, -1.71661545e-02, ...,
         -1.40956357e-01, -1.46573985e+00, -9.60531652e-01]]],
      dtype=float32)
label_result = array([[[ 2.37022352e+00, -5.30359209e-01, -1.93081474e+00, ...,
         -3.15548092e-01,  4.43342543e+00,  1.2920631...42766678e+00,  4.06287760e-01, ...,
         -7.07697570e-01, -9.39380825e-02, -4.77803469e-01]]],
      dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-False-0.1-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb1769cb040>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.07931643,  0.34981483,  1.627947  , ...,  0.13004941,
          1.3878478 ,  0.7909228 ]]], dtype=float32)
result     = array([[[-0.3650772 ,  0.7972993 ,  0.4254355 , ..., -0.7849034 ,
          0.4540216 ,  0.21651223],
        [-0.4745...
        [-0.6892055 , -0.3975557 , -1.1409695 , ...,  0.6002578 ,
          0.8171405 , -1.0051343 ]]], dtype=float32)
seq_len    = 11
v          = array([[[-0.18071565, -0.93578744, -0.1328542 , ...,  0.21799618,
          0.3303766 , -0.71756196],
        [-1.2459...
        [ 0.25303677,  0.72302336,  0.13070038, ..., -0.46647197,
          1.0845269 ,  0.7676009 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176aaf4c0>, array([[[-0.3650772 ,  0.7972993 ,  0.4254355 , ..., -...2766678e+00,  4.06287760e-01, ...,
         -7.07697570e-01, -9.39380825e-02, -4.77803469e-01]]],
      dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 2376 / 2376 (100%)
E           Max absolute difference: 7.2609816
E           Max relative difference: 2502.4375
E            x: array([[[-0.365077,  0.797299,  0.425436, ..., -0.784903,  0.454022,
E                     0.216512],
E                   [-0.474539,  0.003377,  2.010797, ..., -0.73309 , -0.181145,...
E            y: array([[[ 2.370224e+00, -5.303592e-01, -1.930815e+00, ...,
E                    -3.155481e-01,  4.433425e+00,  1.292063e+00],
E                   [-1.364768e+00, -4.587602e-01, -1.173035e-01, ...,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176aaf4c0>, array([[[-0.3650772 ,  0.7972993 ,  0.4254355 , ..., -...2766678e+00,  4.06287760e-01, ...,
         -7.07697570e-01, -9.39380825e-02, -4.77803469e-01]]],
      dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
________________ test_attention_layer[cpu-0.1-True-32-8-27-5-4] ________________

batch_size = 4, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.1, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = True
current_input_id = '4-5-27-8-32-True-0.1-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-True-0.1-cpu().npy'>
input_dim  = 27
k          = array([[[-0.17591418, -0.81691647, -0.38043165, -1.4896185 ,
         -0.3424145 ,  0.5975326 , -0.55117905, -0.862665...  -0.12426752,  1.3688309 , -0.28665462,  1.8718244 ,
          1.2692264 ,  1.2295368 , -0.991682  ]]], dtype=float32)
label_result = array([[[ 1.28162801e+00, -1.33264995e+00, -2.39378119e+00,
         -4.35591412e+00,  7.40054250e-01,  2.37147737e+00..., -9.56145883e-01,  9.91878152e-01,
         -8.58256578e-01, -3.19480807e-01,  4.91162121e-01]]],
      dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-True-0.1-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb176a2b100>
num_head   = 8
q          = array([[[-8.04154854e-03,  6.31518424e-01,  2.25275445e+00,
         -7.59383500e-01, -6.42755508e-01, -1.04077518e+00...,  5.16363382e-01, -4.79716718e-01,
          7.03656971e-01,  1.89074099e-01, -1.07197821e+00]]],
      dtype=float32)
result     = array([[[ 9.46975172e-01,  4.76853991e+00,  9.96734917e-01,
          6.66983366e-01, -1.80282462e+00, -9.96652782e-01...,  1.47021949e+00,  1.00337811e-01,
          8.77430856e-01,  1.13272369e+00,  5.61406184e-03]]],
      dtype=float32)
seq_len    = 5
v          = array([[[-1.32029665e+00,  3.13428760e-01,  3.91371369e-01,
         -1.15919903e-01, -1.81199983e-01,  1.58794081e+00...,  6.39540374e-01,  1.90380514e-01,
         -7.48570561e-02,  2.28314137e+00, -8.06154013e-01]]],
      dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176aefd30>, array([[[ 9.46975172e-01,  4.76853991e+00,  9.96734917... -9.56145883e-01,  9.91878152e-01,
         -8.58256578e-01, -3.19480807e-01,  4.91162121e-01]]],
      dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 540 / 540 (100%)
E           Max absolute difference: 10.386257
E           Max relative difference: 501.52115
E            x: array([[[ 9.469752e-01,  4.768540e+00,  9.967349e-01,  6.669834e-01,
E                    -1.802825e+00, -9.966528e-01, -2.415492e+00, -4.579788e-01,
E                     3.742263e+00,  1.515466e+00,  6.160998e-01, -2.144943e+00,...
E            y: array([[[ 1.281628e+00, -1.332650e+00, -2.393781e+00, -4.355914e+00,
E                     7.400542e-01,  2.371477e+00,  1.717367e+00, -3.334369e-01,
E                     1.870164e+00,  1.666961e+00,  2.284678e+00, -3.151788e+00,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176aefd30>, array([[[ 9.46975172e-01,  4.76853991e+00,  9.96734917... -9.56145883e-01,  9.91878152e-01,
         -8.58256578e-01, -3.19480807e-01,  4.91162121e-01]]],
      dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
________________ test_attention_layer[cpu-0.1-True-32-8-27-5-8] ________________

batch_size = 8, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.1, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = True
current_input_id = '8-5-27-8-32-True-0.1-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-True-0.1-cpu().npy'>
input_dim  = 27
k          = array([[[-1.3202966 ,  0.31342876,  0.39137137, ..., -0.05047274,
         -0.37128997,  0.06527077],
        [-1.0428...
        [ 0.7475417 , -0.12896587, -0.21562193, ..., -0.4836035 ,
          0.526678  ,  0.26005384]]], dtype=float32)
label_result = array([[[-5.84021509e-01,  1.45251937e-02, -3.29604650e+00, ...,
         -3.61437178e+00,  1.04311121e+00, -3.5872936...17108047e+00,  9.17647958e-01, ...,
         -2.50051588e-01,  5.44878244e-01,  4.07337964e-01]]],
      dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-True-0.1-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb1e7dc87f0>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.6823758 , -0.6566193 ,  0.32996404, ...,  1.2692264 ,
          1.2295368 , -0.991682  ]]], dtype=float32)
result     = array([[[-1.6375222 , -0.63763636, -1.566331  , ..., -0.42596185,
          1.6093522 , -1.0814186 ],
        [-1.4392...
        [-1.4106015 , -4.020299  , -0.6814308 , ..., -0.40422365,
          4.881533  , -2.1860442 ]]], dtype=float32)
seq_len    = 5
v          = array([[[-0.05705854, -1.8222909 ,  0.37688625, ..., -0.30623534,
         -0.7493343 , -0.15542848],
        [ 2.5435...
        [-0.59417653, -0.05847015, -0.01491287, ...,  0.67793965,
          0.08334691,  0.17072625]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176aaf430>, array([[[-1.6375222 , -0.63763636, -1.566331  , ..., -...7108047e+00,  9.17647958e-01, ...,
         -2.50051588e-01,  5.44878244e-01,  4.07337964e-01]]],
      dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1080 / 1080 (100%)
E           Max absolute difference: 7.829411
E           Max relative difference: 18696.88
E            x: array([[[-1.637522, -0.637636, -1.566331, ..., -0.425962,  1.609352,
E                    -1.081419],
E                   [-1.43926 ,  0.049064,  0.078644, ..., -2.263646,  1.061475,...
E            y: array([[[-5.840215e-01,  1.452519e-02, -3.296046e+00, ...,
E                    -3.614372e+00,  1.043111e+00, -3.587294e-01],
E                   [-9.999736e-01,  7.736127e-01, -7.227108e-01, ...,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176aaf430>, array([[[-1.6375222 , -0.63763636, -1.566331  , ..., -...7108047e+00,  9.17647958e-01, ...,
         -2.50051588e-01,  5.44878244e-01,  4.07337964e-01]]],
      dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cpu-0.1-True-32-8-27-11-4] ________________

batch_size = 4, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.1, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = True
current_input_id = '4-11-27-8-32-True-0.1-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-True-0.1-cpu().npy'>
input_dim  = 27
k          = array([[[ 3.31167579e-01, -1.21368361e+00, -1.94302607e+00, ...,
         -3.49218071e-01, -9.10320699e-01,  2.0637938...49814832e-01,  1.62794697e+00, ...,
          1.30049407e-01,  1.38784778e+00,  7.90922821e-01]]],
      dtype=float32)
label_result = array([[[-3.2658248 ,  1.9407164 , -2.0358129 , ..., -2.824458  ,
          2.8177793 ,  1.2496612 ],
        [-1.4604...
        [ 1.9301375 , -1.9234445 , -2.285894  , ..., -0.1349297 ,
          0.74084115,  1.431683  ]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-True-0.1-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb176a78880>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 3.4161992 ,  0.04355975, -0.76129997, ...,  0.59368753,
          0.31795904,  0.14328356]]], dtype=float32)
result     = array([[[ 1.238408  , -0.44155067, -3.4360466 , ...,  2.5634758 ,
         -3.8426678 , -2.332249  ],
        [ 0.6872...
        [-0.607339  ,  0.78120816, -0.8462765 , ...,  0.010862  ,
          0.32768828,  0.16622663]]], dtype=float32)
seq_len    = 11
v          = array([[[ 0.46454597, -0.29647216, -0.00637594, ...,  0.8831419 ,
          1.8853118 , -0.61863774],
        [-0.3089...
        [-0.10503879, -1.4589338 , -0.06638545, ..., -0.8672699 ,
          0.8674379 ,  1.4639174 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176afcc10>, array([[[ 1.238408  , -0.44155067, -3.4360466 , ...,  ...        [ 1.9301375 , -1.9234445 , -2.285894  , ..., -0.1349297 ,
          0.74084115,  1.431683  ]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1188 / 1188 (100%)
E           Max absolute difference: 8.833403
E           Max relative difference: 254.99174
E            x: array([[[ 1.238408, -0.441551, -3.436047, ...,  2.563476, -3.842668,
E                    -2.332249],
E                   [ 0.687234,  3.51325 , -0.373974, ..., -0.143804,  0.142958,...
E            y: array([[[-3.265825,  1.940716, -2.035813, ..., -2.824458,  2.817779,
E                     1.249661],
E                   [-1.46042 ,  2.729792, -2.272669, ..., -2.328222,  2.80542 ,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176afcc10>, array([[[ 1.238408  , -0.44155067, -3.4360466 , ...,  ...        [ 1.9301375 , -1.9234445 , -2.285894  , ..., -0.1349297 ,
          0.74084115,  1.431683  ]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cpu-0.1-True-32-8-27-11-8] ________________

batch_size = 8, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.1, device = cpu()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = True
current_input_id = '8-11-27-8-32-True-0.1-cpu()'
device     = cpu()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-True-0.1-cpu().npy'>
input_dim  = 27
k          = array([[[ 4.64545965e-01, -2.96472162e-01, -6.37594005e-03, ...,
          8.83141875e-01,  1.88531184e+00, -6.1863774...70587523e-02, -1.71661545e-02, ...,
         -1.40956357e-01, -1.46573985e+00, -9.60531652e-01]]],
      dtype=float32)
label_result = array([[[-0.54865247,  1.1625483 ,  3.5370312 , ...,  0.0205907 ,
          0.34213138,  0.07224222],
        [-1.1799...
        [-1.819364  , -1.4276668 ,  0.40628776, ..., -0.7076976 ,
         -0.09393808, -0.47780347]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-True-0.1-cpu().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb1769b8370>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.07931643,  0.34981483,  1.627947  , ...,  0.13004941,
          1.3878478 ,  0.7909228 ]]], dtype=float32)
result     = array([[[-1.3678005e+00, -2.4817986e+00,  3.6146562e+00, ...,
          5.4048139e-01, -1.4875273e+00, -3.9826873e-01]...53e-01, -3.9755571e-01, -1.1409695e+00, ...,
          6.0025781e-01,  8.1714052e-01, -1.0051343e+00]]], dtype=float32)
seq_len    = 11
v          = array([[[-0.18071565, -0.93578744, -0.1328542 , ...,  0.21799618,
          0.3303766 , -0.71756196],
        [-1.2459...
        [ 0.25303677,  0.72302336,  0.13070038, ..., -0.46647197,
          1.0845269 ,  0.7676009 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176aa0280>, array([[[-1.3678005e+00, -2.4817986e+00,  3.6146562e+0...        [-1.819364  , -1.4276668 ,  0.40628776, ..., -0.7076976 ,
         -0.09393808, -0.47780347]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 2376 / 2376 (100%)
E           Max absolute difference: 9.556066
E           Max relative difference: 1312.3376
E            x: array([[[-1.367800e+00, -2.481799e+00,  3.614656e+00, ...,
E                     5.404814e-01, -1.487527e+00, -3.982687e-01],
E                   [-1.251430e+00, -1.094189e+00,  2.000628e+00, ...,...
E            y: array([[[-0.548652,  1.162548,  3.537031, ...,  0.020591,  0.342131,
E                     0.072242],
E                   [-1.179979,  0.645918,  1.845055, ..., -0.584953,  0.704098,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176aa0280>, array([[[-1.3678005e+00, -2.4817986e+00,  3.6146562e+0...        [-1.819364  , -1.4276668 ,  0.40628776, ..., -0.7076976 ,
         -0.09393808, -0.47780347]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cuda-0.0-False-32-8-27-5-4] _______________

batch_size = 4, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.0, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = False
current_input_id = '4-5-27-8-32-False-0.0-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-False-0.0-cuda().npy'>
input_dim  = 27
k          = array([[[-0.17591418, -0.81691647, -0.38043165, -1.4896185 ,
         -0.3424145 ,  0.5975326 , -0.55117905, -0.862665...  -0.12426752,  1.3688309 , -0.28665462,  1.8718244 ,
          1.2692264 ,  1.2295368 , -0.991682  ]]], dtype=float32)
label_result = array([[[ 2.6843922 ,  0.9753972 ,  1.1736586 , -0.9469109 ,
         -1.6394303 ,  1.584719  , -0.47033277,  0.386539...   0.03089267, -1.7722632 , -1.4601024 ,  1.8093982 ,
          0.05870984, -0.91223776, -0.41190833]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-False-0.0-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb177111160>
num_head   = 8
q          = array([[[-8.04154854e-03,  6.31518424e-01,  2.25275445e+00,
         -7.59383500e-01, -6.42755508e-01, -1.04077518e+00...,  5.16363382e-01, -4.79716718e-01,
          7.03656971e-01,  1.89074099e-01, -1.07197821e+00]]],
      dtype=float32)
result     = array([[[ 1.1413968 ,  2.5955105 ,  0.49082917, -0.61278707,
          0.54178655,  0.57458025,  0.59717906, -1.029976...  -0.68027824,  0.4465024 ,  0.8978078 , -0.3478824 ,
          0.5838421 ,  0.69775784,  0.40095446]]], dtype=float32)
seq_len    = 5
v          = array([[[-1.32029665e+00,  3.13428760e-01,  3.91371369e-01,
         -1.15919903e-01, -1.81199983e-01,  1.58794081e+00...,  6.39540374e-01,  1.90380514e-01,
         -7.48570561e-02,  2.28314137e+00, -8.06154013e-01]]],
      dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176aa0d30>, array([[[ 1.1413968 ,  2.5955105 ,  0.49082917, -0.612...  0.03089267, -1.7722632 , -1.4601024 ,  1.8093982 ,
          0.05870984, -0.91223776, -0.41190833]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 540 / 540 (100%)
E           Max absolute difference: 7.63315
E           Max relative difference: 246.41347
E            x: array([[[ 1.141397,  2.59551 ,  0.490829, -0.612787,  0.541787,
E                     0.57458 ,  0.597179, -1.029977, -1.846357, -0.106231,
E                     2.436829, -0.405172,  0.77471 , -1.821504,  1.03205 ,...
E            y: array([[[ 2.684392,  0.975397,  1.173659, -0.946911, -1.63943 ,
E                     1.584719, -0.470333,  0.38654 ,  3.446279,  0.030415,
E                     2.34821 , -1.859017,  0.229898, -0.925394, -3.297909,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176aa0d30>, array([[[ 1.1413968 ,  2.5955105 ,  0.49082917, -0.612...  0.03089267, -1.7722632 , -1.4601024 ,  1.8093982 ,
          0.05870984, -0.91223776, -0.41190833]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cuda-0.0-False-32-8-27-5-8] _______________

batch_size = 8, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.0, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = False
current_input_id = '8-5-27-8-32-False-0.0-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-False-0.0-cuda().npy'>
input_dim  = 27
k          = array([[[-1.3202966 ,  0.31342876,  0.39137137, ..., -0.05047274,
         -0.37128997,  0.06527077],
        [-1.0428...
        [ 0.7475417 , -0.12896587, -0.21562193, ..., -0.4836035 ,
          0.526678  ,  0.26005384]]], dtype=float32)
label_result = array([[[-0.9861897 ,  0.01227093, -1.0986575 , ..., -0.60012406,
          1.1766453 ,  1.0502951 ],
        [-2.2617...
        [-0.8464455 ,  0.99343526,  0.8675424 , ..., -0.10476305,
          0.19767879,  0.0904888 ]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-False-0.0-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb17711f160>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.6823758 , -0.6566193 ,  0.32996404, ...,  1.2692264 ,
          1.2295368 , -0.991682  ]]], dtype=float32)
result     = array([[[ 1.1133953 ,  1.3988235 , -2.4611483 , ...,  0.9047268 ,
          0.725208  , -0.6622699 ],
        [-0.7116...
        [-1.2725767 , -2.9671826 , -0.6424608 , ..., -0.7607482 ,
          4.2985916 , -2.0962005 ]]], dtype=float32)
seq_len    = 5
v          = array([[[-0.05705854, -1.8222909 ,  0.37688625, ..., -0.30623534,
         -0.7493343 , -0.15542848],
        [ 2.5435...
        [-0.59417653, -0.05847015, -0.01491287, ...,  0.67793965,
          0.08334691,  0.17072625]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176aa0ee0>, array([[[ 1.1133953 ,  1.3988235 , -2.4611483 , ...,  ...        [-0.8464455 ,  0.99343526,  0.8675424 , ..., -0.10476305,
          0.19767879,  0.0904888 ]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1080 / 1080 (100%)
E           Max absolute difference: 5.7682467
E           Max relative difference: 1137.1652
E            x: array([[[ 1.113395,  1.398823, -2.461148, ...,  0.904727,  0.725208,
E                    -0.66227 ],
E                   [-0.711652,  1.558339, -0.303517, ...,  0.110257, -0.056099,...
E            y: array([[[-0.98619 ,  0.012271, -1.098657, ..., -0.600124,  1.176645,
E                     1.050295],
E                   [-2.261757,  0.475472,  0.094867, ..., -0.7179  ,  0.300462,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176aa0ee0>, array([[[ 1.1133953 ,  1.3988235 , -2.4611483 , ...,  ...        [-0.8464455 ,  0.99343526,  0.8675424 , ..., -0.10476305,
          0.19767879,  0.0904888 ]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
______________ test_attention_layer[cuda-0.0-False-32-8-27-11-4] _______________

batch_size = 4, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.0, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = False
current_input_id = '4-11-27-8-32-False-0.0-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-False-0.0-cuda().npy'>
input_dim  = 27
k          = array([[[ 3.31167579e-01, -1.21368361e+00, -1.94302607e+00, ...,
         -3.49218071e-01, -9.10320699e-01,  2.0637938...49814832e-01,  1.62794697e+00, ...,
          1.30049407e-01,  1.38784778e+00,  7.90922821e-01]]],
      dtype=float32)
label_result = array([[[ 0.9588864 , -0.98108953, -2.4749508 , ..., -1.4079578 ,
         -0.5512265 , -0.8794156 ],
        [-0.0266...
        [ 1.7334447 , -1.7192153 , -2.1126585 , ..., -0.14162238,
          0.63673747,  1.2376448 ]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-False-0.0-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb176a4e880>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 3.4161992 ,  0.04355975, -0.76129997, ...,  0.59368753,
          0.31795904,  0.14328356]]], dtype=float32)
result     = array([[[ 1.3423105 ,  2.1469631 , -0.24065776, ...,  1.8989524 ,
         -0.4764918 ,  0.8251513 ],
        [-2.1423...
        [-0.41440523,  0.7241263 , -0.8658507 , ..., -0.09846449,
          0.3622967 ,  0.06566393]]], dtype=float32)
seq_len    = 11
v          = array([[[ 0.46454597, -0.29647216, -0.00637594, ...,  0.8831419 ,
          1.8853118 , -0.61863774],
        [-0.3089...
        [-0.10503879, -1.4589338 , -0.06638545, ..., -0.8672699 ,
          0.8674379 ,  1.4639174 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176aa0ee0>, array([[[ 1.3423105 ,  2.1469631 , -0.24065776, ...,  ...        [ 1.7334447 , -1.7192153 , -2.1126585 , ..., -0.14162238,
          0.63673747,  1.2376448 ]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1188 / 1188 (100%)
E           Max absolute difference: 6.6190157
E           Max relative difference: 357.5368
E            x: array([[[ 1.342311,  2.146963, -0.240658, ...,  1.898952, -0.476492,
E                     0.825151],
E                   [-2.142376,  0.252431,  1.007315, ...,  2.405457, -2.506707,...
E            y: array([[[ 0.958886, -0.98109 , -2.474951, ..., -1.407958, -0.551226,
E                    -0.879416],
E                   [-0.026666, -2.639181, -1.162378, ...,  0.319179, -0.150182,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176aa0ee0>, array([[[ 1.3423105 ,  2.1469631 , -0.24065776, ...,  ...        [ 1.7334447 , -1.7192153 , -2.1126585 , ..., -0.14162238,
          0.63673747,  1.2376448 ]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
______________ test_attention_layer[cuda-0.0-False-32-8-27-11-8] _______________

batch_size = 8, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.0, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = False
current_input_id = '8-11-27-8-32-False-0.0-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-False-0.0-cuda().npy'>
input_dim  = 27
k          = array([[[ 4.64545965e-01, -2.96472162e-01, -6.37594005e-03, ...,
          8.83141875e-01,  1.88531184e+00, -6.1863774...70587523e-02, -1.71661545e-02, ...,
         -1.40956357e-01, -1.46573985e+00, -9.60531652e-01]]],
      dtype=float32)
label_result = array([[[ 2.2122064 , -0.6254729 , -1.1846285 , ..., -0.4557999 ,
          3.4089768 ,  1.5059081 ],
        [-1.6189...
        [-1.5021623 , -1.2630752 ,  0.5229462 , ..., -0.608539  ,
         -0.34653953, -0.6441029 ]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-False-0.0-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb176a884f0>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.07931643,  0.34981483,  1.627947  , ...,  0.13004941,
          1.3878478 ,  0.7909228 ]]], dtype=float32)
result     = array([[[-4.71048683e-01,  7.36927569e-01,  4.25019354e-01, ...,
         -8.34151566e-01,  4.18677241e-01,  3.7866923...24058604e-01, -1.20106137e+00, ...,
          3.21060658e-01,  1.07927859e+00, -1.08807814e+00]]],
      dtype=float32)
seq_len    = 11
v          = array([[[-0.18071565, -0.93578744, -0.1328542 , ...,  0.21799618,
          0.3303766 , -0.71756196],
        [-1.2459...
        [ 0.25303677,  0.72302336,  0.13070038, ..., -0.46647197,
          1.0845269 ,  0.7676009 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176afcc10>, array([[[-4.71048683e-01,  7.36927569e-01,  4.25019354...        [-1.5021623 , -1.2630752 ,  0.5229462 , ..., -0.608539  ,
         -0.34653953, -0.6441029 ]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 2376 / 2376 (100%)
E           Max absolute difference: 7.8613443
E           Max relative difference: 3632.057
E            x: array([[[-4.710487e-01,  7.369276e-01,  4.250194e-01, ...,
E                    -8.341516e-01,  4.186772e-01,  3.786692e-01],
E                   [-5.213122e-01, -9.581105e-03,  1.808503e+00, ...,...
E            y: array([[[ 2.212206, -0.625473, -1.184628, ..., -0.4558  ,  3.408977,
E                     1.505908],
E                   [-1.618988, -0.403132, -0.31861 , ..., -1.115377,  2.052999,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176afcc10>, array([[[-4.71048683e-01,  7.36927569e-01,  4.25019354...        [-1.5021623 , -1.2630752 ,  0.5229462 , ..., -0.608539  ,
         -0.34653953, -0.6441029 ]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cuda-0.0-True-32-8-27-5-4] ________________

batch_size = 4, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.0, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = True
current_input_id = '4-5-27-8-32-True-0.0-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-True-0.0-cuda().npy'>
input_dim  = 27
k          = array([[[-0.17591418, -0.81691647, -0.38043165, -1.4896185 ,
         -0.3424145 ,  0.5975326 , -0.55117905, -0.862665...  -0.12426752,  1.3688309 , -0.28665462,  1.8718244 ,
          1.2692264 ,  1.2295368 , -0.991682  ]]], dtype=float32)
label_result = array([[[ 1.15346432e+00, -1.19938540e+00, -2.15440130e+00,
         -3.92032194e+00,  6.66048586e-01,  2.13432884e+00..., -1.46010244e+00,  1.80939817e+00,
          5.87098449e-02, -9.12237763e-01, -4.11908329e-01]]],
      dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-True-0.0-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb17711c370>
num_head   = 8
q          = array([[[-8.04154854e-03,  6.31518424e-01,  2.25275445e+00,
         -7.59383500e-01, -6.42755508e-01, -1.04077518e+00...,  5.16363382e-01, -4.79716718e-01,
          7.03656971e-01,  1.89074099e-01, -1.07197821e+00]]],
      dtype=float32)
result     = array([[[ 0.85227764,  4.291686  ,  0.8970603 ,  0.6002846 ,
         -1.6225426 , -0.89698756, -2.1739423 , -0.412180...  -0.68027824,  0.4465024 ,  0.8978078 , -0.3478824 ,
          0.5838421 ,  0.69775784,  0.40095446]]], dtype=float32)
seq_len    = 5
v          = array([[[-1.32029665e+00,  3.13428760e-01,  3.91371369e-01,
         -1.15919903e-01, -1.81199983e-01,  1.58794081e+00...,  6.39540374e-01,  1.90380514e-01,
         -7.48570561e-02,  2.28314137e+00, -8.06154013e-01]]],
      dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176aafd30>, array([[[ 0.85227764,  4.291686  ,  0.8970603 ,  0.600... -1.46010244e+00,  1.80939817e+00,
          5.87098449e-02, -9.12237763e-01, -4.11908329e-01]]],
      dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 540 / 540 (100%)
E           Max absolute difference: 9.34763
E           Max relative difference: 992.3042
E            x: array([[[ 0.852278,  4.291686,  0.89706 ,  0.600285, -1.622543,
E                    -0.896988, -2.173942, -0.41218 ,  3.368036,  1.363919,
E                     0.554489, -1.930448, -0.081659, -1.879353,  0.313441,...
E            y: array([[[ 1.153464e+00, -1.199385e+00, -2.154401e+00, -3.920322e+00,
E                     6.660486e-01,  2.134329e+00,  1.545630e+00, -3.000924e-01,
E                     1.683147e+00,  1.500266e+00,  2.056209e+00, -2.836608e+00,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176aafd30>, array([[[ 0.85227764,  4.291686  ,  0.8970603 ,  0.600... -1.46010244e+00,  1.80939817e+00,
          5.87098449e-02, -9.12237763e-01, -4.11908329e-01]]],
      dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cuda-0.0-True-32-8-27-5-8] ________________

batch_size = 8, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.0, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = True
current_input_id = '8-5-27-8-32-True-0.0-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-True-0.0-cuda().npy'>
input_dim  = 27
k          = array([[[-1.3202966 ,  0.31342876,  0.39137137, ..., -0.05047274,
         -0.37128997,  0.06527077],
        [-1.0428...
        [ 0.7475417 , -0.12896587, -0.21562193, ..., -0.4836035 ,
          0.526678  ,  0.26005384]]], dtype=float32)
label_result = array([[[-0.52561873,  0.01307249, -2.9664423 , ..., -3.2529328 ,
          0.9387998 , -0.32285675],
        [-0.8999...
        [-0.8464455 ,  0.99343526,  0.8675424 , ..., -0.10476305,
          0.19767879,  0.0904888 ]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-True-0.0-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb176afe820>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.6823758 , -0.6566193 ,  0.32996404, ...,  1.2692264 ,
          1.2295368 , -0.991682  ]]], dtype=float32)
result     = array([[[-1.4737704 , -0.5738725 , -1.409698  , ..., -0.3833657 ,
          1.4484162 , -0.97327757],
        [-1.2953...
        [-1.2725767 , -2.9671826 , -0.6424608 , ..., -0.7607482 ,
          4.2985916 , -2.0962005 ]]], dtype=float32)
seq_len    = 5
v          = array([[[-0.05705854, -1.8222909 ,  0.37688625, ..., -0.30623534,
         -0.7493343 , -0.15542848],
        [ 2.5435...
        [-0.59417653, -0.05847015, -0.01491287, ...,  0.67793965,
          0.08334691,  0.17072625]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176a56040>, array([[[-1.4737704 , -0.5738725 , -1.409698  , ..., -...        [-0.8464455 ,  0.99343526,  0.8675424 , ..., -0.10476305,
          0.19767879,  0.0904888 ]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1080 / 1080 (100%)
E           Max absolute difference: 7.046467
E           Max relative difference: 32984.613
E            x: array([[[-1.47377 , -0.573873, -1.409698, ..., -0.383366,  1.448416,
E                    -0.973278],
E                   [-1.295334,  0.044158,  0.07078 , ..., -2.037281,  0.955328,...
E            y: array([[[-0.525619,  0.013072, -2.966442, ..., -3.252933,  0.9388  ,
E                    -0.322857],
E                   [-0.899977,  0.696252, -0.650439, ..., -3.034249,  1.538145,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176a56040>, array([[[-1.4737704 , -0.5738725 , -1.409698  , ..., -...        [-0.8464455 ,  0.99343526,  0.8675424 , ..., -0.10476305,
          0.19767879,  0.0904888 ]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cuda-0.0-True-32-8-27-11-4] _______________

batch_size = 4, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.0, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = True
current_input_id = '4-11-27-8-32-True-0.0-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-True-0.0-cuda().npy'>
input_dim  = 27
k          = array([[[ 3.31167579e-01, -1.21368361e+00, -1.94302607e+00, ...,
         -3.49218071e-01, -9.10320699e-01,  2.0637938...49814832e-01,  1.62794697e+00, ...,
          1.30049407e-01,  1.38784778e+00,  7.90922821e-01]]],
      dtype=float32)
label_result = array([[[-3.23120546e+00,  2.48784423e+00, -7.00054109e-01, ...,
         -2.83167267e+00,  3.56361079e+00,  9.1523045...71921527e+00, -2.11265850e+00, ...,
         -1.41622379e-01,  6.36737466e-01,  1.23764479e+00]]],
      dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-True-0.0-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb176a2b1c0>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 3.4161992 ,  0.04355975, -0.76129997, ...,  0.59368753,
          0.31795904,  0.14328356]]], dtype=float32)
result     = array([[[ 1.8854189 , -1.3444659 , -3.9229677 , ...,  2.683056  ,
         -2.56832   , -3.084055  ],
        [ 0.4277...
        [-0.41440523,  0.7241263 , -0.8658507 , ..., -0.09846449,
          0.3622967 ,  0.06566393]]], dtype=float32)
seq_len    = 11
v          = array([[[ 0.46454597, -0.29647216, -0.00637594, ...,  0.8831419 ,
          1.8853118 , -0.61863774],
        [-0.3089...
        [-0.10503879, -1.4589338 , -0.06638545, ..., -0.8672699 ,
          0.8674379 ,  1.4639174 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176a56b80>, array([[[ 1.8854189 , -1.3444659 , -3.9229677 , ...,  ...1921527e+00, -2.11265850e+00, ...,
         -1.41622379e-01,  6.36737466e-01,  1.23764479e+00]]],
      dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1188 / 1188 (100%)
E           Max absolute difference: 7.9500628
E           Max relative difference: 4509.212
E            x: array([[[ 1.885419, -1.344466, -3.922968, ...,  2.683056, -2.56832 ,
E                    -3.084055],
E                   [ 0.427768,  3.029819, -0.344979, ...,  0.052667,  0.054343,...
E            y: array([[[-3.231205e+00,  2.487844e+00, -7.000541e-01, ...,
E                    -2.831673e+00,  3.563611e+00,  9.152305e-01],
E                   [-2.176373e+00,  3.947624e+00, -1.859022e+00, ...,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176a56b80>, array([[[ 1.8854189 , -1.3444659 , -3.9229677 , ...,  ...1921527e+00, -2.11265850e+00, ...,
         -1.41622379e-01,  6.36737466e-01,  1.23764479e+00]]],
      dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cuda-0.0-True-32-8-27-11-8] _______________

batch_size = 8, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.0, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = True
current_input_id = '8-11-27-8-32-True-0.0-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.0
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-True-0.0-cuda().npy'>
input_dim  = 27
k          = array([[[ 4.64545965e-01, -2.96472162e-01, -6.37594005e-03, ...,
          8.83141875e-01,  1.88531184e+00, -6.1863774...70587523e-02, -1.71661545e-02, ...,
         -1.40956357e-01, -1.46573985e+00, -9.60531652e-01]]],
      dtype=float32)
label_result = array([[[-7.6738834e-01,  1.2576637e+00,  4.0786333e+00, ...,
         -3.3998165e-01,  4.5593637e-01,  3.5968187e-01]...23e+00, -1.2630752e+00,  5.2294618e-01, ...,
         -6.0853899e-01, -3.4653953e-01, -6.4410287e-01]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-True-0.0-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb17698b4c0>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.07931643,  0.34981483,  1.627947  , ...,  0.13004941,
          1.3878478 ,  0.7909228 ]]], dtype=float32)
result     = array([[[-1.7508776e+00, -2.5629845e+00,  2.7685773e+00, ...,
         -1.5953350e-01, -1.4444786e+00, -5.0518781e-01]...13e-04,  6.2405860e-01, -1.2010614e+00, ...,
          3.2106066e-01,  1.0792786e+00, -1.0880781e+00]]], dtype=float32)
seq_len    = 11
v          = array([[[-0.18071565, -0.93578744, -0.1328542 , ...,  0.21799618,
          0.3303766 , -0.71756196],
        [-1.2459...
        [ 0.25303677,  0.72302336,  0.13070038, ..., -0.46647197,
          1.0845269 ,  0.7676009 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176a56940>, array([[[-1.7508776e+00, -2.5629845e+00,  2.7685773e+0...3e+00, -1.2630752e+00,  5.2294618e-01, ...,
         -6.0853899e-01, -3.4653953e-01, -6.4410287e-01]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 2376 / 2376 (100%)
E           Max absolute difference: 8.308763
E           Max relative difference: 5674.945
E            x: array([[[-1.750878e+00, -2.562984e+00,  2.768577e+00, ...,
E                    -1.595335e-01, -1.444479e+00, -5.051878e-01],
E                   [-1.713299e+00, -1.214198e+00,  2.572685e+00, ...,...
E            y: array([[[-7.673883e-01,  1.257664e+00,  4.078633e+00, ...,
E                    -3.399816e-01,  4.559364e-01,  3.596819e-01],
E                   [-1.668350e+00,  7.955310e-01,  3.222339e+00, ...,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176a56940>, array([[[-1.7508776e+00, -2.5629845e+00,  2.7685773e+0...3e+00, -1.2630752e+00,  5.2294618e-01, ...,
         -6.0853899e-01, -3.4653953e-01, -6.4410287e-01]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cuda-0.1-False-32-8-27-5-4] _______________

batch_size = 4, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.1, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = False
current_input_id = '4-5-27-8-32-False-0.1-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-False-0.1-cuda().npy'>
input_dim  = 27
k          = array([[[-0.17591418, -0.81691647, -0.38043165, -1.4896185 ,
         -0.3424145 ,  0.5975326 , -0.55117905, -0.862665...  -0.12426752,  1.3688309 , -0.28665462,  1.8718244 ,
          1.2692264 ,  1.2295368 , -0.991682  ]]], dtype=float32)
label_result = array([[[ 2.934638  ,  0.44954175,  2.7100496 , -0.12178469,
         -2.2799354 ,  1.3231927 , -0.14751914, -0.227303...  -0.09449179, -0.91556466, -0.95614535,  0.9918786 ,
         -0.85825616, -0.31948107,  0.49116245]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-False-0.1-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb1769b3550>
num_head   = 8
q          = array([[[-8.04154854e-03,  6.31518424e-01,  2.25275445e+00,
         -7.59383500e-01, -6.42755508e-01, -1.04077518e+00...,  5.16363382e-01, -4.79716718e-01,
          7.03656971e-01,  1.89074099e-01, -1.07197821e+00]]],
      dtype=float32)
result     = array([[[ 1.15931761e+00,  2.67736936e+00,  8.63862991e-01,
         -3.45565438e-01,  8.71940255e-01,  5.40359139e-01...,  1.47021973e+00,  1.00337781e-01,
          8.77430737e-01,  1.13272369e+00,  5.61448559e-03]]],
      dtype=float32)
seq_len    = 5
v          = array([[[-1.32029665e+00,  3.13428760e-01,  3.91371369e-01,
         -1.15919903e-01, -1.81199983e-01,  1.58794081e+00...,  6.39540374e-01,  1.90380514e-01,
         -7.48570561e-02,  2.28314137e+00, -8.06154013e-01]]],
      dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176a0a040>, array([[[ 1.15931761e+00,  2.67736936e+00,  8.63862991... -0.09449179, -0.91556466, -0.95614535,  0.9918786 ,
         -0.85825616, -0.31948107,  0.49116245]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 540 / 540 (100%)
E           Max absolute difference: 7.79678
E           Max relative difference: 501.54437
E            x: array([[[ 1.159318e+00,  2.677369e+00,  8.638630e-01, -3.455654e-01,
E                     8.719403e-01,  5.403591e-01,  7.094051e-01, -1.090203e+00,
E                    -1.853167e+00,  2.115197e-01,  2.196263e+00,  4.791695e-02,...
E            y: array([[[ 2.934638,  0.449542,  2.71005 , -0.121785, -2.279935,
E                     1.323193, -0.147519, -0.227303,  3.561443,  0.389996,
E                     2.331521, -2.525776, -0.628981, -0.837106, -3.046322,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176a0a040>, array([[[ 1.15931761e+00,  2.67736936e+00,  8.63862991... -0.09449179, -0.91556466, -0.95614535,  0.9918786 ,
         -0.85825616, -0.31948107,  0.49116245]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cuda-0.1-False-32-8-27-5-8] _______________

batch_size = 8, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.1, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = False
current_input_id = '8-5-27-8-32-False-0.1-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-False-0.1-cuda().npy'>
input_dim  = 27
k          = array([[[-1.3202966 ,  0.31342876,  0.39137137, ..., -0.05047274,
         -0.37128997,  0.06527077],
        [-1.0428...
        [ 0.7475417 , -0.12896587, -0.21562193, ..., -0.4836035 ,
          0.526678  ,  0.26005384]]], dtype=float32)
label_result = array([[[-1.34418   , -0.29734764, -0.73432344, ..., -0.6605536 ,
          1.3073809 ,  0.8877824 ],
        [-2.1590...
        [-0.76380044,  1.1710814 ,  0.9176476 , ..., -0.25005147,
          0.5448774 ,  0.4073379 ]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-False-0.1-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb1769b8040>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.6823758 , -0.6566193 ,  0.32996404, ...,  1.2692264 ,
          1.2295368 , -0.991682  ]]], dtype=float32)
result     = array([[[ 1.7573109 ,  0.7188602 , -2.0107505 , ...,  0.4874693 ,
          0.8902503 , -0.5454961 ],
        [-0.7833...
        [-1.4106017 , -4.020298  , -0.68143094, ..., -0.40422353,
          4.8815327 , -2.186045  ]]], dtype=float32)
seq_len    = 5
v          = array([[[-0.05705854, -1.8222909 ,  0.37688625, ..., -0.30623534,
         -0.7493343 , -0.15542848],
        [ 2.5435...
        [-0.59417653, -0.05847015, -0.01491287, ...,  0.67793965,
          0.08334691,  0.17072625]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176a0a310>, array([[[ 1.7573109 ,  0.7188602 , -2.0107505 , ...,  ...        [-0.76380044,  1.1710814 ,  0.9176476 , ..., -0.25005147,
          0.5448774 ,  0.4073379 ]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1080 / 1080 (100%)
E           Max absolute difference: 6.3069553
E           Max relative difference: 2932.2637
E            x: array([[[ 1.757311,  0.71886 , -2.010751, ...,  0.487469,  0.89025 ,
E                    -0.545496],
E                   [-0.783388,  1.599858, -0.323495, ...,  0.150905,  0.035989,...
E            y: array([[[-1.34418 , -0.297348, -0.734323, ..., -0.660554,  1.307381,
E                     0.887782],
E                   [-2.159029,  0.659327,  0.377896, ..., -0.840011,  0.414792,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176a0a310>, array([[[ 1.7573109 ,  0.7188602 , -2.0107505 , ...,  ...        [-0.76380044,  1.1710814 ,  0.9176476 , ..., -0.25005147,
          0.5448774 ,  0.4073379 ]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
______________ test_attention_layer[cuda-0.1-False-32-8-27-11-4] _______________

batch_size = 4, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.1, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = False
current_input_id = '4-11-27-8-32-False-0.1-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-False-0.1-cuda().npy'>
input_dim  = 27
k          = array([[[ 3.31167579e-01, -1.21368361e+00, -1.94302607e+00, ...,
         -3.49218071e-01, -9.10320699e-01,  2.0637938...49814832e-01,  1.62794697e+00, ...,
          1.30049407e-01,  1.38784778e+00,  7.90922821e-01]]],
      dtype=float32)
label_result = array([[[ 1.1349123e+00, -1.5840460e+00, -3.1854000e+00, ...,
         -1.8324608e+00, -1.0809392e+00, -8.0918860e-01]...80e+00, -1.9234449e+00, -2.2858944e+00, ...,
         -1.3492963e-01,  7.4084121e-01,  1.4316832e+00]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-False-0.1-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb176a3cb80>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 3.4161992 ,  0.04355975, -0.76129997, ...,  0.59368753,
          0.31795904,  0.14328356]]], dtype=float32)
result     = array([[[ 2.1161156 ,  2.06533   , -0.46164984, ...,  1.5772607 ,
         -0.17069604,  0.9915622 ],
        [-1.4310...
        [-0.60733896,  0.78120756, -0.8462763 , ...,  0.01086191,
          0.32768893,  0.16622685]]], dtype=float32)
seq_len    = 11
v          = array([[[ 0.46454597, -0.29647216, -0.00637594, ...,  0.8831419 ,
          1.8853118 , -0.61863774],
        [-0.3089...
        [-0.10503879, -1.4589338 , -0.06638545, ..., -0.8672699 ,
          0.8674379 ,  1.4639174 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176a0aca0>, array([[[ 2.1161156 ,  2.06533   , -0.46164984, ...,  ...0e+00, -1.9234449e+00, -2.2858944e+00, ...,
         -1.3492963e-01,  7.4084121e-01,  1.4316832e+00]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1188 / 1188 (100%)
E           Max absolute difference: 6.489438
E           Max relative difference: 2937.7341
E            x: array([[[ 2.116116,  2.06533 , -0.46165 , ...,  1.577261, -0.170696,
E                     0.991562],
E                   [-1.43103 , -0.546311,  0.427665, ...,  1.491289, -2.669833,...
E            y: array([[[ 1.134912e+00, -1.584046e+00, -3.185400e+00, ...,
E                    -1.832461e+00, -1.080939e+00, -8.091886e-01],
E                   [ 2.013415e+00, -2.546045e+00, -4.875771e-02, ...,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176a0aca0>, array([[[ 2.1161156 ,  2.06533   , -0.46164984, ...,  ...0e+00, -1.9234449e+00, -2.2858944e+00, ...,
         -1.3492963e-01,  7.4084121e-01,  1.4316832e+00]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
______________ test_attention_layer[cuda-0.1-False-32-8-27-11-8] _______________

batch_size = 8, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = False, dropout = 0.1, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = False
current_input_id = '8-11-27-8-32-False-0.1-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-False-0.1-cuda().npy'>
input_dim  = 27
k          = array([[[ 4.64545965e-01, -2.96472162e-01, -6.37594005e-03, ...,
          8.83141875e-01,  1.88531184e+00, -6.1863774...70587523e-02, -1.71661545e-02, ...,
         -1.40956357e-01, -1.46573985e+00, -9.60531652e-01]]],
      dtype=float32)
label_result = array([[[ 2.37022305e+00, -5.30358553e-01, -1.93081534e+00, ...,
         -3.15548003e-01,  4.43342447e+00,  1.2920632...42766666e+00,  4.06287730e-01, ...,
         -7.07697928e-01, -9.39381719e-02, -4.77803677e-01]]],
      dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-False-0.1-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb1769b3400>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.07931643,  0.34981483,  1.627947  , ...,  0.13004941,
          1.3878478 ,  0.7909228 ]]], dtype=float32)
result     = array([[[-0.3650774 ,  0.79729927,  0.42543605, ..., -0.78490365,
          0.45402238,  0.21651195],
        [-0.4745...
        [-0.6892058 , -0.39755556, -1.1409696 , ...,  0.6002583 ,
          0.8171405 , -1.0051342 ]]], dtype=float32)
seq_len    = 11
v          = array([[[-0.18071565, -0.93578744, -0.1328542 , ...,  0.21799618,
          0.3303766 , -0.71756196],
        [-1.2459...
        [ 0.25303677,  0.72302336,  0.13070038, ..., -0.46647197,
          1.0845269 ,  0.7676009 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176a56940>, array([[[-0.3650774 ,  0.79729927,  0.42543605, ..., -...2766666e+00,  4.06287730e-01, ...,
         -7.07697928e-01, -9.39381719e-02, -4.77803677e-01]]],
      dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 2376 / 2376 (100%)
E           Max absolute difference: 7.2609816
E           Max relative difference: 2502.525
E            x: array([[[-0.365077,  0.797299,  0.425436, ..., -0.784904,  0.454022,
E                     0.216512],
E                   [-0.47454 ,  0.003377,  2.010798, ..., -0.73309 , -0.181145,...
E            y: array([[[ 2.370223e+00, -5.303586e-01, -1.930815e+00, ...,
E                    -3.155480e-01,  4.433424e+00,  1.292063e+00],
E                   [-1.364769e+00, -4.587599e-01, -1.173034e-01, ...,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176a56940>, array([[[-0.3650774 ,  0.79729927,  0.42543605, ..., -...2766666e+00,  4.06287730e-01, ...,
         -7.07697928e-01, -9.39381719e-02, -4.77803677e-01]]],
      dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cuda-0.1-True-32-8-27-5-4] ________________

batch_size = 4, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.1, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = True
current_input_id = '4-5-27-8-32-True-0.1-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-True-0.1-cuda().npy'>
input_dim  = 27
k          = array([[[-0.17591418, -0.81691647, -0.38043165, -1.4896185 ,
         -0.3424145 ,  0.5975326 , -0.55117905, -0.862665...  -0.12426752,  1.3688309 , -0.28665462,  1.8718244 ,
          1.2692264 ,  1.2295368 , -0.991682  ]]], dtype=float32)
label_result = array([[[ 1.28162801e+00, -1.33264995e+00, -2.39378119e+00,
         -4.35591412e+00,  7.40054250e-01,  2.37147737e+00..., -9.56145346e-01,  9.91878629e-01,
         -8.58256161e-01, -3.19481075e-01,  4.91162449e-01]]],
      dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-5-27-8-32-True-0.1-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb176a03160>
num_head   = 8
q          = array([[[-8.04154854e-03,  6.31518424e-01,  2.25275445e+00,
         -7.59383500e-01, -6.42755508e-01, -1.04077518e+00...,  5.16363382e-01, -4.79716718e-01,
          7.03656971e-01,  1.89074099e-01, -1.07197821e+00]]],
      dtype=float32)
result     = array([[[ 9.46975172e-01,  4.76853991e+00,  9.96734917e-01,
          6.66983366e-01, -1.80282462e+00, -9.96652782e-01...,  1.47021973e+00,  1.00337781e-01,
          8.77430737e-01,  1.13272369e+00,  5.61448559e-03]]],
      dtype=float32)
seq_len    = 5
v          = array([[[-1.32029665e+00,  3.13428760e-01,  3.91371369e-01,
         -1.15919903e-01, -1.81199983e-01,  1.58794081e+00...,  6.39540374e-01,  1.90380514e-01,
         -7.48570561e-02,  2.28314137e+00, -8.06154013e-01]]],
      dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb1770f4a60>, array([[[ 9.46975172e-01,  4.76853991e+00,  9.96734917... -9.56145346e-01,  9.91878629e-01,
         -8.58256161e-01, -3.19481075e-01,  4.91162449e-01]]],
      dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 540 / 540 (100%)
E           Max absolute difference: 10.386256
E           Max relative difference: 501.54437
E            x: array([[[ 9.469752e-01,  4.768540e+00,  9.967349e-01,  6.669834e-01,
E                    -1.802825e+00, -9.966528e-01, -2.415492e+00, -4.579788e-01,
E                     3.742263e+00,  1.515466e+00,  6.160998e-01, -2.144943e+00,...
E            y: array([[[ 1.281628e+00, -1.332650e+00, -2.393781e+00, -4.355914e+00,
E                     7.400542e-01,  2.371477e+00,  1.717367e+00, -3.334369e-01,
E                     1.870164e+00,  1.666961e+00,  2.284678e+00, -3.151788e+00,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb1770f4a60>, array([[[ 9.46975172e-01,  4.76853991e+00,  9.96734917... -9.56145346e-01,  9.91878629e-01,
         -8.58256161e-01, -3.19481075e-01,  4.91162449e-01]]],
      dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cuda-0.1-True-32-8-27-5-8] ________________

batch_size = 8, seq_len = 5, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.1, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = True
current_input_id = '8-5-27-8-32-True-0.1-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-True-0.1-cuda().npy'>
input_dim  = 27
k          = array([[[-1.3202966 ,  0.31342876,  0.39137137, ..., -0.05047274,
         -0.37128997,  0.06527077],
        [-1.0428...
        [ 0.7475417 , -0.12896587, -0.21562193, ..., -0.4836035 ,
          0.526678  ,  0.26005384]]], dtype=float32)
label_result = array([[[-5.84021568e-01,  1.45252645e-02, -3.29604793e+00, ...,
         -3.61437225e+00,  1.04311121e+00, -3.5872995...17108142e+00,  9.17647600e-01, ...,
         -2.50051469e-01,  5.44877410e-01,  4.07337904e-01]]],
      dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-5-27-8-32-True-0.1-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb17711c550>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.6823758 , -0.6566193 ,  0.32996404, ...,  1.2692264 ,
          1.2295368 , -0.991682  ]]], dtype=float32)
result     = array([[[-1.6375222 , -0.63763636, -1.566331  , ..., -0.42596185,
          1.6093522 , -1.0814186 ],
        [-1.4392...
        [-1.4106017 , -4.020298  , -0.68143094, ..., -0.40422353,
          4.8815327 , -2.186045  ]]], dtype=float32)
seq_len    = 5
v          = array([[[-0.05705854, -1.8222909 ,  0.37688625, ..., -0.30623534,
         -0.7493343 , -0.15542848],
        [ 2.5435...
        [-0.59417653, -0.05847015, -0.01491287, ...,  0.67793965,
          0.08334691,  0.17072625]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176a0a310>, array([[[-1.6375222 , -0.63763636, -1.566331  , ..., -...7108142e+00,  9.17647600e-01, ...,
         -2.50051469e-01,  5.44877410e-01,  4.07337904e-01]]],
      dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1080 / 1080 (100%)
E           Max absolute difference: 7.8294115
E           Max relative difference: 18714.281
E            x: array([[[-1.637522, -0.637636, -1.566331, ..., -0.425962,  1.609352,
E                    -1.081419],
E                   [-1.43926 ,  0.049064,  0.078644, ..., -2.263646,  1.061476,...
E            y: array([[[-5.840216e-01,  1.452526e-02, -3.296048e+00, ...,
E                    -3.614372e+00,  1.043111e+00, -3.587300e-01],
E                   [-9.999741e-01,  7.736129e-01, -7.227104e-01, ...,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176a0a310>, array([[[-1.6375222 , -0.63763636, -1.566331  , ..., -...7108142e+00,  9.17647600e-01, ...,
         -2.50051469e-01,  5.44877410e-01,  4.07337904e-01]]],
      dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cuda-0.1-True-32-8-27-11-4] _______________

batch_size = 4, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.1, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 4
causal     = True
current_input_id = '4-11-27-8-32-True-0.1-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-True-0.1-cuda().npy'>
input_dim  = 27
k          = array([[[ 3.31167579e-01, -1.21368361e+00, -1.94302607e+00, ...,
         -3.49218071e-01, -9.10320699e-01,  2.0637938...49814832e-01,  1.62794697e+00, ...,
          1.30049407e-01,  1.38784778e+00,  7.90922821e-01]]],
      dtype=float32)
label_result = array([[[-3.2658248 ,  1.9407164 , -2.0358129 , ..., -2.824458  ,
          2.8177793 ,  1.2496612 ],
        [-1.4604...
        [ 1.930138  , -1.9234449 , -2.2858944 , ..., -0.13492963,
          0.7408412 ,  1.4316832 ]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-4-11-27-8-32-True-0.1-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb176a64b80>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 3.4161992 ,  0.04355975, -0.76129997, ...,  0.59368753,
          0.31795904,  0.14328356]]], dtype=float32)
result     = array([[[ 1.238408  , -0.44155067, -3.4360466 , ...,  2.5634758 ,
         -3.8426678 , -2.332249  ],
        [ 0.6872...
        [-0.60733896,  0.78120756, -0.8462763 , ...,  0.01086191,
          0.32768893,  0.16622685]]], dtype=float32)
seq_len    = 11
v          = array([[[ 0.46454597, -0.29647216, -0.00637594, ...,  0.8831419 ,
          1.8853118 , -0.61863774],
        [-0.3089...
        [-0.10503879, -1.4589338 , -0.06638545, ..., -0.8672699 ,
          0.8674379 ,  1.4639174 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176a0a700>, array([[[ 1.238408  , -0.44155067, -3.4360466 , ...,  ...        [ 1.930138  , -1.9234449 , -2.2858944 , ..., -0.13492963,
          0.7408412 ,  1.4316832 ]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 1188 / 1188 (100%)
E           Max absolute difference: 8.833404
E           Max relative difference: 255.01054
E            x: array([[[ 1.238408, -0.441551, -3.436047, ...,  2.563476, -3.842668,
E                    -2.332249],
E                   [ 0.687233,  3.51325 , -0.373974, ..., -0.143805,  0.142957,...
E            y: array([[[-3.265825,  1.940716, -2.035813, ..., -2.824458,  2.817779,
E                     1.249661],
E                   [-1.46042 ,  2.729792, -2.27267 , ..., -2.328222,  2.80542 ,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176a0a700>, array([[[ 1.238408  , -0.44155067, -3.4360466 , ...,  ...        [ 1.930138  , -1.9234449 , -2.2858944 , ..., -0.13492963,
          0.7408412 ,  1.4316832 ]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
_______________ test_attention_layer[cuda-0.1-True-32-8-27-11-8] _______________

batch_size = 8, seq_len = 11, input_dim = 27, num_head = 8, dim_head = 32
causal = True, dropout = 0.1, device = cuda()

    @pytest.mark.parametrize("batch_size", [4, 8])
    @pytest.mark.parametrize("seq_len", [5, 11])
    @pytest.mark.parametrize("input_dim", [27])
    @pytest.mark.parametrize("num_head", [8])
    @pytest.mark.parametrize("dim_head", [32])
    @pytest.mark.parametrize("causal", [False, True])
    @pytest.mark.parametrize("dropout", [0.0, 0.1])
    @pytest.mark.parametrize("device", _DEVICES, ids=["cpu", "cuda"])
    def test_attention_layer(batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device):
    
        np.random.seed(19943)
    
        q = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        k = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
        v = np.random.randn(
            batch_size, seq_len, input_dim
        ).astype(np.float32)
    
        layer = nn.AttentionLayer(
            input_dim, num_head, dim_head,
            dropout=dropout, causal=causal, device=device)
    
        result = layer(
            ndl.Tensor(q, device=device),
            ndl.Tensor(k, device=device),
            ndl.Tensor(v, device=device),
        )
    
        result = result.numpy()
    
        current_input_id = "-".join([str(x) for x in (
            batch_size, seq_len, input_dim, num_head, dim_head, causal, dropout, device
        )])
    
        labels_path = (
            "./tests/hw4_extra/data/" +
            "test_attention_layer-{}.npy"
            .format(current_input_id))
    
        with open(labels_path, 'rb') as f:
            label_result = np.load(f)
    
>       np.testing.assert_allclose(result, label_result, atol=1e-5, rtol=1e-5)

batch_size = 8
causal     = True
current_input_id = '8-11-27-8-32-True-0.1-cuda()'
device     = cuda()
dim_head   = 32
dropout    = 0.1
f          = <_io.BufferedReader name='./tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-True-0.1-cuda().npy'>
input_dim  = 27
k          = array([[[ 4.64545965e-01, -2.96472162e-01, -6.37594005e-03, ...,
          8.83141875e-01,  1.88531184e+00, -6.1863774...70587523e-02, -1.71661545e-02, ...,
         -1.40956357e-01, -1.46573985e+00, -9.60531652e-01]]],
      dtype=float32)
label_result = array([[[-0.54865247,  1.1625483 ,  3.5370312 , ...,  0.0205907 ,
          0.34213138,  0.07224222],
        [-1.1799...
        [-1.8193636 , -1.4276667 ,  0.40628773, ..., -0.7076979 ,
         -0.09393817, -0.47780368]]], dtype=float32)
labels_path = './tests/hw4_extra/data/test_attention_layer-8-11-27-8-32-True-0.1-cuda().npy'
layer      = <needle.nn.nn_transformer.AttentionLayer object at 0x7fb17711efa0>
num_head   = 8
q          = array([[[-0.00804155,  0.6315184 ,  2.2527544 , ...,  0.57792866,
          1.2252008 , -1.2465482 ],
        [ 1.8416...
        [ 0.07931643,  0.34981483,  1.627947  , ...,  0.13004941,
          1.3878478 ,  0.7909228 ]]], dtype=float32)
result     = array([[[-1.3678005e+00, -2.4817986e+00,  3.6146562e+00, ...,
          5.4048139e-01, -1.4875273e+00, -3.9826873e-01]...83e-01, -3.9755556e-01, -1.1409696e+00, ...,
          6.0025829e-01,  8.1714052e-01, -1.0051342e+00]]], dtype=float32)
seq_len    = 11
v          = array([[[-0.18071565, -0.93578744, -0.1328542 , ...,  0.21799618,
          0.3303766 , -0.71756196],
        [-1.2459...
        [ 0.25303677,  0.72302336,  0.13070038, ..., -0.46647197,
          1.0845269 ,  0.7676009 ]]], dtype=float32)

tests/hw4_extra/test_transformer.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

args = (<function assert_allclose.<locals>.compare at 0x7fb176a433a0>, array([[[-1.3678005e+00, -2.4817986e+00,  3.6146562e+0...        [-1.8193636 , -1.4276667 ,  0.40628773, ..., -0.7076979 ,
         -0.09393817, -0.47780368]]], dtype=float32))
kwds = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}

    @wraps(func)
    def inner(*args, **kwds):
        with self._recreate_cm():
>           return func(*args, **kwds)
E           AssertionError: 
E           Not equal to tolerance rtol=1e-05, atol=1e-05
E           
E           Mismatched elements: 2376 / 2376 (100%)
E           Max absolute difference: 9.556066
E           Max relative difference: 1312.3219
E            x: array([[[-1.367800e+00, -2.481799e+00,  3.614656e+00, ...,
E                     5.404814e-01, -1.487527e+00, -3.982687e-01],
E                   [-1.251430e+00, -1.094189e+00,  2.000629e+00, ...,...
E            y: array([[[-0.548652,  1.162548,  3.537031, ...,  0.020591,  0.342131,
E                     0.072242],
E                   [-1.179979,  0.645918,  1.845055, ..., -0.584953,  0.704098,...

args       = (<function assert_allclose.<locals>.compare at 0x7fb176a433a0>, array([[[-1.3678005e+00, -2.4817986e+00,  3.6146562e+0...        [-1.8193636 , -1.4276667 ,  0.40628773, ..., -0.7076979 ,
         -0.09393817, -0.47780368]]], dtype=float32))
func       = <function assert_array_compare at 0x7fb1770ae1f0>
kwds       = {'equal_nan': True, 'err_msg': '', 'header': 'Not equal to tolerance rtol=1e-05, atol=1e-05', 'verbose': True}
self       = <contextlib._GeneratorContextManager object at 0x7fb177116b20>

/usr/lib/python3.8/contextlib.py:75: AssertionError
=============================== warnings summary ===============================
../../../../../../usr/lib/python3/dist-packages/urllib3/util/selectors.py:14
  /usr/lib/python3/dist-packages/urllib3/util/selectors.py:14: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated since Python 3.3, and in 3.9 it will stop working
    from collections import namedtuple, Mapping

../../../../../../usr/lib/python3/dist-packages/urllib3/_collections.py:2
  /usr/lib/python3/dist-packages/urllib3/_collections.py:2: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated since Python 3.3, and in 3.9 it will stop working
    from collections import Mapping, MutableMapping

python/needle/nn/nn_transformer.py:191
  /home/cc/file/dpsys/deeplearning-sys-pj-master/hw4_extra/python/needle/nn/nn_transformer.py:191: SyntaxWarning: "is not" with a literal. Did you mean "!="?
    if len(x.shape) is not 2:

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-False-32-8-27-5-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-False-32-8-27-5-8]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-False-32-8-27-11-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-False-32-8-27-11-8]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-True-32-8-27-5-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-True-32-8-27-5-8]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-True-32-8-27-11-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.0-True-32-8-27-11-8]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-False-32-8-27-5-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-False-32-8-27-5-8]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-False-32-8-27-11-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-False-32-8-27-11-8]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-True-32-8-27-5-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-True-32-8-27-5-8]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-True-32-8-27-11-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cpu-0.1-True-32-8-27-11-8]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-False-32-8-27-5-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-False-32-8-27-5-8]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-False-32-8-27-11-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-False-32-8-27-11-8]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-True-32-8-27-5-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-True-32-8-27-5-8]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-True-32-8-27-11-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.0-True-32-8-27-11-8]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-False-32-8-27-5-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-False-32-8-27-5-8]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-False-32-8-27-11-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-False-32-8-27-11-8]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-True-32-8-27-5-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-True-32-8-27-5-8]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-True-32-8-27-11-4]
FAILED tests/hw4_extra/test_transformer.py::test_attention_layer[cuda-0.1-True-32-8-27-11-8]
================ 32 failed, 80 deselected, 3 warnings in 1.86s =================
